<Location "/">

	# Netscape 4.x has some problems...
	BrowserMatch ^Mozilla/4 gzip-only-text/html

	# Netscape 4.06-4.08 have some more problems
	BrowserMatch ^Mozilla/4\.0[678] no-gzip

	# MSIE masquerades as Netscape, but it is fine
	# BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

	# NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
	# the above regex won't work. You can use the following
	# workaround to get the desired effect:
	BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

	# Don't compress images
	SetEnvIfNoCase Request_URI \
	\.(?:gif|jpe?g|png|plist|py)$ no-gzip dont-vary

	# Make sure proxies don't deliver the wrong content
	Header append Vary User-Agent env=!dont-vary
	
	# Turn off Keep-Alive for Safari (workaround for ##4876179)
	BrowserMatch WebKit SafariUploadWorkaround
	BrowserMatch WebKit proxy-nokeepalive=1
	RequestHeader set Connection close env=SafariUploadWorkaround
	
	# ETags (modtime and file size only)
	FileETag MTime Size
</Location>

<Location /wiki>
	RequestHeader add X-Forwarded-Path-Stem /wiki
</Location>

<IfModule mod_expires.c>
	<FilesMatch "\.(jpg|jpeg|gif|png|css|js|ico)$">
		ExpiresActive on
		ExpiresDefault "access plus 1 year"
	</FilesMatch>
	<Location /wiki/files>
		ExpiresActive on
		ExpiresDefault "access plus 1 year"
	</Location>
	<Location /__collabd>
		ExpiresActive on
		ExpiresDefault "access plus 1 year"
		# Insert filter
		SetOutputFilter DEFLATE
	</Location>
</IfModule>

<IfModule mod_xsendfile.c>
    XSendFile on
    XSendFilePath /Library/Server/Wiki/FileData
</IfModule>

Alias /__collabd/coreclientbase "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/coreclientbase/public"
Alias /__collabd/coreclientauth "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/coreclientauth/public"
Alias /__collabd/coreclientdesktop "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/coreclientdesktop/public"
Alias /__collabd/coreclientwiki "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/coreclientwiki/public"
Alias /__collabd/coreclientmobile "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/coreclientmobile/public"
Alias /__collabd/xcodeshared "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/xcodeshared/public"
Alias /__collabd/webcal "/Applications/Server.app/Contents/ServerRoot/usr/share/collabd/webcal/public"
