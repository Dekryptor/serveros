<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>description</key>
	<string>Perform setup for Wiki Server</string>
	<key>dependencies</key>
	<array>
		<string>PostgreSQL</string>
		<string>servermgr_web_ConfigDone</string>
	</array>
	<key>environment</key>
	<dict>
		<key>collab_group_name</key>
		<string>_collaboration</string>
	</dict>
	<key>setup</key>
	<dict>
		<key>accounts</key>
		<dict>
			<key>${collab_group_name}</key>
			<dict>
				<key>name</key>
				<string>${collab_group_name}</string>
				<key>type</key>
				<string>group</string>
				<key>description</key>
				<string>Clients of collaboration server</string>
				<key>fullName</key>
				<string>Collaboration</string>
				<key>gid</key>
				<integer>223</integer> <!-- See com.apple.collabd.plist -->
			</dict>
		</dict>
		<key>scripts</key>
		<array>
			<dict>
				<key>path</key>
				<string>/usr/bin/dscl</string>
				<key>arguments</key>
				<array>
					<string>/Local/Default</string>
					<string>-create</string>
					<string>/Users/_teamsserver</string>
					<string>NFSHomeDirectory</string>
					<string>/dev/null</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>/usr/bin/dscl</string>
				<key>arguments</key>
				<array>
					<string>/Local/Default</string>
					<string>-merge</string>
					<string>/Groups/${collab_group_name}</string>
					<string>GroupMembership</string>
					<string>_devicemgr</string>
					<string>_calendar</string>
					<string>_teamsserver</string>
					<string>_www</string>
				</array>
			</dict>
		</array>
	</dict>
	<key>promotion</key>
	<dict>
		<key>scripts</key>
		<array>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/sbin/collabd_preflight</string>
				<key>arguments</key>
				<array/>
			</dict>
		</array>
	</dict>
	<key>migration</key>
	<dict>
		<key>scripts</key>
		<array>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/libexec/98-wikimigrator.rb</string>
				<key>arguments</key>
				<array>
					<string>--sourceRoot</string>
					<string>/Library/Server/Previous</string>
					<string>--targetRoot</string>
					<string>/</string>
					<string>--purge</string>
					<string>0</string>
					<string>--language</string>
					<string>en</string>
					<string>--sourceType</string>
					<string>System</string>
					<string>--sourceVersion</string>
					<string>${previousSystemVersion}</string>
				</array>
			</dict>
		</array>
	</dict>
	<key>postSetup</key>
	<dict>
		<key>scripts</key>
		<array>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/sbin/collabd_database_loader</string>
				<key>arguments</key>
				<array>
					<string>--mode</string>
					<string>start</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/sbin/collabd_database_loader</string>
				<key>arguments</key>
				<array>
					<string>--mode</string>
					<string>stop</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/bin/wikiadmin</string>
				<key>arguments</key>
				<array>
					<string>updateSchema</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/sbin/serveradmin</string>
				<key>arguments</key>
				<array>
					<string>stop</string>
					<string>collabd</string>
				</array>
			</dict>
			<dict>
				<key>description</key>
				<string>Clean up any derelict _teamsserver processes</string>
				<key>path</key>
				<string>${serverRoot}/usr/libexec/terminate</string>
				<key>arguments</key>
				<array>
					<string>_teamsserver</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/sbin/serveradmin</string>
				<key>arguments</key>
				<array>
					<string>start</string>
					<string>collabd</string>
				</array>
			</dict>
			<dict>
				<key>path</key>
				<string>${serverRoot}/usr/libexec/restore_webapp_state</string>
				<key>arguments</key>
				<array>
					<string>com.apple.webapp.wiki</string>
					<string>com.apple.webapp.wiki</string>
					<string>com.apple.webapp.collab</string>
				</array>
			</dict>
		</array>
	</dict>
</dict>
</plist>
