#!/Applications/Server.app/Contents/ServerRoot/Library/CalendarServer/bin/python
#
# Preflight script for calendar server from Lion Server and earlier only.
#
# Copyright (c) 2005-2015 Apple Inc.  All Rights Reserved.
#
# IMPORTANT NOTE:  This file is licensed only for use on Apple-labeled
# computers and is subject to the terms and conditions of the Apple
# Software License Agreement accompanying the package this file is a
# part of.  You may not port this file to another platform without
# Apple's written consent.

from __future__ import print_function

import os
from calendar_setup_util import log


def main():

    # Remove obsolete webapp plists
    obsoletes = [
        "/Library/Server/Previous/private/etc/apache2/webapps/org.calendarserver.plist",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.contacts.plist",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.contacts.plist.default",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.contactsssl.plist",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.contactsssl.plist.default",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.webcal.plist",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.webcalssl.plist",
        "/Library/Server/Previous/private/etc/apache2/webapps/com.apple.webapp.webcal.webssl.plist",
    ]
    for plistPath in obsoletes:
        log("Looking for {}".format(plistPath))
        if os.path.exists(plistPath):
            log("Obsolete plist exists: {}".format(plistPath))
            try:
                os.remove(plistPath)
                log("Removed {}".format(plistPath))
            except Exception, e:
                log("Failed to remove {}: {}".format(plistPath, e))



if __name__ == '__main__':
    main()
