// Copyright (c) 2009-2014 Apple Inc. All Rights Reserved.
// 
// IMPORTANT NOTE: This file is licensed only for use on Apple-branded
// computers and is subject to the terms and conditions of the Apple Software
// License Agreement accompanying the package this file is a part of.
// You may not port this file to another platform without Apple's written consent.
//
// IMPORTANT NOTE: This file is licensed only for use with the Wiki Server feature
// of the Apple Software and is subject to the terms and conditions of the Apple
// Software License Agreement accompanying the package this file is part of.

/**
*
* Copyright Â© 2009 -2014-2014 Apple Inc.  All rights reserved.
*
**/

/* iAd JS Version: 1.5 -  */
var iAd={};iAd.VERSION="1.5";iAd.Utils={};iAd.Utils.copyPropertiesFromSourceToTarget=function(a,b){for(var c in a)b[c]=a[c]};iAd.Utils.objectIsFunction=function(a){return typeof a=="function"};iAd.Utils.objectIsString=function(a){return typeof a=="string"||a instanceof String};iAd.Utils.objectIsArray=function(a){return a instanceof Array};iAd.Utils.objectIsPrimitive=function(a){return a==null||typeof a=="number"||typeof a=="boolean"||this.objectIsString(a)};
iAd.Utils.objectHasMethod=function(a,b){return a!=null&&a[b]!==undefined&&this.objectIsFunction(a[b])};iAd.Utils.resolveObjectPathFrom=function(a,b,c){if(!(!b||b[0]==".")){b=b.split(".");for(var d,e,f=0,g=b.length;a!=null&&f<g;f++){e=b[f];d=a[e];if(c&&d==null)d=a[e]={};a=d}return a}};iAd.Utils.resolveObjectPath=function(a,b){return iAd.Utils.resolveObjectPathFrom(window,a,b)};
iAd.Utils.setupDisplayNames=function(a,b){b=b||a.displayName||a.name;for(var c in a)if(!a.__lookupGetter__(c)){var d=a[c];if(iAd.Utils.objectIsFunction(d))d.displayName=iAd.Utils.createDisplayName(b,c)}for(c in a.prototype)if(!a.prototype.__lookupGetter__(c)){d=a.prototype[c];if(iAd.Utils.objectIsFunction(d))d.displayName=iAd.Utils.createDisplayName(b,c,true)}};iAd.Utils.createDisplayName=function(a,b,c){return a+(c?".":"#")+b+"()"};iAd.Utils.setupDisplayNames(iAd.Utils,"iAd.Utils");iAd.Path={};
iAd.Path.HIDPI_SUFFIX="@2x";iAd.Path.escapeRegExp=function(a){var b=RegExp("[.*+?|()\\[\\]{}\\\\]","g");return a.replace(b,"\\$&")};
iAd.Path.appendHiDPISuffix=function(a){var b="("+iAd.Path.escapeRegExp(iAd.Path.HIDPI_SUFFIX)+"|"+iAd.Path.escapeRegExp(encodeURIComponent(iAd.Path.HIDPI_SUFFIX))+")(\\.[^\\./]+)?$";if(!RegExp(b,"i").test(a))if(/~ipad/.test(a)){b=a.lastIndexOf("~ipad");a=a.substr(0,b)+iAd.Path.HIDPI_SUFFIX+a.substr(b)}else if(/\.[^\.\/]+/.test(a)){b=a.lastIndexOf(".");a=a.substr(0,b)+iAd.Path.HIDPI_SUFFIX+a.substr(b)}else a+=iAd.Path.HIDPI_SUFFIX;return a};iAd.Path.HREF_PROXY=null;
iAd.Path.resolveAbsolutePath=function(a){if(!iAd.Path.HREF_PROXY)iAd.Path.HREF_PROXY=document.createElement("a");var b=iAd.Path.HREF_PROXY;b.href=a;return b.href};iAd.Path.objectToQueryString=function(a,b){return iAd.Path.objectToQueryStringForKey(a,b,null)};
iAd.Path.objectToQueryStringForKey=function(a,b,c){b=b||"&";c=c||"";if(iAd.Utils.objectIsPrimitive(a)){a=a?encodeURIComponent(a):"";if(c&&a)return encodeURIComponent(c)+"="+a;return a}var d=[],e=c;if(iAd.Utils.objectIsArray(a)){if(e)e+="[]";c=0;for(var f=a.length;c<f;c++)d.push(iAd.Path.objectToQueryStringForKey(a[c],b,e))}else if(typeof a=="object")for(c in a)d.push(iAd.Path.objectToQueryStringForKey(a[c],b,e?e+"["+c+"]":c));return d.join(b)};
Object.defineProperty(iAd.Path,"assetsPath",{get:function(){if(this._assetsPath)return this._assetsPath;for(var a=/\/?iAd(-\w+)?\.cssz?(\?.*)?$/,b,c,d=0,e=document.styleSheets.length;d<e;d++){b=document.styleSheets[d];if(b.href){b=b.href.split("/");c=b.pop();if(a.test(c)){b.push("assets/");return this._assetsPath=b.join("/")}}}},set:function(a){this._assetsPath=a}});iAd.Utils.setupDisplayNames(iAd.Path,"iAd.Path");iAd.Console={};
iAd.Console.log=function(){window.console&&console.log&&console.log.apply(console,arguments)};iAd.Console._log=function(a,b){if(window.console&&console[a])console[a].apply(console,b);else{b=Array.prototype.slice.call(b);b.unshift(a.toUpperCase()+":");iAd.Console.log.apply(iAd.Console,b)}};iAd.Console.warn=function(){iAd.Console._log("warn",arguments)};iAd.Console.error=function(){iAd.Console._log("error",arguments)};iAd.Console.debug=function(){iAd.Console._log("debug",arguments)};
iAd.Console.info=function(){iAd.Console._log("info",arguments)};
iAd.Class=function(a){if(typeof a==="string")a={name:a};a=a||{};a.symbol=a.symbol===undefined?a.name:a.symbol;a.name=a.name||"AnonymousClass";if(!a.superclass)if("superclass"in a)throw new ReferenceError("An undefined superclass was provided for "+a.name);else if(iAd.Object)a.superclass=iAd.Object;var b=function(){b.processed||iAd.Class.processAllClasses();b.prototype.init.apply(this,arguments)};b.processed=false;iAd.Class.unprocessedClasses.push(b);b.displayName=b._name=a.name;iAd.Utils.copyPropertiesFromSourceToTarget(a,
b);if(a.symbol&&typeof a.symbol==="string"){var c=a.symbol.split(".");a=c.pop();if(c=c.length?iAd.Utils.resolveObjectPath(c.join("."),true):window)c[a]=b}return b};iAd.Class.unprocessedClasses=[];iAd.Class.processAllClasses=function(){for(var a,b=0,c=iAd.Class.unprocessedClasses.length;b<c;b++){a=iAd.Class.unprocessedClasses[b];a.processed||iAd.Class.processClassAndHierarchy(a)}iAd.Class.unprocessedClasses=[]};
iAd.Class.processClassAndHierarchy=function(a){for(var b=[a],c=a;c=c.superclass;)b.push(c);var d;for(c=b.length-1;c>=0;c--){d=b[c];d.processed||iAd.Class.processClass(d)}for(c=b.length-1;c>=0;c--){d=b[c];iAd.Utils.objectHasMethod(d,"initialize")&&d.initialize.apply(a)}};
iAd.Class.processClass=function(a){a.mixins&&iAd.Class.mixin(a.prototype,a.mixins);for(var b=a.synthesizedProperties||[],c=0,d=b.length;c<d;c++)iAd.Class.synthesizeProperty(a.prototype,b[c]);for(var e in a.prototype)iAd.Class.processMethod(a,e);for(e in a)iAd.Class.processClassMethod(a,e);if(a!==iAd.Object)a.prototype.__proto__=a.superclass.prototype;a.processed=true};
iAd.Class.synthesizeProperty=function(a,b){var c=b.charAt(0).toUpperCase()+b.substr(1),d="get"+c,e="set"+c,f="_"+b;iAd.Utils.objectHasMethod(a,e)||(a[e]=function(i){this[f]=i});c=function(i){this[e](i);this.notifyPropertyChange(b)};c.displayName="Setter for ."+b+" on "+a.constructor.displayName;iAd.Utils.objectHasMethod(a,d)||(a[d]=function(){return this[f]});var g=function(){return this[d]()};g.displayName="Getter for ."+b+" on "+a.constructor.displayName;Object.defineProperty(a,b,{get:g,set:c})};
iAd.Class.processMethod=function(a,b){var c=Object.getOwnPropertyDescriptor(a.prototype,b).value;if(iAd.Utils.objectIsFunction(c)){c._class=a;c._name=b;if(c.displayName==null)c.displayName=iAd.Utils.createDisplayName(a.displayName,b)}};iAd.Class.processClassMethod=function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);if(c){c=c.value;if(iAd.Utils.objectIsFunction(c)&&c.displayName==null)c.displayName=iAd.Utils.createDisplayName(a.displayName,b,true)}};
iAd.Class.mixin=function(a,b){for(var c,d=0,e=b.length;d<e;d++){c=b[d];for(var f in c)a.hasOwnProperty(f)||(a[f]=c[f])}};iAd.Class.synthesizeProperties=function(a,b){iAd.Class.processClassAndHierarchy(a);for(var c=0,d=b.length;c<d;c++)iAd.Class.synthesizeProperty(a.prototype,b[c])};iAd.Class.processMethods=function(a,b){iAd.Class.processClassAndHierarchy(a);for(var c=0,d=b.length;c<d;c++)iAd.Class.processMethod(a,b[c])};iAd.Utils.setupDisplayNames(iAd.Class,"iAd.Class");
iAd.Class({name:"iAd.Object",archivedProperties:["delegate","dataSource"]});iAd.Object.PROPERTY_CHANGED="handlePropertyChange";iAd.Object.prototype.init=function(){this.observedProperties={}};iAd.Object.DELEGATE_REG_EXP=/delegate/i;iAd.Object.DATA_SOURCE_REG_EXP=/dataSource/i;
iAd.Object.prototype.archiveProperty=function(a){var b=this[a];if(iAd.Object.DELEGATE_REG_EXP.test(a)||iAd.Object.DATA_SOURCE_REG_EXP.test(a)){if(iAd.ViewController&&b instanceof iAd.ViewController)return b.id;return b?iAd.Archiver.referenceForObject(b):null}return b};
iAd.Object.prototype.restoreProperty=function(a,b){if(iAd.Object.DELEGATE_REG_EXP.test(a)||iAd.Object.DATA_SOURCE_REG_EXP.test(a))b=iAd.ViewController&&iAd.ViewController.instances[b]?iAd.ViewController.instances[b]:iAd.Archiver.objectForReference(b);this[a]=b};
iAd.Object.prototype.callSuper=function(){var a=iAd.Object.prototype.callSuper.caller;if(iAd.Utils.objectHasMethod(a,"superclass"))a.superclass.apply(this,arguments);else{var b=a._class.superclass.prototype;a=a._name;if(iAd.Utils.objectHasMethod(b,a))return b[a].apply(this,arguments)}};iAd.Object.prototype.isPropertyObserved=function(a){return this.observedProperties[a]!==undefined};
iAd.Object.prototype.addPropertyObserver=function(a,b,c){var d=this.observedProperties[a];if(this.isPropertyObserved(a)){if(d.targets.indexOf(b)>-1)return}else d=this.observedProperties[a]={targets:[],methodNames:[]};c=c||iAd.Object.PROPERTY_CHANGED;if(iAd.Utils.objectHasMethod(b,c)){d.targets.push(b);d.methodNames.push(c)}};
iAd.Object.prototype.removePropertyObserver=function(a,b){if(!this.isPropertyObserved(a))return false;var c=this.observedProperties[a],d=c.targets.indexOf(b),e=d>-1;if(e){c.targets.splice(d,1);c.methodNames.splice(d,1);c.targets.length==0&&delete this.observedProperties[a]}return e};iAd.Object.prototype.notifyPropertyChange=function(a){if(this.isPropertyObserved(a)){var b=this.observedProperties[a],c=b.targets.slice();b=b.methodNames.slice();for(var d=0,e=c.length;d<e;d++)c[d][b[d]](this,a)}};
iAd.Object.prototype.callMethodNameAfterDelay=function(a,b){var c=this,d=Array.prototype.slice.call(arguments,2),e=function(){c[a].apply(c,d)};e.displayName=iAd.Utils.createDisplayName(this.constructor.displayName||this.constructor.name,a);return setTimeout(e,b*1E3)};iAd.Event={};iAd.Event.notificationEvents={};iAd.Event.registerForNotificationEvent=function(a){iAd.Event.notificationEvents[a]=true};iAd.Event.SUPPORTS_TOUCHES="createTouch"in document;
iAd.Event.START_EVENT=iAd.Event.SUPPORTS_TOUCHES?"touchstart":"mousedown";iAd.Event.MOVE_EVENT=iAd.Event.SUPPORTS_TOUCHES?"touchmove":"mousemove";iAd.Event.END_EVENT=iAd.Event.SUPPORTS_TOUCHES?"touchend":"mouseup";iAd.Event.CANCEL_EVENT="touchcancel";iAd.Event.createUIEvent=function(a,b){return iAd.Event.SUPPORTS_TOUCHES?this.createEventWithTouch(a,b):this.createEventWithMouse(a,b)};
iAd.Event.createEventWithTouch=function(a,b){var c=document.createEvent("TouchEvent");c.initTouchEvent(a,b.bubbles,b.cancelable,window,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.touches,b.targetTouches,b.changedTouches,b.scale,b.rotation);return c};
iAd.Event.createEventWithMouse=function(a,b){var c=document.createEvent("MouseEvent");c.initMouseEvent(a,b.bubbles,b.cancelable,document.defaultView,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.metaKey,b.button,b.relatedTarget);return c};iAd.Event.preventDefault=function(a){a.preventDefault()};iAd.Event.eventHandlerForString=function(a){var b=new Function(a);return function(c){b.call(null,c)}};iAd.Utils.setupDisplayNames(iAd.Event,"iAd.Event");
iAd.EventTarget={};iAd.EventTarget.addEventListener=function(a,b,c){if(this.eventTarget){iAd.Event.registerForNotificationEvent(a);this.eventTarget.addEventListener(a,b,c)}else iAd.Console.warn("iAd.EventTarget.addEventListener: cannot add event listener since no eventTarget was specified by the mixing object.")};iAd.EventTarget.removeEventListener=function(a,b,c){this.eventTarget?this.eventTarget.removeEventListener(a,b,c):iAd.Console.warn("iAd.EventTarget.removeEventListener: cannot remove event listener since no eventTarget was specified by the mixing object.")};
iAd.EventTarget.dispatchEvent=function(a){this.eventTarget?this.eventTarget.dispatchEvent(a):iAd.Console.warn("iAd.EventTarget.dispatchEvent: cannot dispatch event since no eventTarget was specified by the mixing object.")};iAd.EventTarget.dispatchNotification=function(a,b,c){this.notifyDelegate(a,b,c);this.createAndDispatchEvent(a,c)};iAd.EventTarget.notifyDelegate=function(a,b,c){if(iAd.Utils.objectHasMethod(b,a)){var d=[this];if(c)d=d.concat(c.map(function(e){return e[1]}));b[a].apply(b,d)}};
iAd.EventTarget.createEvent=function(a,b){var c=document.createEvent("Event");c.initEvent(a,true,false);if(!c.ad)c.ad={};c.ad.sender=this;if(b)for(var d=0,e=b.length;d<e;d++)c.ad[b[d][0]]=b[d][1];return c};iAd.EventTarget.createAndDispatchEvent=function(a,b){iAd.Event.notificationEvents[a]&&this.dispatchEvent(this.createEvent(a,b))};iAd.Utils.setupDisplayNames(iAd.EventTarget,"iAd.EventTarget");iAd.Class({name:"iAd.Point",archivedProperties:["x","y"]});
iAd.Point.prototype.init=function(a,b){this.callSuper();this.x=a!=null&&!isNaN(a)?a:0;this.y=b!=null&&!isNaN(b)?b:0};iAd.Point.fromEvent=function(a){a=a.touches&&a.touches.length>0?a.touches[0]:a;return new iAd.Point(a.pageX,a.pageY)};iAd.Point.fromEventInElement=function(a,b){a=a.touches&&a.touches.length>0?a.touches[0]:a;var c=window.webkitConvertPointFromPageToNode(b,new WebKitPoint(a.pageX,a.pageY));return new iAd.Point(c.x,c.y)};
iAd.Point.prototype.toString=function(){return"iAd.Point["+this.x+","+this.y+"]"};iAd.Point.prototype.copy=function(){return new iAd.Point(this.x,this.y)};iAd.Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};iAd.Class({name:"iAd.Size",archivedProperties:["width","height"]});iAd.Size.prototype.init=function(a,b){this.callSuper();this.width=a!=null&&!isNaN(a)?a:0;this.height=b!=null&&!isNaN(b)?b:0};iAd.Size.ZERO_SIZE=new iAd.Size(0,0);
iAd.Size.prototype.toString=function(){return"iAd.Size["+this.width+","+this.height+"]"};iAd.Size.prototype.copy=function(){return new iAd.Size(this.width,this.height)};iAd.Size.prototype.equals=function(a){return this.width==a.width&&this.height==a.height};iAd.Class({name:"iAd.Rect",archivedProperties:["origin","size"]});iAd.Rect.prototype.init=function(a,b,c,d){this.callSuper();this.origin=new iAd.Point(a||0,b||0);this.size=new iAd.Size(c||0,d||0)};iAd.Rect.ZERO_RECT=new iAd.Rect(0,0,0,0);
iAd.Rect.prototype.toString=function(){return"iAd.Rect["+[this.origin.x,this.origin.y,this.size.width,this.size.height].join(", ")+"]"};iAd.Rect.prototype.copy=function(){return new iAd.Rect(this.origin.x,this.origin.y,this.size.width,this.size.height)};iAd.Rect.prototype.equals=function(a){return this.origin.equals(a.origin)&&this.size.equals(a.size)};
iAd.Rect.prototype.inset=function(a){return new iAd.Rect(this.origin.x+a.left,this.origin.y+a.top,this.size.width-a.left-a.right,this.size.height-a.top-a.bottom)};iAd.Rect.prototype.minX=function(){return this.origin.x};iAd.Rect.prototype.minY=function(){return this.origin.y};iAd.Rect.prototype.midX=function(){return this.origin.x+this.size.width/2};iAd.Rect.prototype.midY=function(){return this.origin.y+this.size.height/2};iAd.Rect.prototype.maxX=function(){return this.origin.x+this.size.width};
iAd.Rect.prototype.maxY=function(){return this.origin.y+this.size.height};iAd.Rect.prototype.intersectionWithRect=function(a){var b=new iAd.Rect,c=Math.max(this.minX(),a.minX()),d=Math.min(this.maxX(),a.maxX());if(c>d)return iAd.Rect.ZERO_RECT;b.origin.x=c;b.size.width=d-c;c=Math.max(this.minY(),a.minY());a=Math.min(this.maxY(),a.maxY());if(c>a)return iAd.Rect.ZERO_RECT;b.origin.y=c;b.size.height=a-c;return b};iAd.Class({name:"iAd.EdgeInsets",archivedProperties:["top","right","bottom","left"]});
iAd.EdgeInsets.prototype.init=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};iAd.EdgeInsets.prototype.equals=function(a){return this.top==a.top&&this.right==a.right&&this.bottom==a.bottom&&this.left==a.left};iAd.CSS={};iAd.CSS.t=function(a,b){return iAd.CSS.t3d(a,b,0)};iAd.CSS.t3d=function(a,b,c){return"translate3d("+a+"px, "+b+"px, "+c+"px)"};iAd.CSS.r3d=function(a,b,c,d){return"rotate3d("+a+", "+b+", "+c+", "+d+"rad)"};
iAd.CSS.roundedPxValue=function(a){var b=window.devicePixelRatio;return(a*b|0)/b};iAd.CSS.tm=function(a,b){return"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+a+", "+b+", 0, 1)"};iAd.CSS.matrixFromString=function(a){var b="";if(a.length>0&&a!="none")b=a.replace(/([^(]*)\(([^)]*)\)/g,function(c,d,e){c=e.replace(/(\-?[0-9.]+(?:e\-?[0-9]+)?)([^,]*)/g,function(f,g,i){g=parseFloat(g);return g.toFixed(6)+i});return d+"("+c+")"});return new WebKitCSSMatrix(b)};
iAd.CSS.concatenateTransforms=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];d&&d!="none"&&a.push(d)}return a.join(" ")};iAd.CSS.isClassNameValid=function(a){return a!=null&&a!=""&&a===String(a).replace(/\s/g,"")};iAd.CSS.matrixEqualsToMatrix=function(a,b){for(var c=1;c<=4;c++)for(var d=1;d<=4;d++){var e="m"+c+d;if(a[e]!==b[e])return false}return true};
iAd.CSS.widthForTextAndFont=function(a,b){if(!this.textMeasuringCanvasContext)this.textMeasuringCanvasContext=document.createElement("canvas").getContext("2d");if(b)this.textMeasuringCanvasContext.font=b;return this.textMeasuringCanvasContext.measureText(a).width};iAd.CSS.isStyleSheetLoaded=function(a){return iAd.CSS.elementForStyleSheet(a)!=null};iAd.CSS.elementForStyleSheet=function(a){for(var b,c=document.styleSheets,d=0,e=c.length;d<e;d++){b=c[d];if(b.href==a)return b}return null};
iAd.CSS.flushPendingUpdates=function(){};iAd.Utils.setupDisplayNames(iAd.CSS,"iAd.CSS");iAd.Element={};iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX="data-";iAd.Element.ATTRIBUTE_PREFIX="ad-";iAd.Element.elementFromString=function(a){var b=document.createRange();b.selectNode(document.body);for(a=b.createContextualFragment(a).firstChild;a.nodeType!=Node.ELEMENT_NODE&&a.nextSibling;)a=a.nextSibling;return a};
iAd.Element.hasCustomAttribute=function(a,b){return a.hasAttribute(iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+b)||a.hasAttribute(b)};iAd.Element.getCustomAttribute=function(a,b){return a.getAttribute(iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+b)||a.getAttribute(b)};iAd.Element.SUPPORTS_CLASS_LIST="classList"in document.documentElement;
Element.prototype.hasClassName=iAd.Element.SUPPORTS_CLASS_LIST?function(a){return iAd.CSS.isClassNameValid(a)&&this.classList.contains(a)}:function(a){return RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)").test(this.className)};Element.prototype.addClassName=iAd.Element.SUPPORTS_CLASS_LIST?function(a){if(!iAd.CSS.isClassNameValid(a)||this.classList.contains(a))return false;this.classList.add(a);return true}:function(a){if(this.hasClassName(a))return false;else{this.className=[this.className,a].join(" ");return true}};
Element.prototype.removeClassName=iAd.Element.SUPPORTS_CLASS_LIST?function(a){if(iAd.CSS.isClassNameValid(a)&&this.classList.contains(a)){this.classList.remove(a);return true}return false}:function(a){if(this.hasClassName(a)){this.className=this.className.replace(RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)","g")," ");return true}return false};
Element.prototype.iad_toggleClassName=iAd.Element.SUPPORTS_CLASS_LIST?function(a,b){if(iAd.CSS.isClassNameValid(a)){if(b==null)b=!this.classList.contains(a);this.classList[b?"add":"remove"](a)}}:function(a,b){if(b==null)b=!this.hasClassName(a);this[b?"addClassName":"removeClassName"](a)};iAd.Utils.setupDisplayNames(Element,"Element");iAd.Class({name:"iAd.Transition",mixins:[iAd.EventTarget]});iAd.Transition.DID_COMPLETE_DELEGATE="transitionDidComplete";
iAd.Transition.DEFAULTS={duration:0.5,delay:0,removesTargetUponCompletion:false,revertsToOriginalValues:false};iAd.Transition.STYLES=["-webkit-transition-property","-webkit-transition-duration","-webkit-transition-timing-function","-webkit-transition-delay","-webkit-transition"];iAd.Transition.NORMALIZE_ZERO_REG_EXP=/([^\d+-]|^)[+-]?0[a-z%]*/g;iAd.Transition.HARDWARE_LAYER_BACKING_PROPERTIES=["position"];
iAd.Transition.prototype.init=function(a,b){this.revertsToOriginalValues=this.removesTargetUponCompletion=this.delegate=this.timingFunction=this.to=this.from=this.delay=this.duration=this.base=this.properties=this.target=null;this.defaultsApplied=false;this.archivedStyles=null;this.archivedValues=[];this.archivedBaseValues=[];this.definition=a;this.reversed=!!b};
iAd.Transition.prototype.applyDefaults=function(){if(!this.defaultsApplied){for(var a in iAd.Transition.DEFAULTS)if(this[a]==null)this[a]=iAd.Transition.DEFAULTS[a];this.defaultsApplied=true}};iAd.Transition.prototype.archiveTransitionStyles=function(){if(this.archivedStyles==null){var a=this.target instanceof iAd.View?this.target.layer:this.target;this.archivedStyles=[];for(var b=0,c=iAd.Transition.STYLES.length;b<c;b++)this.archivedStyles.push(a.style.getPropertyValue(iAd.Transition.STYLES[b]))}};
iAd.Transition.prototype.restoreTransitionStyles=function(){for(var a=0,b=iAd.Transition.STYLES.length;a<b;a++)this.element.style.setProperty(iAd.Transition.STYLES[a],this.archivedStyles[a],"");this.archivedStyles=null};
iAd.Transition.prototype.archiveBaseValues=function(){if(this.revertsToOriginalValues)if(this.target instanceof iAd.View){for(var a=0,b=this.properties.length;a<b;a++)this.archivedValues[a]=this.target[this.properties[a]];if(this.base){a=0;for(b=this.base.length;a<b;a+=2)this.archivedBaseValues[a]=this.target[this.base[a]]}}else{a=0;for(b=this.properties.length;a<b;a++)this.archivedValues[a]=this.target.style.getPropertyValue(this.properties[a]);if(this.base){a=0;for(b=this.base.length;a<b;a+=2)this.archivedBaseValues[a]=
this.target.style.getPropertyValue(this.base[a])}}};
iAd.Transition.prototype.restoreBaseValues=function(){if(this.target instanceof iAd.View){for(var a=0,b=this.properties.length;a<b;a++)this.target[this.properties[a]]=this.archivedValues[a];if(this.base){a=0;for(b=this.base.length;a<b;a+=2)this.target[this.base[a]]=this.archivedBaseValues[a]}}else{a=0;for(b=this.properties.length;a<b;a++)this.target.style.setProperty(this.properties[a],this.archivedValues[a],null);if(this.base){a=0;for(b=this.base.length;a<b;a+=2)this.target.style.setProperty(this.base[a],
this.archivedBaseValues[a],null)}}};iAd.Transition.prototype.start=function(){if(iAd.Transaction.openTransactions>0)iAd.Transaction.addTransition(this);else{this.applyFromState();iAd.CSS.flushPendingUpdates();this.callMethodNameAfterDelay("applyToState",0)}return this};
iAd.Transition.prototype.applyFromState=function(){this.processDefinition();this.applyDefaults();this.archiveTransitionStyles();this.archiveBaseValues();this.enforceHardwareLayerBacking();if(this.from!=null)if(this.target instanceof iAd.View){this.target.layer.style.webkitTransitionDuration=0;if(this.base)for(var a=0,b=this.base.length;a<b;a+=2)this.target[this.base[a]]=this.base[a+1];a=0;for(b=this.properties.length;a<b;a++)this.target[this.properties[a]]=this.from[a]}else{this.target.style.webkitTransitionDuration=
0;if(this.base){a=0;for(b=this.base.length;a<b;a+=2)this.target.style.setProperty(this.base[a],this.base[a+1],null)}a=0;for(b=this.properties.length;a<b;a++)this.target.style.setProperty(this.properties[a],this.from[a],null)}};
iAd.Transition.prototype.processDefinition=function(){if(this.definition){var a=this.definition;if(iAd.Utils.objectIsFunction(a))if(this.target!=null&&this.target instanceof iAd.View)a=a(this.target);else return;iAd.Utils.copyPropertiesFromSourceToTarget(a,this);if(this.reversed){a=this.from;this.from=this.to;this.to=a}}};
iAd.Transition.prototype.enforceHardwareLayerBacking=function(){if(this.target instanceof iAd.View)for(var a=0,b=this.properties.length;a<b;a++)if(iAd.Transition.HARDWARE_LAYER_BACKING_PROPERTIES.indexOf(this.properties[a])!=-1){this.target.wantsHardwareLayerBacking=true;break}};
iAd.Transition.prototype.applyToState=function(){var a=this.target instanceof iAd.View;this.cssProperties=[];for(var b=[],c=0,d=this.properties.length;c<d;c++){var e=a?this.target.cssPropertyNameForJSProperty(this.properties[c]):this.properties[c];if(!(this.cssProperties.indexOf(e)>-1)){var f=iAd.Utils.objectIsArray(this.duration)?this.duration[c]:this.duration,g=iAd.Utils.objectIsArray(this.timingFunction)?this.timingFunction[c]:this.timingFunction,i=iAd.Utils.objectIsArray(this.delay)?this.delay[c]:
this.delay;b.push([e,f+"s",g,i+"s"].join(" "));this.propertyStatesAreEqualForIndex(c)||this.cssProperties.push(e)}}this.eventTarget=this.element=a?this.target.layer:this.target;f!==0&&this.element.addEventListener("webkitTransitionEnd",this,false);this.completedTransitions=0;this.element.style.webkitTransition=b.join(", ");if(a){c=0;for(d=this.properties.length;c<d;c++)this.target[this.properties[c]]=this.to[c]}else{c=0;for(d=this.properties.length;c<d;c++)this.target.style.setProperty(this.properties[c],
this.to[c],"")}this.cssProperties.length||this.callMethodNameAfterDelay("handleTransitionComplete",0)};
iAd.Transition.prototype.propertyStatesAreEqualForIndex=function(a){var b=this.from==null?this.target[this.properties[a]]:this.from[a];a=this.to[a];if(b instanceof iAd.Point&&a instanceof iAd.Point||b instanceof iAd.Size&&a instanceof iAd.Size)return b.equals(a);else{if(iAd.Utils.objectIsString(b)&&iAd.Utils.objectIsString(a)){b=b.replace(iAd.Transition.NORMALIZE_ZERO_REG_EXP,"$10");a=a.replace(iAd.Transition.NORMALIZE_ZERO_REG_EXP,"$10")}return b===a}};
iAd.Transition.prototype.handleEvent=function(a){if(a.target===this.element){this.completedTransitions++;this.completedTransitions==this.cssProperties.length&&this.handleTransitionComplete()}};
iAd.Transition.prototype.handleTransitionComplete=function(){this.dispatchNotification(iAd.Transition.DID_COMPLETE_DELEGATE,this.delegate);this.element.removeEventListener("webkitTransitionEnd",this,false);if(this.removesTargetUponCompletion){var a=this.target;this.target instanceof iAd.View?a.removeFromSuperview():a.parentNode.removeChild(a)}else this.restoreTransitionStyles();this.revertsToOriginalValues&&this.restoreBaseValues()};iAd.Device={};iAd.Device.iOS_VERSION=navigator.userAgent.match(/OS ([0-9_]+)/);
iAd.Device.iOS_VERSION=iAd.Device.iOS_VERSION?iAd.Device.iOS_VERSION[1].replace(/_/g,"."):null;iAd.Device.IS_IPAD=navigator.platform.indexOf("iPad")>-1;iAd.Device.HAS_HIDPI_DISPLAY=window.devicePixelRatio>=2;iAd.Device.iOSVersionLessThan=function(a){if(iAd.Device.iOS_VERSION==null){iAd.Console.warn("iAd.Device.iOS_VERSION is null.");return false}return iAd.Device.compareiOSVersions(iAd.Device.iOS_VERSION,a)==-1};
iAd.Device.compareiOSVersions=function(a,b){for(var c=a.split("."),d=b.split("."),e=0,f=Math.max(c.length,d.length);e<f;e++){var g=parseInt(c[e]||"0",10),i=parseInt(d[e]||"0",10);if(i>g)return-1;else if(g>i)return 1}return 0};iAd.Device.ORIENTATION_PORTRAIT_CSS="ad-device-portrait";iAd.Device.ORIENTATION_LANDSCAPE_CSS="ad-device-landscape";iAd.Device.ORIENTATION_PORTRAIT=0;iAd.Device.ORIENTATION_PORTRAIT_UPSIDE_DOWN=180;iAd.Device.ORIENTATION_LANDSCAPE_LEFT=90;
iAd.Device.ORIENTATION_LANDSCAPE_RIGHT=-90;iAd.Device.init=function(){iAd.Device.iOS_VERSION&&window.addEventListener("orientationchange",iAd.Device.orientationDidChange,true);iAd.Device.setOrientation(window.orientation||iAd.Device.ORIENTATION_PORTRAIT)};iAd.Device.orientationDidChange=function(){iAd.Device.setOrientation(window.orientation)};
iAd.Device.setOrientation=function(a){var b=this.orientation;this.orientation=a;a=Math.abs(a)==90;var c=document.body;if(c.addClassName(a?iAd.Device.ORIENTATION_LANDSCAPE_CSS:iAd.Device.ORIENTATION_PORTRAIT_CSS))c.removeClassName(a?iAd.Device.ORIENTATION_PORTRAIT_CSS:iAd.Device.ORIENTATION_LANDSCAPE_CSS);b!=null&&iAd.ViewController&&iAd.ViewController.orientationDidChange(b)};window.addEventListener("DOMContentLoaded",iAd.Device.init,true);iAd.Utils.setupDisplayNames(iAd.Device,"iAd.Device");
iAd.String={};iAd.String.dashedStringToCamelCase=function(a){a=a.split("-");return a.shift()+a.map(iAd.String.capitalizeString).join("")};iAd.String.capitalizeString=function(a){return a.charAt(0).toUpperCase()+a.substr(1)};iAd.String.camelCaseStringToDashed=function(a){return a.replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()})};iAd.Utils.setupDisplayNames(iAd.String,"iAd.String");iAd.Array={};
iAd.Array.removeObjectFromArray=function(a,b){var c=b.indexOf(a);if(c==-1)return false;b.splice(c,1);return true};iAd.Utils.setupDisplayNames(iAd.Array,"iAd.Array");
iAd.Class({name:"iAd.View",superclass:iAd.Object,mixins:[iAd.EventTarget],synthesizedProperties:["id","position","size","frame","transform","anchorPoint","anchorPointZ","doubleSided","zIndex","opacity","clipsToBounds","hidden","wantsHardwareLayerBacking","transitionsEnabled","transitionsDuration","hostingLayer","userInteractionEnabled","declarativeLayerWasInitialized","eventTarget","layerIsInDocument","touchLayer","tracking"],archivedProperties:["id","position","size","autoresizingMask","transform",
"anchorPoint","anchorPointZ","doubleSided","zIndex","opacity","clipsToBounds","hidden","wantsHardwareLayerBacking","transitionsEnabled","transitionsDuration","subviews","userInteractionEnabled"],cssClassName:"ad-view",collectionAccessor:"views"});
iAd.View.prototype.init=function(a){this.callSuper();if(iAd.Utils.objectIsString(a))a=document.querySelector(a);this.layer=a;this.superview=null;this.subviews=[];this.autoresizesSubviews=this.tracksAllTouchesOnceTouchesBegan=true;this.autoresizingMask=iAd.View.AUTORESIZING_NONE;this._layerIsInDocument=false;this._position=new iAd.Point;this._size=new iAd.Size;this._anchorPoint=new iAd.Point(0.5,0.5);this._anchorPointZ=0;this._doubleSided=true;this._zIndex=0;this._opacity=1;this._transform="none";
this._transitionsEnabled=this._wantsHardwareLayerBacking=this._hidden=this._clipsToBounds=false;this._transitionsDuration=0.5;this._hostingLayer=null;this._userInteractionEnabled=false;this._touchLayer=null;this.touchInside=this._tracking=false;this.gestureRecognizers=[];this.usesDeclarativeBacking=a instanceof Element;this._declarativeLayerWasInitialized=false;if(this.usesDeclarativeBacking){if(document.body.contains(this.layer)){this._layerIsInDocument=true;this.initWithDeclarativeBacking();this.layerWasInsertedIntoDocument()}}else{this.createLayer();
this.setupCSSClasses();this.layerWasCreated()}this.layer._view=this};iAd.View.MANAGED_BY_VIEW_CONTROLLER_ATTR="ad-managed-by-view-controller";iAd.View.AUTORESIZING_NONE=0;iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN=1;iAd.View.AUTORESIZING_FLEXIBLE_WIDTH=2;iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN=4;iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN=8;iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT=16;iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN=32;
iAd.View.PROPERTY_MAPPING={opacity:"opacity",transform:"-webkit-transform",position:"-webkit-transform",anchorPoint:"-webkit-transform-origin",doubleSided:"-webkit-backface-visibility",zIndex:"z-index"};iAd.View.EVENT_ATTRIBUTE_PREFIX=iAd.Element.ATTRIBUTE_PREFIX+"on";iAd.View.LAYER_STYLE_DID_CHANGE_EVENT="viewLayerStyleDidChange";iAd.View.INSIDE_PADDING=iAd.Device.IS_IPAD?25:70;iAd.View.TOUCH_DOWN_EVENT="viewTouchDown";iAd.View.TOUCH_DRAG_INSIDE_EVENT="viewTouchDragInside";
iAd.View.TOUCH_DRAG_OUTSIDE_EVENT="viewTouchDragOutside";iAd.View.TOUCH_DRAG_ENTER_EVENT="viewTouchDragEnter";iAd.View.TOUCH_DRAG_EXIT_EVENT="viewTouchDragExit";iAd.View.TOUCH_UP_INSIDE_EVENT="viewTouchUpInside";iAd.View.TOUCH_UP_OUTSIDE_EVENT="viewTouchUpOutside";iAd.View.TOUCH_CANCEL_EVENT="viewTouchCancel";iAd.View.TOUCH_STATE_CHANGE_EVENT="viewTouchStateChange";
iAd.View.synthesizedEvents=[iAd.View.TOUCH_DOWN_EVENT,iAd.View.TOUCH_DRAG_INSIDE_EVENT,iAd.View.TOUCH_DRAG_OUTSIDE_EVENT,iAd.View.TOUCH_DRAG_ENTER_EVENT,iAd.View.TOUCH_DRAG_EXIT_EVENT,iAd.View.TOUCH_UP_INSIDE_EVENT,iAd.View.TOUCH_UP_OUTSIDE_EVENT,iAd.View.TOUCH_CANCEL_EVENT,iAd.View.TOUCH_STATE_CHANGE_EVENT];iAd.View.dispatchesStyleChangeEvents=false;iAd.View.prototype.createLayer=function(){this.layer=document.createElement("div")};
iAd.View.prototype.initWithDeclarativeBacking=function(){this.setupLayer();this.layerWasCreated();this.setupCSSClasses();this.readPropertiesFromLayerComputedStyle(window.getComputedStyle(this.layer));this.readPropertiesFromLayerAttributes(this.getCustomLayerAttributes());this.declarativeLayerWasInitialized=true};iAd.View.prototype.setupLayer=function(){this.lookupViewLayersInLayer(this.hostingLayer)};
iAd.View.prototype.lookupViewLayersInLayer=function(a){for(a=a.firstElementChild;a;){if(!a.hasOwnProperty("_view")){var b=iAd.View.viewClassForLayer(a);if(b){b=new b(a);b._indexInSuperviewSubviews=this.subviews.push(b)-1;b.willMoveToSuperview(this);b.superview=this;b.didMoveToSuperview()}else this.lookupViewLayersInLayer(a)}a=a.nextElementSibling}};
iAd.View.prototype.setupCSSClasses=function(){for(var a=this.constructor;a.superclass;){(cssClassName=a.cssClassName)&&this.layer.addClassName(cssClassName);if(a===iAd.View)break;a=a.superclass}};
iAd.View.prototype.readPropertiesFromLayerComputedStyle=function(a){this._size.width=parseInt(a.width,10)||0;this._size.height=parseInt(a.height,10)||0;this._position.x=parseInt(a.left,10)||0;this._position.y=parseInt(a.top,10)||0;this._zIndex=parseInt(a.zIndex,10)||0;this._clipsToBounds=a.overflow=="hidden";this._doubleSided=a.webkitBackfaceVisibility=="visible";this._transform=a.webkitTransform;this._hidden=a.visibility=="hidden";this._opacity=parseFloat(a.opacity);a=iAd.CSS.matrixFromString(this._transform);
var b=new WebKitCSSMatrix;if(!iAd.CSS.matrixEqualsToMatrix(a,b)){this._position.x+=a.m41;this._position.y+=a.m42;a=a.translate(a.m41*-1,a.m42*-1,0);this._transform=a.toString()}if(this._transform!="none")this._wantsHardwareLayerBacking=true};
iAd.View.prototype.readPropertiesFromLayerAttributes=function(a){iAd.ViewController!=null&&a.hasOwnProperty(iAd.View.MANAGED_BY_VIEW_CONTROLLER_ATTR)&&this.createManagingViewController();var b,c,d,e=this.constructor.synthesizedEventMap;for(b in a){d=a[b];(c=e[b.toLowerCase()])?this.addEventListener(c,iAd.Event.eventHandlerForString(d),false):this.setValueForAttribute(d,b)}};
iAd.View.prototype.createManagingViewController=function(){new iAd.ViewController({id:this.layer.hasAttribute("id")?this.layer.getAttribute("id"):"",properties:{view:this}})};iAd.View.prototype.setValueForAttribute=function(a,b){var c=this.propertyNameForAttribute(b);switch(typeof this[c]){case "string":this[c]=a;break;case "number":this[c]=parseFloat(a);break;case "boolean":this[c]=a!="false";break;default:this[c]=a}};iAd.View.prototype.propertyNameForAttribute=function(a){return iAd.String.dashedStringToCamelCase(a.substr(iAd.Element.ATTRIBUTE_PREFIX.length))};
iAd.View.prototype.attributeNameForProperty=function(a){return iAd.Element.ATTRIBUTE_PREFIX+iAd.String.camelCaseStringToDashed(a)};
iAd.View.prototype.getCustomLayerAttributes=function(){for(var a={},b=iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX+iAd.Element.ATTRIBUTE_PREFIX,c=this.layer.attributes,d,e,f=0,g=c.length;f<g;f++){d=c.item(f);e=d.name;if(e.indexOf(b)==0)a[e.substr(iAd.Element.HTML5_CUSTOM_ATTRIBUTE_PREFIX.length)]=d.value;else if(e.indexOf(iAd.Element.ATTRIBUTE_PREFIX)==0)a[e]=d.value}return this.customLayerAttributes=a};
iAd.View.prototype.layerHasCustomAttribute=function(a){if(this.customLayerAttributes)return this.customLayerAttributes.hasOwnProperty(a);return iAd.Element.hasCustomAttribute(this.layer,a)};iAd.View.prototype.getLayerCustomAttributeValue=function(a){return this.customLayerAttributes?this.customLayerAttributes[a]||null:iAd.Element.getCustomAttribute(this.layer,a)};
iAd.View.prototype.setLayerStyle=function(a){for(var b in a)this.layer.style.setProperty(b,a[b]);iAd.View.dispatchesStyleChangeEvents&&this.createAndDispatchEvent(iAd.View.LAYER_STYLE_DID_CHANGE_EVENT,[["changedProperties",a]])};iAd.View.prototype.toString=function(){return[this.constructor.displayName,"[",this._size.width,"x",this._size.height,"@",this._position.x,",",this._position.y,"]"].join("")};iAd.View.prototype.getId=function(){return this.layer.id};
iAd.View.prototype.setId=function(a){this.layer.id=a};iAd.View.prototype.setPosition=function(a){if(!(!a||this._position.equals(a))){this._position=a;this.updatePositionAndTransform()}};iAd.View.prototype.setSize=function(a){if(!(!a||this._size.equals(a))){var b=this._size.copy();this._size=a;this.setLayerStyle({width:a.width+"px",height:a.height+"px"});this.autoresizesSubviews&&this.resizeSubviewsWithOldSize(b)}};
iAd.View.prototype.getFrame=function(){return new iAd.Rect(this.position.x,this.position.y,this.size.width,this.size.height)};iAd.View.prototype.setFrame=function(a){this.position=a.origin;this.size=a.size};iAd.View.prototype.setTransform=function(a){this._transform=a;this.updatePositionAndTransform()};iAd.View.prototype.setAnchorPoint=function(a){if(a){this._anchorPoint=a;this.updateLayerTransformOrigin()}};iAd.View.prototype.setAnchorPointZ=function(a){this._anchorPointZ=a;this.updateLayerTransformOrigin()};
iAd.View.prototype.updateLayerTransformOrigin=function(){this.setLayerStyle({"-webkit-transform-origin":Math.round(this._anchorPoint.x*100)+"% "+Math.round(this._anchorPoint.y*100)+"% "+this._anchorPointZ+"px"})};iAd.View.prototype.setDoubleSided=function(a){this._doubleSided=a;this.setLayerStyle({"-webkit-backface-visibility":a?"visible":"hidden"})};iAd.View.prototype.setZIndex=function(a){this._zIndex=a;this.setLayerStyle({"z-index":a})};
iAd.View.prototype.setHidden=function(a){this._hidden=a;this.setLayerStyle({visibility:a?"hidden":"visible"})};iAd.View.prototype.updatePositionAndTransform=function(){this.setLayerStyle({left:this._position.x+"px",top:this._position.y+"px","-webkit-transform":this._transform})};iAd.View.prototype.setOpacity=function(a){this._opacity=a;this.setLayerStyle({opacity:a})};
iAd.View.prototype.setTransitionsEnabled=function(a){this.setLayerStyle({"-webkit-transition-duration":a?this._transitionsDuration+"s":"0s"});this._transitionsEnabled=a;this.updatePositionAndTransform()};iAd.View.prototype.setWantsHardwareLayerBacking=function(a){if(this._wantsHardwareLayerBacking!=a){this._wantsHardwareLayerBacking=a;this.updatePositionAndTransform()}};
iAd.View.prototype.setTransitionsDuration=function(a){this.setLayerStyle({"-webkit-transition-duration":a+"s"});this._transitionsDuration=a};iAd.View.prototype.setClipsToBounds=function(a){this._clipsToBounds=a;this.setLayerStyle({overflow:a?"hidden":"visible"})};iAd.View.prototype.getTouchLayer=function(){return this._touchLayer||this.layer};iAd.View.prototype.getHostingLayer=function(){return this._hostingLayer!=null?this._hostingLayer:this.layer};
iAd.View.prototype.addSubview=function(a){return this.insertSubviewAtIndex(a,this.subviews.length)};iAd.View.prototype.removeFromSuperview=function(){if(this.superview!=null){this.willMoveToSuperview(null);this.superview.removeSubview(this);this.layer.parentNode.removeChild(this.layer);this.superview=null;this.didMoveToSuperview();this.dispatchNotificationOfLayerRemovalFromDocument()}};
iAd.View.prototype.removeSubview=function(a){if(a.superview==this){this.willRemoveSubview(a);var b=this.subviews;a=a._indexInSuperviewSubviews;b.splice(a,1);a=a;for(var c=b.length;a<c;a++)b[a]._indexInSuperviewSubviews=a}};
iAd.View.prototype.insertSubviewAtIndex=function(a,b){var c=this.subviews;if(!(b>c.length)){var d=a.superview,e;if(d==this){e=a._indexInSuperviewSubviews;if(b===e)return;c.splice(e,1);b>e&&b--}else{d&&d.removeSubview(a);a.willMoveToSuperview(this)}c.splice(b,0,a);a._indexInSuperviewSubviews=b;e=e!=null&&e<b?e:b+1;for(var f=c.length;e<f;e++)c[e]._indexInSuperviewSubviews=e;c=c[b+1];this.hostingLayer.insertBefore(a.layer,c?c.layer:null);if(d!=this){a.superview=this;a.didMoveToSuperview()}this.didAddSubview(a);
this._layerIsInDocument&&!a._layerIsInDocument&&a.dispatchNotificationOfLayerInsertionIntoDocument();return a}};iAd.View.prototype.insertSubviewAfterSubview=function(a,b){if(b.superview===this){var c=b._indexInSuperviewSubviews+1;c<this.subviews.length?this.insertSubviewAtIndex(a,c):this.addSubview(a);return a}};iAd.View.prototype.insertSubviewBeforeSubview=function(a,b){if(b.superview===this)return this.insertSubviewAtIndex(a,b._indexInSuperviewSubviews)};
iAd.View.prototype.exchangeSubviewsAtIndices=function(a,b){if(!(a>=this.subviews.length||b>=this.subviews.length)){var c=this.subviews[a],d=this.subviews[b];this.subviews[a]=d;this.subviews[b]=c;c._indexInSuperviewSubviews=b;d._indexInSuperviewSubviews=a;c=c.layer;d=d.layer;var e=this.hostingLayer,f=c.nextSibling,g=d.nextSibling;f!=null?e.insertBefore(d,f):e.appendChild(d);g!=null?e.insertBefore(c,g):e.appendChild(c)}};
iAd.View.prototype.isDescendantOfView=function(a){for(var b=false,c=this;c.superview!=null;){if(c.superview===a){b=true;break}c=c.superview}return b};iAd.View.prototype.layerWasCreated=function(){};iAd.View.prototype.willMoveToSuperview=function(){};iAd.View.prototype.didMoveToSuperview=function(){};iAd.View.prototype.didAddSubview=function(){};iAd.View.prototype.willRemoveSubview=function(){};
iAd.View.prototype.layerWasInsertedIntoDocument=function(){if(this.usesDeclarativeBacking)if(this.declarativeLayerWasInitialized){var a=window.getComputedStyle(this.layer);if(isNaN(this._size.width)){this._size.width=parseInt(a.width,10);this._size.height=parseInt(a.height,10)}if(isNaN(this._position.x)){this._position.x=parseInt(a.left,10);this._position.y=parseInt(a.top,10)}}else this.initWithDeclarativeBacking();this.layerIsInDocument=true};
iAd.View.prototype.layerWasRemovedFromDocument=function(){this.layerIsInDocument=false};iAd.View.prototype.dispatchNotificationOfLayerInsertionIntoDocument=function(){for(var a=this.subviews,b=0,c=a.length;b<c;b++)a[b].dispatchNotificationOfLayerInsertionIntoDocument();this.layerWasInsertedIntoDocument()};iAd.View.prototype.dispatchNotificationOfLayerRemovalFromDocument=function(){for(var a=this.subviews,b=0,c=a.length;b<c;b++)a[b].dispatchNotificationOfLayerRemovalFromDocument();this.layerWasRemovedFromDocument()};
iAd.View.prototype.setUserInteractionEnabled=function(a){if(this._userInteractionEnabled!=a){this.layer[a?"addEventListener":"removeEventListener"](iAd.Event.START_EVENT,this,false);this._userInteractionEnabled=a}};iAd.View.prototype.handleEvent=function(a){switch(a.type){case iAd.Event.START_EVENT:this.touchesBegan(a);break;case iAd.Event.MOVE_EVENT:this.touchesMoved(a);break;case iAd.Event.END_EVENT:this.touchesEnded(a);break;case iAd.Event.CANCEL_EVENT:this.touchesCancelled(a)}};
iAd.View.prototype.touchesBegan=function(a){if(this.tracksAllTouchesOnceTouchesBegan){window.addEventListener(iAd.Event.MOVE_EVENT,this,true);window.addEventListener(iAd.Event.END_EVENT,this,true);window.addEventListener(iAd.Event.CANCEL_EVENT,this,true)}a.preventDefault();this.touchInside=this.tracking=true;this.dispatchEvent(this.createUIEvent(iAd.View.TOUCH_DOWN_EVENT,a));this.createAndDispatchEvent(iAd.View.TOUCH_STATE_CHANGE_EVENT);this.lastProcessedEvent=a};
iAd.View.prototype.touchesMoved=function(a){this.shouldPreventEventDefault(a)&&a.preventDefault();var b=this.pointInsidePaddedBounds(iAd.Point.fromEventInElement(a,this.layer)),c=b?iAd.View.TOUCH_DRAG_INSIDE_EVENT:iAd.View.TOUCH_DRAG_OUTSIDE_EVENT;if(b!=this.touchInside){c=(this.touchInside=b)?iAd.View.TOUCH_DRAG_ENTER_EVENT:iAd.View.TOUCH_DRAG_EXIT_EVENT;this.createAndDispatchEvent(iAd.View.TOUCH_STATE_CHANGE_EVENT)}this.dispatchEvent(this.createUIEvent(c,a));this.lastProcessedEvent=a};
iAd.View.prototype.shouldPreventEventDefault=function(){return true};iAd.View.prototype.touchesEnded=function(){window.removeEventListener(iAd.Event.MOVE_EVENT,this,true);window.removeEventListener(iAd.Event.END_EVENT,this,true);window.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);this.tracking=false;this.dispatchEvent(this.createUIEvent(this.touchInside?iAd.View.TOUCH_UP_INSIDE_EVENT:iAd.View.TOUCH_UP_OUTSIDE_EVENT,this.lastProcessedEvent));this.touchInside=false;this.createAndDispatchEvent(iAd.View.TOUCH_STATE_CHANGE_EVENT)};
iAd.View.prototype.touchesCancelled=function(a){window.removeEventListener(iAd.Event.MOVE_EVENT,this,true);window.removeEventListener(iAd.Event.END_EVENT,this,true);window.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);this.touchInside=this.tracking=false;this.dispatchEvent(this.createUIEvent(iAd.View.TOUCH_CANCEL_EVENT,a))};iAd.View.prototype.createUIEvent=function(a,b){var c=iAd.Event.createUIEvent(a,b);if(!c.ad)c.ad={};c.ad.sender=this;return c};
iAd.View.prototype.pointInsidePaddedBounds=function(a){var b=iAd.View.INSIDE_PADDING;return a.x>=-b&&a.x<=this.size.width+b&&a.y>=-b&&a.y<=this.size.height+b};iAd.View.prototype.pointInside=function(a){return a.x>=0&&a.x<=this.size.width&&a.y>=0&&a.y<=this.size.height};iAd.View.prototype.resizeSubviewsWithOldSize=function(a){for(var b=0,c=this.subviews.length;b<c;b++)this.subviews[b].resizeWithOldSuperviewSize(a)};
iAd.View.prototype.resizeWithOldSuperviewSize=function(a){var b=this._position.copy(),c=this._size.copy(),d=this.autoresizingMask;if(a.width!=0||c.width==0){var e;switch((d&iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN)+(d&iAd.View.AUTORESIZING_FLEXIBLE_WIDTH)+(d&iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN)){case iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN:b.x+=this.superview._size.width-a.width;break;case iAd.View.AUTORESIZING_FLEXIBLE_WIDTH:c.width=this.superview._size.width-(a.width-this._size.width);
break;case iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH:e=a.width-this._size.width-this._position.x;b.x=this._position.x/(a.width-e)*(this.superview._size.width-e);c.width=this.superview._size.width-b.x-e;break;case iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN:e=a.width-this._size.width-this._position.x;b.x+=(this.superview._size.width-a.width)*(this.position.x/(this.position.x+e));break;case iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN|
iAd.View.AUTORESIZING_FLEXIBLE_WIDTH:e=a.width-this._size.width-this._position.x;scaled_right_margin=e/(a.width-this._position.x)*(this.superview._size.width-this._position.x);c.width=this.superview._size.width-b.x-scaled_right_margin;break;case iAd.View.AUTORESIZING_FLEXIBLE_LEFT_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN:b.x=this._position.x/a.width*this.superview._size.width;c.width=this._size.width/a.width*this.superview._size.width}}if(a.height!=0||
c.height==0)switch((d&iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN)+(d&iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT)+(d&iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN)){case iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN:b.y+=this.superview._size.height-a.height;break;case iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT:c.height=this.superview._size.height-(a.height-this._size.height);break;case iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT:d=a.height-this._size.height-this._position.y;b.y=
this._position.y/(a.height-d)*(this.superview._size.height-d);c.height=this.superview._size.height-b.y-d;break;case iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN:d=a.height-this._size.height-this._position.y;b.y+=(this.superview._size.height-a.height)*(this.position.y/(this.position.y+d));break;case iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT:d=a.height-this._size.height-this._position.y;scaled_bottom_margin=d/(a.height-
this._position.y)*(this.superview._size.height-this._position.y);c.height=this.superview._size.height-b.y-scaled_bottom_margin;break;case iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN:b.y=this._position.y/a.height*this.superview._size.height;c.height=this._size.height/a.height*this.superview._size.height}this.position=b;this.size=c};iAd.View.prototype.cssPropertyNameForJSProperty=function(a){return iAd.View.PROPERTY_MAPPING[a]};
iAd.View.prototype.applyTransition=function(a,b){if(a==null)return null;var c=new iAd.Transition(a,b);c.target=this;c.start();return c};iAd.View.prototype.descendantViewsOfClass=function(a){return iAd.View.viewsForClassAndNode(a,this.layer)};iAd.View.prototype.getEventTarget=function(){return this.layer};
iAd.View.prototype.addGestureRecognizer=function(a){if(this.gestureRecognizers.indexOf(a)==-1){a.view!=null&&a.view!==this&&a.view.removeGestureRecognizer(a);this.gestureRecognizers.push(a);a.view=this}};iAd.View.prototype.removeGestureRecognizer=function(a){if(iAd.Array.removeObjectFromArray(a,this.gestureRecognizers))a.view=null};
iAd.View.prototype.convertRectToView=function(a,b){var c=this.convertPointToView(a.origin,b),d=this.convertPointToView(new iAd.Point(a.maxX(),a.maxY()),b);return new iAd.Rect(c.x,c.y,d.x-c.x,d.y-c.y)};iAd.View.prototype.convertRectFromView=function(a,b){return b.convertRectToView(a,this)};
iAd.View.prototype.convertPointToView=function(a,b){var c=window.webkitConvertPointFromNodeToPage(this.layer,new WebKitPoint(a.x,a.y));c=window.webkitConvertPointFromPageToNode(b.layer,c);return new iAd.Point(c.x,c.y)};iAd.View.prototype.convertPointFromView=function(a,b){return b.convertPointToView(a,this)};iAd.View.prototype.restoreProperty=function(a,b){switch(a){case "subviews":for(var c=0,d=b.length;c<d;c++)this.addSubview(b[c]);break;default:this.callSuper(a,b)}};
iAd.View.getViewById=function(a){return(a=document.getElementById(a))&&a._view!=undefined?a._view:null};iAd.View.registeredHTMLViewLoadingClasses={};iAd.View.registerClassForHTMLViewLoading=function(a){iAd.View.registeredHTMLViewLoadingClasses[a.cssClassName]=a};iAd.View.viewClassForLayer=function(a){var b=this.registeredHTMLViewLoadingClasses;a=a.className.trim().split(/\s+/);for(var c=0,d=a.length;c<d;c++){var e=b.hasOwnProperty(a[c])?b[a[c]]:null;if(e)return e}return null};
iAd.View.viewForLayer=function(a){return new (iAd.View.viewClassForLayer(a)||iAd.View)(a)};iAd.View.viewsForClassAndNode=function(a,b){var c=[];if(!a.hasOwnProperty("cssClassName"))return c;for(var d=b.querySelectorAll("."+a.cssClassName),e=0,f=d.length;e<f;e++)c.push(d[e]._view);return c};iAd.View.nearestViewForElement=function(a){for(;a._view==undefined&&a.parentNode;)a=a.parentNode;return a._view==undefined?null:a._view};iAd.Utils.setupDisplayNames(Node,"Node");
iAd.View.initialize=function(){var a=this;if(this.hasOwnProperty("cssClassName")){Object.defineProperty(this,"views",{get:function(){return iAd.View.viewsForClassAndNode(a,document)}});iAd.View.registerClassForHTMLViewLoading(this);if(a.hasOwnProperty("collectionAccessor"))Object.getOwnPropertyDescriptor(iAd.View.prototype,this.collectionAccessor)?iAd.Console.warn("The class "+this._name+' has a .collectionAccessor "'+this.collectionAccessor+'" in conflict with another iAd.View subclass, this collection accessor will be ignored.'):
Object.defineProperty(iAd.View.prototype,this.collectionAccessor,{get:function(){return this.descendantViewsOfClass(a)}})}if(!this.hasOwnProperty("synthesizedEventMap"))this.synthesizedEventMap={};for(var b=this;b;){if(b.hasOwnProperty("synthesizedEvents"))for(var c=b.synthesizedEvents,d=0,e=c.length;d<e;d++){var f=c[d];this.synthesizedEventMap[iAd.View.EVENT_ATTRIBUTE_PREFIX+f.toLowerCase()]=f}b=b.superclass}};
iAd.Class({name:"iAd.ScriptAction",mixins:[iAd.EventTarget],synthesizedProperties:["viewController","delay"]});iAd.ScriptAction.ACTION_DID_COMPLETE="scriptActionDidComplete";iAd.ScriptAction.prototype.init=function(a){this.callSuper();this.viewController=a;this.delay=0;this.eventTarget=document};iAd.ScriptAction.prototype.run=function(){this.callMethodNameAfterDelay("start",this.delay)};iAd.ScriptAction.prototype.prepare=function(){};iAd.ScriptAction.prototype.start=function(){this.end()};
iAd.ScriptAction.prototype.end=function(){this.dispatchNotification(iAd.ScriptAction.ACTION_DID_COMPLETE,this.delegate)};iAd.Class({name:"iAd.ActionListManager",mixins:[iAd.EventTarget]});iAd.ActionListManager.ACTIVE_STATE_SUFFIX="-is-active";iAd.ActionListManager.ACTION_LIST_WILL_START="actionListWillStart";iAd.ActionListManager.ACTION_LIST_DID_START="actionListDidStart";iAd.ActionListManager.ACTION_LIST_WILL_ITERATE="actionListWillIterate";iAd.ActionListManager.ACTION_LIST_DID_ITERATE="actionListDidIterate";
iAd.ActionListManager.ACTION_LIST_WILL_COMPLETE="actionListWillComplete";iAd.ActionListManager.ACTION_LIST_DID_COMPLETE="actionListDidComplete";iAd.ActionListManager.ACTION_LIST_DID_CANCEL="actionListDidCancel";iAd.ActionListManager.ACTION_LIST_DID_PROGRESS="actionListDidProgress";
iAd.ActionListManager.prototype.init=function(a,b){this.callSuper();this.eventTarget=document;this.id=a.id||iAd.ActionListManager.uniqueId();this.actionList=a;this.viewController=b;this.actionsByName={};this.actions=[];this.seedActions=[];this.actionQueue=[];this.dependency={};this.selectors=[];this.timers=[];this.usesAnimationIterationCount=true;var c,d;this.actionList.actions.forEach(function(e){var f=e.type;if(f=="css-reset")this.selectors.push(e.selector);else{var g=e.name,i=e.startAfter||[];
if(f=="script"){f=e.className;var h=iAd.Utils.resolveObjectPath(f);if(!h)throw new ReferenceError("Can't find script action class named: "+f);f=new h(this.viewController);h=e.properties;for(var j in h)f[j]=h[j];if(e.delay)f.delay=e.delay;if(!e.asynchronous)f.delegate=this;f._action=e;f.prepare();e.object=f;this.usesAnimationIterationCount=false}else if(f=="css"){this.selectors.push(e.selector);j=e.duration||0;if(c==null)c=j;else if(c!=j)this.usesAnimationIterationCount=false;j=e.delay||0;if(d==null)d=
j;else if(d!=j)this.usesAnimationIterationCount=false}if(i.length>0){i.forEach(function(k){if(this.dependency[k])this.dependency[k].push(e);else this.dependency[k]=[e]},this);this.usesAnimationIterationCount=false}else this.seedActions.push(e);if(g)this.actionsByName[g]=e;e.completed=false;this.actions.push(e)}},this);this.totalIterations=this.actionList.iterationCount||1;this.totalActions=this.actions.length};
iAd.ActionListManager.prototype.start=function(){if(this.viewController.isInState(this.actionList.cssClassName)){this.reset(true);this.callMethodNameAfterDelay("start",0)}else{this.clearCSSAnimationProperties();this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_WILL_START,this.viewController,[["actionList",this.actionList]]);this.viewController.enterState(this.actionList.cssClassName);this.viewController.enterState(this.actionList.cssClassName+iAd.ActionListManager.ACTIVE_STATE_SUFFIX);this.viewController.view.layer.addEventListener("webkitAnimationEnd",
this,true);this.usesAnimationIterationCount&&this.viewController.view.layer.addEventListener("webkitAnimationIteration",this,true);this.completedIterationCount=0;this.iterate();this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_DID_START,this.viewController,[["actionList",this.actionList]])}};
iAd.ActionListManager.prototype.iterate=function(){this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_WILL_ITERATE,this.viewController,[["actionList",this.actionList],["iteration",this.completedIterationCount]]);this.completedActionCount=0;this.actionQueue=this.seedActions.slice();this.flushActionQueue()};
iAd.ActionListManager.prototype.clearCSSAnimationProperties=function(){if(this.selectors.length!=0)for(var a=this.viewController.view.layer.querySelectorAll(this.selectors.join(",")),b=a.length-1;b>=0;b--){var c=a[b];c.style.webkitAnimationName="";c.style.webkitAnimationDuration="";c.style.webkitAnimationDelay="";c.style.webkitAnimationIterationCount=""}};
iAd.ActionListManager.prototype.reset=function(a){this.clearCSSAnimationProperties();this.timers.forEach(clearTimeout);this.timers=[];this.actionQueue=[];this.actions.forEach(function(b){b.completed=false},this);this.viewController.exitState(this.actionList.cssClassName);this.viewController.exitState(this.actionList.cssClassName+iAd.ActionListManager.ACTIVE_STATE_SUFFIX);a!=true&&this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_DID_CANCEL,this.viewController,[["actionList",this.actionList]])};
iAd.ActionListManager.prototype.handleEvent=function(a){var b,c=a.type;if(c=="webkitAnimationEnd"||c=="webkitAnimationIteration")b=this.actionsByName[a.animationName];b==null||b.asynchronous||this.handleActionDidComplete(b)};iAd.ActionListManager.prototype.scriptActionDidComplete=function(a){this.handleActionDidComplete(a._action)};
iAd.ActionListManager.prototype.handleActionDidComplete=function(a){a.completed=true;this.completedActionCount++;this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_DID_PROGRESS,this.viewController,[["actionList",this.actionList],["action",a],["progress",this.totalIterations=="infinite"?0:(this.completedIterationCount*this.totalActions+this.completedActionCount)/(this.totalActions*this.totalIterations)]]);if(this.completedActionCount==this.totalActions){this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_DID_ITERATE,
this.viewController,[["actionList",this.actionList],["iteration",this.completedIterationCount]]);this.completedIterationCount++;if(this.totalIterations!="infinite"&&this.completedIterationCount==this.totalIterations){this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_WILL_COMPLETE,this.viewController,[["actionList",this.actionList]]);this.viewController.view.layer.removeEventListener("webkitAnimationEnd",this,true);this.usesAnimationIterationCount&&this.viewController.view.layer.removeEventListener("webkitAnimationIteration",
this,true);this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_DID_COMPLETE,this.viewController,[["actionList",this.actionList]]);this.viewController.exitState(this.actionList.cssClassName+iAd.ActionListManager.ACTIVE_STATE_SUFFIX)}else if(this.usesAnimationIterationCount){this.dispatchNotification(iAd.ActionListManager.ACTION_LIST_WILL_ITERATE,this.viewController,[["actionList",this.actionList],["iteration",this.completedIterationCount]]);this.completedActionCount=0}else{this.reset();this.callMethodNameAfterDelay("iterate",
0)}}else if(a=a.name)if(a=this.dependency[a])for(var b=0,c=a.length;b<c;b++){for(var d=a[b],e=d.startAfter,f=true,g=0,i=e.length;g<i;g++){var h=this.actionsByName[e[g]];if(h&&h.completed==false){f=false;break}}f&&this.actionQueue.push(d)}this.flushActionQueue()};
iAd.ActionListManager.prototype.flushActionQueue=function(){if(this.actionQueue.length!=0){var a=[],b={},c=this.viewController.view.layer;this.actionQueue.forEach(function(g){var i=g.type;if(i=="css"){i=c.querySelectorAll(g.selector);var h=i.length;if(h>0)for(var j=g.name,k=g.duration+"s",l=g.delay||"0s",p=0;p<h;p++){var m=i[p],n=m.id;if(!n)n=m.id=iAd.ActionListManager.uniqueId();var o=b[n];if(o){o.keyframeNames.push(j);o.durations.push(k);o.delays.push(l)}else b[n]={keyframeNames:[j],durations:[k],
delays:[l],element:m}}}else i=="script"&&this.timers.push(g.object.run());g.asynchronous&&a.push(g)},this);for(var d in b){var e=b[d],f=e.element;f.style.webkitAnimationName=e.keyframeNames.join(",");f.style.webkitAnimationDuration=e.durations.join(",");f.style.webkitAnimationDelay=e.delays.join(",");f.style.webkitAnimationFillMode="both";f.style.webkitAnimationIterationCount=this.usesAnimationIterationCount?this.totalIterations:""}this.actionQueue=[];a.forEach(this.handleActionDidComplete,this);
this.flushActionQueue()}};iAd.ActionListManager.uniqueId=function(){return"al-"+this._uid++};iAd.ActionListManager._uid=1;iAd.Archiver={};iAd.Archiver._uid=1;iAd.Archiver.WILL_ENCODE_OBJECT="willEncodeObjectToArchive";iAd.Archiver.DID_ENCODE_OBJECT="didEncodeObjectToArchive";iAd.Archiver.WILL_RESTORE_OBJECT="willRestoreFromArchive";iAd.Archiver.DID_RESTORE_OBJECT="didRestoreFromArchive";
iAd.Archiver.archive=function(a,b){if(!b){b={};return{__root:this.archive(a,b),__objects:b}}if(iAd.Utils.objectIsPrimitive(a))return a;else if(iAd.Utils.objectIsArray(a))return a.map(function(g){return this.archive(g,b)},this);var c=a._uid||(a._uid=this._uid++);if(!b[c]){var d=b[c]={};if(a instanceof iAd.Object){var e=a.constructor;d.__className=e._name;e=this.archivePropertiesForClass(e);iAd.Utils.objectHasMethod(a,iAd.Archiver.WILL_ENCODE_OBJECT)&&a[iAd.Archiver.WILL_ENCODE_OBJECT](d);for(var f in e)d[f]=
this.archive(a.archiveProperty(f),b);iAd.Utils.objectHasMethod(a,iAd.Archiver.DID_ENCODE_OBJECT)&&a[iAd.Archiver.DID_ENCODE_OBJECT](d)}else for(f in a)if(f!="_uid")d[f]=this.archive(a[f],b)}return{_uid:c}};iAd.Archiver.archiveToJSON=function(a){return JSON.stringify(this.archive(a))};
iAd.Archiver.archivePropertiesForClass=function(a){var b=a._archivePropertyMap;if(b)return b;b=a._archivePropertyMap={};var c=a.superclass;c&&iAd.Utils.copyPropertiesFromSourceToTarget(this.archivePropertiesForClass(c),b);var d=a.archivedProperties||[];c=0;for(var e=d.length;c<e;c++)b[d[c]]=true;a=a.excludedProperties||[];c=0;for(e=a.length;c<e;c++)delete b[a[c]];return b};
iAd.Archiver.restoreFromArchive=function(a,b,c){if(iAd.Utils.objectIsPrimitive(a))return a;else if(a.__root)return this.restoreFromArchive(a.__root,a.__objects,{});else if(a._uid){a=a._uid;return c[a]||(c[a]=this.restoreFromArchive(b[a],b,c))}else if(iAd.Utils.objectIsArray(a))return a.map(function(h){return this.restoreFromArchive(h,b,c)},this);else{var d={};for(var e in a)if(e!="__className")d[e]=this.restoreFromArchive(a[e],b,c);if(a.__className){var f=iAd.Utils.resolveObjectPath(a.__className),
g=f,i;do i=g.restoreFromArchive;while(!i&&(g=g.superclass));f=i?i.call(f,d):new f;iAd.Utils.objectHasMethod(f,iAd.Archiver.WILL_RESTORE_OBJECT)&&f[iAd.Archiver.WILL_RESTORE_OBJECT](a);for(e in d)f.restoreProperty(e,d[e]);iAd.Utils.objectHasMethod(f,iAd.Archiver.DID_RESTORE_OBJECT)&&f[iAd.Archiver.DID_RESTORE_OBJECT](a);return f}else return d}};iAd.Archiver.restoreWithJSONArchive=function(a){return a?this.restoreFromArchive(JSON.parse(a)):null};iAd.Archiver.objectReferences={};
iAd.Archiver.referenceForObject=function(a){var b=this.objectReferences,c;if(a.__archiveReference){c=a.__archiveReference;b[c].count++;return c}c=++this._uid;b[c]={object:a,count:1};return a.__archiveReference=c};iAd.Archiver.objectForReference=function(a){var b=this.objectReferences,c=b[a];if(!c)return null;var d=c.object;c.count--;if(c.count<=0){delete b[a];delete d.__archiveReference}return d};
iAd.Class({name:"iAd.Loader",mixins:[iAd.EventTarget],synthesizedProperties:["supportingObject","progress","url","resolvedURL","timeout"]});iAd.Loader.DID_START="loaderDidStart";iAd.Loader.DID_PROGRESS="loaderDidProgress";iAd.Loader.DID_COMPLETE="loaderDidComplete";iAd.Loader.DID_FAIL="loaderDidFail";iAd.Loader.NO_ERROR=0;iAd.Loader.LOAD_ERROR=1;iAd.Loader.LOAD_ABORTED=2;iAd.Loader.LOAD_TIMED_OUT=3;iAd.Loader.DEFAULT_TIMEOUT=0;
iAd.Loader.prototype.init=function(a){this.callSuper();this._url=a;this._timeout=-1;this.delegate=null;this.loaded=this.loading=false;this.error=iAd.Loader.NO_ERROR;this.eventTarget=document};iAd.Loader.prototype.load=function(){if(this.loading)return false;this.loading=true;this.loaded=false;this.error=iAd.Loader.NO_ERROR;this.startTimeoutTimer();this.notifyLoaderDidStart();this.startLoad();return true};
iAd.Loader.prototype.abort=function(){if(!this.loading||this.loaded)return false;this.loaded=this.loading=false;this.cancelTimeoutTimer();this.abortLoad();this.notifyLoaderDidFail(iAd.Loader.LOAD_ABORTED);return true};iAd.Loader.prototype.getProgress=function(){return this.loaded?1:0};iAd.Loader.prototype.setUrl=function(a){if(this.loading||this.loaded)iAd.Console.warn("iAd.Loader: You cannot change the url after starting the load.");else this._url=a};iAd.Loader.prototype.getResolvedURL=function(){return iAd.Path.resolveAbsolutePath(this._url)};
iAd.Loader.prototype.getTimeout=function(){return this._timeout>=0?this._timeout:this.constructor.DEFAULT_TIMEOUT};iAd.Loader.prototype.startLoad=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_ERROR)};iAd.Loader.prototype.abortLoad=function(){};iAd.Loader.prototype.startTimeoutTimer=function(){if(this.timeout>0)this.timeoutTimer=this.callMethodNameAfterDelay("handleTimeout",this.timeout)};
iAd.Loader.prototype.cancelTimeoutTimer=function(){this.timeoutTimer&&clearTimeout(this.timeoutTimer);this.timeoutTimer=null};iAd.Loader.prototype.handleTimeout=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_TIMED_OUT)};iAd.Loader.prototype.notifyLoaderDidStart=function(){this.loading=true;this.dispatchLoaderNotification(iAd.Loader.DID_START)};iAd.Loader.prototype.notifyLoaderDidProgress=function(){this.dispatchLoaderNotification(iAd.Loader.DID_PROGRESS,[["progress",this.progress]])};
iAd.Loader.prototype.notifyLoaderDidFail=function(a){this.loading=false;this.error=a;this.dispatchLoaderNotification(iAd.Loader.DID_FAIL,[["error",a||iAd.Loader.LOAD_ERROR]])};iAd.Loader.prototype.notifyLoaderDidComplete=function(){this.loading=false;this.loaded=true;this.dispatchLoaderNotification(iAd.Loader.DID_COMPLETE)};iAd.Loader.prototype.dispatchLoaderNotification=function(a,b){this.dispatchNotification(a,this.delegate,b);this.notifyDelegate(a,this._manager,b)};
iAd.Class({name:"iAd.LoaderManager",superclass:iAd.Loader,synthesizedProperties:["length"]});iAd.LoaderManager.DID_PROGRESS="loaderDidProgress";iAd.LoaderManager.prototype.init=function(a){this.callSuper();this._progress=0;this.loaders=a||[];this.pendingLoaders=this.loaders.slice();this.failedLoaders=[];this.completedLoaders=[];this.openLoaders=[]};
iAd.LoaderManager.prototype.add=function(a){if(this.contains(a)){iAd.Console.warn(this.constructor.displayName+": Unable to add loader again if already managed.");return false}if(a.error||a.loaded||a.loading){iAd.Console.warn(this.constructor.displayName+": Unable to add a loader that has already started to load.");return false}this.loaders.push(a);this.pendingLoaders.push(a);this.loading&&this.updateProgress();return true};
iAd.LoaderManager.prototype.remove=function(a){if(this.loading){iAd.Console.warn(this.constructor.displayName+": Unable to remove loaders from a manager that has already started to load.");return false}if(this.contains(a)&&this.pendingLoaders.indexOf(a)==-1){iAd.Console.warn(this.constructor.displayName+": Unable to remove a loader that has already started to load.");return false}var b=iAd.Array.removeObjectFromArray(a,this.loaders);iAd.Array.removeObjectFromArray(a,this.pendingLoaders);return b};
iAd.LoaderManager.prototype.clear=function(){if(this.loading)iAd.Console.warn(this.constructor.displayName+": You cannot clear while loading is in progress.");else{this.resetLoaderArrays();this.updateProgress()}};iAd.LoaderManager.prototype.contains=function(a){return this.loaders.indexOf(a)!=-1};iAd.LoaderManager.prototype.resetLoaderArrays=function(){this.pendingLoaders=[];this.completedLoaders=[];this.openLoaders=[];this.failedLoaders=[];this.loaders=[]};
iAd.LoaderManager.prototype.getProgress=function(){return this._progress};iAd.LoaderManager.prototype.updateProgress=function(){var a=this.length;if(a==0)this._progress=0;else{for(var b=this.loaders,c=0,d=0,e,f,g=0;g<a;g++){e=b[g];f=e.length||1;c+=f;d+=f*e.progress}this._progress=d/c}};iAd.LoaderManager.prototype.getLength=function(){return this.loaders.length};iAd.LoaderManager.prototype.startLoad=function(){this._progress=0;this.openLoaders=[];this.completedLoaders=[];this.failedLoaders=[]};
iAd.LoaderManager.prototype.abortLoad=function(){for(var a=0,b=this.openLoaders.length;a<b;a++)this.openLoaders[a].abort();return true};iAd.LoaderManager.prototype.loadNextItem=function(){if(this.pendingLoaders.length!=0){var a=this.pendingLoaders.shift();this.openLoaders.push(a);a._manager=this;a.callMethodNameAfterDelay("load",0)}};iAd.LoaderManager.prototype.loaderDidComplete=function(a){this.completedLoaders.push(a);this.loaderDidEnd(a)};
iAd.LoaderManager.prototype.loaderDidFail=function(a){this.failedLoaders.push(a);this.loaderDidEnd(a)};iAd.LoaderManager.prototype.loaderDidProgress=function(a,b,c){this.notifyLoaderDidProgress(c||a)};iAd.LoaderManager.prototype.loaderDidEnd=function(a){iAd.Array.removeObjectFromArray(a,this.openLoaders);delete a._manager;this.notifyLoaderDidProgress(a)};
iAd.LoaderManager.prototype.notifyLoaderDidProgress=function(a){this.updateProgress();this.dispatchLoaderNotification(iAd.Loader.DID_PROGRESS,[["progress",this.progress],["relatedLoader",a]])};iAd.Class({name:"iAd.LoaderBatch",superclass:iAd.LoaderManager});iAd.LoaderBatch.prototype.add=function(a){if(this.callSuper(a)&&this.loading){this.loadNextItem();this.notifyLoaderDidProgress()}};
iAd.LoaderBatch.prototype.startLoad=function(){this.callSuper();for(var a=this.pendingLoaders;a.length>0;)this.loadNextItem();return true};iAd.LoaderBatch.prototype.loaderDidComplete=function(a){this.callSuper(a);this.checkLoaderDidComplete()};iAd.LoaderBatch.prototype.loaderDidFail=function(a,b){this.callSuper(a,b);this.checkLoaderDidComplete()};iAd.LoaderBatch.prototype.checkLoaderDidComplete=function(){this.openLoaders.length==0&&this.notifyLoaderDidComplete()};
iAd.Class({name:"iAd.StyleLoader",superclass:iAd.Loader});iAd.StyleLoader.DEFAULT_TIMEOUT=0;iAd.StyleLoader.prototype.startLoad=function(){var a=this._element=document.createElement("link");a.rel="stylesheet";a.href=this._url;if(iAd.CSS.isStyleSheetLoaded(this.resolvedURL)){this._element=iAd.CSS.elementForStyleSheet(this.resolvedURL);this.notifyLoaderDidComplete()}else{document.head.appendChild(a);iAd.StyleLoader.enqueueStyleLoader(this)}};
iAd.StyleLoader.prototype.abortLoad=function(){if(this._element){document.head.removeChild(this._element);iAd.StyleLoader.dequeueStyleLoader(this)}};iAd.StyleLoader.prototype.getSupportingObject=function(){return this._element};iAd.StyleLoader.prototype.getResolvedURL=function(){return this._element?this._element.href:this.callSuper()};iAd.StyleLoader.stylesheetsLoadingQueue={};iAd.StyleLoader.stylesheetsLoadPoller=null;
iAd.StyleLoader.enqueueStyleLoader=function(a){var b=a.resolvedURL,c=iAd.StyleLoader.stylesheetsLoadingQueue;if(c.hasOwnProperty(b))c[b].push(a);else c[b]=[a];if(iAd.StyleLoader.stylesheetsLoadPoller==null)iAd.StyleLoader.stylesheetsLoadPoller=window.setInterval(iAd.StyleLoader.pollStylesheetLoad,50)};iAd.StyleLoader.dequeueStyleLoader=function(a){var b=iAd.StyleLoader.stylesheetsLoadingQueue,c=a.resolvedURL;b.hasOwnProperty(c)&&iAd.Array.removeObjectFromArray(a,b[c]);b[c].length==0&&delete b[c]};
iAd.StyleLoader.pollStylesheetLoad=function(){var a=iAd.StyleLoader.stylesheetsLoadingQueue;for(var b in a)if(iAd.CSS.isStyleSheetLoaded(b)){a[b].forEach(function(c){c.notifyLoaderDidComplete()});delete a[b]}if(Object.keys(a).length==0){window.clearInterval(iAd.StyleLoader.stylesheetsLoadPoller);iAd.StyleLoader.stylesheetsLoadPoller=null}};iAd.Class({name:"iAd.XHRLoader",superclass:iAd.Loader,synthesizedProperties:["xmlContent","content"]});
iAd.XHRLoader.XHR_EVENTS=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"];iAd.XHRLoader.DEFAULT_TIMEOUT=0;iAd.XHRLoader.prototype.init=function(a,b,c){this.callSuper(a);this.method=b||"GET";this.params=c;this.headers={};this.urlEncoded=true};iAd.XHRLoader.prototype.getContent=function(){return this._xhr?this._xhr.responseText:null};iAd.XHRLoader.prototype.getXmlContent=function(){return this._xhr?this._xhr.responseXML:null};
iAd.XHRLoader.prototype.getSupportingObject=function(){return this._xhr};iAd.XHRLoader.prototype.getProgress=function(){if(this.loaded)return 1;return this.bytesTotal?this.bytesLoaded/this.bytesTotal:0};iAd.XHRLoader.prototype.getResolvedURL=function(){return iAd.Path.resolveAbsolutePath(this.shouldSerializeURL()?this.serializeURL():this._url)};
iAd.XHRLoader.prototype.startLoad=function(){var a=this.shouldSerializeURL()?this.serializeURL():this._url,b=this.method.toUpperCase(),c=this.params;if(b=="GET")c=null;if(this.urlEncoded&&(b=="POST"||b=="PUT")){this.headers["Content-type"]="application/x-www-form-urlencoded; charset=utf-8";if(c){c=this.serializeQueryString(c);this.headers["Content-length"]=c.length}}if(!this._xhr)this._xhr=new XMLHttpRequest;this.addXHRListeners();this._xhr.open(b,a,true);for(var d in this.headers)try{this._xhr.setRequestHeader(d,
this.headers[d])}catch(e){iAd.Console.warn('iAd.XHRLoader: Error when attempting to set header "'+d+'".')}this.bytesLoaded=this.bytesTotal=0;this._xhr.send(c)};iAd.XHRLoader.prototype.abortLoad=function(){if(this._xhr){this._xhr.abort();this.removeXHRListeners();this._xhr=null}};iAd.XHRLoader.prototype.serializeURL=function(){var a=this._url,b=a.indexOf("?")!=-1?"&":"?";return this.params?a+b+this.serializeParams():a};iAd.XHRLoader.prototype.serializeParams=function(){return iAd.Path.objectToQueryString(this.params)};
iAd.XHRLoader.prototype.shouldSerializeURL=function(){return this.method.toUpperCase()=="GET"&&!!this.params};iAd.XHRLoader.prototype.addXHRListeners=function(){for(var a=iAd.XHRLoader.XHR_EVENTS,b=0,c=a.length;b<c;b++)this._xhr.addEventListener(a[b],this)};iAd.XHRLoader.prototype.removeXHRListeners=function(){for(var a=iAd.XHRLoader.XHR_EVENTS,b=0,c=a.length;b<c;b++)this._xhr.removeEventListener(a[b],this)};
iAd.XHRLoader.prototype.handleEvent=function(a){switch(a.type){case "load":this.handleLoadEvent(a);break;case "progress":this.handleProgressEvent(a);break;case "abort":this.handleAbortEvent(a);break;case "error":this.handleErrorEvent(a)}};iAd.XHRLoader.prototype.handleLoadEvent=function(){this.notifyLoaderDidComplete()};iAd.XHRLoader.prototype.handleProgressEvent=function(a){if(a.lengthComputable){this.bytesLoaded=a.loaded;this.bytesTotal=a.total}this.notifyLoaderDidProgress()};
iAd.XHRLoader.prototype.handleAbortEvent=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_ABORTED)};iAd.XHRLoader.prototype.handleErrorEvent=function(){this.notifyLoaderDidFail(iAd.Loader.LOAD_ERROR)};iAd.Class({name:"iAd.ScriptLoader",superclass:iAd.Loader});iAd.ScriptLoader.DEFAULT_TIMEOUT=0;
iAd.ScriptLoader.prototype.startLoad=function(){var a=this._element=document.createElement("script");a.type="text/javascript";a.src=this._url;var b=iAd.ScriptLoader.elementForScript(a.src);if(b){this._element=b;this.notifyLoaderDidComplete()}else{this.addElementListeners();document.head.appendChild(a)}};iAd.ScriptLoader.prototype.abortLoad=function(){if(this._element){document.head.removeChild(this._element);this.removeElementListeners()}};iAd.ScriptLoader.prototype.getSupportingObject=function(){return this._element};
iAd.ScriptLoader.prototype.getResolvedURL=function(){return this._element?this._element.src:this.callSuper()};iAd.ScriptLoader.prototype.addElementListeners=function(){if(this._element){this._element.addEventListener("load",this,false);this._element.addEventListener("error",this,false)}};iAd.ScriptLoader.prototype.removeElementListeners=function(){if(this._element){this._element.removeEventListener("load",this,false);this._element.removeEventListener("error",this,false)}};
iAd.ScriptLoader.prototype.handleEvent=function(a){this.removeElementListeners();if(a.type=="load")this.notifyLoaderDidComplete();else a.type=="error"&&this.notifyLoaderDidFail(iAd.Loader.LOAD_ERROR)};iAd.ScriptLoader.elementForScript=function(a){for(var b,c=document.scripts,d=0,e=c.length;d<e;d++){b=c[d];if(b.href==a)return b}return null};iAd.Class({name:"iAd.ImageLoader",superclass:iAd.Loader});iAd.ImageLoader.DEFAULT_TIMEOUT=5;
iAd.ImageLoader.prototype.init=function(a,b){this.callSuper(a);this.hasHiDPIVersion=b};iAd.ImageLoader.prototype.startLoad=function(){var a=this._img=document.createElement("img");this.addImageEventListeners();a.src=this.processImageURL(this._url,this.hasHiDPIVersion)};iAd.ImageLoader.prototype.processImageURL=function(a,b){return b&&iAd.Device.HAS_HIDPI_DISPLAY?iAd.Path.appendHiDPISuffix(a):a};iAd.ImageLoader.prototype.abortLoad=function(){this.removeImageEventListeners()};
iAd.ImageLoader.prototype.getSupportingObject=function(){return this._img};iAd.ImageLoader.prototype.getResolvedURL=function(){return this.processImageURL(this.callSuper(),this.hasHiDPIVersion)};iAd.ImageLoader.prototype.handleEvent=function(a){this.removeImageEventListeners();if(a.type=="load")this.notifyLoaderDidComplete();else a.type=="error"&&this.notifyLoaderDidFail(iAd.Loader.LOAD_ERROR)};
iAd.ImageLoader.prototype.addImageEventListeners=function(){if(this._img){this._img.addEventListener("load",this);this._img.addEventListener("error",this)}};iAd.ImageLoader.prototype.removeImageEventListeners=function(){if(this._img){this._img.removeEventListener("load",this);this._img.removeEventListener("error",this)}};iAd.Class({name:"iAd.ViewControllerRequiredFilesLoader",superclass:iAd.LoaderBatch,synthesizedProperties:["contentViewMarkup"]});
iAd.ViewControllerRequiredFilesLoader.LOADER_CLASSES={stylesheets:iAd.StyleLoader,scripts:iAd.ScriptLoader,images:iAd.ImageLoader,contentView:iAd.XHRLoader};iAd.ViewControllerRequiredFilesLoader.prototype.init=function(a){this.callSuper();this.viewController=a;a=a.configuration;a.requiredFileURIs&&this.processFiles(a.requiredFileURIs)};iAd.ViewControllerRequiredFilesLoader.prototype.getContentViewMarkup=function(){return this.contentViewLoader.content};
iAd.ViewControllerRequiredFilesLoader.prototype.processFiles=function(a){for(var b in a)if(a.hasOwnProperty(b))switch(b){case "contentView":this.contentViewLoader=this.addFilesOfType([a[b]],b)[0];break;case "stylesheets":this.addFilesOfType(a[b],b);break;case "scripts":this.addFilesOfType(a[b],b);break;case "images":this.addFilesOfType(a[b],b);break;default:iAd.Console.warn('iAd.ViewController # loadRequiredFiles : unknown key "'+b+'" in configuration.requiredFileURIs')}};
iAd.ViewControllerRequiredFilesLoader.prototype.addFilesOfType=function(a,b){var c=iAd.ViewControllerRequiredFilesLoader.LOADER_CLASSES[b];if(c){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];g=c==iAd.ImageLoader?new c(g,this.viewController.configuration.hasHiDPIVersion):new c(g);this.add(g);d.push(g)}return d}else iAd.Console.warn('iAd.ViewController #loadRequiredFiles : No known loader for type "'+b+'"')};
iAd.ViewControllerRequiredFilesLoader.prototype.notifyLoaderDidProgress=function(a){this.callSuper(a);this.viewController.requiredFilesLoaderDidProgress(this,this.progress,a)};iAd.ViewControllerRequiredFilesLoader.prototype.notifyLoaderDidFail=function(a){this.callSuper(a);this.viewController.requiredFilesLoaderDidFail(this,a)};iAd.ViewControllerRequiredFilesLoader.prototype.notifyLoaderDidComplete=function(){this.callSuper();this.viewController.requiredFilesLoaderDidComplete(this)};
iAd.Class({name:"iAd.ViewController",superclass:iAd.Object,mixins:[iAd.EventTarget],synthesizedProperties:["view","title","loadingRequiredFiles","loadedAllRequiredFiles","viewWasProcessed","contentView","interfaceOrientation","contentSizeForViewInPopover"],archivedProperties:["configuration","viewWasArchived","title","toolbarItems","requiredFilesLoadDelegate","stateChangeDelegate","actionListDelegate","wasBackItemTransition","becomesBackItemTransition","wasTopItemTransition","becomesTopItemTransition",
"becomesHiddenTransition","becomesVisibleTransition","buildInActionListShouldOccurAfterTransition","buildOutActionListShouldDelayTransition","disableLoadingViewController","viewLoadingDelaysTransition","contentSizeForViewInPopover","modalInPopover"]});iAd.ViewController.__minimalViewLoadingTime=0;
iAd.ViewController.prototype.init=function(a){this.actionListDelegate=this.stateChangeDelegate=this.requiredFilesLoadDelegate=null;this.callSuper();this.configuration={};this.viewWasArchived=this.viewIsLoaded=this.shouldProcessViewUponRequestsCompleted=this.shouldSetUpContentViewUponLoad=false;this.shouldArchiveView=true;if(iAd.Utils.objectIsString(a))this.configuration={id:a};else if(a!==undefined&&a!==null)this.configuration=a;this.id=this.configuration.id||iAd.ViewController.uniqueId();this._contentView=
this._view=null;this._title="";this._toolbarItems=this._navigationItem=this._tabBarItem=null;this._viewWasProcessed=false;this.outlets={};this.eventTarget=document;this.searchDisplayController=this.modalTransitionStyle=this.viewAppearancePropagationProperty=this.parentViewController=this.modalViewController=null;this.wasBackItemTransition=iAd.ViewController.TRANSITION_IN_FROM_LEFT;this.becomesBackItemTransition=iAd.ViewController.TRANSITION_OUT_TO_LEFT;this.wasTopItemTransition=iAd.ViewController.TRANSITION_OUT_TO_RIGHT;
this.becomesTopItemTransition=iAd.ViewController.TRANSITION_IN_FROM_RIGHT;this.becomesHiddenTransition=iAd.ViewController.TRANSITION_DISSOLVE_OUT;this.becomesVisibleTransition=iAd.ViewController.TRANSITION_DISSOLVE_IN;this.disableLoadingViewController=this.buildOutActionListShouldDelayTransition=this.buildInActionListShouldOccurAfterTransition=false;this.viewLoadingDelaysTransition=true;this.__minimalViewLoadingTime=iAd.ViewController.__minimalViewLoadingTime;this.contentSizeForViewInPopover=new iAd.Size(320,
1100);this.modalInPopover=false;iAd.ViewController.instances[this.id]=this;iAd.Utils.copyPropertiesFromSourceToTarget(this.configuration.properties,this);this.actionListManagersByName={};this.actionListByName={};this.actionListNameByClassName={};if(a=this.configuration.actionLists)for(var b=0,c=a.length;b<c;b++)this.loadActionList(a[b])};iAd.ViewController.restoreFromArchive=function(a){return new this(a.configuration)};iAd.ViewController.instances={};iAd.ViewController.viewProcessors=[];
iAd.ViewController.WILL_LOAD_REQUIRED_FILES="viewControllerWillLoadRequiredFiles";iAd.ViewController.PROGRESS_LOADING_REQUIRED_FILES="viewControllerProgressLoadingRequiredFiles";iAd.ViewController.DID_LOAD_REQUIRED_FILES="viewControllerDidLoadRequiredFiles";iAd.ViewController.DID_ABORT_LOAD_REQUIRED_FILES="viewControllerDidAbortLoadRequiredFiles";iAd.ViewController.DID_ENTER_STATE="viewControllerDidEnterState";iAd.ViewController.DID_EXIT_STATE="viewControllerDidExitState";
iAd.ViewController.ACTION_LIST_WILL_START="viewControllerActionListWillStart";iAd.ViewController.ACTION_LIST_DID_START="viewControllerActionListDidStart";iAd.ViewController.ACTION_LIST_WILL_ITERATE="viewControllerActionListWillIterate";iAd.ViewController.ACTION_LIST_DID_ITERATE="viewControllerActionListDidIterate";iAd.ViewController.ACTION_LIST_WILL_COMPLETE="viewControllerActionListWillComplete";iAd.ViewController.ACTION_LIST_DID_COMPLETE="viewControllerActionListDidComplete";
iAd.ViewController.ACTION_LIST_DID_CANCEL="viewControllerActionListDidCancel";iAd.ViewController.ACTION_LIST_DID_PROGRESS="viewControllerActionListDidProgress";iAd.ViewController.VIEW_WILL_APPEAR_STATE="ad-view-will-appear";iAd.ViewController.VIEW_DID_APPEAR_STATE="ad-view-did-appear";iAd.ViewController.VIEW_WILL_DISAPPEAR_STATE="ad-view-will-disappear";iAd.ViewController.VIEW_DID_DISAPPEAR_STATE="ad-view-did-disappear";
iAd.ViewController.APPEARANCE_STATES=[iAd.ViewController.VIEW_WILL_APPEAR_STATE,iAd.ViewController.VIEW_DID_APPEAR_STATE,iAd.ViewController.VIEW_WILL_DISAPPEAR_STATE,iAd.ViewController.VIEW_DID_DISAPPEAR_STATE];iAd.ViewController.VIEW_WILL_APPEAR_EVENT="viewControllerViewWillAppear";iAd.ViewController.VIEW_DID_APPEAR_EVENT="viewControllerViewDidAppear";iAd.ViewController.VIEW_WILL_DISAPPEAR_EVENT="viewControllerViewWillDisappear";iAd.ViewController.VIEW_DID_DISAPPEAR_EVENT="viewControllerViewDidDisappear";
iAd.ViewController.VIEW_DID_LOAD="viewControllerViewDidLoad";iAd.ViewController.VIEW_DID_UNLOAD="viewControllerViewDidUnload";iAd.ViewController.TRANSITION_IN_FROM_RIGHT={properties:["transform"],from:["translateX(100%)"],to:["translateX(0)"]};iAd.ViewController.TRANSITION_IN_FROM_LEFT={properties:["transform"],from:["translateX(-100%)"],to:["translateX(0)"]};iAd.ViewController.TRANSITION_OUT_TO_RIGHT={properties:["transform"],from:["translateX(0)"],to:["translateX(100%)"]};
iAd.ViewController.TRANSITION_OUT_TO_LEFT={properties:["transform"],from:["translateX(0)"],to:["translateX(-100%)"]};iAd.ViewController.TRANSITION_DISSOLVE_OUT={properties:["opacity"],from:[1],to:[0]};iAd.ViewController.TRANSITION_DISSOLVE_IN={properties:["opacity"],from:[0],to:[1]};iAd.ViewController.DECLARATIVE_MIME_TYPE="application/vnd.apple.iadjs; type=view-controllers";iAd.ViewController.ARCHIVE_PREFIX=window.location.href+":";iAd.ViewController.VIEW_ARCHIVE_PREFIX=window.location.href+"-view:";
iAd.ViewController.prototype.getView=function(){if(this._view)return this._view;if(this.viewWasArchived){var a=iAd.ViewController.VIEW_ARCHIVE_PREFIX+this.id,b=window.localStorage[a];delete window.localStorage[a];this.viewWasArchived=false;this.view=iAd.Archiver.restoreWithJSONArchive(b)}this._view==null&&this.loadView();return this._view};
iAd.ViewController.prototype.setView=function(a){this._view instanceof iAd.View&&delete this._view._viewController;if(a==null){a=this.shouldArchiveView;this.shouldArchiveView=false;this.unloadView();this.shouldArchiveView=a}else{if(this.__minimalViewLoadingTime>0)this.__loadViewStartTime=new Date;a._viewController=this;this._view=a;var b=this.configuration;if(a.usesDeclarativeBacking&&a.layerHasCustomAttribute("ad-content-view")){if(!b.requiredFileURIs)b.requiredFileURIs={};b.requiredFileURIs.contentView=
a.getLayerCustomAttributeValue("ad-content-view")}if(b.requiredFileURIs&&b.requiredFileURIs.contentView)this.loadContentView();else if(b.requiredFileURIs&&!this.loadedAllRequiredFiles){this.shouldProcessViewUponRequestsCompleted=true;this.loadingRequiredFiles||this.loadRequiredFiles()}else this.processView()}};iAd.ViewController.prototype.setContentView=function(a){a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this._contentView=a};
iAd.ViewController.prototype.loadView=function(){this.view=new iAd.View};iAd.ViewController.prototype.loadContentView=function(){if(this.loadingRequiredFiles)this.shouldSetUpContentViewUponLoad=true;else if(this.loadedAllRequiredFiles)this.setupContentViewFromLayer();else{this.shouldSetUpContentViewUponLoad=true;this.loadRequiredFiles()}};
iAd.ViewController.prototype.unloadView=function(){if(!(this._view==null||!this.isViewLoaded())){this.archiveView();this._contentView=null;this._view.removeFromSuperview();this._view=null;this.cleanViewProcessors();this.viewIsLoaded=false;this.viewDidUnload()}};
iAd.ViewController.prototype.archiveView=function(){if(!(!this.shouldArchiveView||!this._view||this._contentView)){window.localStorage[iAd.ViewController.VIEW_ARCHIVE_PREFIX+this.id]=iAd.Archiver.archiveToJSON(this._view);this.viewWasArchived=true}};iAd.ViewController.prototype.willEncodeObjectToArchive=function(a){this.archiveView();this.callSuper(a)};iAd.ViewController.prototype.archiveProperty=function(a){var b=this.callSuper(a);if(a=="configuration")b.id=this.id;return b};
iAd.ViewController.prototype.isViewLoading=function(){return this.loadingRequiredFiles||this.loadedAllRequiredFiles&&!this.viewIsLoaded};iAd.ViewController.prototype.isViewLoaded=function(){return this.viewIsLoaded};iAd.ViewController.prototype.viewDidLoad=function(){this.createAndDispatchEvent(iAd.ViewController.VIEW_DID_LOAD)};iAd.ViewController.prototype.viewDidUnload=function(){this.createAndDispatchEvent(iAd.ViewController.VIEW_DID_UNLOAD)};
iAd.ViewController.prototype.didReceiveMemoryWarning=function(){this.parentViewController==null&&this.isViewLoaded()&&!document.body.contains(this.view.layer)&&this.unloadView()};iAd.ViewController.prototype.setTitle=function(a){this._title=a;var b=this.parentViewController;if(b!=null)if(iAd.TabBarController!=null&&b instanceof iAd.TabBarController)this.tabBarItem.title=a;else if(iAd.NavigationController!=null&&b instanceof iAd.NavigationController)this.navigationItem.title=a};
iAd.ViewController.prototype.isInState=function(a){return this.view.layer.hasClassName(a)};iAd.ViewController.prototype.enterState=function(a){var b=this.view.layer.addClassName(a);b&&this.dispatchNotification(iAd.ViewController.DID_ENTER_STATE,this.stateChangeDelegate,[["state",a]]);return b};iAd.ViewController.prototype.exitState=function(a){var b=this.view.layer.removeClassName(a);b&&this.dispatchNotification(iAd.ViewController.DID_EXIT_STATE,this.stateChangeDelegate,[["state",a]]);return b};
iAd.ViewController.prototype.toggleState=function(a,b){if(b==null)b=!this.isInState(a);this[b?"enterState":"exitState"](a)};iAd.ViewController.prototype.enterExclusiveAppearanceState=function(a){for(var b,c=0,d=iAd.ViewController.APPEARANCE_STATES.length;c<d;c++){b=iAd.ViewController.APPEARANCE_STATES[c];this[b===a?"enterState":"exitState"](b)}};
iAd.ViewController.prototype.propagateViewAppearanceIfNotInState=function(a,b,c){var d=this.viewAppearancePropagationProperty;(d=d?this[d]:null)&&!d.isInState(c)&&d[a](b)};iAd.ViewController.prototype.viewWillAppear=function(a){this.createAndDispatchEvent(iAd.ViewController.VIEW_WILL_APPEAR_EVENT,[["animated",a]]);this.enterExclusiveAppearanceState(iAd.ViewController.VIEW_WILL_APPEAR_STATE);this.propagateViewAppearanceIfNotInState("viewWillAppear",a,iAd.ViewController.VIEW_DID_APPEAR_STATE)};
iAd.ViewController.prototype.viewDidAppear=function(a){this.enterExclusiveAppearanceState(iAd.ViewController.VIEW_DID_APPEAR_STATE);this.createAndDispatchEvent(iAd.ViewController.VIEW_DID_APPEAR_EVENT,[["animated",a]]);this.propagateViewAppearanceIfNotInState("viewDidAppear",a,iAd.ViewController.VIEW_DID_APPEAR_STATE)};
iAd.ViewController.prototype.viewWillDisappear=function(a){this.createAndDispatchEvent(iAd.ViewController.VIEW_WILL_DISAPPEAR_EVENT,[["animated",a]]);this.enterExclusiveAppearanceState(iAd.ViewController.VIEW_WILL_DISAPPEAR_STATE);this.propagateViewAppearanceIfNotInState("viewWillDisappear",a,iAd.ViewController.VIEW_DID_DISAPPEAR_STATE)};
iAd.ViewController.prototype.viewDidDisappear=function(a){this.enterExclusiveAppearanceState(iAd.ViewController.VIEW_DID_DISAPPEAR_STATE);this.createAndDispatchEvent(iAd.ViewController.VIEW_DID_DISAPPEAR_EVENT,[["animated",a]]);this.propagateViewAppearanceIfNotInState("viewDidDisappear",a,iAd.ViewController.VIEW_DID_DISAPPEAR_STATE);this.resetAllActionLists()};iAd.ViewController.prototype.presentModalViewControllerAnimated=function(a){this.modalViewController=a};
iAd.ViewController.prototype.dismissModalViewControllerAnimated=function(){this.modalViewController=null};iAd.ViewController.prototype.parentControllerOfKind=function(a){for(var b=this;b=b.parentViewController;)if(b instanceof a)return b;return null};iAd.ViewController.prototype.getLoadingRequiredFiles=function(){return this.requiredFilesLoader&&this.requiredFilesLoader.loading};
iAd.ViewController.prototype.getLoadedAllRequiredFiles=function(){var a=this.requiredFilesLoader;return a&&(a.loaded||a.length==0)};
iAd.ViewController.prototype.loadRequiredFiles=function(){if(!this.loadedAllRequiredFiles){if(!this.requiredFilesLoader)this.requiredFilesLoader=new iAd.ViewControllerRequiredFilesLoader(this);this.dispatchNotification(iAd.ViewController.WILL_LOAD_REQUIRED_FILES,this.requiredFilesLoadDelegate);var a=this.requiredFilesLoader;if(a.length>0){a.load();this.notifyPropertyChange("loadingRequiredFiles")}else this.dispatchNotification(iAd.ViewController.DID_LOAD_REQUIRED_FILES,this.requiredFilesLoadDelegate)}};
iAd.ViewController.prototype.abortLoadRequiredFiles=function(){this.requiredFilesLoader.loading&&this.requiredFilesLoader.abort()};iAd.ViewController.prototype.handleEvent=function(){};
iAd.ViewController.prototype.setupContentViewFromLayer=function(){var a=iAd.Element.elementFromString(this.requiredFilesLoader.contentViewMarkup);this._view.hostingLayer.appendChild(a);if(!a.hasAttribute("id"))a.id=this.id;a=iAd.View.viewForLayer(a);a.superview=this._view;a._indexInSuperviewSubviews=this._view.subviews.push(a)-1;this.contentView=a;a.declarativeLayerWasInitialized?this.processView():a.addPropertyObserver("declarativeLayerWasInitialized",this,"processView")};
iAd.ViewController.prototype.requiredFilesLoaderDidProgress=function(a,b,c){if(c.loaded)this.dispatchNotification(iAd.ViewController.PROGRESS_LOADING_REQUIRED_FILES,this.requiredFilesLoadDelegate,[["progress",b],["url",c.url]]);else c.error&&iAd.Console.warn("iAd.ViewController \u2014 could not load required file with URI "+c.url)};
iAd.ViewController.prototype.requiredFilesLoaderDidComplete=function(){this.dispatchNotification(iAd.ViewController.DID_LOAD_REQUIRED_FILES,this.requiredFilesLoadDelegate);this.notifyPropertyChange("loadingRequiredFiles");if(this.shouldSetUpContentViewUponLoad)this.setupContentViewFromLayer();else this.shouldProcessViewUponRequestsCompleted&&this.processView()};
iAd.ViewController.prototype.requiredFilesLoaderDidFail=function(a,b){if(b==iAd.Loader.LOAD_ABORTED){for(var c=[],d=this.requiredFilesLoader.openLoaders,e=0,f=d.length;e<f;e++)c.push(d[e].url);this.notifyPropertyChange("loadingRequiredFiles");this.dispatchNotification(iAd.ViewController.DID_ABORT_LOAD_REQUIRED_FILES,this.requiredFilesLoadDelegate,[["uris",c]])}};
iAd.ViewController.prototype.processView=function(){if(!this._view.layer.hasAttribute("id"))this._view.id=this.id+(this.configuration.hasOwnProperty("requiredFileURIs")&&this.configuration.requiredFileURIs.hasOwnProperty("contentView")?"-container":"");this.viewProcessors=[];for(var a,b=0,c=iAd.ViewController.viewProcessors.length;b<c;b++){a=new iAd.ViewController.viewProcessors[b](this);a.processView(this._view);this.viewProcessors.push(a)}if(this.__minimalViewLoadingTime>0){a=(Date.now()-this.__loadViewStartTime)/
1E3;if(a<this.__minimalViewLoadingTime){this.callMethodNameAfterDelay("viewProcessingDidComplete",this.__minimalViewLoadingTime-a);return}}this.viewProcessingDidComplete()};iAd.ViewController.prototype.viewProcessingDidComplete=function(){if(!this.viewIsLoaded){this.viewIsLoaded=true;this.viewDidLoad()}this.viewWasProcessed=true};iAd.ViewController.prototype.cleanViewProcessors=function(){for(;this.viewProcessors.length;)this.viewProcessors.pop().cleanUp();this.viewWasProcessed=false};
iAd.ViewController.uniqueId=function(){return"vc-"+Math.floor(Math.random()*1E10)};iAd.ViewController.addViewProcessor=function(a){iAd.ViewController.viewProcessors.push(a)};
iAd.ViewController.init=function(){iAd.Class.processAllClasses();for(var a=document.scripts,b,c=0,d=a.length;c<d;c++){b=a[c];b.type==iAd.ViewController.DECLARATIVE_MIME_TYPE&&iAd.ViewController.handleScriptElementForDeclarativeViewControllers(b)}window.addEventListener("ADMemoryLevelWarning",iAd.ViewController.handleMemoryWarning,true);window.addEventListener("ADMemoryLevelUrgent",iAd.ViewController.handleMemoryWarning,true)};
iAd.ViewController.handleScriptElementForDeclarativeViewControllers=function(a){if(a.src!=""){var b=new XMLHttpRequest;b._url=a.src;b.addEventListener("load",this.handleEventProxy,false);b.addEventListener("error",this.handleEventProxy,false);b.open("GET",b._url,true);b.send()}else{var c=Function("undefined","return ("+a.textContent+");")();setTimeout(function(){iAd.ViewController.handleDeclarativeViewControllerDefinitions(c)},0)}};iAd.ViewController.handleEventProxy=function(a){iAd.ViewController.handleEvent(a)};
iAd.ViewController.handleEvent=function(a){var b=a.target;switch(a.type){case "load":a=Function("undefined","return ("+b.responseText+");")();iAd.ViewController.handleDeclarativeViewControllerDefinitions(a);break;case "error":iAd.Console.error("Failed to read content from JSON file "+b._url)}};iAd.ViewController.handleDeclarativeViewControllerDefinitions=function(a){if(iAd.Utils.objectIsArray(a))for(var b=0,c=a.length;b<c;b++)iAd.ViewController.viewControllerWithConfiguration(a[b]);else iAd.ViewController.viewControllerWithConfiguration(a)};
iAd.ViewController.viewControllerWithConfiguration=function(a){return new (iAd.ViewController.constructorMap[a.type]||iAd.ViewController)(a)};iAd.ViewController.constructorMap={};iAd.ViewController.handleMemoryWarning=function(){var a=iAd.ViewController.instances;for(var b in a)a[b].didReceiveMemoryWarning()};
iAd.ViewController.prototype.startAction=function(a){var b=iAd.Utils.resolveObjectPath(a.className);if(!b)throw iAd.ActionListManager.INVALID_CLASS_NAME_EXCEPTION;b=new b(this);var c=a.properties;for(var d in c)b[d]=c[d];if(a.delay)b.delay=a.delay;b.prepare();b.run()};
iAd.ViewController.prototype.loadActionList=function(a){var b=a.name,c=a.cssClassName;if(b&&a.actions.length>0){this.actionListByName[b]=a;if(c==null)a.cssClassName=c=b.replace(/\s+/g,"-").toLowerCase();this.actionListNameByClassName[c]=b}};iAd.ViewController.prototype.startActionList=function(a){var b=this.actionListByName[a];if(b){var c=this.actionListManagersByName[a];c||(this.actionListManagersByName[a]=c=new iAd.ActionListManager(b,this));c.callMethodNameAfterDelay("start",0)}};
iAd.ViewController.prototype.cancelActionList=function(a){(a=this.actionListManagersByName[a])&&a.reset()};iAd.ViewController.prototype.resetAllActionLists=function(){for(var a in this.actionListManagersByName)this.actionListManagersByName[a].reset()};iAd.ViewController.prototype.hasActionList=function(a){return!!this.actionListByName[a]};
iAd.ViewController.prototype.dispatchActionListNotification=function(a,b){this.notifyDelegate(a,this.transitionController,b);this.dispatchNotification(a,this.actionListDelegate,b)};iAd.ViewController.prototype.actionListWillStart=function(a,b){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_WILL_START,[["actionList",b]])};iAd.ViewController.prototype.actionListDidStart=function(a,b){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_DID_START,[["actionList",b]])};
iAd.ViewController.prototype.actionListWillIterate=function(a,b,c){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_WILL_ITERATE,[["actionList",b],["iteration",c]])};iAd.ViewController.prototype.actionListDidIterate=function(a,b,c){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_DID_ITERATE,[["actionList",b],["iteration",c]])};
iAd.ViewController.prototype.actionListWillComplete=function(a,b){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_WILL_COMPLETE,[["actionList",b]])};iAd.ViewController.prototype.actionListDidComplete=function(a,b){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_DID_COMPLETE,[["actionList",b]])};iAd.ViewController.prototype.actionListDidCancel=function(a,b){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_DID_CANCEL,[["actionList",b]])};
iAd.ViewController.prototype.actionListDidProgress=function(a,b,c,d){this.dispatchActionListNotification(iAd.ViewController.ACTION_LIST_DID_PROGRESS,[["actionList",b],["action",c],["progress",d]])};iAd.ViewController.orientationDidChange=function(a){var b=this.instances;for(var c in b)b[c].didRotateFromInterfaceOrientation(a)};iAd.ViewController.prototype.getInterfaceOrientation=function(){return iAd.Device.orientation};iAd.ViewController.prototype.didRotateFromInterfaceOrientation=function(){};
iAd.ViewController.prototype.archive=function(){window.localStorage[iAd.ViewController.ARCHIVE_PREFIX+this.id]=iAd.Archiver.archiveToJSON(this)};iAd.ViewController.restore=function(a){return(a=window.localStorage[iAd.ViewController.ARCHIVE_PREFIX+a])?iAd.Archiver.restoreWithJSONArchive(a):null};iAd.ViewController.clearArchives=function(){for(var a in window.localStorage)if(a.indexOf(iAd.ViewController.ARCHIVE_PREFIX)==0||a.indexOf(iAd.ViewController.VIEW_ARCHIVE_PREFIX)==0)delete window.localStorage[a]};
iAd.ViewController.initialize=function(){iAd.ViewController.constructorMap[this.displayName]=this};iAd.ViewController.stylesheetsLoadingQueue={};
iAd.ViewController.notifyWhenStylesheetIsLoaded=function(a,b){if(iAd.CSS.isStyleSheetLoaded(a)){b.stylesheetDidLoad(a);return true}var c=iAd.ViewController.stylesheetsLoadingQueue;if(c.hasOwnProperty(a))c[a].push(b);else c[a]=[b];if(iAd.ViewController.stylesheetsLoadPoller==null)iAd.ViewController.stylesheetsLoadPoller=window.setInterval(iAd.ViewController.pollStylesheetLoad,50);return false};
iAd.ViewController.pollStylesheetLoad=function(){var a=iAd.ViewController.stylesheetsLoadingQueue;for(var b in a)if(iAd.CSS.isStyleSheetLoaded(b)){a[b].forEach(function(c){c.stylesheetDidLoad(b)});delete a[b]}if(Object.keys(a).length==0){window.clearInterval(iAd.ViewController.stylesheetsLoadPoller);delete iAd.ViewController.stylesheetsLoadPoller}};
iAd.ViewController.removeFromStylesheetNotificationQueue=function(a,b){var c=iAd.ViewController.stylesheetsLoadingQueue;if(c.hasOwnProperty(a)){iAd.Array.removeObjectFromArray(b,c[a]);c[a].length==0&&delete c[a]}};iAd.View.prototype.containingViewController=function(){for(var a=this;a;){if(a._viewController)return a._viewController;a=a.superview}};iAd.Class.processMethods(iAd.View,["containingViewController"]);window.addEventListener("DOMContentLoaded",iAd.ViewController.init,true);
iAd.Class({name:"iAd.RootView",superclass:iAd.View,synthesizedProperties:["disablesDefaultScrolling","scrollsHorizontally","scrollsVertically"],archivedProperties:["disablesDefaultScrolling","scrollsHorizontally","scrollsVertically"],cssClassName:"ad-root-view"});
iAd.RootView.prototype.init=function(a){this.callSuper(a);if(this.layer===document.body){this.layerIsInDocument=true;this._size=new iAd.Size(window.innerWidth,window.innerHeight);this.layer.removeClassName("ad-view");window.addEventListener(iAd.Device.iOS_VERSION?"orientationchange":"resize",this,true)}this._scrollsHorizontally=false;this.disablesDefaultScrolling=this._scrollsVertically=true;iAd.RootView.sharedRoot=this};iAd.RootView.prototype.createLayer=function(){this.layer=document.body};
iAd.RootView.prototype.setDisablesDefaultScrolling=function(a){this._disablesDefaultScrolling=a;this.updateSize();iAd.HostScrollView||this.layer[a?"addEventListener":"removeEventListener"](iAd.Event.MOVE_EVENT,iAd.Event.preventDefault,false)};iAd.RootView.prototype.handleEvent=function(a){this.callSuper(a);if(a.type=="resize"||a.type=="orientationchange"){this.updateSize();this._disablesDefaultScrolling&&window.scrollTo(0,0)}};
iAd.RootView.prototype.updateSize=function(){if(this.layer===document.body)if(this._disablesDefaultScrolling)this.size=new iAd.Size(window.innerWidth,window.innerHeight);else{this._size=new iAd.Size(document.body.offsetWidth,document.body.offsetHeight);this.notifyPropertyChange("size")}};iAd.RootView._sharedRoot=null;
Object.defineProperty(iAd.RootView,"sharedRoot",{get:function(){if(iAd.RootView._sharedRoot==null)iAd.RootView._sharedRoot=new iAd.RootView;return iAd.RootView._sharedRoot},set:function(a){iAd.RootView._sharedRoot=a}});
iAd.RootView.init=function(){document.body.addClassName(iAd.Device.HAS_HIDPI_DISPLAY?"ad-HiDPI":"ad-LoDPI");iAd.Device.IS_IPAD&&document.body.addClassName("ad-iPad");if(iAd.RootView._sharedRoot==null){var a=document.querySelector("."+iAd.RootView.cssClassName);if(a!=null)iAd.RootView._sharedRoot=new iAd.RootView(a)}};window.addEventListener("DOMContentLoaded",iAd.RootView.init,true);iAd.Class({name:"iAd.RootViewController",superclass:iAd.ViewController,archivedProperties:["navigationController"]});
iAd.RootViewController.ID="root";iAd.RootViewController.prototype.init=function(a){a=a||{};a.id=iAd.RootViewController.ID;a.requiredFileURIs&&delete a.requiredFileURIs.contentView;this.callSuper(a);this.openBeginIgnoringInteractionEventsCalls=0;this.shouldArchiveView=false;iAd.RootViewController.sharedRootViewController=this};iAd.RootViewController.prototype.loadView=function(){this.view=iAd.RootView.sharedRoot};
iAd.RootViewController.prototype.archiveProperty=function(a){return a=="navigationController"?this._navigationController:this.callSuper(a)};iAd.RootViewController.prototype.beginIgnoringInteractionEvents=function(){this.openBeginIgnoringInteractionEventsCalls++;if(this.openBeginIgnoringInteractionEventsCalls==1)this.view.layer.style.pointerEvents="none"};
iAd.RootViewController.prototype.endIgnoringInteractionEvents=function(){if(this.openBeginIgnoringInteractionEventsCalls!=0){this.openBeginIgnoringInteractionEventsCalls--;if(this.openBeginIgnoringInteractionEventsCalls==0)this.view.layer.style.pointerEvents="auto"}};iAd.RootViewController.prototype.isIgnoringInteractionEvents=function(){return this.openBeginIgnoringInteractionEventsCalls>0};
Object.defineProperty(iAd.RootViewController,"sharedRootViewController",{get:function(){if(!iAd.RootViewController.hasOwnProperty("_sharedRootViewController")){var a=new iAd.RootViewController;iAd.RootViewController.sharedRootViewController=a}return iAd.RootViewController._sharedRootViewController},set:function(a){iAd.RootViewController._sharedRootViewController=a}});iAd.Transaction={transitions:[],openTransactions:0,defaults:{},defaultsStates:[]};
iAd.Transaction.begin=function(){if(this.openTransactions==0){this.transitions=[];this.defaults={}}else{var a={};iAd.Utils.copyPropertiesFromSourceToTarget(this.defaults,a);this.defaultsStates.push(a)}this.openTransactions++};iAd.Transaction.addTransition=function(a){for(var b in this.defaults)if(a[b]==null)a[b]=this.defaults[b];this.transitions.push(a)};
iAd.Transaction.commit=function(){if(this.openTransactions!=0){this.openTransactions--;if(this.openTransactions!=0)this.defaults=this.defaultsStates.pop();else{for(var a=this.transitions,b=0,c=a.length;b<c;b++)a[b].applyFromState();iAd.CSS.flushPendingUpdates();setTimeout(function(){for(;a.length;)a.pop().applyToState()},0)}}};iAd.Utils.setupDisplayNames(iAd.Transaction,"iAd.Transaction");
iAd.Class({name:"iAd.TransitionController",superclass:iAd.ViewController,synthesizedProperties:["visibleViewController","cachedViewControllers","loadingViewController"],archivedProperties:["visibleViewController","previouslyVisibleViewController","loadingViewController","loadingViewControllerMinimumDisplayTime"]});iAd.TransitionController.WILL_MAKE_VIEW_CONTROLLER_VISIBLE="transitionControllerWillMakeViewControllerVisibleAnimated";iAd.TransitionController.DID_MAKE_VIEW_CONTROLLER_VISIBLE="transitionControllerDidMakeViewControllerVisibleAnimated";
iAd.TransitionController.VIEW_IS_VISIBLE_STATE="ad-transition-controller-visible";iAd.TransitionController.VIEW_IS_HIDDEN_STATE="ad-transition-controller-hidden";iAd.TransitionController.VIEW_BUILDS_IN_STATE="ad-view-builds-in";iAd.TransitionController.VIEW_BUILDS_OUT_STATE="ad-view-builds-out";iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS="ad-view-builds-in-action-list";iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS="ad-view-builds-out-action-list";
iAd.TransitionController.VIEW_IDLE_STATE="ad-view-is-idle";iAd.TransitionController.DEFAULT_TRANSITION_DURATION=0.35;iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS="ad-waiting-on-display";
iAd.TransitionController.prototype.init=function(a,b){this.callSuper(a);this._cachedViewControllers=[];this._loadingViewController=this._visibleViewController=null;this.loadingViewControllerMinimumDisplayTime=0;this.loadingViewControllerVisible=false;this.delegate=null;this.hidesLoadingViewControllerWithTransition=true;this.previouslyVisibleViewController=null;this.busy=false;if(b!=undefined)this.visibleViewController=b};iAd.TransitionController.prototype.loadView=function(){this.view=new iAd.TransitionControllerView};
iAd.TransitionController.prototype.setCachedViewControllers=function(a){for(var b,c=this._cachedViewControllers,d=0,e=c.length;d<e;d++){b=c[d];b!==this._visibleViewController&&a.indexOf(b)==-1&&b.view.removeFromSuperview()}d=0;for(e=a.length;d<e;d++){b=a[d];b!==this._visibleViewController&&c.indexOf(b)==-1&&this.attachViewController(b)}this._cachedViewControllers=a.slice()};
iAd.TransitionController.prototype.attachViewController=function(a){a=a.view;a.layer.addClassName(iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS);a.superview!==this._view&&this._view.addSubview(a)};iAd.TransitionController.prototype.setVisibleViewController=function(a){this.setVisibleViewControllerAnimated(a,false)};
iAd.TransitionController.prototype.setVisibleViewControllerAnimated=function(a,b){if(!(this.busy||this._visibleViewController===a)){iAd.RootViewController.sharedRootViewController.beginIgnoringInteractionEvents();this.transitionIsDelayedByPreviouslyVisibleViewController=false;this.previouslyVisibleViewController=this._visibleViewController;if(this._visibleViewController=a)a._transitionController=this;if(this.previouslyVisibleViewController!=null){this.previouslyVisibleViewController.viewWillDisappear(b);
this.transitionIsDelayedByPreviouslyVisibleViewController=this.prepareToHideViewController(this.previouslyVisibleViewController)}if(a==null)this.performTransitionToViewController(a,b);else{this.attachViewController(a);this.nextVisibleViewController=a;this.willUseAnimationToTransitionToNextVisibleViewController=b;this.transitionIsDelayedByPreviouslyVisibleViewController||this.previousViewControllerDidUnblockTransitions();a.isViewLoaded()||a.addPropertyObserver("viewWasProcessed",this,"viewControllerFinishedProcessingView")}}};
iAd.TransitionController.prototype.performTransitionToViewController=function(a,b){a!=null&&a.viewWillAppear(b);this.dispatchNotification(iAd.TransitionController.WILL_MAKE_VIEW_CONTROLLER_VISIBLE,this.delegate,[["newlyVisibleViewController",a],["previouslyVisibleViewController",this.previouslyVisibleViewController],["animated",b]]);a!=null&&this.prepareToShowViewController(a);iAd.Transaction.begin();var c,d=null;this.busy=b;iAd.Transaction.begin();iAd.Transaction.defaults.duration=b?iAd.TransitionController.DEFAULT_TRANSITION_DURATION:
0;if(this.previouslyVisibleViewController!=null){c=b?this.previouslyVisibleViewController.becomesHiddenTransition:null;if(c!=null)c=this.viewForTransition(this.previouslyVisibleViewController).applyTransition(c,false)}if(a!=null){d=b?a.becomesVisibleTransition:null;if(d!=null)d=this.viewForTransition(a).applyTransition(d,false)}if(d instanceof iAd.Transition)d.delegate=this;else if(c instanceof iAd.Transition)c.delegate=this;else b=false;iAd.Transaction.commit();if(a!=null)d?setTimeout(function(){a.view.layer.removeClassName(iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS)},
0):a.view.layer.removeClassName(iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS);this.hidesLoadingViewControllerWithTransition&&this.hideLoadingViewController();iAd.Transaction.commit();b||this.transitionDidComplete()};
iAd.TransitionController.prototype.performBuildInToViewController=function(a){var b=a.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS];if(b){a.enterState(iAd.TransitionController.VIEW_BUILDS_IN_STATE);a.callMethodNameAfterDelay("startActionList",0,b)}};
iAd.TransitionController.prototype.prepareToHideViewController=function(a){var b=false;a.exitState(iAd.TransitionController.VIEW_IS_VISIBLE_STATE);a.enterState(iAd.TransitionController.VIEW_IS_HIDDEN_STATE);a.exitState(iAd.TransitionController.VIEW_IDLE_STATE);var c=a.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS];if(c){a.enterState(iAd.TransitionController.VIEW_BUILDS_OUT_STATE);a.startActionList(c);if(a.buildOutActionListShouldDelayTransition)b=true}return b};
iAd.TransitionController.prototype.prepareToShowViewController=function(a){a.exitState(iAd.TransitionController.VIEW_BUILDS_OUT_STATE);a.exitState(iAd.TransitionController.VIEW_IS_HIDDEN_STATE);a.enterState(iAd.TransitionController.VIEW_IS_VISIBLE_STATE);a.exitState(iAd.TransitionController.VIEW_IDLE_STATE);a.buildInActionListShouldOccurAfterTransition||this.performBuildInToViewController(a)};
iAd.TransitionController.prototype.viewControllerActionListDidComplete=function(a,b){if(a.isInState(iAd.TransitionController.VIEW_BUILDS_IN_STATE)||a.isInState(iAd.TransitionController.VIEW_BUILDS_OUT_STATE)){var c=b.cssClassName;if(c===iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS){a.exitState(iAd.TransitionController.VIEW_BUILDS_OUT_STATE);if(this.transitionIsDelayedByPreviouslyVisibleViewController){this.transitionIsDelayedByPreviouslyVisibleViewController=false;this.previousViewControllerDidUnblockTransitions()}else if(a===
this._loadingViewController){this.detachLoadingViewControllerAnimated(a.becomesHiddenTransition!=null);a.buildOutActionListShouldDelayTransition&&this.showNextViewControllerIfReady()}}else if(c===iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS){a.exitState(iAd.TransitionController.VIEW_BUILDS_IN_STATE);if(!this.busy){a.enterState(iAd.TransitionController.VIEW_IDLE_STATE);a===this._loadingViewController&&this.showNextViewControllerIfReady()}}}};
iAd.TransitionController.prototype.viewControllerFinishedProcessingView=function(a){a.removePropertyObserver("viewWasProcessed",this);this.showNextViewControllerIfReady()};iAd.TransitionController.prototype.previousViewControllerDidUnblockTransitions=function(){var a=this.nextVisibleViewController,b=a.viewLoadingDelaysTransition&&!a.isViewLoaded();if(!a.disableLoadingViewController&&this._loadingViewController&&b)this.showLoadingViewController();else b||this.performTransitionToViewController(a,this.willUseAnimationToTransitionToNextVisibleViewController)};
iAd.TransitionController.prototype.viewForTransition=function(a){var b=a.view;if(b.size.equals(iAd.Size.ZERO_SIZE)&&a.contentView!=null)b=a.contentView;return b};iAd.TransitionController.prototype.viewControllerViewDidAppear=function(a,b){a.buildInActionListShouldOccurAfterTransition&&this.performBuildInToViewController(a);a.viewDidAppear(b)};iAd.TransitionController.prototype.viewControllerViewDidDisappear=function(a,b){a.viewDidDisappear(b)};
iAd.TransitionController.prototype.contentTransitionDidComplete=function(){iAd.RootViewController.sharedRootViewController.endIgnoringInteractionEvents();var a=this._wasAnimatedTransition=this.busy;if(this.previouslyVisibleViewController!=null){this._cachedViewControllers.indexOf(this.previouslyVisibleViewController)==-1?this.previouslyVisibleViewController.view.removeFromSuperview():this.previouslyVisibleViewController.view.layer.addClassName(iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS);
this.viewControllerViewDidDisappear(this.previouslyVisibleViewController,a)}if(this._visibleViewController!=null)this.loadingViewControllerVisible&&!this.hidesLoadingViewControllerWithTransition?this.hideLoadingViewController():this.notifyVisibleViewControllerDidAppear();this.busy=false;this.dispatchNotification(iAd.TransitionController.DID_MAKE_VIEW_CONTROLLER_VISIBLE,this.delegate,[["newlyVisibleViewController",this._visibleViewController],["previouslyVisibleViewController",this.previouslyVisibleViewController],
["animated",a]])};iAd.TransitionController.prototype.notifyVisibleViewControllerDidAppear=function(){this.viewControllerViewDidAppear(this._visibleViewController,this._wasAnimatedTransition);this._wasAnimatedTransition=false;if(!this._visibleViewController.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_IN_ACTION_LIST_CLASS]||!this._visibleViewController.isInState(iAd.TransitionController.VIEW_BUILDS_IN_STATE))this._visibleViewController.enterState(iAd.TransitionController.VIEW_IDLE_STATE)};
iAd.TransitionController.prototype.setLoadingViewController=function(a){if(!this.loadingViewControllerVisible){a&&!a.isViewLoading()&&!a.isViewLoaded()&&this.attachViewController(a);if(this._loadingViewController=a)a._transitionController=this}};
iAd.TransitionController.prototype.showLoadingViewController=function(){if(!(this.loadingViewControllerVisible||this._loadingViewController==null)){var a=this._loadingViewController,b=a.view,c=a.becomesVisibleTransition!=null;a.view.layer.removeClassName(iAd.TransitionController.WAITING_ON_DISPLAY_CSS_CLASS);a.viewWillAppear(c);this.prepareToShowViewController(this._loadingViewController);if(c){b.size=this._view.size.copy();b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;
b.applyTransition(a.becomesVisibleTransition,false).delegate=this}this._view.addSubview(b);this.loadingViewControllerVisible=true;if(this.loadingViewControllerMinimumDisplayTime>0){this.loadingViewDisplayTime=new Date;this.callMethodNameAfterDelay("showNextViewControllerIfReady",this.loadingViewControllerMinimumDisplayTime)}if(!c){this.viewControllerViewDidAppear(a,false);this.showNextViewControllerIfReady()}}};
iAd.TransitionController.prototype.hideLoadingViewController=function(){if(this.loadingViewControllerVisible){var a=this._loadingViewController;if(!a.isInState(iAd.ViewController.VIEW_WILL_DISAPPEAR_STATE)){var b=a.becomesHiddenTransition!=null;a.viewWillDisappear(b);this.prepareToHideViewController(a);a.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS]||this.detachLoadingViewControllerAnimated(b)}}};
iAd.TransitionController.prototype.detachLoadingViewControllerAnimated=function(a){var b=this._loadingViewController;if(a)b.view.applyTransition(b.becomesHiddenTransition,false).delegate=this;else{b.view.removeFromSuperview();this.viewControllerViewDidDisappear(b,false)}this.loadingViewControllerVisible=false};
iAd.TransitionController.prototype.loadingViewControllerTransitionDidComplete=function(){if(this.loadingViewControllerVisible){this.viewControllerViewDidAppear(this._loadingViewController,true);this.showNextViewControllerIfReady()}else{this._loadingViewController.view.removeFromSuperview();this.viewControllerViewDidDisappear(this._loadingViewController,true);this.hidesLoadingViewControllerWithTransition||this.notifyVisibleViewControllerDidAppear()}};
iAd.TransitionController.prototype.showNextViewControllerIfReady=function(){if(!this.transitionIsDelayedByPreviouslyVisibleViewController){if(this.loadingViewControllerVisible){var a=this._loadingViewController;if(a.isInState(iAd.TransitionController.VIEW_BUILDS_IN_STATE)||a.isInState(iAd.ViewController.VIEW_WILL_APPEAR_STATE))return;if(this.loadingViewControllerMinimumDisplayTime>0)if((Date.now()-this.loadingViewDisplayTime)/1E3<this.loadingViewControllerMinimumDisplayTime)return;if(this.hidesLoadingViewControllerWithTransition)if(a.actionListNameByClassName[iAd.TransitionController.VIEW_BUILDS_OUT_ACTION_LIST_CLASS]&&
a.buildOutActionListShouldDelayTransition){this.hideLoadingViewController();return}}(a=this.nextVisibleViewController)&&a.viewLoadingDelaysTransition&&!a.isViewLoaded()||a.isInState(iAd.ViewController.VIEW_WILL_APPEAR_STATE)||a.isInState(iAd.ViewController.VIEW_DID_APPEAR_STATE)||this.performTransitionToViewController(a,this.willUseAnimationToTransitionToNextVisibleViewController)}};
iAd.TransitionController.prototype.transitionDidComplete=function(a){a&&this._loadingViewController!=null&&a.target===this._loadingViewController.view?this.loadingViewControllerTransitionDidComplete(a):this.contentTransitionDidComplete(a)};iAd.Class({name:"iAd.TransitionControllerView",superclass:iAd.View,cssClassName:"ad-transition-controller-view"});iAd.TransitionControllerView.prototype.init=function(a){this.callSuper(a);this.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT};
iAd.TransitionControllerView.prototype.willMoveToSuperview=function(a){this.callSuper(a);if(a!=null&&this._size.equals(iAd.Size.ZERO_SIZE))this.size=a.size.copy()};iAd.ViewController.prototype.getTransitionController=function(){return this._transitionController||this.parentControllerOfKind(iAd.TransitionController)};iAd.Class.synthesizeProperties(iAd.ViewController,["transitionController"]);
iAd.RootViewController.prototype.getTransitionController=function(){if(!this.hasOwnProperty("_transitionController")){var a=iAd.RootView.sharedRoot,b=new iAd.TransitionController;b.view.size=a.size.copy();b.delegate=this;a.addSubview(b.view,0);this._transitionController=b}return this._transitionController};iAd.Class.synthesizeProperties(iAd.RootViewController,["transitionController"]);
iAd.Class({name:"iAd.StackController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","topViewController","visibleViewController"],archivedProperties:["viewControllers"]});iAd.StackController.WILL_SHOW_VIEW_CONTROLLER="navigationControllerWillShowViewControllerAnimated";iAd.StackController.DID_SHOW_VIEW_CONTROLLER="navigationControllerDidShowViewControllerAnimated";
iAd.StackController.prototype.init=function(a,b){this.callSuper(a);this.delegate=null;this._viewControllers=[];this.autoReversesTransitions=false;this.previousController=null;this.viewAppearancePropagationProperty="visibleViewController";this.shouldArchiveView=false;this.delayedSetOperationArguments=null;this.backingTransitionController=new iAd.TransitionController;this.backingTransitionController.delegate=this;if(b!=undefined)this.viewControllers=[b]};
iAd.StackController.prototype.loadView=function(){this.view=new iAd.StackControllerView;this.hostView=this._view.addSubview(this.backingTransitionController.view);this.hostView.layer.addClassName("ad-stack-controller-host-view");this.performDelayedSetOperation()};iAd.StackController.prototype.unloadView=function(){if(this.hostView){this.hostView.removeFromSuperview();this.hostView=null}this.callSuper()};
iAd.StackController.prototype.didReceiveMemoryWarning=function(){this.callSuper();for(var a=this._viewControllers.length-(this._view?2:0),b=0;b<a;b++)this._viewControllers[b].unloadView()};iAd.StackController.prototype.getTopViewController=function(){return this.viewControllers.length>0?this.viewControllers[this.viewControllers.length-1]:null};iAd.StackController.prototype.getVisibleViewController=function(){var a=this.topViewController;return a.modalViewController||a};
iAd.StackController.prototype.getViewControllers=function(){return this.delayedSetOperationArguments!=null?this.delayedSetOperationArguments[0]:this._viewControllers};iAd.StackController.prototype.setViewControllers=function(a){this.setViewControllersAnimated(a,false)};
iAd.StackController.prototype.setViewControllersAnimated=function(a,b){if(a.length!=0)if(this.shouldDelaySetOperation())this.delayedSetOperationArguments=arguments;else{iAd.Transaction.begin();var c=this._viewControllers.length>0?this._viewControllers[this._viewControllers.length-1]:null,d=a[a.length-1],e=this._viewControllers.indexOf(d)!=-1,f=!c&&b?this.shouldAnimateInitialViewController():b;this.dispatchWillShowNotification(d,f);for(var g=0,i=this._viewControllers.length;g<i;g++)this._viewControllers[g].parentViewController=
null;g=0;for(i=a.length;g<i;g++)a[g].parentViewController=this;this._viewControllers=a;this.prepareViewControllersForTransition(c,d,e);this.backingTransitionController.setVisibleViewControllerAnimated(d,f);iAd.Transaction.commit()}};
iAd.StackController.prototype.prepareViewControllersForTransition=function(a,b,c){if(a==null)b.becomesVisibleTransition=b.becomesTopItemTransition;else if(a!==b)if(this.autoReversesTransitions){a.becomesHiddenTransition=c?a.wasTopItemTransition:b.becomesBackItemTransition;b.becomesVisibleTransition=c?a.wasBackItemTransition:b.becomesTopItemTransition}else{a.becomesHiddenTransition=c?a.wasTopItemTransition:a.becomesBackItemTransition;b.becomesVisibleTransition=c?b.wasBackItemTransition:b.becomesTopItemTransition}};
iAd.StackController.prototype.shouldDelaySetOperation=function(){return!this.isViewLoaded()||this.backingTransitionController.busy};iAd.StackController.prototype.shouldAnimateInitialViewController=function(){return true};
iAd.StackController.prototype.pushViewControllerAnimated=function(a,b){this.viewControllers.indexOf(a)!=-1?iAd.Console.warn("iAd.StackController.prototype.pushViewControllerAnimated: attempt to push a view controller already in the stack"):this.setViewControllersAnimated(this.viewControllers.concat([a]),b)};
iAd.StackController.prototype.popViewControllerAnimated=function(a){if(this.viewControllers.length>1){var b=this.topViewController;this.setViewControllersAnimated(this.viewControllers.slice(0,this.viewControllers.length-1),a);return b}return null};iAd.StackController.prototype.popToRootViewControllerAnimated=function(a){return this.popToViewControllerAnimated(this.viewControllers[0],a)};
iAd.StackController.prototype.popToViewControllerAnimated=function(a,b){var c=this.viewControllers.indexOf(a);if(c<0||c>=this.viewControllers.length-1)return[];var d=this.viewControllers.slice(c+1);this.setViewControllersAnimated(this.viewControllers.slice(0,c+1),b);return d};iAd.StackController.prototype.transitionControllerWillMakeViewControllerVisibleAnimated=function(){};
iAd.StackController.prototype.transitionControllerDidMakeViewControllerVisibleAnimated=function(a,b,c,d){this.dispatchDidShowNotification(b,d);this.performDelayedSetOperation()};iAd.StackController.prototype.dispatchDidShowNotification=function(a,b){this.dispatchNotification(iAd.StackController.DID_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",a],["animated",b]])};
iAd.StackController.prototype.dispatchWillShowNotification=function(a,b){this.dispatchNotification(iAd.StackController.WILL_SHOW_VIEW_CONTROLLER,this.delegate,[["viewController",a],["animated",b]])};iAd.StackController.prototype.performDelayedSetOperation=function(){if(this.delayedSetOperationArguments!=null){this.setViewControllersAnimated(this.delayedSetOperationArguments[0],this.delayedSetOperationArguments[1]);this.delayedSetOperationArguments=null}};
iAd.Class({name:"iAd.StackControllerView",superclass:iAd.View,cssClassName:"ad-stack-controller-view"});iAd.StackControllerView.prototype.init=function(a){this.callSuper(a);this.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT};iAd.StackControllerView.prototype.willMoveToSuperview=function(a){this.callSuper(a);if(a!=null&&this._size.equals(iAd.Size.ZERO_SIZE))this.size=a.size.copy()};iAd.ViewController.prototype.getStackController=function(){return this.parentControllerOfKind(iAd.StackController)};
iAd.RootViewController.prototype.getStackController=function(){if(!this.hasOwnProperty("_stackController"))this.stackController=new iAd.StackController;return this._stackController};iAd.RootViewController.prototype.setStackController=function(a){var b=this.view;a.view.size=b._size.copy();a.delegate=this;b.addSubview(a.view);this._stackController=a};iAd.Class.synthesizeProperties(iAd.RootViewController,["stackController"]);iAd.View.TRANSITION_DISSOLVE_OUT={properties:["opacity"],from:[1],to:[0]};
iAd.View.TRANSITION_DISSOLVE_IN={properties:["opacity"],from:[0],to:[1]};iAd.View.TRANSITION_ZOOM_IN={properties:["opacity","transform"],from:[0,"scale(0.2)"],to:[1,"scale(1)"]};iAd.View.TRANSITION_ZOOM_OUT={properties:["opacity","transform"],from:[0,"scale(1.2)"],to:[1,"scale(1)"]};iAd.View.TRANSITION_CROSS_SPIN_RIGHT={properties:["opacity","transform"],from:[0,"rotate(20deg)"],to:[1,"rotate(0)"]};
iAd.View.TRANSITION_CROSS_SPIN_LEFT={properties:["opacity","transform"],from:[0,"rotate(-20deg)"],to:[1,"rotate(0)"]};iAd.View.TRANSITION_FLIP_LEFT_OUT={properties:["transform"],from:["perspective(800) rotateY(0deg) translateZ(0)"],to:["perspective(800) rotateY(-180deg) translateZ(-1px)"]};iAd.View.TRANSITION_FLIP_LEFT_IN={properties:["transform"],from:["perspective(800) rotateY(180deg) translateZ(-1px)"],to:["perspective(800) rotateY(0deg) translateZ(0)"]};
iAd.View.TRANSITION_FLIP_RIGHT_OUT={properties:["transform"],from:["perspective(800) rotateY(0deg) translateZ(0)"],to:["perspective(800) rotateY(180deg) translateZ(-1px)"]};iAd.View.TRANSITION_FLIP_RIGHT_IN={properties:["transform"],from:["perspective(800) rotateY(-180deg) translateZ(-1px)"],to:["perspective(800) rotateY(0deg) translateZ(0)"]};
iAd.View.TRANSITION_CUBE_LEFT_OUT=function(a){a=-a.size.width/2;return{base:["anchorPoint",new iAd.Point(0.5,0.5),"anchorPointZ",a],properties:["transform"],from:["perspective(800) translateZ("+a+"px) rotateY(0deg)"],to:["perspective(800) translateZ("+a+"px) rotateY(-90deg)"]}};
iAd.View.TRANSITION_CUBE_LEFT_IN=function(a){a=-a.size.width/2;return{base:["anchorPoint",new iAd.Point(0.5,0.5),"anchorPointZ",a],properties:["transform"],from:["perspective(800) translateZ("+a+"px) rotateY(90deg)"],to:["perspective(800) translateZ("+a+"px) rotateY(0deg)"]}};
iAd.View.TRANSITION_CUBE_RIGHT_OUT=function(a){a=-a.size.width/2;return{base:["anchorPoint",new iAd.Point(0.5,0.5),"anchorPointZ",a],properties:["transform"],from:["perspective(800) translateZ("+a+"px) rotateY(0deg)"],to:["perspective(800) translateZ("+a+"px) rotateY(90deg)"]}};
iAd.View.TRANSITION_CUBE_RIGHT_IN=function(a){a=-a.size.width/2;return{base:["anchorPoint",new iAd.Point(0.5,0.5),"anchorPointZ",a],properties:["transform"],from:["perspective(800) translateZ("+a+"px) rotateY(-90deg)"],to:["perspective(800) translateZ("+a+"px) rotateY(0deg)"]}};iAd.View.TRANSITION_DOOR_OPEN_LEFT_OUT={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform"],from:["perspective(800) rotateY(0deg)"],to:["perspective(800) rotateY(-90deg)"]};
iAd.View.TRANSITION_DOOR_CLOSE_LEFT_IN={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform"],from:["perspective(800) rotateY(-90deg)"],to:["perspective(800) rotateY(0deg)"]};iAd.View.TRANSITION_DOOR_OPEN_RIGHT_OUT={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform"],from:["perspective(800) rotateY(0deg)"],to:["perspective(800) rotateY(90deg)"]};
iAd.View.TRANSITION_DOOR_CLOSE_RIGHT_IN={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform"],from:["perspective(800) rotateY(90deg)"],to:["perspective(800) rotateY(0deg)"]};iAd.View.TRANSITION_REVOLVE_TOWARDS_LEFT_OUT={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform","opacity"],from:["perspective(800) rotateY(0deg)",1],to:["perspective(800) rotateY(-90deg)",0]};
iAd.View.TRANSITION_REVOLVE_TOWARDS_LEFT_IN={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform"],from:["perspective(800) rotateY(90deg)"],to:["perspective(800) rotateY(0deg)"]};iAd.View.TRANSITION_REVOLVE_AWAY_LEFT_OUT={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform"],from:["perspective(800) rotateY(0deg)"],to:["perspective(800) rotateY(90deg)"]};
iAd.View.TRANSITION_REVOLVE_AWAY_LEFT_IN={base:["anchorPoint",new iAd.Point(0,0.5)],properties:["transform","opacity"],from:["perspective(800) rotateY(-90deg)",0],to:["perspective(800) rotateY(0deg)",1]};iAd.View.TRANSITION_REVOLVE_TOWARDS_RIGHT_OUT={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform","opacity"],from:["perspective(800) rotateY(0deg)",1],to:["perspective(800) rotateY(90deg)",0]};
iAd.View.TRANSITION_REVOLVE_TOWARDS_RIGHT_IN={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform"],from:["perspective(800) rotateY(-90deg)"],to:["perspective(800) rotateY(0deg)"]};iAd.View.TRANSITION_REVOLVE_AWAY_RIGHT_OUT={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform"],from:["perspective(800) rotateY(0deg)"],to:["perspective(800) rotateY(-90deg)"]};
iAd.View.TRANSITION_REVOLVE_AWAY_RIGHT_IN={base:["anchorPoint",new iAd.Point(1,0.5)],properties:["transform","opacity"],from:["perspective(800) rotateY(90deg)",0],to:["perspective(800) rotateY(0deg)",1]};iAd.View.TRANSITION_SPIN_LEFT_OUT={properties:["transform","opacity"],from:["perspective(800) rotate(0)",1],to:["perspective(800) rotate(180deg)",0]};
iAd.View.TRANSITION_SPIN_LEFT_IN={base:["zIndex",1],properties:["transform","opacity"],from:["perspective(800) rotate(-180deg)",0],to:["perspective(800) rotate(0)",1]};iAd.View.TRANSITION_SPIN_RIGHT_OUT={properties:["transform","opacity"],from:["perspective(800) rotate(0)",1],to:["perspective(800) rotate(-180deg)",0]};iAd.View.TRANSITION_SPIN_RIGHT_IN={base:["zIndex",1],properties:["transform","opacity"],from:["perspective(800) rotate(180deg)",0],to:["perspective(800) rotate(0)",1]};
iAd.View.TRANSITION_SCALE_IN={base:["zIndex",1],properties:["transform"],from:["scale(0.01)"],to:["scale(1)"]};iAd.View.TRANSITION_SCALE_OUT={base:["zIndex",1],properties:["transform"],from:["scale(1)"],to:["scale(0.01)"]};iAd.Class({name:"iAd.Image",synthesizedProperties:["width","height","loaded"],archivedProperties:["url","hasHiDPIVersion"]});
iAd.Image.prototype.init=function(a,b){this.callSuper();this.url=a;this.resolvedURL=iAd.Image.resolveURL(a,b);this.hasHiDPIVersion=b;this._loaded=false;this.scaleFactor=b&&iAd.Device.HAS_HIDPI_DISPLAY?0.5:1;this.element=new Image;this.load();iAd.Image.imageWasCreated(this)};iAd.Image.prototype.getWidth=function(){return this.element.width*this.scaleFactor};iAd.Image.prototype.getHeight=function(){return this.element.height*this.scaleFactor};
iAd.Image.prototype.handleEvent=function(a){if(a.type==="load"&&a.target===this.element){this.loaded=true;this.element.removeEventListener("load",this,false);this.runCompletion(false)}};iAd.Image.prototype.load=function(){this.element.src=this.resolvedURL;if(this.element.complete)this.loaded=true;else this.element.addEventListener("load",this,false)};iAd.Image.prototype.whenLoaded=function(a,b){this.whenLoadedArguments={completion:a,methodName:b};this._loaded&&this.runCompletion(true)};
iAd.Image.prototype.runCompletion=function(a){var b=this.whenLoadedArguments;if(b){if(iAd.Utils.objectIsFunction(b.completion))b.completion(this,a);else iAd.Utils.objectHasMethod(b.completion,b.methodName)&&b.completion[b.methodName](this,a);delete this.whenLoadedArguments}};iAd.Image.imageForURL=function(a,b){if(!a)return null;var c=iAd.Image.resolveURL(a,b);if(this.instances&&this.instances[c])return this.instances[c];return new iAd.Image(a,b)};
iAd.Image.restoreFromArchive=function(a){return this.imageForURL(a.url,a.hasHiDPIVersion)};iAd.Image.resolveURL=function(a,b){return b&&iAd.Device.HAS_HIDPI_DISPLAY?iAd.Path.appendHiDPISuffix(a):a};iAd.Image.imageWasCreated=function(a){if(!this.instances){this.instances={};window.setTimeout(iAd.Image.runLoopDidStart,0)}this.instances[a.resolvedURL]=a};iAd.Image.runLoopDidStart=function(){delete iAd.Image.instances};
iAd.Class({name:"iAd.BarItem",synthesizedProperties:["enabled","image","imageOffset","title"],archivedProperties:["enabled","image","imageOffset","title","tag"]});iAd.BarItem.DISABLED_CSS="ad-disabled";iAd.BarItem.prototype.init=function(){this.callSuper();this._enabled=true;this._imageOffset=this._image=null;this._title="";this.tag=0};
iAd.Class({name:"iAd.Control",superclass:iAd.View,synthesizedProperties:["state","enabled","selected","highlighted"],archivedProperties:["highlighted","enabled","selected","tag"],cssClassName:"ad-control",collectionAccessor:"controls"});iAd.Control.prototype.init=function(a){this.tag=0;this._enabled=true;this._highlighted=this._selected=false;this.callSuper(a);this.layer._control=this;this.userInteractionEnabled=this._enabled};iAd.Control.VALUE_CHANGE_EVENT="controlValueChange";
iAd.Control.STATE_NORMAL=0;iAd.Control.STATE_NORMAL_CSS="ad-normal";iAd.Control.STATE_HIGHLIGHTED=1;iAd.Control.STATE_HIGHLIGHTED_CSS="ad-highlighted";iAd.Control.STATE_DISABLED=2;iAd.Control.STATE_DISABLED_CSS="ad-disabled";iAd.Control.STATE_SELECTED=4;iAd.Control.STATE_SELECTED_CSS="ad-selected";iAd.Control.synthesizedEvents=[iAd.Control.VALUE_CHANGE_EVENT];
iAd.Control.prototype.getState=function(){return iAd.Control.STATE_NORMAL|(this._highlighted?iAd.Control.STATE_HIGHLIGHTED:0)|(this._enabled?0:iAd.Control.STATE_DISABLED)|(this._selected?iAd.Control.STATE_SELECTED:0)};iAd.Control.prototype.setEnabled=function(a){if(a!=this._enabled){this.layer.iad_toggleClassName(iAd.Control.STATE_DISABLED_CSS,!a);this.userInteractionEnabled=this._enabled=a;this.notifyPropertyChange("state")}};
iAd.Control.prototype.setSelected=function(a){if(a!=this._selected){this.layer.iad_toggleClassName(iAd.Control.STATE_SELECTED_CSS,a);this._selected=a;this.notifyPropertyChange("state")}};iAd.Control.prototype.setHighlighted=function(a){if(a!=this._highlighted){this.layer.iad_toggleClassName(iAd.Control.STATE_HIGHLIGHTED_CSS,a);this._highlighted=a;this.notifyPropertyChange("state")}};iAd.Control.prototype.touchesBegan=function(a){if(this._enabled){this.callSuper(a);this.highlighted=true}};
iAd.Control.prototype.touchesMoved=function(a){var b=this.touchInside;this.callSuper(a);if(b!=this.touchInside)this.highlighted=this.touchInside};iAd.Control.prototype.touchesEnded=function(a){this.callSuper(a);this.highlighted=false};iAd.Control.prototype.touchesCancelled=function(a){this.callSuper(a);this.highlighted=false};
iAd.Control.isNodeInControlHierarchyBoundedByElement=function(a,b){for(;a.parentNode;){if(a.hasOwnProperty("_view")&&a._view instanceof iAd.Control)return true;if(a===b)break;a=a.parentNode}return false};iAd.Class({name:"iAd.BarButton",superclass:iAd.Control,synthesizedProperties:["maxWidth","width","type","buttonStyle","image","imageOffset","title"],archivedProperties:["maxWidth","width","type","buttonStyle","image","imageOffset","title"],cssClassName:"ad-bar-button",collectionAccessor:"barButtons"});
iAd.BarButton.DEFAULT_HEIGHT=30;iAd.BarButton.POINTY_X_OFFSET=3;iAd.BarButton.FONT_DEFAULT="bold 12px Helvetica";iAd.BarButton.FONT_PLAIN="bold 20px Helvetica";iAd.BarButton.HAS_HIDPI_VERSION_ATTR="ad-has-hidpi-version";
iAd.BarButton.prototype.init=function(a,b){this._width=this._maxWidth=0;this._buttonStyle=this._type="";this._imageOffset=this._image=null;this._title="";this.previouslyMeasuredTitle=null;this.usesAutomaticImageOffset=true;this.callSuper(a);if(!this.usesDeclarativeBacking){this.type=b!=null?b:iAd.BarButtonItem.TYPE_SQUARE;this.buttonStyle=iAd.BarButtonItem.STYLE_DEFAULT}};
iAd.BarButton.prototype.setupLayer=function(){this.callSuper();if(this.layer.hasClassName(iAd.BarButtonItem.STYLE_BLACK))this._buttonStyle=iAd.BarButtonItem.STYLE_BLACK;else if(this.layer.hasClassName(iAd.BarButtonItem.STYLE_DEFAULT))this._buttonStyle=iAd.BarButtonItem.STYLE_DEFAULT;else if(this.layer.hasClassName(iAd.BarButtonItem.STYLE_DONE))this._buttonStyle=iAd.BarButtonItem.STYLE_DONE;if(this.layer.hasClassName(iAd.BarButtonItem.TYPE_PLAIN))this._type=iAd.BarButtonItem.TYPE_PLAIN;else if(this.layer.hasClassName(iAd.BarButtonItem.TYPE_SQUARE))this._type=
iAd.BarButtonItem.TYPE_SQUARE;else if(this.layer.hasClassName(iAd.BarButtonItem.TYPE_BACK))this._type=iAd.BarButtonItem.TYPE_BACK;else if(this.layer.hasClassName(iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE))this._type=iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE;else if(this.layer.hasClassName(iAd.BarButtonItem.TYPE_FIXED_SPACE))this._type=iAd.BarButtonItem.TYPE_FIXED_SPACE;this.width=this.layerHasCustomAttribute("ad-width")?parseInt(this.getLayerCustomAttributeValue("ad-width"),10):0};
iAd.BarButton.prototype.layerWasCreated=function(){this.callSuper();this.layer.setAttribute("role","button");this.background=this.layer.appendChild(document.createElement("div"));this.icon=this.layer.appendChild(document.createElement("img"))};iAd.BarButton.prototype.readPropertiesFromLayerComputedStyle=function(a){this.callSuper(a);a=parseInt(a.maxWidth,10);this.maxWidth=isNaN(a)?0:a};
iAd.BarButton.prototype.setValueForAttribute=function(a,b){switch(b){case "ad-image":this.image=iAd.Image.imageForURL(a,this.layerHasCustomAttribute(iAd.BarButton.HAS_HIDPI_VERSION_ATTR));case iAd.BarButton.HAS_HIDPI_VERSION_ATTR:break;case "ad-image-offset-x":this.imageOffset=new iAd.Point(parseInt(a,10),this.imageOffset.y);break;case "ad-image-offset-y":this.imageOffset=new iAd.Point(this.imageOffset.x,parseInt(a,10));break;default:this.callSuper(a,b)}};
iAd.BarButton.prototype.getSize=function(){return new iAd.Size(this._maxWidth==0?this._size.width:Math.min(this._maxWidth,this._size.width),this._size.height)};iAd.BarButton.prototype.setSize=function(a){a.height=iAd.BarButton.DEFAULT_HEIGHT;this.callSuper(a)};iAd.BarButton.prototype.touchesBegan=function(a){this.type==iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE||this.type==iAd.BarButtonItem.TYPE_FIXED_SPACE?a.preventDefault():this.callSuper(a)};
iAd.BarButton.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.imageRequiresPositioning&&this.positionImage()};iAd.BarButton.prototype.setMaxWidth=function(a){this.layer.style.maxWidth=a==0?"inherit":a+"px";this._maxWidth=a;this._width==0&&this.autoSizeTitle()};iAd.BarButton.prototype.setWidth=function(a){if(a==0){this.autoSizeTitle();this.autoSizeImage()}else{this._width=a;this.size=new iAd.Size(a,iAd.BarButton.DEFAULT_HEIGHT)}this.positionImage()};
iAd.BarButton.prototype.autoSizeTitle=function(){if(!(this._title==""||this._title==this.previouslyMeasuredTitle)){var a=this._type===iAd.BarButtonItem.TYPE_PLAIN,b=iAd.CSS.widthForTextAndFont(this._title,a?iAd.BarButton.FONT_PLAIN:iAd.BarButton.FONT_DEFAULT);if(!a){b+=20;if(this._type===iAd.BarButtonItem.TYPE_BACK)b+=4}this.size=new iAd.Size(b,this._size.height);this.previouslyMeasuredTitle=this._title}};
iAd.BarButton.prototype.autoSizeImage=function(){if(this._image!=null){var a=this.getBorderXOffsets();this.size=new iAd.Size(this._image.width+a.left+a.right,this._size.height)}};iAd.BarButton.prototype.setTitle=function(a){this._title=this.background.textContent=a;this._width==0&&this.autoSizeTitle()};iAd.BarButton.prototype.setImage=function(a){if(this._image=a){this.icon.src=a.resolvedURL;a.loaded?this.positionImage():a.addPropertyObserver("loaded",this)}else this.icon.src=""};
iAd.BarButton.prototype.getImageOffset=function(){return new iAd.Point(parseInt(this.icon.style.left),parseInt(this.icon.style.top))};iAd.BarButton.prototype.setImageOffset=function(a){if(a){this.icon.style.left=a.x+"px";this.icon.style.top=a.y+"px";this.usesAutomaticImageOffset=false}};
iAd.BarButton.prototype.positionImage=function(){if(!(this._image==null||!this.usesAutomaticImageOffset))if(this.layerIsInDocument){var a=Math.min(this._image.height,this.size.height),b=this.getBorderXOffsets();this.icon.height=a;this.imageOffset=new iAd.Point((this._size.width-b.left-b.right)/2-this._image.width/2,(iAd.BarButton.DEFAULT_HEIGHT-this._image.height)/2);this.usesAutomaticImageOffset=true;this.imageRequiresPositioning=false}else this.imageRequiresPositioning=true};
iAd.BarButton.prototype.setType=function(a){this.layer.removeClassName(this._type);this.layer.addClassName(a);this._type=a;this.positionImage()};iAd.BarButton.prototype.setButtonStyle=function(a){this.layer.removeClassName(this._buttonStyle);this.layer.addClassName(a);this._buttonStyle=a};
iAd.BarButton.prototype.getBorderXOffsets=function(){var a=window.getComputedStyle(this.layer),b=a.getPropertyCSSValue("border-left-width");a=a.getPropertyCSSValue("border-right-width");return{left:b!=null?b.getFloatValue(CSSPrimitiveValue.CSS_PX):0,right:a!=null?a.getFloatValue(CSSPrimitiveValue.CSS_PX):0}};iAd.BarButton.prototype.handlePropertyChange=function(){this._width==0&&this.autoSizeImage();this.positionImage()};
iAd.BarButton.prototype.dispatchEvent=function(a){if(this.barButtonItem)a.ad.sender=this.barButtonItem;this.callSuper(a)};iAd.Class({name:"iAd.BarButtonItem",superclass:iAd.BarItem,mixins:[iAd.EventTarget],synthesizedProperties:["maxWidth","customView","width","type","style"],archivedProperties:["maxWidth","customView","width","type","style"]});iAd.BarButtonItem.TYPE_PLAIN="ad-plain";iAd.BarButtonItem.TYPE_SQUARE="ad-square";iAd.BarButtonItem.TYPE_BACK="ad-back";
iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE="ad-flexible-space";iAd.BarButtonItem.TYPE_FIXED_SPACE="ad-fixed-space";iAd.BarButtonItem.STYLE_BLACK="ad-black";iAd.BarButtonItem.STYLE_DEFAULT="ad-default";iAd.BarButtonItem.STYLE_DONE="ad-done";iAd.BarButtonItem.STYLE_DELETE="ad-delete";iAd.BarButtonItem.prototype.init=function(a,b){this.callSuper();this.view=b||new iAd.BarButton(null,a);this.view.isCustomView=!(this.view instanceof iAd.BarButton);this.view.barButtonItem=this;this.eventTarget=this.view};
iAd.BarButtonItem.restoreFromArchive=function(a){return new this(a.type,a.customView)};iAd.BarButtonItem.prototype.getEnabled=function(){return!this.view.isCustomView?this.view.enabled:this.view.userInteractionEnabled};iAd.BarButtonItem.prototype.setEnabled=function(a){if(this.view.isCustomView)this.view.userInteractionEnabled=a;else this.view.enabled=a};iAd.BarButtonItem.prototype.getMaxWidth=function(){return!this.view.isCustomView?this.view.maxWidth:0};
iAd.BarButtonItem.prototype.setMaxWidth=function(a){if(!this.view.isCustomView)this.view.maxWidth=a};iAd.BarButtonItem.prototype.getWidth=function(){return!this.view.isCustomView?this.view.width:this.view.size.width};iAd.BarButtonItem.prototype.setWidth=function(a){if(this.view.isCustomView)this.view.size=new iAd.Size(a,this.view.size.height);else this.view.width=a};iAd.BarButtonItem.prototype.getTitle=function(){return!this.view.isCustomView?this.view.title:""};
iAd.BarButtonItem.prototype.setTitle=function(a){if(!this.view.isCustomView)this.view.title=a};iAd.BarButtonItem.prototype.getImage=function(){return!this.view.isCustomView?this.view.image:null};iAd.BarButtonItem.prototype.setImage=function(a){if(a&&!this.view.isCustomView)this.view.image=a};iAd.BarButtonItem.prototype.getImageOffset=function(){return!this.view.isCustomView?this.view.imageOffset:null};
iAd.BarButtonItem.prototype.setImageOffset=function(a){if(!this.view.isCustomView)this.view.imageOffset=a};iAd.BarButtonItem.prototype.getType=function(){return!this.view.isCustomView?this.view.type:""};iAd.BarButtonItem.prototype.setType=function(a){if(!this.view.isCustomView)this.view.type=a};iAd.BarButtonItem.prototype.getStyle=function(){return!this.view.isCustomView?this.view.buttonStyle:""};iAd.BarButtonItem.prototype.setStyle=function(a){if(!this.view.isCustomView)this.view.buttonStyle=a};
iAd.BarButtonItem.prototype.getCustomView=function(){return this.view.isCustomView?this.view:null};iAd.BarButtonItem.prototype.setCustomView=function(a){if(!(!a||a==this.view)){a.isCustomView=true;a.barButtonItem=this;this.view=a}};iAd.Class({name:"iAd.Toolbar",superclass:iAd.View,synthesizedProperties:["items","barStyle"],archivedProperties:["items","barStyle"],excludedProperties:["subviews"],cssClassName:"ad-toolbar",collectionAccessor:"toolbars"});iAd.Toolbar.DEFAULT_HEIGHT=44;
iAd.Toolbar.EDGE_MARGIN=6;iAd.Toolbar.ITEM_MARGIN=10;iAd.Toolbar.STYLE_DEFAULT="ad-default";iAd.Toolbar.STYLE_BLACK="ad-black";iAd.Toolbar.STYLE_BLACK_TRANSLUCENT="ad-black-translucent";iAd.Toolbar.ANIMATION_DURATION=0.2;iAd.Toolbar.FADE_OUT_TRANSITION={properties:["transform","opacity"],to:["scale(0.01)",0]};iAd.Toolbar.prototype.init=function(a){this._items=[];this._barStyle="";this.callSuper(a);if(!this.usesDeclarativeBacking)this.barStyle=iAd.Toolbar.STYLE_DEFAULT};
iAd.Toolbar.prototype.setupLayer=function(){this.callSuper();if(this.layer.hasClassName(iAd.Toolbar.STYLE_BLACK))this._barStyle=iAd.Toolbar.STYLE_BLACK;else if(this.layer.hasClassName(iAd.Toolbar.STYLE_BLACK_TRANSLUCENT))this._barStyle=iAd.Toolbar.STYLE_BLACK_TRANSLUCENT;else this.barStyle=iAd.Toolbar.STYLE_DEFAULT};
iAd.Toolbar.prototype.layerWasCreated=function(){this.callSuper();this.glow=this.layer.appendChild(document.createElement("div"));this.glow.className="ad-glow";this.layer.addEventListener("webkitTransitionEnd",this,false);this.clipsToBounds=true};
iAd.Toolbar.prototype.readPropertiesFromLayerAttributes=function(a){this.callSuper(a);a=[];for(var b,c=0,d=this.subviews.length;c<d;c++){b=this.subviews[c];b.willMoveToSuperview(this);a.push(new iAd.BarButtonItem(null,b));b.didMoveToSuperview()}this.setItemsAnimated(a,false)};iAd.Toolbar.prototype.setPosition=function(a){this.callSuper(a);this.layerIsInDocument&&this.callMethodNameAfterDelay("updateBackgroundWithPosition",0)};
iAd.Toolbar.prototype.setSize=function(a){a.height=iAd.Toolbar.DEFAULT_HEIGHT;this.callSuper(a);this.updateLayout()};iAd.Toolbar.prototype.willMoveToSuperview=function(a){if(a!=null&&this._size.width==0)this.size=new iAd.Size(a.size.width,iAd.Toolbar.DEFAULT_HEIGHT)};iAd.Toolbar.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.updateBackgroundWithPosition()};
iAd.Toolbar.prototype.setBarStyle=function(a){this.layer.removeClassName(this._barStyle);this.layer.addClassName(a);this._barStyle=a};iAd.Toolbar.prototype.setItems=function(a){this.setItemsAnimated(a,false)};
iAd.Toolbar.prototype.setItemsAnimated=function(a,b){if(a==null)a=[];iAd.Transaction.begin();iAd.Transaction.defaults.duration=b?iAd.Toolbar.ANIMATION_DURATION:0;for(var c=0,d=this._items.length;c<d;c++){var e=this._items[c],f=e.view;if(a.indexOf(e)==-1)if(b){f.needsRemoval=true;f.applyTransition(iAd.Toolbar.FADE_OUT_TRANSITION)}else f.removeFromSuperview()}c=0;for(d=a.length;c<d;c++){e=a[c];f=e.view;if(f.superview!==this){e._newItem=true;this.addSubview(f);f.addPropertyObserver("size",this);e.type==
iAd.BarButtonItem.TYPE_PLAIN&&f.addEventListener(iAd.View.TOUCH_STATE_CHANGE_EVENT,this,false)}}var g=0;c=f=0;for(d=a.length;c<d;c++){e=a[c];if(e.type==iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE)g++;else f+=e.view.size.width}c=this.isInPopover?0:iAd.Toolbar.EDGE_MARGIN;d=this.size.width-f-iAd.Toolbar.ITEM_MARGIN*(a.length-1)-c*2;g=g>0?d/g:0;var i=c,h;c=0;for(d=a.length;c<d;c++){h=iAd.Toolbar.ITEM_MARGIN;e=a[c];f=e.view;if(e.type==iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE)i+=g;else if(e.type==iAd.BarButtonItem.TYPE_FIXED_SPACE){i+=
f.size.width;h=0}else{var j=new iAd.Point(iAd.CSS.roundedPxValue(i),iAd.CSS.roundedPxValue((this.size.height-f.size.height)/2));if(e._newItem){f.position=j;e._newItem=false;b&&f.applyTransition(iAd.View.TRANSITION_DISSOLVE_IN)}else f.applyTransition({properties:["position"],to:[j]});i+=f.size.width}i+=h}iAd.Transaction.commit();this._items=a};iAd.Toolbar.prototype.updateLayout=function(){this._items.length>0&&this.setItemsAnimated(this._items,false)};
iAd.Toolbar.prototype.updateBackgroundWithPosition=function(){this.layer.iad_toggleClassName("ad-top",window.webkitConvertPointFromNodeToPage(this.layer,new WebKitPoint(0,0)).y==0)};
iAd.Toolbar.prototype.handleEvent=function(a){this.callSuper(a);if(a.type=="webkitTransitionEnd"){if(a.target!==this.layer)if(a.target!==this.glow)this.removeItemViewIfNeeded(a.target._control);else if(this.glow.style.opacity==0)this.glow.style.display="none"}else if(a.type==iAd.View.TOUCH_STATE_CHANGE_EVENT){a=a.ad.sender.view;this.glow.style.webkitTransform=iAd.CSS.t(a.position.x+a.size.width/2-50,0);this.glow.style.opacity=a.touchInside?1:0;this.glow.style.display="block"}};
iAd.Toolbar.prototype.removeItemViewIfNeeded=function(a){if(a&&a.needsRemoval){a.removeFromSuperview();a.needsRemoval=false;a.transitionsEnabled=false;a.transform="scale(1)";a.opacity=1}};iAd.Toolbar.prototype.handlePropertyChange=function(){this.setItemsAnimated(this._items,false)};iAd.Number={};iAd.Number.degreesToRadians=function(a){return a/360*Math.PI*2};iAd.Number.radiansToDegrees=function(a){return a/(Math.PI*2)*360};iAd.Number.clampValue=function(a,b,c){return Math.min(Math.max(a,b),c)};
iAd.Utils.setupDisplayNames(iAd.Number,"iAd.Number");iAd.EventTriage={};iAd.EventTriage.handleEvent=function(a){this instanceof iAd.Object&&this.callSuper(a);var b=a.type;b="handle"+b.charAt(0).toUpperCase()+b.substr(1);iAd.Utils.objectHasMethod(this,b)&&this[b](a)};iAd.Utils.setupDisplayNames(iAd.EventTriage,"iAd.EventTriage");
iAd.Class({name:"iAd.NavigationItem",mixins:[iAd.EventTriage],synthesizedProperties:["title","titleView","backBarButtonItem","leftBarButtonItem","rightBarButtonItem","hidesBackButton"],archivedProperties:["title","titleView","backBarButtonItem","leftBarButtonItem","rightBarButtonItem","hidesBackButton"]});iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN=5;iAd.NavigationItem.LEFT_BUTTON_RIGHT_MARGIN=8;iAd.NavigationItem.RIGHT_BUTTON_LEFT_MARGIN=11;iAd.NavigationItem.RIGHT_BUTTON_RIGHT_MARGIN=5;
iAd.NavigationItem.prototype.init=function(a){this.callSuper();this._title="";this._backBarButtonItem=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_BACK);this._backBarButtonItem.view.layer.setAttribute("aria-label","_Control.Back".loc());this._backBarButtonItem.view.layer.setAttribute("name","_Control.Back".loc());this._hidesBackButton=false;this._titleView=this._rightBarButtonItem=this._leftBarButtonItem=null;this.defaultTitleView=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.defaultTitleView.layer.setAttribute("role",
"header");this.viewController=this.navigationBar=this.positions=null;this.title=a||"";this._backBarButtonItem.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false)};iAd.NavigationItem.prototype.handleViewTouchUpInside=function(){if(this.viewController!=null&&this.viewController.parentViewController!=null)this.viewController.parentViewController.popViewControllerAnimated(true);else this.navigationBar!=null&&this.navigationBar.popNavigationItemAnimated(true)};
iAd.NavigationItem.prototype.setTitle=function(a){this._title=a;this.updateLayoutIfTopItem()};iAd.NavigationItem.prototype.setTitleView=function(a){if(a!==this._titleView){var b=this.titleViewForDisplay();this._titleView=a;if(b.superview){b.superview.insertSubviewBeforeSubview(this.titleViewForDisplay(),b);b.removeFromSuperview()}this.updateLayoutIfTopItem()}};iAd.NavigationItem.prototype.titleViewForDisplay=function(){return this._titleView||this.defaultTitleView};
iAd.NavigationItem.prototype.setBackBarButtonItem=function(a){if(this.navigationBar!=null&&this.navigationBar.backItem===this){this._backBarButtonItem!=null&&this._backBarButtonItem.view.superview.removeFromSuperview();this._backBarButtonItem=a;if(a!=null){var b=new iAd.View;b.addSubview(a.view);b.opacity=this.navigationBar.topItem._hidesBackButton?0:1;this.navigationBar.insertSubviewAtIndex(b,0)}this.navigationBar.topItem.updateLayoutIfTopItem()}else this._backBarButtonItem=a;this._backBarButtonItem!=
null&&this._backBarButtonItem.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false)};iAd.NavigationItem.prototype.setHidesBackButton=function(a){this.setHidesBackButtonAnimated(a,false)};
iAd.NavigationItem.prototype.setLeftBarButtonItem=function(a){if(this.navigationBar!=null&&this.navigationBar.topItem===this){this.getDefaultBackButton();this.leftButton!=null&&this.leftButton.view.superview.removeFromSuperview();a=(this._leftBarButtonItem=a)||this.getDefaultBackButton();if(a!=null){var b=new iAd.View;b.addSubview(a.view);if(this._leftBarButtonItem==null)b.opacity=this._hidesBackButton?0:1;this.navigationBar.insertSubviewAtIndex(b,0)}this.updateLayoutIfTopItem()}else this._leftBarButtonItem=
a};iAd.NavigationItem.prototype.setRightBarButtonItem=function(a){if(this.navigationBar!=null&&this.navigationBar.topItem===this){this._rightBarButtonItem!=null&&this._rightBarButtonItem.view.superview.removeFromSuperview();this._rightBarButtonItem=a;a!=null&&this.navigationBar.addSubview(new iAd.View).addSubview(this._rightBarButtonItem.view);this.updateLayoutIfTopItem()}else this._rightBarButtonItem=a};
iAd.NavigationItem.prototype.setHidesBackButtonAnimated=function(a,b){var c=this.getDefaultBackButton();if(this._hidesBackButton!=a){this._hidesBackButton=a;if(c!=null){c=c.view.superview;c.transitionsEnabled=b;c.opacity=a?0:1;c.layer.style.pointerEvents=a?"none":"all"}}};
iAd.NavigationItem.prototype.setLeftBarButtonItemAnimated=function(a,b){if(!b||this.navigationBar==null||this.navigationBar.topItem!==this)this.leftBarButtonItem=a;else{iAd.Transaction.begin();iAd.Transaction.defaults.duration=0.5;iAd.Transaction.defaults.properties=["opacity"];var c=this.leftButton;c!=null&&(new iAd.Transition({target:c.view.superview,to:[0],removesTargetUponCompletion:true})).start();c=(this._leftBarButtonItem=a)||this.getDefaultBackButton();if(c!=null){var d=new iAd.View;d.addSubview(c.view);
this.navigationBar.subviews.length==0?this.navigationBar.addSubview(d):this.navigationBar.insertSubviewAtIndex(d,0);if(this._leftBarButtonItem!=null||!this._hidesBackButton)(new iAd.Transition({target:d,from:[0],to:[1]})).start()}this.updateLayoutIfTopItem();iAd.Transaction.commit()}};
iAd.NavigationItem.prototype.setRightBarButtonItemAnimated=function(a,b){if(!b||this.navigationBar==null||this.navigationBar.topItem!==this)this.rightBarButtonItem=a;else{iAd.Transaction.begin();iAd.Transaction.defaults.duration=0.5;iAd.Transaction.defaults.properties=["opacity"];var c=this._rightBarButtonItem;c!=null&&(new iAd.Transition({target:c.view.superview,to:[0],removesTargetUponCompletion:true})).start();this._rightBarButtonItem=a;if(this._rightBarButtonItem!=null){c=this.navigationBar.addSubview(new iAd.View);
c.addSubview(this._rightBarButtonItem.view);(new iAd.Transition({target:c,from:[0],to:[1]})).start()}this.updateLayoutIfTopItem();iAd.Transaction.commit()}};iAd.NavigationItem.prototype.getDefaultBackButton=function(){return this.navigationBar!=null&&this.navigationBar.backItem!=null?this.navigationBar.backItem.backBarButtonItem:null};
iAd.NavigationItem.prototype.sizeItemsAndComputePositionsWithBackItem=function(a){if(!(this.navigationBar==null||this.navigationBar._size.equals(iAd.Size.ZERO_SIZE))){var b=this.navigationBar.isInPopover?0:iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN,c=this.navigationBar.isInPopover?0:iAd.NavigationItem.RIGHT_BUTTON_RIGHT_MARGIN,d=this._leftBarButtonItem||(a!=null?a.backBarButtonItem:null),e=this._rightBarButtonItem!=null?this._rightBarButtonItem.view.size.width:0,f=this.navigationBar.size.width-b-
c;if(d!=null)f-=iAd.NavigationItem.LEFT_BUTTON_RIGHT_MARGIN;if(this._rightBarButtonItem!=null)f-=iAd.NavigationItem.RIGHT_BUTTON_LEFT_MARGIN+e;var g=0;if(d!=null){d.maxWidth=this.navigationBar.size.width/2;if(d!==this._leftBarButtonItem&&d.title==""&&d.image==null)d.title=a.title;g=d.view.size.width}a=this.titleViewForDisplay();var i=this._titleView==null;if(i){a.maxWidth=0;a.title=this._title}var h=a.size.width;if(h+g>f){if(d!=null){d.maxWidth=iAd.Number.clampValue(f/3,f-h,d.maxWidth);g=d.view.size.width}h=
f-g;if(i)a.maxWidth=h;else a.size=new iAd.Size(h,a.size.height);h=a.size.width}c=this.navigationBar.size.width-c-e;g=b+(d!=null?g+iAd.NavigationItem.LEFT_BUTTON_RIGHT_MARGIN:0);e=c-h-(e>0?iAd.NavigationItem.RIGHT_BUTTON_LEFT_MARGIN:0);f=h=(this.navigationBar.size.width-h)/2;if(h>e||h<g)f=Math.abs(h-g)<Math.abs(h-e)?g:e;this.leftButton=d;this.positions={leftButton:new iAd.Point(b,d!=null?(iAd.NavigationBar.DEFAULT_HEIGHT-d.view.size.height)/2:0),title:new iAd.Point(f,(iAd.NavigationBar.DEFAULT_HEIGHT-
a.size.height)/2),rightButton:new iAd.Point(c,this._rightBarButtonItem!=null?(iAd.NavigationBar.DEFAULT_HEIGHT-this._rightBarButtonItem.view.size.height)/2:0)};for(var j in this.positions){b=this.positions[j];b.x=iAd.CSS.roundedPxValue(b.x);b.y=iAd.CSS.roundedPxValue(b.y)}}};
iAd.NavigationItem.prototype.updateLayout=function(){if(this.positions!=null){if(this.leftButton!=null)this.leftButton.view.superview.position=this.positions.leftButton;if(this._rightBarButtonItem!=null)this._rightBarButtonItem.view.superview.position=this.positions.rightButton;this.titleViewForDisplay().superview.position=this.positions.title}};
iAd.NavigationItem.prototype.updateLayoutIfTopItem=function(){if(!(this.navigationBar==null||this.navigationBar.topItem!==this)){this.sizeItemsAndComputePositionsWithBackItem(this.navigationBar.backItem);this.updateLayout()}};iAd.Class({name:"iAd.NavigationBar",superclass:iAd.View,synthesizedProperties:["barStyle","items","topItem","backItem","busy"],archivedProperties:["barStyle","items"],cssClassName:"ad-navigation-bar",collectionAccessor:"navigationBars"});iAd.NavigationBar.STYLE_DEFAULT="ad-default";
iAd.NavigationBar.STYLE_BLACK="ad-black";iAd.NavigationBar.STYLE_BLACK_TRANSLUCENT="ad-black-translucent";iAd.NavigationBar.DEFAULT_HEIGHT=44;iAd.NavigationBar.ANIMATION_DURATION=0.35;iAd.NavigationBar.SHOULD_PUSH_ITEM_DELEGATE="navigationBarShouldPushItem";iAd.NavigationBar.DID_PUSH_ITEM_DELEGATE="navigationBarDidPushItem";iAd.NavigationBar.SHOULD_POP_ITEM_DELEGATE="navigationBarShouldPopItem";iAd.NavigationBar.DID_POP_ITEM_DELEGATE="navigationBarDidPopItem";
iAd.NavigationBar.prototype.init=function(a){this.delegate=null;this._barStyle=iAd.NavigationBar.STYLE_DEFAULT;this._items=[];this._busy=false;this.itemsToSetupAfterAnimatedChange=null;this.callSuper(a);if(!this.usesDeclarativeBacking)this.barStyle=iAd.NavigationBar.STYLE_DEFAULT};
iAd.NavigationBar.prototype.setupLayer=function(){this.callSuper();this.barStyle=this.layer.hasClassName(iAd.NavigationBar.STYLE_BLACK)?iAd.NavigationBar.STYLE_BLACK:this.layer.hasClassName(iAd.NavigationBar.STYLE_BLACK_TRANSLUCENT)?iAd.NavigationBar.STYLE_BLACK_TRANSLUCENT:iAd.NavigationBar.STYLE_DEFAULT};iAd.NavigationBar.prototype.setSize=function(a){this.callSuper(new iAd.Size(a.width,iAd.NavigationBar.DEFAULT_HEIGHT));this.updateTopItemLayout()};
iAd.NavigationBar.prototype.willMoveToSuperview=function(a){if(a!=null&&!this.usesDeclarativeBacking&&this._size.width==0)this.size=new iAd.Size(a._size.width,iAd.NavigationBar.DEFAULT_HEIGHT)};iAd.NavigationBar.prototype.setBarStyle=function(a){this.layer.removeClassName(this._barStyle);this.layer.addClassName(a);this._barStyle=a};iAd.NavigationBar.prototype.getTopItem=function(){return this._items.length>0?this._items[this._items.length-1]:null};
iAd.NavigationBar.prototype.getBackItem=function(){return this._items.length>1?this._items[this._items.length-2]:null};iAd.NavigationBar.prototype.setItems=function(a){this.setItemsAnimated(a,false)};
iAd.NavigationBar.prototype.setItemsAnimated=function(a,b){if(!(this.busy||!a||a.length==0)){iAd.Transaction.begin();for(var c=this.topItem,d=a.length>1?a[a.length-2]:null,e=a[a.length-1],f=0,g=this._items.length;f<g;f++)this._items[f].navigationBar=null;f=0;for(g=a.length;f<g;f++)a[f].navigationBar=this;if(c==null){this.addItemViews(e,d,false);e.sizeItemsAndComputePositionsWithBackItem(d);e.updateLayout();this._items=a;this.dispatchNotification(iAd.NavigationBar.DID_PUSH_ITEM_DELEGATE,this.delegate,
[["item",e]]);iAd.Transaction.commit()}else if(c===e){for(this.removeViewsForItem(c);this.subviews.length;)this.subviews[0].removeFromSuperview();this.addItemViews(e,d,false);e.sizeItemsAndComputePositionsWithBackItem(d);e.updateLayout();this._items=a;iAd.Transaction.commit()}else{f=this._items.indexOf(e)==-1;this.addItemViews(e,d,true);e.sizeItemsAndComputePositionsWithBackItem(d);this.itemsAfterTransition=a;this.transitionToItem(e,c,f,b)}}};
iAd.NavigationBar.prototype.pushNavigationItemAnimated=function(a,b){if(!this.busy){iAd.Transaction.begin();this.shouldPushItem(a)&&this.setItemsAnimated(this._items.concat([a]),b);iAd.Transaction.commit()}};iAd.NavigationBar.prototype.popNavigationItemAnimated=function(a){if(!(this.busy||this._items.length<2)){iAd.Transaction.begin();this.shouldPopItem(this.topItem)&&this.setItemsAnimated(this._items.slice(0,this._items.length-1),a);iAd.Transaction.commit()}};
iAd.NavigationBar.prototype.isItemViewHostedInBar=function(a){return(a=a.superview)&&a.superview===this};
iAd.NavigationBar.prototype.addItemViews=function(a,b,c){var d=[],e=a._leftBarButtonItem||(b!=null?b.backBarButtonItem:null)||null;if(a.rightBarButtonItem!=null&&!this.isItemViewHostedInBar(a.rightBarButtonItem.view)){b=this.addSubview(new iAd.View);b.addSubview(a.rightBarButtonItem.view);d.push(b)}var f=a.titleViewForDisplay();if(f!=null&&!this.isItemViewHostedInBar(f)){b=a.rightBarButtonItem!=null?this.insertSubviewBeforeSubview(new iAd.View,a.rightBarButtonItem.view.superview):this.addSubview(new iAd.View);
b.addSubview(f);d.push(b)}if(e!=null&&!this.isItemViewHostedInBar(e.view)){b=this.insertSubviewBeforeSubview(new iAd.View,f.superview);b.addSubview(e.view);d.push(b)}for(a=c?0:1;d.length;){b=d.pop();b.opacity=a;b.wantsHardwareLayerBacking=true}};
iAd.NavigationBar.prototype.transitionToItem=function(a,b,c,d){this.busy=d;this.previousItem=b;this.transitionWentForward=c;iAd.Transaction.defaults.duration=d?iAd.NavigationBar.ANIMATION_DURATION:0;iAd.Transaction.defaults.properties=["opacity","position"];var e=null;if(b._leftBarButtonItem!=null){if(b._leftBarButtonItem!==a._leftBarButtonItem)e=(new iAd.Transition({target:b._leftBarButtonItem.view.superview,properties:["opacity"],to:[0]})).start()}else if(b.leftButton!=null){e=c?-b.leftButton.view.size.width-
iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN:a.positions.title.x;e=(new iAd.Transition({target:b.leftButton.view.superview,to:[0,new iAd.Point(e,b.positions.leftButton.y)]})).start()}var f=b.titleViewForDisplay(),g=a.titleViewForDisplay(),i=f!==g;if(i){e=c?iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN:this.size.width;e=(new iAd.Transition({target:f.superview,to:[0,new iAd.Point(e,b.positions.title.y)]})).start()}if(b._rightBarButtonItem!=null&&b._rightBarButtonItem!==a._rightBarButtonItem)e=(new iAd.Transition({target:b._rightBarButtonItem.view.superview,
properties:["opacity"],to:[0]})).start();if(a._leftBarButtonItem!=null){if(a._leftBarButtonItem!==b._leftBarButtonItem){a._leftBarButtonItem.view.superview.position=a.positions.leftButton;e=(new iAd.Transition({target:a._leftBarButtonItem.view.superview,properties:["opacity"],from:[0],to:[1]})).start()}}else if(a.leftButton!=null){f=c?b.positions.title.x:-b.leftButton.view.size.width-iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN;e=(new iAd.Transition({target:a.leftButton.view.superview,from:[0,new iAd.Point(f,
a.positions.leftButton.y)],to:[a.hidesBackButton?0:1,a.positions.leftButton]})).start()}if(i){f=c?this.size.width:iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN;e=(new iAd.Transition({target:g.superview,from:[0,new iAd.Point(f,a.positions.title.y)],to:[1,a.positions.title]})).start()}if(a._rightBarButtonItem!=null&&a._rightBarButtonItem!==b._rightBarButtonItem){a._rightBarButtonItem.view.superview.position=a.positions.rightButton;e=(new iAd.Transition({target:a._rightBarButtonItem.view.superview,properties:["opacity"],
from:[0],to:[1]})).start()}if(d=d&&e!=null)e.delegate=this;iAd.Transaction.commit();d||this.transitionsEnded()};iAd.NavigationBar.prototype.transitionsEnded=function(){this._items=this.itemsAfterTransition;this.busy=false;this.transitionWentForward?this.dispatchNotification(iAd.NavigationBar.DID_PUSH_ITEM_DELEGATE,this.delegate,[["item",this.topItem]]):this.dispatchNotification(iAd.NavigationBar.DID_POP_ITEM_DELEGATE,this.delegate,[["item",this.previousItem]]);this.removeViewsForItem(this.previousItem)};
iAd.NavigationBar.prototype.removeViewsForItem=function(a){var b=a.titleViewForDisplay();b!==this.topItem.titleViewForDisplay()&&b.superview.removeFromSuperview();a.leftButton!=null&&a.leftButton!==this.topItem.leftButton&&a.leftButton.view.superview.removeFromSuperview();a._rightBarButtonItem!=null&&a._rightBarButtonItem!==this.topItem._rightBarButtonItem&&a._rightBarButtonItem.view.superview.removeFromSuperview();a.leftButton!=null&&a.leftButton.removeEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false)};iAd.NavigationBar.prototype.updateTopItemLayout=function(){this._items.length>0&&this.topItem.updateLayoutIfTopItem()};iAd.NavigationBar.prototype.shouldPushItem=function(a){this.dispatchNotification(iAd.NavigationBar.SHOULD_PUSH_ITEM_DELEGATE,this.delegate,[["item",a]]);return true};iAd.NavigationBar.prototype.shouldPopItem=function(a){this.dispatchNotification(iAd.NavigationBar.SHOULD_POP_ITEM_DELEGATE,this.delegate,[["item",a]]);return true};
iAd.NavigationBar.prototype.transitionDidComplete=function(){this.transitionsEnded()};iAd.Class({name:"iAd.NavigationController",superclass:iAd.StackController,synthesizedProperties:["navigationBarHidden","toolbarHidden"],archivedProperties:["navigationBarHidden","toolbarHidden"]});iAd.NavigationController.WILL_SHOW_VIEW_CONTROLLER="navigationControllerWillShowViewControllerAnimated";iAd.NavigationController.DID_SHOW_VIEW_CONTROLLER="navigationControllerDidShowViewControllerAnimated";
iAd.NavigationController.HIDE_SHOW_BAR_DURATION=0.2;iAd.NavigationController.POPOVER_OFFSET=6;iAd.NavigationController.prototype.init=function(a,b){this.callSuper(a,b);this._navigationBarHidden=false;this._toolbarHidden=true;this.navigationBar=new iAd.NavigationBar;this.toolbar=null;this.requiresDeferredHostViewSizeUpdate=false};
iAd.NavigationController.prototype.loadView=function(){var a=new iAd.NavigationView(this);this.view=a;a.layer.addClassName("ad-navigation-controller-view");a.size=new iAd.Size(window.innerWidth,window.innerHeight);a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;a.clipsToBounds=true;this._navigationBarHidden||a.addSubview(this.navigationBar);this.navigationBar.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.navigationBar.size=new iAd.Size(window.innerWidth,
iAd.NavigationBar.DEFAULT_HEIGHT);this.hostView=a.addSubview(this.backingTransitionController.view);this.hostView.layer.addClassName("ad-navigation-controller-host-view");this.toolbar=new iAd.Toolbar;this._toolbarHidden||a.addSubview(this.toolbar);this.toolbar.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.toolbar.size=new iAd.Size(window.innerWidth,iAd.Toolbar.DEFAULT_HEIGHT);a.addPropertyObserver("size",this,"sizeChanged");this.sizeChanged();this.performDelayedSetOperation();if((a=this.topViewController?
this.topViewController.view:null)&&a.superview!=this.hostView){a.size=this.hostView.size.copy();a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.hostView.addSubview(a)}};iAd.NavigationController.prototype.viewMovedToNewSuperview=function(){var a=this.navigationBar.topItem;a!=null&&a.updateLayoutIfTopItem()};iAd.NavigationController.prototype.unloadView=function(){if(this.toolbar){this.toolbar.removeFromSuperview();this.toolbar=null}this.callSuper()};
iAd.NavigationController.prototype.sizeChanged=function(){var a=this.hostedInPopoverController(),b=-iAd.NavigationBar.DEFAULT_HEIGHT,c=0,d=this._view.size.height;if(!this._navigationBarHidden){b=a?-iAd.NavigationController.POPOVER_OFFSET:0;c+=iAd.NavigationBar.DEFAULT_HEIGHT-(a?iAd.NavigationController.POPOVER_OFFSET:0)}this._toolbarHidden||(d-=iAd.Toolbar.DEFAULT_HEIGHT-(a?iAd.NavigationController.POPOVER_OFFSET+1:0));this.navigationBar.position=new iAd.Point(0,b);this.toolbar.position=new iAd.Point(0,
d);this.hostView.position=new iAd.Point(0,c);this.updateHostViewSize()};iAd.NavigationController.prototype.updateHostViewSize=function(){var a=this._view.size.height,b=this.hostedInPopoverController();this._navigationBarHidden||(a-=iAd.NavigationBar.DEFAULT_HEIGHT-(b?iAd.NavigationController.POPOVER_OFFSET:0));this._toolbarHidden||(a-=iAd.Toolbar.DEFAULT_HEIGHT-(b?iAd.NavigationController.POPOVER_OFFSET:0));this.hostView.size=new iAd.Size(this._view.size.width,a)};
iAd.NavigationController.prototype.shouldDelaySetOperation=function(){return this.callSuper()||!this.navigationBarHidden&&this.navigationBar.busy};iAd.NavigationController.prototype.shouldAnimateInitialViewController=function(){return false};iAd.NavigationController.prototype.prepareViewControllersForTransition=function(a,b,c){this.callSuper(a,b,c);b.view.size=this.hostView.size.copy();b.view.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT};
iAd.NavigationController.prototype.hostedInPopoverController=function(){return iAd.hasOwnProperty("PopoverController")&&this.parentViewController instanceof iAd.PopoverController};iAd.NavigationController.prototype.setNavigationBarHidden=function(a){this.setNavigationBarHiddenAnimated(a,false)};
iAd.NavigationController.prototype.setNavigationBarHiddenAnimated=function(a,b){if(this._navigationBarHidden!=a){this._navigationBarHidden=a;if(this.isViewLoaded()){var c=this.hostedInPopoverController(),d=new iAd.Point(0,a?-iAd.NavigationBar.DEFAULT_HEIGHT:c?-iAd.NavigationController.POPOVER_OFFSET:0);c=new iAd.Point(0,a?0:iAd.NavigationBar.DEFAULT_HEIGHT-(c?iAd.NavigationController.POPOVER_OFFSET:0));a||this.view.addSubview(this.navigationBar);if(b){iAd.Transaction.begin();iAd.Transaction.defaults.duration=
b?iAd.NavigationController.HIDE_SHOW_BAR_DURATION:0;iAd.Transaction.defaults.properties=["position"];(new iAd.Transition({target:this.navigationBar,to:[d],removesTargetUponCompletion:a})).start();(new iAd.Transition({target:this.hostView,to:[c],delegate:this})).start();iAd.Transaction.commit();if(a)this.updateHostViewSize();else this.requiresDeferredHostViewSizeUpdate=true}else{this.navigationBar.position=d;this.hostView.position=c;this.updateHostViewSize();a&&this.navigationBar.removeFromSuperview()}}}};
iAd.NavigationController.prototype.transitionDidComplete=function(){if(this.requiresDeferredHostViewSizeUpdate){this.requiresDeferredHostViewSizeUpdate=false;this.updateHostViewSize()}};iAd.NavigationController.prototype.setToolbarHidden=function(a){this.setToolbarHiddenAnimated(a,false)};
iAd.NavigationController.prototype.setToolbarHiddenAnimated=function(a,b){if(this._toolbarHidden!=a){this._toolbarHidden=a;if(this.isViewLoaded()){var c=new iAd.Point(0,this._view.size.height-(a?0:iAd.NavigationBar.DEFAULT_HEIGHT));if(this.hostedInPopoverController())c.y+=iAd.NavigationController.POPOVER_OFFSET;a||this.view.addSubview(this.toolbar);if(b){(new iAd.Transition({target:this.toolbar,properties:["position"],to:[c],duration:b?iAd.NavigationController.HIDE_SHOW_BAR_DURATION:0,delegate:this,
removesTargetUponCompletion:a})).start();if(a)this.updateHostViewSize();else this.requiresDeferredHostViewSizeUpdate=true;this.notifyPropertyChange("toolbarHidden")}else{this.toolbar.position=c;this.updateHostViewSize();a&&this.toolbar.removeFromSuperview()}}}};
iAd.NavigationController.prototype.transitionControllerWillMakeViewControllerVisibleAnimated=function(a,b,c,d){a=[];c=0;for(var e=this._viewControllers.length;c<e;c++)a.push(this._viewControllers[c].navigationItem);this.navigationBar.setItemsAnimated(a,this.navigationBarHidden?false:d);this.toolbar.setItemsAnimated(b.toolbarItems,d)};
iAd.NavigationController.prototype.performDelayedSetOperation=function(){if(this.delayedSetOperationArguments!=null)this.navigationBar.busy?this.navigationBar.addPropertyObserver("busy",this,"navigationBarBusyStateChanged"):this.callSuper()};iAd.NavigationController.prototype.navigationBarBusyStateChanged=function(){if(!this.navigationBar.busy){this.navigationBar.removePropertyObserver("busy",this,"navigationBarBusyStateChanged");this.performDelayedSetOperation()}};
iAd.Class({name:"iAd.NavigationView",superclass:iAd.View});iAd.NavigationView.prototype.init=function(a){this.callSuper();this.viewController=a};iAd.NavigationView.prototype.didMoveToSuperview=function(a){this.callSuper(a);a!=null&&this.viewController.viewMovedToNewSuperview()};iAd.ViewController.prototype.getNavigationController=function(){return this.parentControllerOfKind(iAd.NavigationController)};
iAd.ViewController.prototype.getNavigationItem=function(){if(this._navigationItem==null){this._navigationItem=new iAd.NavigationItem(this.title);this._navigationItem.viewController=this}return this._navigationItem};iAd.ViewController.prototype.setToolbarItems=function(a){this.setToolbarItemsAnimated(a,false)};
iAd.ViewController.prototype.setToolbarItemsAnimated=function(a,b){this._toolbarItems=a;var c=this.parentViewController;c!=null&&c instanceof iAd.NavigationController&&c.toolbar.setItemsAnimated(a,b)};iAd.Class.synthesizeProperties(iAd.ViewController,["navigationController","navigationItem","toolbarItems"]);iAd.Class.processMethods(iAd.ViewController,["setToolbarItemsAnimated"]);
iAd.RootViewController.prototype.getNavigationController=function(){if(!this.hasOwnProperty("_navigationController"))this.navigationController=new iAd.NavigationController;return this._navigationController};iAd.RootViewController.prototype.setNavigationController=function(a){var b=this.view;a.view.size=b._size.copy();a.delegate=this;b.addSubview(a.view);this._navigationController=a};iAd.Class.synthesizeProperties(iAd.RootViewController,["navigationController"]);
iAd.Class({name:"WK.LeftSidebarViewController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","isSidebarVisible"]});WK.LeftSidebarViewController.SIDEBAR_WIDTH=240;WK.LeftSidebarViewController.OVERLAY_SHADOW_WIDTH=10;WK.LeftSidebarViewController.SIDEBAR_HIDING_OFFSET=WK.LeftSidebarViewController.SIDEBAR_WIDTH+WK.LeftSidebarViewController.OVERLAY_SHADOW_WIDTH;WK.LeftSidebarViewController.ANIMATION_DURATION=0.2;
WK.LeftSidebarViewController.prototype={init:function(a){this.callSuper(a);this._isSidebarVisible=false},loadView:function(){this.callSuper();var a=new iAd.View;a.size=new iAd.Size(window.innerWidth,window.innerHeight);a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;var b=this.viewControllers[0].view;b.size=new iAd.Size(WK.LeftSidebarViewController.SIDEBAR_WIDTH,window.innerHeight);b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_RIGHT_MARGIN;
b.zIndex=3;b.wantsHardwareLayerBacking=true;b.position=new iAd.Point(-WK.LeftSidebarViewController.SIDEBAR_HIDING_OFFSET,0);var c=this.viewControllers[1].view;c.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;c.size=new iAd.Size(window.innerWidth,window.innerHeight);a.addSubview(b);a.addSubview(c);this.view=a},toggleSidebarAnimated:function(a){this.setIsSidebarVisibleAnimated(!this.isSidebarVisible,a)},hideSidebarAnimated:function(a){this.setIsSidebarVisibleAnimated(false,
a)},showSidebarAnimated:function(a){this.setIsSidebarVisibleAnimated(true,a)},setIsSidebarVisible:function(a){this.setIsSidebarVisibleAnimated(a,false)},setIsSidebarVisibleAnimated:function(a){if(a!=this.isSidebarVisible){this._isSidebarVisible=a;var b=-WK.LeftSidebarViewController.SIDEBAR_HIDING_OFFSET;if(a){b=0;this.overlayView=new iAd.View;this.overlayView.size=new iAd.Size(window.innerWidth,window.innerHeight);this.overlayView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;
this.overlayView.zIndex=2;this.overlayView.userInteractionEnabled=true;this.overlayView.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.view.addSubview(this.overlayView)}else this.overlayView&&this.overlayView.removeFromSuperview();this.viewControllers[0].view.position=new iAd.Point(b,0)}},handleEvent:function(a){this.callSuper(a);a.ad.sender==this.overlayView&&this.toggleSidebarAnimated(true)}};
iAd.Class({name:"iAd.ScrollIndicator",superclass:iAd.View,synthesizedProperties:["visible","width","height","indicatorStyle"]});iAd.ScrollIndicator.THICKNESS=7;iAd.ScrollIndicator.END_SIZE=3;iAd.ScrollIndicator.TYPE_HORIZONTAL="ad-horizontal";iAd.ScrollIndicator.TYPE_VERTICAL="ad-vertical";
iAd.ScrollIndicator.prototype.init=function(a){this.callSuper();this.type=a;this.layer.addClassName(a);this._visible=false;this._height=this._width=iAd.ScrollIndicator.THICKNESS;this.positionBeforeHide=this.position=new iAd.Point(-iAd.ScrollIndicator.THICKNESS,-iAd.ScrollIndicator.THICKNESS);this.lastPositionUpdateInHide=false;this._indicatorStyle=iAd.ScrollView.INDICATOR_STYLE_DEFAULT;this.visible=false};
iAd.ScrollIndicator.prototype.createLayer=function(){this.callSuper();this.layer.addClassName("ad-scroll-indicator");this.layer.addEventListener("webkitTransitionEnd",this,false);this.start=this.layer.appendChild(document.createElement("div"));this.middle=this.layer.appendChild(document.createElement("div"));this.end=this.layer.appendChild(document.createElement("div"))};
iAd.ScrollIndicator.prototype.setPosition=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);this.callSuper(a);this.lastPositionUpdateInHide=false};iAd.ScrollIndicator.prototype.setSize=function(a){this.width=a.width;this.height=a.height;this._size=a};
iAd.ScrollIndicator.prototype.setIndicatorStyle=function(a){if(a){this._indicatorStyle=a;this.layer.removeClassName(this._indicatorStyle);this.layer.addClassName(this._indicatorStyle);var b=this.type===iAd.ScrollIndicator.TYPE_HORIZONTAL?"-3px 0":"0 -3px";a=iAd.Path.assetsPath+"scroll-"+a.substr(3)+".png";if(iAd.Device.HAS_HIDPI_DISPLAY)a=iAd.Path.appendHiDPISuffix(a);this.middle.style.background='url("'+a+'") '+b}};
iAd.ScrollIndicator.prototype.setWidth=function(a){this.middle.style.webkitTransform="translate3d(0,0,0) scale("+(a-iAd.ScrollIndicator.END_SIZE*2)+",1)";this.end.style.webkitTransform="translate3d("+(a-iAd.ScrollIndicator.END_SIZE)+"px,0,0)";this._width=a};
iAd.ScrollIndicator.prototype.setHeight=function(a){this.middle.style.webkitTransform="translate3d(0,0,0) scale(1,"+(a-iAd.ScrollIndicator.END_SIZE*2)+")";this.end.style.webkitTransform="translate3d(0,"+(a-iAd.ScrollIndicator.END_SIZE)+"px,0)";this._height=a};
iAd.ScrollIndicator.prototype.setVisible=function(a){if(a){this.fading=false;this.opacity=1;this.position=this.lastPositionUpdateInHide?this.positionBeforeHide:this.position}else if(!this.fading){this.fading=true;this.opacity=0;this.lastPositionUpdateInHide=true;this.positionBeforeHide=this.position}this._visible=a};iAd.ScrollIndicator.prototype.flash=function(){this.flashing=true};
iAd.ScrollIndicator.prototype.handleEvent=function(a){if(a.type=="webkitTransitionEnd"){this.callSuper(a);if(this.flashing)this.flashing=false;else if(this.fading){this.position=new iAd.Point(-iAd.ScrollIndicator.THICKNESS,-iAd.ScrollIndicator.THICKNESS);this.fading=false}}};iAd.Class({name:"iAd.ScrollViewPanGestureRecognizer",synthesizedProperties:["enabled"]});
iAd.ScrollViewPanGestureRecognizer.prototype.init=function(){this.callSuper();this.identifier=this.delegate=this.view=null;this.translation=new iAd.Point;this.panning=this.detectedPanning=this.tracking=false;this.trackingDataPoints=[];this._enabled=true};iAd.ScrollViewPanGestureRecognizer.MINIMUM_TRACKING_FOR_PAN=10;iAd.ScrollViewPanGestureRecognizer.MAX_TIME_FOR_TRACKING_DATA_POINTS=100;iAd.ScrollViewPanGestureRecognizer.PANNING_DID_FAIL="panningGestureDidFail";
iAd.ScrollViewPanGestureRecognizer.PANNING_DID_START="panningGestureDidStart";iAd.ScrollViewPanGestureRecognizer.PANNING_DID_CHANGE="panningGestureDidChange";iAd.ScrollViewPanGestureRecognizer.PANNING_DID_END="panningGestureDidEnd";iAd.ScrollViewPanGestureRecognizer.PANNING_DID_CANCEL="panningGestureDidCancel";
iAd.ScrollViewPanGestureRecognizer.prototype.touchBegan=function(a,b){if(!this.tracking){this.startTouchPosition=iAd.Point.fromEvent(a);this.startTouchPositionInView=iAd.Point.fromEventInElement(a,this.view.layer);this.tracking=true;this.addTrackingDataPoint(this.startTouchPositionInView,b)}};
iAd.ScrollViewPanGestureRecognizer.prototype.touchMoved=function(a,b){this.lastTouchPositionInView=iAd.Point.fromEventInElement(a,this.view.layer);this.addTrackingDataPoint(this.lastTouchPositionInView,b);var c=iAd.Point.fromEvent(a);this.translation=new iAd.Point(c.x-this.startTouchPosition.x,c.y-this.startTouchPosition.y);if(this.panning)this.notifyDelegateOfStateChange(iAd.ScrollViewPanGestureRecognizer.PANNING_DID_CHANGE,b);else{c=iAd.ScrollViewPanGestureRecognizer.MINIMUM_TRACKING_FOR_PAN;if(Math.abs(this.translation.x)>=
c||Math.abs(this.translation.y)>=c)this.detectedPanning=true}};iAd.ScrollViewPanGestureRecognizer.prototype.touchEnded=function(a,b){this.panning&&this.notifyDelegateOfStateChange(iAd.ScrollViewPanGestureRecognizer.PANNING_DID_END,b);this.reset()};iAd.ScrollViewPanGestureRecognizer.prototype.touchCancelled=function(a,b){this.panning&&this.notifyDelegateOfStateChange(iAd.ScrollViewPanGestureRecognizer.PANNING_DID_CANCEL,b);this.reset()};
iAd.ScrollViewPanGestureRecognizer.prototype.reset=function(){this.panning=this.detectedPanning=this.tracking=false;this.trackingDataPoints=[];this.identifier=this.lastTouchPositionInView=null};iAd.ScrollViewPanGestureRecognizer.prototype.setEnabled=function(a){if(a!=this._enabled){this._enabled=a;if(!a){this.panning&&this.touchCancelled();iAd.ScrollViewPanGestureRecognizer.recognizerWasDisabled(this)}}};
iAd.ScrollViewPanGestureRecognizer.prototype.notifyDelegateOfStateChange=function(a,b,c){this.delegate!=null&&iAd.Utils.objectHasMethod(this.delegate,a)&&this.delegate[a](this,b,c)};
iAd.ScrollViewPanGestureRecognizer.prototype.gestureWasRecognized=function(a){this.startTouchPosition=this.trackingDataPoints[0].point;if(this.lastTouchPositionInView)this.startTouchPositionInView=this.lastTouchPositionInView.copy();this.detectedPanning=false;this.panning=true;this.notifyDelegateOfStateChange(iAd.ScrollViewPanGestureRecognizer.PANNING_DID_START,a)};
iAd.ScrollViewPanGestureRecognizer.prototype.gestureWasNotRecognized=function(a,b){this.notifyDelegateOfStateChange(iAd.ScrollViewPanGestureRecognizer.PANNING_DID_FAIL,a,b);this.reset()};iAd.ScrollViewPanGestureRecognizer.prototype.translationInView=function(){return new iAd.Point(this.lastTouchPositionInView.x-this.startTouchPositionInView.x,this.lastTouchPositionInView.y-this.startTouchPositionInView.y)};
iAd.ScrollViewPanGestureRecognizer.prototype.velocityInView=function(){this.purgeTrackingDataPointsWithTime((new Date).getTime());if(this.trackingDataPoints.length<2)return new iAd.Point(0,0);var a=this.trackingDataPoints[0],b=this.trackingDataPoints[this.trackingDataPoints.length-1],c=(b.time-a.time)/1E3;return new iAd.Point((b.point.x-a.point.x)/c,(b.point.y-a.point.y)/c)};
iAd.ScrollViewPanGestureRecognizer.prototype.purgeTrackingDataPointsWithTime=function(a){for(;this.trackingDataPoints.length>0;){if(a-this.trackingDataPoints[0].time<=iAd.ScrollViewPanGestureRecognizer.MAX_TIME_FOR_TRACKING_DATA_POINTS)break;this.trackingDataPoints.shift()}};iAd.ScrollViewPanGestureRecognizer.prototype.addTrackingDataPoint=function(a,b){var c=b.timeStamp;this.purgeTrackingDataPointsWithTime(c);this.trackingDataPoints.push({time:c,point:a})};
iAd.ScrollViewPanGestureRecognizer.recognizers=[];iAd.ScrollViewPanGestureRecognizer.recognizersForTouch={};iAd.ScrollViewPanGestureRecognizer.panningTouchIdentifiers=[];
iAd.ScrollViewPanGestureRecognizer.registerRecognizerWithTouch=function(a,b){if(!(!a.enabled||this.recognizers.indexOf(a)!=-1||!a.view.userInteractionEnabled)){a.identifier=b.identifier;this.recognizers.push(a);if(this.recognizersForTouch[a.identifier]==undefined)this.recognizersForTouch[a.identifier]=[];this.recognizersForTouch[a.identifier].push(a);if(this.recognizers.length==1){window.addEventListener(iAd.Event.MOVE_EVENT,this.handleEventProxy,true);window.addEventListener(iAd.Event.END_EVENT,
this.handleEventProxy,true);window.addEventListener(iAd.Event.CANCEL_EVENT,this.handleEventProxy,true)}}};
iAd.ScrollViewPanGestureRecognizer.stopTrackingTouchIdentifier=function(a){var b=this.recognizersForTouch[a];if(b!=undefined){for(;b.length;)iAd.Array.removeObjectFromArray(b.pop(),this.recognizers);delete this.recognizersForTouch[a];if(this.recognizers.length==0){window.removeEventListener(iAd.Event.MOVE_EVENT,this.handleEventProxy,true);window.removeEventListener(iAd.Event.END_EVENT,this.handleEventProxy,true);window.removeEventListener(iAd.Event.CANCEL_EVENT,this.handleEventProxy,true)}iAd.Array.removeObjectFromArray(a,
this.panningTouchIdentifiers)}};iAd.ScrollViewPanGestureRecognizer.recognizerWasDisabled=function(a){var b=this.recognizersForTouch[a.identifier];if(b!=undefined){iAd.Array.removeObjectFromArray(a,b);iAd.Array.removeObjectFromArray(a,this.recognizers);b.length==0&&this.stopTrackingTouchIdentifier(a.identifier)}};iAd.ScrollViewPanGestureRecognizer.handleEventProxy=function(a){iAd.ScrollViewPanGestureRecognizer.handleEvent(a)};
iAd.ScrollViewPanGestureRecognizer.handleEvent=function(a){if(!a.hasOwnProperty("_synthetic")){var b=a.changedTouches;if(!iAd.Event.SUPPORTS_TOUCHES){a.identifier=0;b=[a]}a.type===iAd.Event.START_EVENT&&this.setupRecognizersForTouches(b,a);for(var c,d,e,f=0,g=b.length;f<g;f++){c=b[f];if(d=this.recognizersForTouch[c.identifier])for(var i=0,h=d.length;i<h;i++){e=d[i];this.sendEventToRecognizer(e,a,c)}a.type==iAd.Event.MOVE_EVENT&&this.panningTouchIdentifiers.indexOf(c.identifier)==-1&&this.checkRecognizersWithTouchIdentifierForPanning(c.identifier,
a);a.type==iAd.Event.END_EVENT&&this.stopTrackingTouchIdentifier(c.identifier)}}};iAd.ScrollViewPanGestureRecognizer.parentScrollViewForView=function(a){for(;a.superview;){a=a.superview;if(a instanceof iAd.ScrollView)return a}return null};iAd.ScrollViewPanGestureRecognizer.scrollViewHasPanningChildScrollView=function(a){a=a.scrollViews;for(var b=0,c=a.length;b<c;b++)if(a[b].dragging)return true;return false};
iAd.ScrollViewPanGestureRecognizer.scrollViewHasPanningParentScrollView=function(a){for(a=this.parentScrollViewForView(a);a!=null;){if(a.dragging)return true;a=this.parentScrollViewForView(a)}return iAd.ScrollView.hostScrollView.dragging};iAd.ScrollViewPanGestureRecognizer.hasRecognizerTrackingNativeScrollView=function(){for(var a=0,b=this.recognizers.length;a<b;a++)if(this.recognizers[a].view.usesNativeScrolling)return true;return false};
iAd.ScrollViewPanGestureRecognizer.setupRecognizersForTouches=function(a,b){for(var c,d,e,f=0,g=a.length;f<g;f++){c=a[f];d=iAd.View.nearestViewForElement(c.target)||iAd.ScrollView.hostScrollView;if(d!=null){e=(e=d instanceof iAd.ScrollView?d:this.parentScrollViewForView(d))||iAd.ScrollView.hostScrollView;if(!(e==null||e.dragging||this.scrollViewHasPanningChildScrollView(e)||this.scrollViewHasPanningParentScrollView(e))){for(e=null;d;){e=this.processViewRecognizersForTouch(d,c);d=d.superview}d=iAd.ScrollView.hostScrollView;
d.touchesBegan(b);this.registerRecognizerWithTouch(d.gestureRecognizers[0],c);if(e){e.touchBegan(c,b);this.gestureWasRecognized(e,b)}}}}};iAd.ScrollViewPanGestureRecognizer.processViewRecognizersForTouch=function(a,b){var c=a.gestureRecognizers,d=null;if(c.length>0&&a.pointInside(iAd.Point.fromEventInElement(b,a.layer)))for(var e=0,f=c.length;e<f;e++){recognizer=c[e];if(recognizer.tracking)return;if(a.decelerating)d=recognizer;a.touchesBegan(event);this.registerRecognizerWithTouch(recognizer,b)}return d};
iAd.ScrollViewPanGestureRecognizer.checkRecognizersWithTouchIdentifierForPanning=function(a,b){var c=this.recognizersForTouch[a];if(c!=undefined)for(var d,e,f=0,g=c.length;f<g;f++){d=c[f];if(d.panning)break;if(d.detectedPanning){e=d.view;var i=iAd.ScrollViewPanGestureRecognizer.MINIMUM_TRACKING_FOR_PAN;if(e=Math.abs(d.translation.x)>=i&&(e.canScrollHorizontally||e.alwaysBounceHorizontal)||Math.abs(d.translation.y)>=i&&(e.canScrollVertically||e.alwaysBounceVertical)){this.gestureWasRecognized(d,b);
break}}}};iAd.ScrollViewPanGestureRecognizer.gestureWasRecognized=function(a,b){a.gestureWasRecognized(b);this.panningTouchIdentifiers.push(a.identifier);for(var c=this.recognizersForTouch[a.identifier],d=c.length;d--;)if(c[d]!=a){c[d].gestureWasNotRecognized(b,a);iAd.Array.removeObjectFromArray(c[d],this.recognizers);c.splice(d,1)}};
iAd.ScrollViewPanGestureRecognizer.sendEventToRecognizer=function(a,b,c){switch(b.type){case iAd.Event.START_EVENT:a.touchBegan(c,b);break;case iAd.Event.MOVE_EVENT:a.touchMoved(c,b);break;case iAd.Event.END_EVENT:a.touchEnded(c,b);break;case iAd.Event.CANCEL_EVENT:a.touchCancelled(c,b)}};document.addEventListener(iAd.Event.START_EVENT,iAd.ScrollViewPanGestureRecognizer.handleEventProxy,true);
iAd.Class({name:"iAd.ScrollView",superclass:iAd.View,synthesizedProperties:["contentOffset","contentSize","indicatorStyle","scrollEnabled","scrollIndicatorInsets","dragging","pagingEnabled","pageSize","bounces","showsHorizontalScrollIndicator","showsVerticalScrollIndicator","usesNativeScrolling"],archivedProperties:["contentSize","contentOffset","indicatorStyle","scrollEnabled","scrollIndicatorInsets","showsHorizontalScrollIndicator","showsVerticalScrollIndicator","pagingEnabled","pageSize","bounces",
"alwaysBounceHorizontal","alwaysBounceVertical","delaysContentTouches","canCancelContentTouches"],cssClassName:"ad-scroll-view",collectionAccessor:"scrollViews"});iAd.ScrollView.WILL_BEGIN_DRAGGING="scrollViewWillBeginDragging";iAd.ScrollView.WILL_BEGIN_SCROLLING_ANIMATION="scrollViewWillBeginScrollingAnimation";iAd.ScrollView.DID_END_SCROLLING_ANIMATION="scrollViewDidEndScrollingAnimation";iAd.ScrollView.DID_SCROLL="scrollViewDidScroll";iAd.ScrollView.WILL_END_DRAGGING="scrollViewWillEndDraggingWithVelocityAndTargetContentOffset";
iAd.ScrollView.DID_END_DRAGGING="scrollViewDidEndDragging";iAd.ScrollView.WILL_BEGIN_DECELERATING="scrollViewWillBeginDecelerating";iAd.ScrollView.DID_END_DECELERATING="scrollViewDidEndDecelerating";iAd.ScrollView.MIN_INDICATOR_LENGTH=34;iAd.ScrollView.DECELERATION_FRICTION_FACTOR=0.998;iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE=1/60;iAd.ScrollView.MINIMUM_VELOCITY=10;iAd.ScrollView.PENETRATION_DECELERATION=5;iAd.ScrollView.PENETRATION_ACCELERATION=8;
iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION=250;iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION_WITH_PAGING=300;iAd.ScrollView.PAGING_ACCELERATION=3.6E-4;iAd.ScrollView.PAGING_DECELERATION=0.9668;iAd.ScrollView.PAGING_TRANSITION_DURATION="0.25s";iAd.ScrollView.CONTENT_TOUCHES_DELAY=0.15;iAd.ScrollView.AUTOMATED_CONTENT_SIZE=-1;iAd.ScrollView.INDICATOR_STYLE_DEFAULT="ad-indicator-default";iAd.ScrollView.INDICATOR_STYLE_BLACK="ad-indicator-black";iAd.ScrollView.INDICATOR_STYLE_WHITE="ad-indicator-white";
iAd.ScrollView.NON_NATIVE_PROPERTIES={pagingEnabled:true,bounces:false,showsHorizontalScrollIndicator:false,showsVerticalScrollIndicator:false};iAd.ScrollView.TEXT_FIELD_INPUT_TYPES=["text","password","email","url","search","tel","number","week"];
iAd.ScrollView.prototype.init=function(a){this._contentOffset=new iAd.Point;this._contentSize=iAd.ScrollView.AUTOMATED_CONTENT_SIZE;this.adjustedContentSize=new iAd.Size;this.decelerating=this._dragging=false;this.decelerationTimer=null;this._indicatorStyle="";this._showsVerticalScrollIndicator=this._showsHorizontalScrollIndicator=true;this._scrollIndicatorInsets=new iAd.EdgeInsets(0,0,0,0);this._pagingEnabled=this.scrollIndicatorsNeedFlashing=false;this._pageSize=new iAd.Size;this._bounces=true;
this.alwaysBounceVertical=this.alwaysBounceHorizontal=false;this.delegate=null;this.canCancelContentTouches=this.delaysContentTouches=true;this._setContentOffsetAnimatedCalledFromSetter=false;this.beginTouchesInContentTimer=null;this.panGestureRecognizer=new iAd.ScrollViewPanGestureRecognizer;this.panGestureRecognizer.delegate=this;this.callSuper(a);this.userInteractionEnabled=true;this.layer.addEventListener("webkitTransitionEnd",this,false);this.hostingLayer.addEventListener("webkitTransitionEnd",
this,false);this.addGestureRecognizer(this.panGestureRecognizer);this.layer.addEventListener("focus",this,true);this.shouldPreventSelectElementFocus=false;for(var b in iAd.ScrollView.NON_NATIVE_PROPERTIES)this.addPropertyObserver(b,this,"handleNonNativePropertyChange")};
iAd.ScrollView.prototype.createLayer=function(){this.callSuper();this._hostingLayer=this.layer.appendChild(document.createElement("div"));this._hostingLayer.className="ad-hosting-layer";this.clipsToBounds=true;this.createScrollIndicators();this.indicatorStyle=iAd.ScrollView.INDICATOR_STYLE_DEFAULT};
iAd.ScrollView.prototype.setupLayer=function(){this.callSuper();this._hostingLayer=document.createElement("div");for(this._hostingLayer.className="ad-hosting-layer";this.layer.firstChild;)this._hostingLayer.appendChild(this.layer.firstChild);this.layer.appendChild(this._hostingLayer);this.updateAlwaysBounce();this.usesNativeScrolling||this.createScrollIndicators();this.indicatorStyle=this.layerHasCustomAttribute("ad-indicator-style")?this.getLayerCustomAttributeValue("ad-indicator-style"):iAd.ScrollView.INDICATOR_STYLE_DEFAULT};
iAd.ScrollView.prototype.setValueForAttribute=function(a,b){switch(b){case "ad-scroll-indicator-inset-left":this._scrollIndicatorInsets.left=parseInt(a);break;case "ad-scroll-indicator-inset-top":this._scrollIndicatorInsets.top=parseInt(a);break;case "ad-scroll-indicator-inset-right":this._scrollIndicatorInsets.right=parseInt(a);break;case "ad-scroll-indicator-inset-bottom":this._scrollIndicatorInsets.bottom=parseInt(a);break;case "ad-indicator-style":this.indicatorStyle=a==""?iAd.ScrollView.INDICATOR_STYLE_DEFAULT:
a;break;case "ad-uses-native-scrolling":this.usesNativeScrolling=a=="true"?true:false;break;case "ad-page-width":this.pageSize=new iAd.Size(parseFloat(a),this.pageSize.height);break;case "ad-page-height":this.pageSize=new iAd.Size(this.pageSize.width,parseFloat(a));break;default:this.callSuper(a,b)}};iAd.ScrollView.prototype.setBounces=function(a){if(this._bounces!=a){this._bounces=a;this.updateAlwaysBounce()}};
iAd.ScrollView.prototype.setAlwaysBounceVertical=function(a){if(this._alwaysBounceVertical!=a){this._alwaysBounceVertical=a;this.updateAlwaysBounce()}};iAd.ScrollView.prototype.setAlwaysBounceHorizontal=function(a){if(this._alwaysBounceHorizontal!=a){this._alwaysBounceHorizontal=a;this.updateAlwaysBounce()}};
iAd.ScrollView.prototype.updateAlwaysBounce=function(){if(this.usesNativeScrolling){this._hostingLayer.style.width=this.bounces&&this._alwaysBounceHorizontal&&(!this._contentSize.width||this._contentSize.width<this._size.width)?this._size.width+1+"px":"";this._hostingLayer.style.height=this.bounces&&this._alwaysBounceVertical&&(!this._contentSize.height||this._contentSize.height<this._size.height)?this._size.height+1+"px":""}else{if(this._hostingLayer.style.width==this._size.width+1+"px")this._hostingLayer.style.width=
this._size.width+"px";if(this._hostingLayer.style.height==this._size.height+1+"px")this._hostingLayer.style.height=this._size.height+"px"}};iAd.ScrollView.prototype.setSize=function(a){if(!this._size.equals(a)){this.callSuper(a);if(this._contentSize!==iAd.ScrollView.AUTOMATED_CONTENT_SIZE||this.layerIsInDocument)this.adjustContentSize(true)}};iAd.ScrollView.prototype.getPageSize=function(){return this._pageSize.equals(iAd.Size.ZERO_SIZE)?this._size:this._pageSize};
iAd.ScrollView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this._contentSize===iAd.ScrollView.AUTOMATED_CONTENT_SIZE&&this.adjustContentSize(true)};iAd.ScrollView.prototype.setUserInteractionEnabled=function(a){if(this._userInteractionEnabled!=a){this.callSuper(a);this.layer[a?"addEventListener":"removeEventListener"](iAd.Event.START_EVENT,this,true)}};
iAd.ScrollView.prototype.setUsesNativeScrolling=function(a){if(this._usesNativeScrolling!=a)if(a&&iAd.Device.iOS_VERSION&&iAd.Device.iOSVersionLessThan("5.0"))iAd.Console.warn("iAd.ScrollView.usesNativeScrolling is only available on iOS 5 and later.");else{if(this._usesNativeScrolling=a){var b=iAd.ScrollView.NON_NATIVE_PROPERTIES;for(var c in b)if(this[c]==b[c]){this[c]=!b[c];iAd.Console.warn('iAd.ScrollView - the value for "'+c+'" was reverted to '+!b[c]+" to support native scrolling.")}}this.layer.style.overflow=
a&&!this._scrollEnabled?"scroll":"";this.layer.style.webkitOverflowScrolling=a?"touch":"none";this.layer.style.webkitTransition=a?"none":"-webkit-transform";this.layer[this._usesNativeScrolling?"addEventListener":"removeEventListener"]("scroll",this,false);if(this._usesNativeScrolling)this.hideScrollIndicators();else{this.horizontalScrollIndicator||this.createScrollIndicators();this.handleScrollEvent()}this.updateScrollPositionWithContentOffset();this.updateAlwaysBounce()}};
iAd.ScrollView.prototype.handleNonNativePropertyChange=function(a,b){var c=iAd.ScrollView.NON_NATIVE_PROPERTIES;if(this.usesNativeScrolling&&this[b]==c[b]){iAd.Console.warn('iAd.ScrollView - native scrolling was disabled because an unsupported value was set for "'+b+'"');this.usesNativeScrolling=false}};iAd.ScrollView.prototype.getScrollEnabled=function(){return this.panGestureRecognizer.enabled};
iAd.ScrollView.prototype.setScrollEnabled=function(a){if(this.usesNativeScrolling)this.layer.style.overflowX=this.layer.style.overflowY=a?"scroll":"hidden";this.panGestureRecognizer.enabled=a};iAd.ScrollView.prototype.setContentOffset=function(a){this._setContentOffsetAnimatedCalledFromSetter=true;this.setContentOffsetAnimated(a,false)};
iAd.ScrollView.prototype.setContentOffsetAnimated=function(a,b){if(!(!a||a.equals(this._contentOffset))){if(b)this.usesNativeScrolling?iAd.Console.warn("iAd.ScrollView - animated content offsets are not supported with native scrolling."):this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_SCROLLING_ANIMATION,this.delegate);this._contentOffset=new iAd.Point(iAd.CSS.roundedPxValue(a.x),iAd.CSS.roundedPxValue(a.y));if(!this.dragging&&!this.decelerating){this.adjustContentSize(false);this._contentOffset.x=
iAd.Number.clampValue(this._contentOffset.x,0,this.maxPoint.x);this._contentOffset.y=iAd.Number.clampValue(this._contentOffset.y,0,this.maxPoint.y)}this.updateScrollPositionWithContentOffset();if(b&&!this.usesNativeScrolling){this.scrollTransitionsNeedRemoval=true;this.hostingLayer.style.webkitTransitionDuration=iAd.ScrollView.PAGING_TRANSITION_DURATION}else this.didScroll(false);if(!b&&!this.usesNativeScrolling){this.canScrollHorizontally&&this.showsHorizontalScrollIndicator&&this.updateHorizontalScrollIndicator();
this.canScrollVertically&&this.showsVerticalScrollIndicator&&this.updateVerticalScrollIndicator()}this._setContentOffsetAnimatedCalledFromSetter||this.notifyPropertyChange("contentOffset");this._setContentOffsetAnimatedCalledFromSetter=false}};
iAd.ScrollView.prototype.updateScrollPositionWithContentOffset=function(){if(this.usesNativeScrolling){this.hostingLayer.style.webkitTransform=iAd.CSS.t(0,0);this.layer.scrollTop=this._contentOffset.y;this.layer.scrollLeft=this._contentOffset.x}else{this.layer.scrollTop=this.layer.scrollLeft=0;this.hostingLayer.style.webkitTransform=iAd.CSS.tm(-this._contentOffset.x,-this._contentOffset.y)}};
iAd.ScrollView.prototype.snapContentOffsetToBounds=function(a){var b=false,c=new iAd.Point;if(this.pagingEnabled&&a){b=this.pageSize;c.x=Math.round(this._contentOffset.x/b.width)*b.width;c.y=Math.round(this._contentOffset.y/b.height)*b.height;b=true}else if(this.bounces){c.x=iAd.Number.clampValue(this._contentOffset.x,0,this.maxPoint.x);c.y=iAd.Number.clampValue(this._contentOffset.y,0,this.maxPoint.y);b=c.x!=this._contentOffset.x||c.y!=this._contentOffset.y}b&&this.setContentOffsetAnimated(c,a)};
iAd.ScrollView.prototype.getContentSize=function(){var a=this._contentSize;if(a===iAd.ScrollView.AUTOMATED_CONTENT_SIZE){a=new iAd.Size(this._hostingLayer.offsetWidth,this._hostingLayer.offsetHeight);for(var b=0,c=this.subviews.length;b<c;b++){var d=this.subviews[b];a.width=Math.max(a.width,d.position.x+d.size.width);a.height=Math.max(a.height,d.position.y+d.size.height)}}return a};iAd.ScrollView.prototype.setClipsToBounds=function(a){this.usesNativeScrolling||this.callSuper(a)};
iAd.ScrollView.prototype.setContentSize=function(a){if(a){this._contentSize=a;this.adjustContentSize(false);this.updateAlwaysBounce()}};
iAd.ScrollView.prototype.adjustContentSize=function(a){if(a){var b=new iAd.Point;if(this.adjustedContentSize.width!=0)b.x=this._contentOffset.x/this.adjustedContentSize.width;if(this.adjustedContentSize.height!=0)b.y=this._contentOffset.y/this.adjustedContentSize.height}this.adjustedContentSize.width=Math.max(this._size.width,this.contentSize.width);this.adjustedContentSize.height=Math.max(this._size.height,this.contentSize.height);this.maxPoint=new iAd.Point(this.adjustedContentSize.width-this._size.width,
this.adjustedContentSize.height-this._size.height);if(a)this.contentOffset=new iAd.Point(Math.min(b.x*this.adjustedContentSize.width,this.maxPoint.x),Math.min(b.y*this.adjustedContentSize.height,this.maxPoint.y));this.canScrollHorizontally=this.size.width<this.adjustedContentSize.width;this.canScrollVertically=this.size.height<this.adjustedContentSize.height};
iAd.ScrollView.prototype.setIndicatorStyle=function(a){this._indicatorStyle=a;if(this.usesNativeScrolling)iAd.Console.warn("iAd.ScrollView - indicatorStyle property is not supported with native scrolling.");else{this.horizontalScrollIndicator.indicatorStyle=a;this.verticalScrollIndicator.indicatorStyle=a}};
iAd.ScrollView.prototype.setScrollIndicatorInsets=function(a){this._scrollIndicatorInsets=a;if(this.usesNativeScrolling)iAd.Console.warn("iAd.ScrollView - scrollIndicatorInsets property is not supported with native scrolling.");else{this.horizontalScrollIndicator.visible&&this.updateHorizontalScrollIndicator();this.verticalScrollIndicator.visible&&this.updateVerticalScrollIndicator()}};
iAd.ScrollView.prototype.createScrollIndicators=function(){this.horizontalScrollIndicator=new iAd.ScrollIndicator(iAd.ScrollIndicator.TYPE_HORIZONTAL);this.layer.appendChild(this.horizontalScrollIndicator.layer);this.horizontalScrollIndicator.indicatorStyle=this._indicatorStyle;this.verticalScrollIndicator=new iAd.ScrollIndicator(iAd.ScrollIndicator.TYPE_VERTICAL);this.layer.appendChild(this.verticalScrollIndicator.layer);this.verticalScrollIndicator.indicatorStyle=this._indicatorStyle};
iAd.ScrollView.prototype.updateHorizontalScrollIndicator=function(){var a=this.scrollIndicatorInsets.left+1,b=this.size.width-this.scrollIndicatorInsets.right-1;if(this.canScrollVertically&&this.showsVerticalScrollIndicator)b-=iAd.ScrollIndicator.THICKNESS-1;var c=b-a,d=Math.max(iAd.ScrollView.MIN_INDICATOR_LENGTH,Math.round(this.size.width/this.adjustedContentSize.width*c)),e=this.size.height-iAd.ScrollIndicator.THICKNESS-this.scrollIndicatorInsets.bottom-1;if(this.contentOffset.x<0){d=Math.round(Math.max(d+
this.contentOffset.x,iAd.ScrollIndicator.THICKNESS));a=a}else if(this.contentOffset.x>this.maxPoint.x){d=Math.round(Math.max(d+this.adjustedContentSize.width-this.size.width-this.contentOffset.x,iAd.ScrollIndicator.THICKNESS));a=b-d}else a=iAd.Number.clampValue(Math.round(this.contentOffset.x/(this.adjustedContentSize.width-this.size.width)*(c-d)+this.scrollIndicatorInsets.left),a,b-d);this.horizontalScrollIndicator.position=new iAd.Point(a,e);this.horizontalScrollIndicator.width=d};
iAd.ScrollView.prototype.updateVerticalScrollIndicator=function(){var a=this.scrollIndicatorInsets.top+1,b=this.size.height-this.scrollIndicatorInsets.bottom-1;if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator)b-=iAd.ScrollIndicator.THICKNESS-1;var c=b-a,d=Math.max(iAd.ScrollView.MIN_INDICATOR_LENGTH,Math.round(this.size.height/this.adjustedContentSize.height*c)),e=this.size.width-iAd.ScrollIndicator.THICKNESS-this.scrollIndicatorInsets.right-1;if(this.contentOffset.y<0){d=Math.round(Math.max(d+
this.contentOffset.y,iAd.ScrollIndicator.THICKNESS));a=a}else if(this.contentOffset.y>this.maxPoint.y){d=Math.round(Math.max(d+this.adjustedContentSize.height-this.size.height-this.contentOffset.y,iAd.ScrollIndicator.THICKNESS));a=b-d}else a=iAd.Number.clampValue(Math.round(this.contentOffset.y/(this.adjustedContentSize.height-this.size.height)*(c-d)+this.scrollIndicatorInsets.top),a,b-d);this.verticalScrollIndicator.position=new iAd.Point(e,a);this.verticalScrollIndicator.height=d};
iAd.ScrollView.prototype.flashScrollIndicators=function(a){if(!this.usesNativeScrolling)if(a)this.scrollIndicatorsNeedFlashing=true;else{if(this.canScrollHorizontally&&this.showsHorizontalScrollIndicator&&this.adjustedContentSize.width>this._size.width){this.updateHorizontalScrollIndicator();this.horizontalScrollIndicator.flash()}if(this.canScrollVertically&&this.showsVerticalScrollIndicator&&this.adjustedContentSize.height>this._size.height){this.updateVerticalScrollIndicator();this.verticalScrollIndicator.flash()}}};
iAd.ScrollView.prototype.hideScrollIndicators=function(){this.horizontalScrollIndicator.visible=false;this.verticalScrollIndicator.visible=false};iAd.ScrollView.prototype.showHorizontalScrollIndicator=function(){if(!this.usesNativeScrolling)this.horizontalScrollIndicator.visible=true};iAd.ScrollView.prototype.showVerticalScrollIndicator=function(){if(!this.usesNativeScrolling)this.verticalScrollIndicator.visible=true};
iAd.ScrollView.prototype.handleEvent=function(a){if(!a.hasOwnProperty("_synthetic"))if(a.type=="focus"&&this.shouldPreventSelectElementFocus){a.stopPropagation();a.preventDefault();this.originalTarget.blur()}else if(a.type==iAd.Event.START_EVENT&&a.eventPhase==Event.CAPTURING_PHASE)this.touchesBeganInCapturePhase(a);else if(a.type=="webkitTransitionEnd")this.transitionEnded(a);else a.type=="scroll"?this.handleScrollEvent(a):this.callSuper(a)};
iAd.ScrollView.prototype.handleScrollEvent=function(a){this._contentOffset=new iAd.Point(this.layer.scrollLeft,this.layer.scrollTop);this.notifyPropertyChange("contentOffset");this.didScroll(!!a)};iAd.ScrollView.prototype.touchesBeganInCapturePhase=function(a){if(this.scrollEnabled){for(var b=iAd.View.nearestViewForElement(a.target);b&&b!=this;){if(b instanceof iAd.ScrollView&&b.scrollEnabled&&b.userInteractionEnabled)return;b=iAd.ScrollViewPanGestureRecognizer.parentScrollViewForView(b)}a.stopPropagation()}};
iAd.ScrollView.prototype.touchesBegan=function(a){this.beginTracking(a)};iAd.ScrollView.prototype.touchesMoved=function(a){var b=this.getInitialTouch(a);if(b!=null){this.lastKnownTouchPosition=iAd.Point.fromEvent(b);this.contentTouchesCouldNotBeCancelled||this.callSuper(a)}};
iAd.ScrollView.prototype.shouldPreventEventDefault=function(a){if(a.type==iAd.Event.MOVE_EVENT||a.type==iAd.Event.START_EVENT)return!this.usesNativeScrolling&&!iAd.ScrollView.isViewInNativeScrollView(this)&&!iAd.ScrollView.viewHasTrackingNativeChildScrollView(this)&&!iAd.ScrollView.hostScrollView.scrollEnabled;return true};
iAd.ScrollView.prototype.touchesEnded=function(a){if(this.getInitialTouch(a)!=null){this.stopTrackingTouches();if(this.scrollEnabled)if(this.contentTouchesCouldNotBeCancelled)if(this.isOriginalTargetElementAtPoint(this.lastKnownTouchPosition)){if(!a.hasOwnProperty("_scrollViewDispatchedEventToContent")){this.dispatchClickToContent();a._scrollViewDispatchedEventToContent=true}}else{if(this.originalTarget.localName=="select")this.shouldPreventSelectElementFocus=true}else if(this.dragging){a.preventDefault();
if(this.originalTarget.localName=="select")this.shouldPreventSelectElementFocus=true;a.stopPropagation()}else{this.hideScrollIndicators();if(this.isOriginalTargetElementAtPoint(this.lastKnownTouchPosition)){if(!a.hasOwnProperty("_scrollViewDispatchedEventToContent")){this.touchesInContentBegan?this.endTouchesInContent():this.dispatchTapSequenceToContent();this.dispatchClickToContent();a._scrollViewDispatchedEventToContent=true}}else if(this.originalTarget.localName=="select")this.shouldPreventSelectElementFocus=
true;else a.preventDefault()}}};iAd.ScrollView.prototype.touchesCancelled=function(){this.stopTrackingTouches();this.hideScrollIndicators()};iAd.ScrollView.prototype.panningGestureDidFail=function(a,b,c){this.stopTrackingTouches();if(!c||!c.view.usesNativeScrolling)b.preventDefault()};
iAd.ScrollView.prototype.panningGestureDidStart=function(){if(!this.contentTouchesCouldNotBeCancelled)if(this.canCancelContentTouches&&this.touchesInContentBegan&&!this.touchesShouldCancelInContentElementAndView(this.originalTarget,iAd.View.nearestViewForElement(this.originalTarget)))this.interruptTrackingInteraction(true);else{this.cancelTouchesInContent();this.hostingLayer.style.webkitTransitionDuration=0;this.startContentOffset=this.contentOffset.copy();this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_DRAGGING,
this.delegate);this.dragging=true;this.canScrollHorizontally&&this.showsHorizontalScrollIndicator&&this.adjustedContentSize.width>this._size.width&&this.showHorizontalScrollIndicator();this.canScrollVertically&&this.showsVerticalScrollIndicator&&this.adjustedContentSize.height>this._size.height&&this.showVerticalScrollIndicator()}};
iAd.ScrollView.prototype.panningGestureDidChange=function(a,b){if(!this.contentTouchesCouldNotBeCancelled){b.stopPropagation();if(!this.usesNativeScrolling){var c=this.canScrollHorizontally||this.bounces&&this.alwaysBounceHorizontal,d=this.canScrollVertically||this.bounces&&this.alwaysBounceVertical,e=a.translationInView();c=c?this.startContentOffset.x-e.x:this._contentOffset.x;d=d?this.startContentOffset.y-e.y:this._contentOffset.y;if(this.bounces){c-=(c>this.maxPoint.x?c-this.maxPoint.x:c<0?c:0)/
2;d-=(d>this.maxPoint.y?d-this.maxPoint.y:d<0?d:0)/2}else{c=iAd.Number.clampValue(c,0,this.maxPoint.x);d=iAd.Number.clampValue(d,0,this.maxPoint.y)}this.contentOffset=new iAd.Point(c,d)}}};
iAd.ScrollView.prototype.panningGestureDidEnd=function(){if(!this.contentTouchesCouldNotBeCancelled){this.dragging=false;this.stopTrackingTouches();this.usesNativeScrolling||this.startDecelerationAnimation();this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);if(!this.decelerating&&!this.usesNativeScrolling){this.snapContentOffsetToBounds(true);this.hideScrollIndicators()}}};
iAd.ScrollView.prototype.panningGestureDidCancel=function(){if(this._dragging){this.dragging=false;this.usesNativeScrolling||this.snapContentOffsetToBounds(true);this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);this.hideScrollIndicators()}};iAd.ScrollView.prototype.getInitialTouch=function(a){if(!iAd.Event.SUPPORTS_TOUCHES)return a;for(var b,c=0,d=a.changedTouches.length;c<d;c++){b=a.changedTouches[c];if(b.identifier==this.initialTouchIdentifier)return b}return null};
iAd.ScrollView.prototype.beginTracking=function(a){if(!this._tracking){this.stopDecelerationAnimation();this.usesNativeScrolling||this.snapContentOffsetToBounds(false);this.lastKnownTouchPosition=iAd.Point.fromEvent(a);var b=iAd.Event.SUPPORTS_TOUCHES?a.targetTouches[0]:a;this.initialTouchIdentifier=b.identifier;b=b.target;this.originalTarget=b.nodeType===Node.ELEMENT_NODE?b:b.parentElement;this.originalEvent=a;this.originalTarget.localName!="select"&&this.shouldPreventEventDefault(a)&&a.preventDefault();
this.adjustContentSize(false);this.tracking=true;this.beginTouchesInContentTimer=null;this.contentTouchesCouldNotBeCancelled=this.shouldPreventSelectElementFocus=this.touchesInContentBegan=false;if(this.delaysContentTouches)this.beginTouchesInContentTimer=this.callMethodNameAfterDelay("beginTouchesInContentIfPermitted",iAd.ScrollView.CONTENT_TOUCHES_DELAY);else this.beginTouchesInContentIfPermitted();document.addEventListener(iAd.Event.MOVE_EVENT,this,true);document.addEventListener(iAd.Event.END_EVENT,
this,true);document.addEventListener(iAd.Event.CANCEL_EVENT,this,true)}};iAd.ScrollView.prototype.stopTrackingTouches=function(){if(this._tracking){this.tracking=false;document.removeEventListener(iAd.Event.MOVE_EVENT,this,true);document.removeEventListener(iAd.Event.END_EVENT,this,true);document.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);window.clearTimeout(this.beginTouchesInContentTimer)}};
iAd.ScrollView.prototype.interruptTrackingInteraction=function(a){this.contentTouchesCouldNotBeCancelled=a;if(this.dragging){this.dragging=false;this.snapContentOffsetToBounds(true);this.dispatchNotification(iAd.ScrollView.DID_END_DRAGGING,this.delegate);this.hideScrollIndicators()}};iAd.ScrollView.prototype.isOriginalTargetElementAtPoint=function(a){return this.originalTarget===document.elementFromPoint(a.x,a.y)};
iAd.ScrollView.prototype.beginTouchesInContentIfPermitted=function(){this.scrollEnabled&&this.touchesShouldBeginInContentElementAndView(this.originalEvent,this.originalTarget,iAd.View.nearestViewForElement(this.originalTarget))&&this.beginTouchesInContent()};iAd.ScrollView.prototype.beginTouchesInContent=function(){if(!this.isContentInEnabledChildScrollView()){this.touchesInContentBegan=true;this.dispatchUIEventToContent(iAd.Event.START_EVENT);this.canCancelContentTouches||this.interruptTrackingInteraction(true)}};
iAd.ScrollView.prototype.endTouchesInContent=function(){this.dispatchUIEventToContent(iAd.Event.END_EVENT);this.elementShouldReceiveFocus(this.originalTarget)&&this.originalTarget.focus()};iAd.ScrollView.prototype.touchesShouldBeginInContentElementAndView=function(){return true};iAd.ScrollView.prototype.cancelTouchesInContent=function(){var a=document.createEvent("Event");a.initEvent(iAd.Event.CANCEL_EVENT,true,true);a._synthetic=true;this.originalTarget.dispatchEvent(a);window.clearTimeout(this.beginTouchesInContentTimer)};
iAd.ScrollView.prototype.touchesShouldCancelInContentElementAndView=function(a){return!iAd.Control.isNodeInControlHierarchyBoundedByElement(a,this.hostingLayer)};iAd.ScrollView.prototype.isContentInEnabledChildScrollView=function(){for(var a,b=this.scrollViews,c=0,d=b.length;c<d;c++){a=b[c];if(a.scrollEnabled&&a.originalTarget===this.originalTarget)return true}return false};iAd.ScrollView.prototype.dispatchTapSequenceToContent=function(){this.dispatchUIEventToContent(iAd.Event.START_EVENT);this.endTouchesInContent()};
iAd.ScrollView.prototype.dispatchUIEventToContent=function(a){a=iAd.Event.createUIEvent(a,this.originalEvent);a._synthetic=true;this.originalTarget.dispatchEvent(a)};iAd.ScrollView.prototype.elementShouldReceiveFocus=function(a){var b=a.nodeName.toLowerCase();return b=="input"&&iAd.ScrollView.TEXT_FIELD_INPUT_TYPES.indexOf(a.type)!=-1||b=="textarea"};
iAd.ScrollView.prototype.dispatchClickToContent=function(){if(iAd.Event.SUPPORTS_TOUCHES){var a=this.getInitialTouch(this.originalEvent);if(a!=null){var b=document.createEvent("MouseEvent");b.initMouseEvent("click",true,true,document.defaultView,0,a.screenX,a.screenY,a.clientX,a.clientY,0,0,0,0,0,0,null);b._synthetic=true;this.originalTarget.dispatchEvent(b)}}};
iAd.ScrollView.prototype.transitionEnded=function(a){if(this.scrollIndicatorsNeedFlashing&&a.currentTarget===this.layer){this.scrollIndicatorsNeedFlashing=false;this.flashScrollIndicators()}if(this.scrollTransitionsNeedRemoval&&a.currentTarget===this.hostingLayer){this.scrollTransitionsNeedRemoval=false;this.hostingLayer.style.webkitTransitionDuration=0;this.didScroll(true)}};
iAd.ScrollView.prototype.didScroll=function(a){a&&this.dispatchNotification(iAd.ScrollView.DID_END_SCROLLING_ANIMATION,this.delegate);this.dispatchNotification(iAd.ScrollView.DID_SCROLL,this.delegate)};
iAd.ScrollView.prototype.startDecelerationAnimation=function(){if(!(this.bounces&&(this._contentOffset.x>this.maxPoint.x||this._contentOffset.x<0)&&(this._contentOffset.y>this.maxPoint.y||this._contentOffset.y<0))){this.decelerationVelocity=this.panGestureRecognizer.velocityInView();this.decelerationVelocity.x=-this.decelerationVelocity.x;this.decelerationVelocity.y=-this.decelerationVelocity.y;this.adjustedDecelerationFactor=new iAd.Size(iAd.ScrollView.DECELERATION_FRICTION_FACTOR,iAd.ScrollView.DECELERATION_FRICTION_FACTOR);
if(!this.canScrollVertically)this.decelerationVelocity.y=0;if(!this.canScrollHorizontally)this.decelerationVelocity.x=0;this.minDecelerationPoint=new iAd.Point(0,0);this.maxDecelerationPoint=this.maxPoint.copy();if(this.pagingEnabled){var a=this.pageSize;this.minDecelerationPoint.x=Math.max(0,Math.floor(this._contentOffset.x/a.width)*a.width);this.minDecelerationPoint.y=Math.max(0,Math.floor(this._contentOffset.y/a.height)*a.height);this.maxDecelerationPoint.x=Math.min(this.maxPoint.x,Math.ceil(this._contentOffset.x/
a.width)*a.width);this.maxDecelerationPoint.y=Math.min(this.maxPoint.y,Math.ceil(this._contentOffset.y/a.height)*a.height)}a=this.pagingEnabled?iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION_WITH_PAGING:iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION;if(Math.abs(this.decelerationVelocity.x)>a||Math.abs(this.decelerationVelocity.y)>a){this.decelerating=true;if(this.pagingEnabled)this.nextPageContentOffset=new iAd.Point(this.decelerationVelocity.x>0?this.maxDecelerationPoint.x:this.minDecelerationPoint.x,
this.decelerationVelocity.y>0?this.maxDecelerationPoint.y:this.minDecelerationPoint.y);else iAd.Utils.objectHasMethod(this.delegate,iAd.ScrollView.WILL_END_DRAGGING)&&this.adjustedDecelerationParameters();this.animatedContentOffset=this._contentOffset.copy();this.decelerationTimer=this.callMethodNameAfterDelay("stepThroughDecelerationAnimation",iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE);this.previousDecelerationFrame=new Date;this.dispatchNotification(iAd.ScrollView.WILL_BEGIN_DECELERATING,this.delegate)}}};
iAd.ScrollView.prototype.adjustedDecelerationParameters=function(){var a=new iAd.Point(this.decelerationVelocity.x/1E3,this.decelerationVelocity.y/1E3),b=new iAd.Point((this.decelerationVelocity.x<0?-iAd.ScrollView.MINIMUM_VELOCITY:iAd.ScrollView.MINIMUM_VELOCITY)/1E3,(this.decelerationVelocity.y<0?-iAd.ScrollView.MINIMUM_VELOCITY:iAd.ScrollView.MINIMUM_VELOCITY)/1E3),c=Math.log(iAd.ScrollView.DECELERATION_FRICTION_FACTOR),d=new iAd.Point(this._contentOffset.x-(a.x-b.x)/c,this._contentOffset.y-(a.y-
b.y)/c);d.x=iAd.Number.clampValue(d.x,this.minDecelerationPoint.x,this.maxDecelerationPoint.x);d.y=iAd.Number.clampValue(d.y,this.minDecelerationPoint.y,this.maxDecelerationPoint.y);var e=d.copy();this.delegate[iAd.ScrollView.WILL_END_DRAGGING](this,a,d);if(!e.equals(d)){var f=new iAd.Point(d.x-this._contentOffset.x,d.y-this._contentOffset.y);if(a.x<=0&&d.x<e.x||a.x>=0&&d.x>e.x)this.decelerationVelocity.x=(b.x-c*f.x)*1E3;else this.adjustedDecelerationFactor.width=Math.min(iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION,
Math.exp(-(a.x-b.x)/f.x));if(a.y<=0&&d.y<e.y||a.y>=0&&d.y>e.y)this.decelerationVelocity.y=(b.y-c*f.y)*1E3;else this.adjustedDecelerationFactor.height=Math.min(iAd.ScrollView.MIN_VELOCITY_FOR_DECELERATION,Math.exp(-(a.y-b.y)/f.y))}};iAd.ScrollView.prototype.stopDecelerationAnimation=function(){this.decelerating=false;clearTimeout(this.decelerationTimer)};
iAd.ScrollView.prototype.stepThroughDecelerationAnimation=function(){if(this.decelerating){var a=new Date,b=a-this.previousDecelerationFrame,c=this.animatedContentOffset.copy();if(this.pagingEnabled)for(var d=0;d<b;d++){this.decelerationVelocity.x+=1E3*iAd.ScrollView.PAGING_ACCELERATION*(this.nextPageContentOffset.x-c.x);this.decelerationVelocity.x*=iAd.ScrollView.PAGING_DECELERATION;c.x+=this.decelerationVelocity.x/1E3;this.decelerationVelocity.y+=1E3*iAd.ScrollView.PAGING_ACCELERATION*(this.nextPageContentOffset.y-
c.y);this.decelerationVelocity.y*=iAd.ScrollView.PAGING_DECELERATION;c.y+=this.decelerationVelocity.y/1E3}else{d=this.adjustedDecelerationFactor;b=new iAd.Size(Math.exp(Math.log(d.width)*b),Math.exp(Math.log(d.height)*b));d=new iAd.Size(d.width*((1-b.width)/(1-d.width)),d.height*((1-b.height)/(1-d.height)));c.x+=this.decelerationVelocity.x/1E3*d.width;c.y+=this.decelerationVelocity.y/1E3*d.height;this.decelerationVelocity.x*=b.width;this.decelerationVelocity.y*=b.height}if(!this.bounces){b=iAd.Number.clampValue(c.x,
0,this.maxPoint.x);if(b!=c.x){c.x=b;this.decelerationVelocity.x=0}b=iAd.Number.clampValue(c.y,0,this.maxPoint.y);if(b!=c.y){c.y=b;this.decelerationVelocity.y=0}}this.animatedContentOffset=c;if(this._contentOffset.x!=iAd.CSS.roundedPxValue(c.x)||this._contentOffset.y!=iAd.CSS.roundedPxValue(c.y))this.contentOffset=c;b=Math.abs(this.decelerationVelocity.y);b=Math.abs(this.decelerationVelocity.x)<=iAd.ScrollView.MINIMUM_VELOCITY&&b<=iAd.ScrollView.MINIMUM_VELOCITY;d=this.pagingEnabled&&b&&Math.abs(this.nextPageContentOffset.x-
c.x)<=1&&Math.abs(this.nextPageContentOffset.y-c.y)<=1;if(!this.pagingEnabled&&b||d)this.decelerationAnimationCompleted();else{if(!this.pagingEnabled&&this.bounces){b=new iAd.Point(0,0);if(c.x<this.minDecelerationPoint.x)b.x=this.minDecelerationPoint.x-c.x;else if(c.x>this.maxDecelerationPoint.x)b.x=this.maxDecelerationPoint.x-c.x;if(c.y<this.minDecelerationPoint.y)b.y=this.minDecelerationPoint.y-c.y;else if(c.y>this.maxDecelerationPoint.y)b.y=this.maxDecelerationPoint.y-c.y;if(b.x!=0)if(b.x*this.decelerationVelocity.x<=
0)this.decelerationVelocity.x+=b.x*iAd.ScrollView.PENETRATION_DECELERATION;else this.decelerationVelocity.x=b.x*iAd.ScrollView.PENETRATION_ACCELERATION;if(b.y!=0)if(b.y*this.decelerationVelocity.y<=0)this.decelerationVelocity.y+=b.y*iAd.ScrollView.PENETRATION_DECELERATION;else this.decelerationVelocity.y=b.y*iAd.ScrollView.PENETRATION_ACCELERATION}this.decelerationTimer=this.callMethodNameAfterDelay("stepThroughDecelerationAnimation",iAd.ScrollView.DESIRED_ANIMATION_FRAME_RATE);this.previousDecelerationFrame=
a}}};iAd.ScrollView.prototype.decelerationAnimationCompleted=function(){this.stopDecelerationAnimation();this.hideScrollIndicators();if(this.pagingEnabled){var a=this.pageSize;this.setContentOffsetAnimated(new iAd.Point(Math.round(this._contentOffset.x/a.width)*a.width,Math.round(this._contentOffset.y/a.height)*a.height),false)}this.snapContentOffsetToBounds(false);this.dispatchNotification(iAd.ScrollView.DID_END_DECELERATING,this.delegate)};
iAd.ScrollView.isViewInNativeScrollView=function(a){if(a=iAd.ScrollViewPanGestureRecognizer.parentScrollViewForView(a))return a.usesNativeScrolling||iAd.ScrollView.isViewInNativeScrollView(a);return false};iAd.ScrollView.viewHasTrackingNativeChildScrollView=function(a){a=a.scrollViews;for(var b=0,c=a.length;b<c;b++)if(a[b].usesNativeScrolling&&a[b].tracking)return true;return false};iAd.Class({name:"iAd.HostScrollView",superclass:iAd.ScrollView});
iAd.HostScrollView.prototype.init=function(){this.callSuper();this._usesNativeScrolling=true;var a=iAd.RootView.sharedRoot;a.addPropertyObserver("disablesDefaultScrolling",this,"rootViewDisablesDefaultScrollingDidChange");this.rootViewDisablesDefaultScrollingDidChange();a.addPropertyObserver("scrollsHorizontally",this,"rootViewScrollingAxesDidChange");a.addPropertyObserver("scrollsVertically",this,"rootViewScrollingAxesDidChange");this.rootViewScrollingAxesDidChange()};
iAd.HostScrollView.prototype.rootViewDisablesDefaultScrollingDidChange=function(){this.scrollEnabled=!iAd.RootView.sharedRoot.disablesDefaultScrolling};iAd.HostScrollView.prototype.rootViewScrollingAxesDidChange=function(){var a=iAd.RootView.sharedRoot;this.canScrollVertically=a.scrollsVertically;this.canScrollHorizontally=a.scrollsHorizontally};
iAd.HostScrollView.prototype.shouldPreventEventDefault=function(a){if(a.type==iAd.Event.MOVE_EVENT&&!this.scrollEnabled)return!iAd.ScrollViewPanGestureRecognizer.hasRecognizerTrackingNativeScrollView();return false};iAd.HostScrollView.prototype.dispatchUIEventToContent=function(){};iAd.HostScrollView.prototype.adjustContentSize=function(){};iAd.ScrollView._hostScrollView=null;
Object.defineProperty(iAd.ScrollView,"hostScrollView",{get:function(){if(iAd.ScrollView._hostScrollView==null)iAd.ScrollView._hostScrollView=new iAd.HostScrollView;return iAd.ScrollView._hostScrollView},set:function(a){iAd.ScrollView._hostScrollView=a}});iAd.PropertyTriage={};iAd.PropertyTriage.handlePropertyChange=function(a,b){var c="handle"+b.charAt(0).toUpperCase()+b.substr(1)+"Change";iAd.Utils.objectHasMethod(this,c)&&this[c](a)};iAd.Utils.setupDisplayNames(iAd.PropertyTriage,"iAd.PropertyTriage");
iAd.Class({name:"iAd.Label",superclass:iAd.View,synthesizedProperties:["numberOfLines","text","verticalAlignment"],archivedProperties:["numberOfLines","text","verticalAlignment"],cssClassName:"ad-label",collectionAccessor:"labels"});iAd.Label.VERTICAL_ALIGNMENT_TOP="top";iAd.Label.VERTICAL_ALIGNMENT_MIDDLE="middle";iAd.Label.VERTICAL_ALIGNMENT_BOTTOM="bottom";iAd.Label.prototype.init=function(a){this._text="";this._numberOfLines=1;this._verticalAlignment=iAd.Label.VERTICAL_ALIGNMENT_MIDDLE;this.callSuper(a)};
iAd.Label.prototype.layerWasCreated=function(){this.callSuper();this._text=this.layer.textContent;this._textContainer=document.createElement("div");this._textContainer.textContent=this._text;this.layer.textContent="";this.layer.appendChild(this._textContainer)};iAd.Label.prototype.setText=function(a){a=a==null?"":String(a);if(a!==this._text){this._text=a;this._textContainer.textContent=a}};
iAd.Label.prototype.setNumberOfLines=function(a){this._numberOfLines=a;if(a==0){this._textContainer.style.webkitLineClamp="100%";this._textContainer.style.overflow="visible"}else{this._textContainer.style.webkitLineClamp=a;this._textContainer.style.overflow="hidden"}};iAd.Label.prototype.setVerticalAlignment=function(a){this._verticalAlignment=a;var b="center";if(a==iAd.Label.VERTICAL_ALIGNMENT_TOP)b="start";else if(a==iAd.Label.VERTICAL_ALIGNMENT_BOTTOM)b="end";this.setLayerStyle({"-webkit-box-pack":b})};
iAd.Class({name:"iAd.Button",superclass:iAd.Control,synthesizedProperties:["currentTitle","autosized"],archivedProperties:["autoSized","type","titles"],excludedProperties:["subviews"],cssClassName:"ad-button",collectionAccessor:"buttons"});iAd.Button.TYPE_CUSTOM="ad-custom-type";iAd.Button.TYPE_ROUNDED_RECT="ad-rounded-rect-type";iAd.Button.TYPE_DETAIL_DISCLOSURE="ad-detail-disclosure-type";iAd.Button.TYPE_INFO_LIGHT="ad-info-light-type";iAd.Button.TYPE_INFO_DARK="ad-info-dark-type";
iAd.Button.TYPE_CONTACT_ADD="ad-contact-add-type";iAd.Button.TYPE_DELETION_ACCESSORY="ad-deletion-accessory-type";iAd.Button.DEFAULT_HEIGHT=37;iAd.Button.prototype.init=function(a,b){this.type=b||iAd.Button.TYPE_ROUNDED_RECT;this._autosized=true;this.titles=[""];this.titleLabel=null;this.callSuper(a)};iAd.Button.restoreFromArchive=function(a){return new this(null,a.type)};
iAd.Button.prototype.initWithDeclarativeBacking=function(){this.callSuper();if(this.layer.hasClassName(iAd.Button.TYPE_ROUNDED_RECT))this.type=iAd.Button.TYPE_ROUNDED_RECT;else if(this.layer.hasClassName(iAd.Button.TYPE_CUSTOM))this.type=iAd.Button.TYPE_CUSTOM;this.layer.addClassName(this.type)};iAd.Button.prototype.createLayer=function(){this.callSuper();this.layer.addClassName(this.type)};
iAd.Button.prototype.layerWasCreated=function(){this.callSuper();if(this.type===iAd.Button.TYPE_ROUNDED_RECT||this.type===iAd.Button.TYPE_CUSTOM)this.titleLabel=this.addSubview(new iAd.Label);this.syncTitleToState();this.addPropertyObserver("state",this,"syncTitleToState")};
iAd.Button.prototype.setValueForAttribute=function(a,b){switch(b){case "ad-title-for-normal-state":this.setTitleForState(a,iAd.Control.STATE_NORMAL);break;case "ad-title-for-highlighted-state":this.setTitleForState(a,iAd.Control.STATE_HIGHLIGHTED);break;case "ad-title-for-disabled-state":this.setTitleForState(a,iAd.Control.STATE_DISABLED);break;case "ad-title-for-selected-state":this.setTitleForState(a,iAd.Control.STATE_SELECTED);break;default:this.callSuper(a,b)}};
iAd.Button.prototype.getSize=function(){var a=window.getComputedStyle(this.layer);return new iAd.Size(parseInt(a.width),parseInt(a.height))};iAd.Button.prototype.setSize=function(a){this._autoSized=false;this.callSuper(a)};iAd.Button.prototype.getCurrentTitle=function(){if(this.titleLabel==null)return null;return this.titleLabel.text};iAd.Button.prototype.setAutosized=function(a){a&&this.setLayerStyle({width:"auto",height:iAd.Button.DEFAULT_HEIGHT+"px"});this._autosized=a};
iAd.Button.prototype.titleForState=function(a){return this.titles[a]||null};iAd.Button.prototype.setTitleForState=function(a,b){this.titles[b]=a;b==this.state&&this.syncTitleToState()};iAd.Button.prototype.syncTitleToState=function(){if(this.titleLabel!=null)this.titleLabel.text=this.titles[this.state]||this.titles[iAd.Control.STATE_NORMAL]};
iAd.Class({name:"iAd.TableViewCell",superclass:iAd.View,synthesizedProperties:["text","detailedText","selectionStyle","accessoryType","highlighted","selected","cellStyle","editingStyle","editing"],archivedProperties:["text","detailedText","selectionStyle","accessoryType","selected","cellStyle"],cssClassName:"ad-table-view-cell",collectionAccessor:"tableViewCells"});iAd.TableViewCell.ACCESSORY_NONE="ad-no-accessory";iAd.TableViewCell.ACCESSORY_DISCLOSURE_INDICATOR="ad-disclosure-accessory";
iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON="ad-detail-accessory";iAd.TableViewCell.ACCESSORY_CHECKMARK="ad-checkmark-accessory";iAd.TableViewCell.SELECTION_STYLE_NONE="ad-no-selection";iAd.TableViewCell.SELECTION_STYLE_BLUE="ad-blue-selection";iAd.TableViewCell.SELECTION_STYLE_GRAY="ad-gray-selection";iAd.TableViewCell.STYLE_DEFAULT="ad-style-default";iAd.TableViewCell.STYLE_VALUE_1="ad-style-value-1";iAd.TableViewCell.STYLE_VALUE_2="ad-style-value-2";iAd.TableViewCell.STYLE_SUBTITLE="ad-style-subtitle";
iAd.TableViewCell.STYLE_CUSTOM="ad-style-custom";iAd.TableViewCell.SEPARATOR_STYLE_NONE="ad-separator-none";iAd.TableViewCell.SEPARATOR_STYLE_SINGLE_LINE="ad-separator-single-line";iAd.TableViewCell.SEPARATOR_STYLE_SINGLE_LINE_ETCHED="ad-separator-single-line-etched";iAd.TableViewCell.EDITING_STYLE_NONE="ad-editing-style-none";iAd.TableViewCell.EDITING_STYLE_DELETE="ad-editing-style-delete";iAd.TableViewCell.CSS_CLASS_CELL_IS_EDITING="ad-cell-is-editing";iAd.TableViewCell.STYLE_VALUE_1_MARGIN=10;
iAd.TableViewCell.prototype.init=function(a,b,c){this._cellStyle=b||iAd.TableViewCell.STYLE_DEFAULT;this._selectionStyle=iAd.TableViewCell.SELECTION_STYLE_BLUE;this._accessoryType=iAd.TableViewCell.ACCESSORY_NONE;this._editingStyle=iAd.TableViewCell.EDITING_STYLE_NONE;this._highlighted=this._selected=false;this.reuseIdentifier=c||this.constructor._name;this.callSuper(a);this.wantsHardwareLayerBacking=true};
iAd.TableViewCell.prototype.setupLayer=function(){this.callSuper();this.createLayerContents();if(this.layer.hasClassName(iAd.TableViewCell.STYLE_VALUE_1))this._cellStyle=iAd.TableViewCell.STYLE_VALUE_1;else if(this.layer.hasClassName(iAd.TableViewCell.STYLE_VALUE_2))this._cellStyle=iAd.TableViewCell.STYLE_VALUE_2;else if(this.layer.hasClassName(iAd.TableViewCell.STYLE_SUBTITLE))this._cellStyle=iAd.TableViewCell.STYLE_SUBTITLE;else if(this.layer.hasClassName(iAd.TableViewCell.STYLE_CUSTOM))this._cellStyle=
iAd.TableViewCell.STYLE_CUSTOM;if(this.layer.hasClassName(iAd.TableViewCell.ACCESSORY_DISCLOSURE_INDICATOR))this._accessoryType=iAd.TableViewCell.ACCESSORY_DISCLOSURE_INDICATOR;else if(this.layer.hasClassName(iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON))this._accessoryType=iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON;else if(this.layer.hasClassName(iAd.TableViewCell.ACCESSORY_CHECKMARK))this._accessoryType=iAd.TableViewCell.ACCESSORY_CHECKMARK;if(this.layer.hasClassName(iAd.TableViewCell.EDITING_STYLE_DELETE))this._editingStyle=
iAd.TableViewCell.EDITING_STYLE_DELETE};iAd.TableViewCell.prototype.createLayer=function(){this.callSuper();this.layer.addClassName(this.cellStyle);this.createLayerContents()};iAd.TableViewCell.prototype.layerWasCreated=function(){this.callSuper();this.cellStyle===iAd.TableViewCell.STYLE_CUSTOM&&this.layer.addClassName(iAd.TableViewCell.STYLE_CUSTOM);this.updateTextLayout()};
iAd.TableViewCell.prototype.createLayerContents=function(){if(this.cellStyle!==iAd.TableViewCell.STYLE_CUSTOM){this.layer.setAttribute("role","button");this.accessory=new iAd.Button(null,iAd.Button.TYPE_DETAIL_DISCLOSURE);this.accessory.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.addSubview(this.accessory);this.textLabel=this.layer.appendChild(document.createElement("span"));this.textLabel.addClassName("ad-text-label");this.detailedTextLabel=this.layer.appendChild(document.createElement("span"));
this.detailedTextLabel.addClassName("ad-detailed-text-label")}};
iAd.TableViewCell.prototype.handleEvent=function(a){if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT){var b=this.superview,c=this._tableViewDataSourceInfo.indexPath;if(b!=undefined&&c!=undefined)if(this.accessory&&this.accessoryType==iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON){this.accessory.layer=a.currentTarget;b.disclosureButtonWasSelectedAtIndexPath(c)}else if(this.editAccessory&&a.currentTarget==this.editAccessory.layer)b.editAccessoryWasSelectedAtIndexPath(c);else this.deleteButton&&a.currentTarget==
this.deleteButton.layer&&b.deleteButtonWasSelectedAtIndexPath(c)}else this.callSuper(a)};iAd.TableViewCell.prototype.getText=function(){return this.cellStyle===iAd.TableViewCell.STYLE_CUSTOM?"":this.textLabel.textContent};iAd.TableViewCell.prototype.setText=function(a){if(this.cellStyle!==iAd.TableViewCell.STYLE_CUSTOM){this.textLabel.textContent=a;this.updateTextLayout()}};iAd.TableViewCell.prototype.getDetailedText=function(){return this.cellStyle===iAd.TableViewCell.STYLE_CUSTOM?"":this.detailedTextLabel.textContent};
iAd.TableViewCell.prototype.setDetailedText=function(a){if(this.cellStyle!==iAd.TableViewCell.STYLE_CUSTOM){this.detailedTextLabel.textContent=a;this.updateTextLayout()}};iAd.TableViewCell.prototype.setSelectionStyle=function(a){this.layer.removeClassName(this._selectionStyle);this.layer.addClassName(a);this._selectionStyle=a};iAd.TableViewCell.prototype.setCellStyle=function(a){this.layer.removeClassName(this._cellStyle);this.layer.addClassName(a);this._cellStyle=a};
iAd.TableViewCell.prototype.setEditingStyle=function(a){this.layer.removeClassName(this._editingStyle);this.layer.iad_toggleClassName(a,a!=iAd.TableViewCell.EDITING_STYLE_NONE);this._editingStyle=a;if(a==iAd.TableViewCell.EDITING_STYLE_DELETE){if(!this.editAccessory){this.editAccessory=new iAd.Button(null,iAd.Button.TYPE_DELETION_ACCESSORY);this.editAccessory.layer.setAttribute("aria-label",this.text+" "+"_Control.TrashIcon".loc());this.editAccessory.layer.setAttribute("name",this.text+" "+"_Control.TrashIcon".loc());
this.editAccessory.layer.setAttribute("role","button");this.editAccessory.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.addSubview(this.editAccessory)}if(!this.deleteButton){this.deleteButton=new iAd.BarButton;this.deleteButton.layer.setAttribute("aria-label","_Control.Delete".loc());this.deleteButton.layer.setAttribute("name","_Control.Delete".loc());this.deleteButton.buttonStyle=iAd.BarButtonItem.STYLE_DELETE;this.deleteButton.title="Delete";this.deleteButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);this.addSubview(this.deleteButton)}}};iAd.TableViewCell.prototype.setEditing=function(a){this.layer.iad_toggleClassName(iAd.TableViewCell.CSS_CLASS_CELL_IS_EDITING,a);this._editing=a};iAd.TableViewCell.prototype.setAccessoryType=function(a){if(this.cellStyle!==iAd.TableViewCell.STYLE_CUSTOM){this.layer.removeClassName(this._accessoryType);this.layer.addClassName(a);this._accessoryType=a}};iAd.TableViewCell.prototype.setHighlighted=function(a){this.setHighlightedAnimated(a,false)};
iAd.TableViewCell.prototype.setHighlightedAnimated=function(a){if(this._highlighted!=a){this._highlighted=a;this.layer.iad_toggleClassName(iAd.Control.STATE_HIGHLIGHTED_CSS,a)}};iAd.TableViewCell.prototype.setSelected=function(a){this.setSelectedAnimated(a,false)};iAd.TableViewCell.prototype.setSelectedAnimated=function(a){if(this._selected!=a){this._selected=a;this.layer.iad_toggleClassName(iAd.Control.STATE_SELECTED_CSS,a);this.superview instanceof iAd.TableView&&this.superview.cellSelectionDidChange(this)}};
iAd.TableViewCell.prototype.prepareForReuse=function(){if(this.textLabel)this.text="";if(this.detailedTextLabel)this.detailedText="";this.selectionStyle=iAd.TableViewCell.SELECTION_STYLE_BLUE;this.accessoryType=iAd.TableViewCell.ACCESSORY_NONE;this.cellStyle=iAd.TableViewCell.STYLE_DEFAULT;this.editingStyle=iAd.TableViewCell.EDITING_STYLE_NONE};iAd.TableViewCell.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.updateTextLayout()};
iAd.TableViewCell.prototype.updateTextLayout=function(){if(!(this.cellStyle!=iAd.TableViewCell.STYLE_VALUE_1||!this.layerIsInDocument)){var a=this.textLabel.offsetWidth-2*iAd.TableViewCell.STYLE_VALUE_1_MARGIN;this.textLabel.style.right="auto !important";this.detailedTextLabel.style.right="auto !important";var b=Math.min(this.textLabel.offsetWidth,a),c=Math.min(this.detailedTextLabel.offsetWidth,a);this.textLabel.setAttribute("style","");this.detailedTextLabel.setAttribute("style","");if(b+c>a){a=
Math.floor(b/(b+c)*a);if(b>c){this.textLabel.style.width=a+"px";this.detailedTextLabel.style.left=a+iAd.TableViewCell.STYLE_VALUE_1_MARGIN*2+"px"}else{this.textLabel.style.width=a+iAd.TableViewCell.STYLE_VALUE_1_MARGIN+"px";this.detailedTextLabel.style.left=a+iAd.TableViewCell.STYLE_VALUE_1_MARGIN*3+"px"}}}};
iAd.Class({name:"iAd.TableView",superclass:iAd.ScrollView,synthesizedProperties:["tableStyle","separatorStyle","editing","confirmesBeforeDeleting"],archivedProperties:["tableStyle","separatorStyle","rowHeight","allowsSelection"],excludedProperties:["subviews"],cssClassName:"ad-table-view",mixins:[iAd.PropertyTriage],collectionAccessor:"tableViews"});iAd.TableView.CELL_FOR_ROW_AT_PATH="tableViewCellForRowAtIndexPath";iAd.TableView.NUMBERS_OF_SECTIONS_IN_TABLE_VIEW="numberOfSectionsInTableView";
iAd.TableView.NUMBERS_OF_ROWS_IN_SECTION="tableViewNumberOfRowsInSection";iAd.TableView.TITLE_FOR_HEADER_IN_SECTION="tableViewTitleForHeaderInSection";iAd.TableView.TITLE_FOR_FOOTER_IN_SECTION="tableViewTitleForFooterInSection";iAd.TableView.SECTION_INDEX_TITLES="sectionIndexTitlesForTableView";iAd.TableView.SECTION_FOR_SECTION_INDEX_TITLE_AT_INDEX="tableViewSectionForSectionIndexTitleAtIndex";iAd.TableView.WILL_DESELECT_ROW_AT_PATH="tableViewWillDeselectRowAtIndexPath";
iAd.TableView.DID_DESELECT_ROW_AT_PATH="tableViewDidDeselectRowAtIndexPath";iAd.TableView.WILL_SELECT_ROW_AT_PATH="tableViewWillSelectRowAtIndexPath";iAd.TableView.DID_SELECT_ROW_AT_PATH="tableViewDidSelectRowAtIndexPath";iAd.TableView.DID_SELECT_ACCESSORY_FOR_ROW_AT_PATH="tableViewDidSelectAccessoryForRowAtIndexPath";iAd.TableView.HEIGHT_FOR_ROW_AT_INDEX_PATH="tableViewHeightForRowAtIndexPath";iAd.TableView.COMMIT_EDITING_STYLE_FOR_ROW_AT_INDEX_PATH="tableViewCommitEditingStyleForRowAtIndexPath";
iAd.TableView.TITLE_FOR_DELETE_CONFIRMATION_BUTTON_FOR_ROW_AT_INDEX_PATH="tableViewTitleForDeleteConfirmationButtonForRowAtIndexPath";iAd.TableView.STYLE_PLAIN="ad-plain";iAd.TableView.STYLE_CUSTOM="ad-custom";iAd.TableView.STYLE_GROUPED="ad-grouped";iAd.TableView.INDEX_CONTAINER_CSS_CLASS="ad-table-view-index";iAd.TableView.INDEX_CONTAINER_VISIBLE_CSS_CLASS="ad-index-visible";iAd.TableView.INDEX_INTERACTIVE_CSS_CLASS="ad-interactive-index";iAd.TableView.PLAIN_HEADER_HEIGHT=23;
iAd.TableView.DEFAULT_ROW_HEIGHT=44;iAd.TableView.GROUPED_TABLE_Y_MARGIN=10;iAd.TableView.MIN_INDEX_LETTER_HEIGHT=12;iAd.TableView.INDEX_Y_OUTER_MARGIN=6;iAd.TableView.INDEX_Y_INNER_MARGIN=4;iAd.TableView.FIRST_INDEX_TITLE_Y_OFFSET=3;iAd.TableView.INDEX_SKIPPED="\u2022";iAd.TableView.INDEX_SEARCH="{search}";iAd.TableView.INDEX_POUND="#";iAd.TableView.INDEX_SKIPPED_CSS_CLASS="ad-skipped-index";iAd.TableView.INDEX_SEARCH_CSS_CLASS="ad-search-index";iAd.TableView.INDEX_POUND_CSS_CLASS="ad-pound-index";
iAd.TableView.CSS_CLASS_FIRST_ROW_IN_SECTION="ad-first-row-in-section";iAd.TableView.CSS_CLASS_LAST_ROW_IN_SECTION="ad-last-row-in-section";iAd.TableView.CSS_CLASS_TABLE_IS_EDITING="ad-table-is-editing";iAd.TableView.TYPE_HEADER=0;iAd.TableView.TYPE_CELL=1;iAd.TableView.TYPE_FOOTER=2;
iAd.TableView.prototype.init=function(a){this._tableStyle=iAd.TableView.STYLE_CUSTOM;this._separatorStyle=iAd.TableViewCell.SEPARATOR_STYLE_SINGLE_LINE;this.dataSource=this.delegate=null;this.numberOfSections=1;this.rowHeight=iAd.TableView.DEFAULT_ROW_HEIGHT;this.allowsSelection=true;this.sectionsInfo=[];this.cellsQueuedForReuse={};this.headersQueuedForReuse=[];this.footersQueuedForReuse=[];this.visibleHeaders=[];this.visibleSubviews=[];this.usesCustomRowHeights=false;this.selectedRowIndexPath=this.touchedCell=
null;this.selectedRowsIndexPaths=[];this.cellsBeingEditedPaths=[];this._confirmesBeforeDeleting=true;this.callSuper(a);this.alwaysBounceVertical=true};iAd.TableView.prototype.didEncodeObjectToArchive=function(a){this.callSuper(a);a.selectedRowsIndexPaths=this.selectedRowsIndexPaths};iAd.TableView.prototype.didRestoreFromArchive=function(a){this.callSuper(a);this.archivedProperties={selectedRowsIndexPaths:a.selectedRowsIndexPaths}};
iAd.TableView.prototype.setupLayer=function(){this.dataSource=new iAd.TableViewDeclarativeDataSource(this.layer);this.callSuper();if(this.layer.hasClassName(iAd.TableView.STYLE_PLAIN))this._tableStyle=iAd.TableView.STYLE_PLAIN;else if(this.layer.hasClassName(iAd.TableView.STYLE_GROUPED))this._tableStyle=iAd.TableView.STYLE_GROUPED;if(this.layer.hasClassName(iAd.TableViewCell.SEPARATOR_STYLE_SINGLE_LINE_ETCHED))this._separatorStyle=iAd.TableViewCell.SEPARATOR_STYLE_SINGLE_LINE_ETCHED;else if(this.layer.hasClassName(iAd.TableViewCell.SEPARATOR_STYLE_NONE))this._separatorStyle=
iAd.TableViewCell.SEPARATOR_STYLE_NONE};iAd.TableView.prototype.initWithDeclarativeBacking=function(){this.callSuper();this.reloadData()};iAd.TableView.prototype.layerWasCreated=function(){this.callSuper();this.indexContainer=this.layer.appendChild(document.createElement("div"));this.indexContainer.className=iAd.TableView.INDEX_CONTAINER_CSS_CLASS};
iAd.TableView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();if(this.needsToUpdateSectionsInfoUponLayerInsertion){this.updateSectionsInfo();this.layoutSubviews()}else this.subviews.length==0&&this.dataSource!=null&&this.reloadData()};
iAd.TableView.prototype.setSize=function(a){if(!this._size.equals(a)){this.callSuper(a);this.updateIndex();if(this._tableStyle===iAd.TableView.STYLE_GROUPED)this.reloadData();else this.contentSize=new iAd.Size(this._size.width,this.contentSize.height);this.layoutSubviews()}};
iAd.TableView.prototype.handleEvent=function(a){if(!a.hasOwnProperty("_synthetic")){if(a.type==iAd.Event.START_EVENT&&a.eventPhase==Event.CAPTURING_PHASE)this.trackingTouchesOnIndex=a.target===this.indexContainer;if(this.trackingTouchesOnIndex)switch(a.type){case iAd.Event.START_EVENT:this.touchesBeganOnIndex(a);break;case iAd.Event.MOVE_EVENT:this.touchesMovedOnIndex(a);break;case iAd.Event.END_EVENT:case iAd.Event.CANCEL_EVENT:this.touchesEndedOnIndex(a)}else this.callSuper(a)}};
iAd.TableView.prototype.setContentOffsetAnimated=function(a,b){if(!a.equals(this._contentOffset)){this.callSuper(a,b);this.layoutSubviews()}};iAd.TableView.prototype.setUsesNativeScrolling=function(a){a&&iAd.Console.warn("iAd.TableView does not support setting .usesNativeScrolling to true.")};iAd.TableView.prototype.setTableStyle=function(a){this.layer.removeClassName(this._tableStyle);this.layer.addClassName(a);this._tableStyle=a};
iAd.TableView.prototype.setSeparatorStyle=function(a){this.layer.removeClassName(this._separatorStyle);this.layer.addClassName(a);this._separatorStyle=a};iAd.TableView.prototype.setEditing=function(a){this._editing=a;this.layer.iad_toggleClassName(iAd.TableView.CSS_CLASS_TABLE_IS_EDITING,a);if(!a){this.cellsBeingEditedPaths.forEach(function(b){this.cellForRowAtIndexPath(b).editing=false},this);this.cellsBeingEditedPaths=[]}};
iAd.TableView.prototype.numberOfRowsInSection=function(a){if(this.sectionsInfo.length==0){if(!iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.NUMBERS_OF_ROWS_IN_SECTION))return null;return this.dataSource[iAd.TableView.NUMBERS_OF_ROWS_IN_SECTION](this,a)}else if(this.isSectionValid(a))return this.sectionsInfo[a].numberOfRows;return null};iAd.TableView.prototype.isSectionValid=function(a){return a>=0&&a<this.numberOfSections};
iAd.TableView.prototype.isIndexPathValid=function(a){return this.isSectionValid(a.section)&&a.row>=0&&a.row<this.sectionsInfo[a.section].numberOfRows};iAd.TableView.prototype.cellForRowAtIndexPath=function(a){var b=null;if(this.isIndexPathValid(a))for(var c=this.tableViewCells.filter(iAd.TableView.queuedCellFilter),d=0,e=c.length;d<e;d++)if(this.indexPathForCell(c[d]).equals(a)){b=c[d];break}return b};iAd.TableView.prototype.indexPathForCell=function(a){return a._tableViewDataSourceInfo.indexPath};
iAd.TableView.prototype.sectionAtPoint=function(a){for(var b=0,c=this.sectionsInfo.length;b<c;b++)if(this.sectionsInfo[b].y>a.y)break;b=Math.max(0,b-1);return b>=this.numberOfSections?null:b};
iAd.TableView.prototype.indexPathForRowAtPoint=function(a){var b=this.sectionAtPoint(a);if(b==null)return null;var c=this.sectionsInfo[b];a=Math.max(a.y-c.y,0);var d=a>=c.headerHeight+c.cumulativeRowHeight;if(a<c.headerHeight||d)return null;if(this.usesCustomRowHeights){d=c.numberOfRows;var e=c.rowHeights,f=0;for(c=1;c<d;c++){f+=e[c];if(a<f){c--;break}}}else c=Math.floor((a-c.headerHeight)/this.rowHeight);return new iAd.IndexPath(b,c)};
iAd.TableView.prototype.reloadData=function(){if(this.archivedProperties){this.selectedRowsIndexPaths=this.archivedProperties.selectedRowsIndexPaths;delete this.archivedProperties}for(this.updateSectionsInfo();this.subviews.length;)this.subviews[0].removeFromSuperview();this.visibleSubviews=[];this.visibleHeaders=[];this.headersQueuedForReuse=[];this.cellsQueuedForReuse={};this.footersQueuedForReuse=[];this.layoutSubviews()};
iAd.TableView.prototype.updateSectionsInfo=function(){if(!(this.dataSource==null||!iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.NUMBERS_OF_ROWS_IN_SECTION))){var a=this._tableStyle===iAd.TableView.STYLE_CUSTOM,b=this._tableStyle===iAd.TableView.STYLE_GROUPED;if(b&&!this.layerIsInDocument)this.needsToUpdateSectionsInfoUponLayerInsertion=true;else{this.needsToUpdateSectionsInfoUponLayerInsertion=false;this.sectionsInfo=[];this.usesCustomRowHeights=this.delegate!=null&&iAd.Utils.objectHasMethod(this.delegate,
iAd.TableView.HEIGHT_FOR_ROW_AT_INDEX_PATH);this.numberOfSections=1;if(iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.NUMBERS_OF_SECTIONS_IN_TABLE_VIEW))this.numberOfSections=this.dataSource[iAd.TableView.NUMBERS_OF_SECTIONS_IN_TABLE_VIEW](this);var c=iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.TITLE_FOR_HEADER_IN_SECTION),d=iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.TITLE_FOR_FOOTER_IN_SECTION);if(b){var e=this.addSubview(new iAd.TableViewHeader);e.hidden=true;var f=
this.addSubview(new iAd.TableViewFooter);f.hidden=true}for(var g=0,i,h,j,k,l,p,m,n,o,q=0;q<this.numberOfSections;q++){i=this.dataSource[iAd.TableView.NUMBERS_OF_ROWS_IN_SECTION](this,q);l=k=0;h=null;if(!a){if(c)h=this.dataSource[iAd.TableView.TITLE_FOR_HEADER_IN_SECTION](this,q);if(b)if(h==null)k=q==0?iAd.TableView.GROUPED_TABLE_Y_MARGIN:2*iAd.TableView.GROUPED_TABLE_Y_MARGIN+1;else{e.text=h||"";k=e.layer.offsetHeight}else if(h!=null)k=iAd.TableView.PLAIN_HEADER_HEIGHT-1;if(b&&d){j=this.dataSource[iAd.TableView.TITLE_FOR_FOOTER_IN_SECTION](this,
q);if(j!=null){f.text=j||"";l=f.layer.offsetHeight}}}h={numberOfRows:i,header:h,footer:j,y:g,headerHeight:k,footerHeight:l};if(this.usesCustomRowHeights){p=[];for(n=m=0;n<i;n++){o=this.delegate[iAd.TableView.HEIGHT_FOR_ROW_AT_INDEX_PATH](this,new iAd.IndexPath(q,n));m+=o;p.push(o)}h.rowHeights=p}else m=i*this.rowHeight;h.cumulativeRowHeight=m;this.sectionsInfo.push(h);g+=m;g+=k;g+=l}if(b){g+=iAd.TableView.GROUPED_TABLE_Y_MARGIN+1;e.removeFromSuperview();f.removeFromSuperview()}this.contentSize=new iAd.Size(this._size.width,
g)}}};iAd.TableView.prototype.layoutSubviews=function(){if(this.sectionsInfo.length!=0){var a=this._contentOffset.y,b=a+this._size.height,c=this.sectionAtPoint(this._contentOffset);a>=0&&a<=this.maxPoint.y&&this.scanSubviewsForQueuing(a,b,c);this.addSubviewsAtTop(a);this.addSubviewsAtBottom(b,c);this._tableStyle===iAd.TableView.STYLE_PLAIN&&this.updatePlainHeaderPositions(a,c)}};
iAd.TableView.prototype.scanSubviewsForQueuing=function(a,b,c){for(var d,e,f=this._tableStyle===iAd.TableView.STYLE_PLAIN,g=0,i=this.subviews.length;g<i;g++){d=this.subviews[g];if(!d._queued&&(d._position.y+d._size.height<=a||d._position.y>=b)){if(d instanceof iAd.TableViewCell)e=this.cellsQueuedForReuse[d.reuseIdentifier]||(this.cellsQueuedForReuse[d.reuseIdentifier]=[]);else if(d instanceof iAd.TableViewHeader){if(f&&d._tableViewDataSourceInfo.section==c)continue;e=this.headersQueuedForReuse;iAd.Array.removeObjectFromArray(d,
this.visibleHeaders)}else e=this.footersQueuedForReuse;this.enqueueView(e,d)}}};
iAd.TableView.prototype.addSubviewsAtTop=function(a){var b=this.visibleSubviews[0];if(b){var c=b._position.y,d=this._tableStyle===iAd.TableView.STYLE_PLAIN,e=null;if(c>=a&&d&&b===this.visibleHeaders[0]){e=this.visibleHeaders[0];b=this.visibleSubviews[1];c=b._position.y}for(;c>=a;){b=this.populatedSubviewForInfo(this.infoForPreviousView(b._tableViewDataSourceInfo));if(!b)break;c-=b._size.height;if(b==e)e=null;else{b.position=new iAd.Point(0,c);e?this.visibleSubviews.splice(1,0,b):this.visibleSubviews.unshift(b);
b instanceof iAd.TableViewHeader&&this.visibleHeaders.unshift(b)}}if(d&&this.visibleHeaders[0]!==this.visibleSubviews[0]){a=this.visibleSubviews[0]._tableViewDataSourceInfo;a=a.type==iAd.TableView.TYPE_CELL?a.indexPath.section:a.section;if(this.sectionsInfo[a].header){b=this.populatedSubviewForInfo(this.infoForHeader(a));this.visibleSubviews.unshift(b);this.visibleHeaders.unshift(b)}}}};
iAd.TableView.prototype.addSubviewsAtBottom=function(a,b){var c=this.visibleSubviews.length?this.visibleSubviews[this.visibleSubviews.length-1]:null,d;if(c)d=c._position.y+c._size.height;else{c=new iAd.TableViewFooter;if(b==0){d=0;c._tableViewDataSourceInfo=this.infoForFooter(-1)}else{d=this.sectionsInfo[b].y;c._tableViewDataSourceInfo=this.infoForFooter(b-1)}}for(;d<=a;){c=this.populatedSubviewForInfo(this.infoForNextView(c._tableViewDataSourceInfo));if(!c)break;c.position=new iAd.Point(0,d);d+=
c._size.height;this.visibleSubviews.push(c);c instanceof iAd.TableViewHeader&&this.visibleHeaders.push(c)}};iAd.TableView.prototype.updatePlainHeaderPositions=function(a,b){for(var c=this.visibleHeaders,d,e,f,g=c.length-1;g>=0;g--){d=c[g];e=d._tableViewDataSourceInfo.section;if(e==b){e=(f=c[g+1])&&f._position.y<a+d._size.height?f._position.y-f._size.height:a;e=Math.max(0,e)}else e=this.sectionsInfo[e].y;d.position=new iAd.Point(0,e)}};
iAd.TableView.prototype.infoForCell=function(a){return{type:iAd.TableView.TYPE_CELL,indexPath:a}};iAd.TableView.prototype.infoForHeader=function(a){return{type:iAd.TableView.TYPE_HEADER,section:a}};iAd.TableView.prototype.infoForFooter=function(a){return{type:iAd.TableView.TYPE_FOOTER,section:a}};
iAd.TableView.prototype.infoForFirstViewInSection=function(a){var b=this.sectionsInfo[a];if(b.header||b.headerHeight)return this.infoForHeader(a);else if(b.numberOfRows>0)return this.infoForCell(new iAd.IndexPath(a,0));else if(b.footerHeight>0)return this.infoForFooter(a);return null};
iAd.TableView.prototype.infoForLastViewInSection=function(a){var b=this.sectionsInfo[a];if(b.footerHeight>0)return this.infoForFooter(a);else if(b.numberOfRows>0)return this.infoForCell(new iAd.IndexPath(a,b.numberOfRows-1));if(b.header||b.headerHeight)return this.infoForHeader(a);return null};
iAd.TableView.prototype.infoForNextView=function(a){var b=null;if(a.type==iAd.TableView.TYPE_CELL){var c=a.indexPath.copy();a=this.sectionsInfo[c.section];if(++c.row<a.numberOfRows)b=this.infoForCell(c);else if(a.footerHeight>0)b=this.infoForFooter(c.section);else if(++c.section<this.numberOfSections)b=this.infoForFirstViewInSection(c.section)}else if(a.type==iAd.TableView.TYPE_HEADER){c=a.section;a=this.sectionsInfo[c];if(a.numberOfRows>0)b=this.infoForCell(new iAd.IndexPath(c,0));else if(a.footerHeight>
0)b=this.infoForFooter(c);else if(++c<this.numberOfSections)b=this.infoForFirstViewInSection(c)}else{c=a.section;if(++c<this.numberOfSections)b=this.infoForFirstViewInSection(c)}return b};
iAd.TableView.prototype.infoForPreviousView=function(a){var b=null;if(a.type==iAd.TableView.TYPE_CELL){var c=a.indexPath.copy();a=this.sectionsInfo[c.section];if(--c.row>=0)b=this.infoForCell(c);else if(a.header||a.headerHeight)b=this.infoForHeader(c.section);else if(--c.section>=0)b=this.infoForLastViewInSection(c.section)}else if(a.type==iAd.TableView.TYPE_HEADER){c=a.section;if(--c>=0)b=this.infoForLastViewInSection(c)}else{c=a.section;a=this.sectionsInfo[c];if(a.numberOfRows>0)b=this.infoForCell(new iAd.IndexPath(c,
a.numberOfRows-1));else if(a.header||a.headerHeight)b=this.infoForHeader(c);else if(--c>=0)b=this.infoForLastViewInSection(c)}return b};iAd.TableView.prototype.rectForSection=function(a){if(!this.isSectionValid(a))return iAd.Rect.ZERO_RECT;a=this.sectionsInfo[a];return new iAd.Rect(0,a.y,this.size.width,a.y+a.headerHeight+a.cumulativeRowHeight+a.footerHeight)};
iAd.TableView.prototype.rectForRowAtIndexPath=function(a){if(!this.isIndexPathValid(a))return iAd.Rect.ZERO_RECT;var b=this.sectionsInfo[a.section],c=b.y+b.headerHeight,d=0;if(this.usesCustomRowHeights){a=a.row;b=b.rowHeights;for(d=0;d<a;d++)c+=b[d];d=b[a]}else{c+=a.row*this.rowHeight;d=this.rowHeight}return new iAd.Rect(0,c,this.size.width,d)};
iAd.TableView.prototype.rectForFooterInSection=function(a){if(!this.isSectionValid(a)||this._tableStyle!==iAd.TableView.STYLE_GROUPED)return iAd.Rect.ZERO_RECT;a=this.sectionsInfo[a];return new iAd.Rect(0,a.y+a.headerHeight+a.cumulativeRowHeight,this._size.width,a.footerHeight)};
iAd.TableView.prototype.rectForHeaderInSection=function(a){if(!this.isSectionValid(a))return iAd.Rect.ZERO_RECT;var b=this.sectionsInfo[a],c=b.y;if(this._tableStyle===iAd.TableView.STYLE_PLAIN)for(var d=this.tableViewHeaders,e=0,f=d.length;e<f;e++){header=d[e];if(header._tableViewDataSourceInfo.section==a){if(!header._queued)return header.frame;break}}return new iAd.Rect(0,c,this._size.width,b.headerHeight)};iAd.TableView.queuedCellFilter=function(a){return a._queued==undefined};
iAd.TableView.selectedCellFilter=function(a){return a.selected};iAd.TableView.indexPathSort=function(a,b){var c=a._tableViewDataSourceInfo.indexPath,d=b._tableViewDataSourceInfo.indexPath;return c.lowerThan(d)?-1:c.greaterThan(d)?1:0};iAd.TableView.prototype.visibleCells=function(){return this.tableViewCells.filter(iAd.TableView.queuedCellFilter).sort(iAd.TableView.indexPathSort)};
iAd.TableView.prototype.indexPathsForVisibleRows=function(){var a=this.visibleCells();if(a.length==0)return null;for(var b=[],c=0,d=a.length;c<d;c++)b.push(this.indexPathForCell(a[c]));return b};
iAd.TableView.prototype.populatedSubviewForInfo=function(a){if(!a)return null;var b=null;b=a.type==iAd.TableView.TYPE_CELL?this.populatedCellForRowAtIndexPath(a.indexPath):a.type==iAd.TableView.TYPE_HEADER?this.populatedHeaderForSection(a.section):this.populatedFooterForSection(a.section);if(!b)return null;b._tableViewDataSourceInfo=a;return b};
iAd.TableView.prototype.populatedHeaderForSection=function(a){var b=null;if(a>=this.numberOfSections)return null;if(this.visibleHeaders.length&&this.visibleHeaders[0]._tableViewDataSourceInfo.section==a)return this.visibleHeaders[0];a=this.sectionsInfo[a];b=this.dequeueView(this.headersQueuedForReuse);if(!b){b=this.addSubview(new iAd.TableViewHeader);b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH}b.size=new iAd.Size(this._size.width,a.headerHeight);b.text=a.header;return b};
iAd.TableView.prototype.populatedFooterForSection=function(a){var b=null;if(a>=this.numberOfSections)return null;a=this.sectionsInfo[a];(b=this.dequeueView(this.footersQueuedForReuse))||(b=this.addSubview(new iAd.TableViewFooter));b._size=new iAd.Size(this._size.width,a.footerHeight);b.text=a.footer;return b};
iAd.TableView.prototype.populatedCellForRowAtIndexPath=function(a){cell=this.dataSource[iAd.TableView.CELL_FOR_ROW_AT_PATH](this,a);cell.layer.iad_toggleClassName(iAd.TableView.CSS_CLASS_FIRST_ROW_IN_SECTION,a.row==0);cell.layer.iad_toggleClassName(iAd.TableView.CSS_CLASS_LAST_ROW_IN_SECTION,a.row==this.sectionsInfo[a.section].numberOfRows-1);if(cell._tableViewDataSourceInfo)cell._tableViewDataSourceInfo.indexPath=a;cell.selected=this.isRowAtIndexPathSelected(a);if(cell.superview!==this){cell.autoresizingMask=
iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.addSubview(cell)}else cell.updateTextLayout();cell.size=new iAd.Size(this._size.width,this.usesCustomRowHeights?this.sectionsInfo[a.section].rowHeights[a.row]:this.rowHeight);return cell};iAd.TableView.prototype.dequeueReusableCell=function(){return this.dequeueReusableCellWithIdentifier(iAd.TableViewCell._name)};iAd.TableView.prototype.dequeueReusableCellWithIdentifier=function(a){(a=this.dequeueView(this.cellsQueuedForReuse[a]))&&a.prepareForReuse();return a};
iAd.TableView.prototype.enqueueView=function(a,b){iAd.Array.removeObjectFromArray(b,this.visibleSubviews);a.push(b);b.position=new iAd.Point(0,-this._size.height);b._queued=true};iAd.TableView.prototype.dequeueView=function(a){if(!a||a.length==0)return null;a=a.pop();delete a._queued;return a};
iAd.TableView.prototype.touchesBeganInCapturePhase=function(a){this.wasDeceleratingWhenTouchesBegan=this.decelerating;this.callSuper(a);if(!this.wasDeceleratingWhenTouchesBegan)if(iAd.Event.SUPPORTS_TOUCHES&&this.touchedCell!=null&&a.touches.length>1){this.touchedCell.highlighted=false;this.resetTouchedCell()}else if(this.allowsSelection)for(a=iAd.View.nearestViewForElement(a.target);a;){if(a instanceof iAd.TableViewCell){this.touchedCell=a;break}a=a.superview}};
iAd.TableView.prototype.beginTouchesInContent=function(){this.callSuper();if(this.touchedCell)if(this.touchedCell.accessory&&this.originalTarget===this.touchedCell.accessory.layer||this.touchedCell.editAccessory&&this.originalTarget===this.touchedCell.editAccessory.layer||this.touchedCell.deleteButton&&this.originalTarget.parentElement===this.touchedCell.deleteButton.layer)this.interruptTrackingInteraction(true);else this.touchedCell.highlighted=true};
iAd.TableView.prototype.cancelTouchesInContent=function(){this.callSuper();this.resetTouchedCell()};
iAd.TableView.prototype.touchesEnded=function(a){this.callSuper(a);if(this.touchedCell!=null)if((!this.touchedCell.accessory||this.originalTarget!==this.touchedCell.accessory.layer)&&(!this.touchedCell.editAccessory||this.originalTarget!==this.touchedCell.editAccessory.layer)&&(!this.touchedCell.deleteButton||this.originalTarget.parentElement!==this.touchedCell.deleteButton.layer))this.selectRowAtIndexPath(this.touchedCell._tableViewDataSourceInfo.indexPath);this.resetTouchedCell()};
iAd.TableView.prototype.touchesCancelled=function(a){this.callSuper(a);this.resetTouchedCell()};iAd.TableView.prototype.resetTouchedCell=function(){if(this.touchedCell!=null){this.touchedCell.highlighted=false;this.touchedCell=null}};iAd.TableView.prototype.isRowAtIndexPathSelected=function(a){for(var b=this.selectedRowsIndexPaths,c=0,d=b.length;c<d;c++)if(a.equals(b[c]))return true;return false};
iAd.TableView.prototype.indexPathForSelectedRow=function(){var a=this.indexPathsForSelectedRows();return a?a[0]:null};iAd.TableView.prototype.indexPathsForSelectedRows=function(){return this.selectedRowsIndexPaths.length>0?this.selectedRowsIndexPaths.slice():null};
iAd.TableView.prototype.cellSelectionDidChange=function(a){var b=a._tableViewDataSourceInfo.indexPath,c=this.selectedRowsIndexPaths,d=c.length||0;if(a.selected){if(!this.isRowAtIndexPathSelected(b)){for(a=0;a<d;a++)if(c[a].greaterThan(b)){c.splice(a,0,b);return}c.push(b)}}else for(a=0;a<d;a++)if(c[a].equals(b)){c.splice(a,1);break}};
iAd.TableView.prototype.deselectRowAtIndexPathAnimated=function(a,b){if(a!=null){this.dispatchNotification(iAd.TableView.WILL_DESELECT_ROW_AT_PATH,this.delegate,[["indexPath",a]]);var c=this.cellForRowAtIndexPath(a);if(c!=null){this.markCellAsSelectedAnimated(c,false,b);if(c._tableViewDataSourceInfo.indexPath.equals(this.selectedRowIndexPath))this.selectedRowIndexPath=null}this.dispatchNotification(iAd.TableView.DID_DESELECT_ROW_AT_PATH,this.delegate,[["indexPath",a]])}};
iAd.TableView.prototype.selectRowAtIndexPath=function(a){var b=this.cellForRowAtIndexPath(a);if(b==null)throw Error("No cell at "+a.toString());this.dispatchNotification(iAd.TableView.WILL_SELECT_ROW_AT_PATH,this.delegate,[["indexPath",a]]);a.equals(this.selectedRowIndexPath)||this.deselectRowAtIndexPathAnimated(this.selectedRowIndexPath,false);this.selectedRowIndexPath=a;b.highlighted=false;this.markCellAsSelectedAnimated(b,true,false);this.dispatchNotification(iAd.TableView.DID_SELECT_ROW_AT_PATH,
this.delegate,[["indexPath",a]])};iAd.TableView.prototype.markCellAsSelectedAnimated=function(a,b,c){a instanceof iAd.TableViewCell?a.setSelectedAnimated(b,c):a.iad_toggleClassName(iAd.Control.STATE_SELECTED_CSS,b)};iAd.TableView.prototype.disclosureButtonWasSelectedAtIndexPath=function(a){this.cellForRowAtIndexPath(a).accessoryType===iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON&&this.dispatchNotification(iAd.TableView.DID_SELECT_ACCESSORY_FOR_ROW_AT_PATH,this.delegate,[["indexPath",a]])};
iAd.TableView.prototype.editAccessoryWasSelectedAtIndexPath=function(a){if(this.confirmesBeforeDeleting){var b=false;this.cellsBeingEditedPaths.forEach(function(e){this.cellForRowAtIndexPath(e).editing=false;if(e.equals(a))b=true},this);this.cellsBeingEditedPaths=[];if(!b){var c=this.cellForRowAtIndexPath(a);if(iAd.Utils.objectHasMethod(this.delegate,iAd.TableView.TITLE_FOR_DELETE_CONFIRMATION_BUTTON_FOR_ROW_AT_INDEX_PATH)){var d=this.delegate[iAd.TableView.TITLE_FOR_DELETE_CONFIRMATION_BUTTON_FOR_ROW_AT_INDEX_PATH](this,
a);c.deleteButton.title=d}c.editing=true;this.cellsBeingEditedPaths.push(a)}}else this.deleteButtonWasSelectedAtIndexPath(a)};
iAd.TableView.prototype.deleteButtonWasSelectedAtIndexPath=function(a){var b=this.cellForRowAtIndexPath(a);b.editing=false;this.cellsBeingEditedPaths=[];b.selected&&this.deselectRowAtIndexPathAnimated(a,false);this.dispatchNotification(iAd.TableView.COMMIT_EDITING_STYLE_FOR_ROW_AT_INDEX_PATH,this.delegate,[["editingStyle",iAd.TableViewCell.EDITING_STYLE_DELETE],["indexPath",a]])};
iAd.TableView.prototype.updateIndex=function(){this.sectionIndexTitles=null;if(iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.SECTION_INDEX_TITLES))this.sectionIndexTitles=this.dataSource[iAd.TableView.SECTION_INDEX_TITLES](this);if(this._tableStyle!==iAd.TableView.STYLE_PLAIN||this.sectionIndexTitles==null||this.sectionIndexTitles.length==0)this.layer.removeClassName(iAd.TableView.INDEX_CONTAINER_VISIBLE_CSS_CLASS);else{this.layer.addClassName(iAd.TableView.INDEX_CONTAINER_VISIBLE_CSS_CLASS);
var a=this.sectionIndexTitles;this.usableIndexContainerHeight=this._size.height-(iAd.TableView.INDEX_Y_OUTER_MARGIN+iAd.TableView.INDEX_Y_INNER_MARGIN)*2;if(Math.floor(this.usableIndexContainerHeight/this.sectionIndexTitles.length)<iAd.TableView.MIN_INDEX_LETTER_HEIGHT){var b=this.sectionIndexTitles[0];a=this.sectionIndexTitles[this.sectionIndexTitles.length-1];var c=b==iAd.TableView.INDEX_SEARCH,d=a==iAd.TableView.INDEX_SEARCH;b=b==iAd.TableView.INDEX_POUND;var e=a==iAd.TableView.INDEX_POUND,f=c+
d+b+e;a=Math.floor(this.usableIndexContainerHeight/iAd.TableView.MIN_INDEX_LETTER_HEIGHT)-f;a%2==0&&a--;f=this.sectionIndexTitles.length-f;var g=(f-1)/(Math.max(a/2+1,1)-1);a=[];c&&a.push(iAd.TableView.INDEX_SEARCH);b&&a.push(iAd.TableView.INDEX_POUND);for(c=a.length;c<f-1;c+=g){a.push(this.sectionIndexTitles[Math.round(c)]);a.push(iAd.TableView.INDEX_SKIPPED)}a.push(this.sectionIndexTitles[this.sectionIndexTitles.length-(d||e?2:1)]);d&&a.push(iAd.TableView.INDEX_SEARCH);e&&a.push(iAd.TableView.INDEX_POUND)}d=
(this.usableIndexContainerHeight-iAd.TableView.MIN_INDEX_LETTER_HEIGHT-iAd.TableView.FIRST_INDEX_TITLE_Y_OFFSET)/(a.length-1);this.indexContainer.textContent="";c=0;for(f=a.length;c<f;c++){e=document.createElement("div");b=a[c];switch(b){case iAd.TableView.INDEX_SEARCH:e.className=iAd.TableView.INDEX_SEARCH_CSS_CLASS;break;case iAd.TableView.INDEX_POUND:e.className=iAd.TableView.INDEX_POUND_CSS_CLASS;break;case iAd.TableView.INDEX_SKIPPED:e.className=iAd.TableView.INDEX_SKIPPED_CSS_CLASS;break;default:e.textContent=
b}e.style.top=c*d+iAd.TableView.INDEX_Y_INNER_MARGIN+"px";this.indexContainer.appendChild(e)}}};
iAd.TableView.prototype.touchesBeganOnIndex=function(a){this.scrollEnabledBeforeTouchesBeganOnIndex=this.scrollEnabled;this.scrollEnabled=false;a.stopPropagation();a.preventDefault();window.addEventListener(iAd.Event.MOVE_EVENT,this,true);window.addEventListener(iAd.Event.END_EVENT,this,true);window.addEventListener(iAd.Event.CANCEL_EVENT,this,true);this.previouslyTouchedIndex=null;this.stopDecelerationAnimation();this.hideScrollIndicators();this.indexContainer.addClassName(iAd.TableView.INDEX_INTERACTIVE_CSS_CLASS);
this.scrollToSectionForIndexEvent(a)};iAd.TableView.prototype.touchesMovedOnIndex=function(a){a.stopPropagation();a.preventDefault();this.scrollToSectionForIndexEvent(a)};
iAd.TableView.prototype.touchesEndedOnIndex=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener(iAd.Event.MOVE_EVENT,this,true);window.removeEventListener(iAd.Event.END_EVENT,this,true);window.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);this.trackingTouchesOnIndex=false;this.indexContainer.removeClassName(iAd.TableView.INDEX_INTERACTIVE_CSS_CLASS);this.scrollEnabled=this.scrollEnabledBeforeTouchesBeganOnIndex};
iAd.TableView.prototype.scrollToSectionForIndexEvent=function(a){if(iAd.Utils.objectHasMethod(this.dataSource,iAd.TableView.SECTION_FOR_SECTION_INDEX_TITLE_AT_INDEX)){var b=this.usableIndexContainerHeight+2*iAd.TableView.INDEX_Y_INNER_MARGIN,c=(this.usableIndexContainerHeight-iAd.TableView.MIN_INDEX_LETTER_HEIGHT-iAd.TableView.FIRST_INDEX_TITLE_Y_OFFSET)/(this.sectionIndexTitles.length-1),d=this.sectionIndexTitles.length*c;a=iAd.Point.fromEventInElement(a,this.indexContainer).y-(b-d)/2;c=iAd.Number.clampValue(Math.floor(a/
c),0,this.sectionIndexTitles.length-1);if(c!=this.previouslyTouchedIndex){this.previouslyTouchedIndex=c;c=this.sectionsInfo[this.dataSource[iAd.TableView.SECTION_FOR_SECTION_INDEX_TITLE_AT_INDEX](this,this.sectionIndexTitles[c],c)].y;this.contentOffset=new iAd.Point(0,c)}}};iAd.Class({name:"iAd.TableViewHeader",superclass:iAd.View,synthesizedProperties:["text"],cssClassName:"ad-table-view-header",collectionAccessor:"tableViewHeaders"});
iAd.TableViewHeader.prototype.init=function(a){this.callSuper(a);this.wantsHardwareLayerBacking=true};iAd.TableViewHeader.prototype.getText=function(){return this.layer.textContent};iAd.TableViewHeader.prototype.setText=function(a){this.layer.textContent=a};iAd.Class({name:"iAd.TableViewFooter",superclass:iAd.View,synthesizedProperties:["text"],cssClassName:"ad-table-view-footer",collectionAccessor:"tableViewFooters"});
iAd.TableViewFooter.prototype.init=function(a){this.callSuper(a);this.wantsHardwareLayerBacking=true};iAd.TableViewFooter.prototype.getText=function(){return this.layer.textContent};iAd.TableViewFooter.prototype.setText=function(a){this.layer.textContent=a};iAd.Class("iAd.IndexPath");iAd.IndexPath.prototype.init=function(a,b){this.section=a||0;this.row=b||0};iAd.IndexPath.prototype.toString=function(){return"iAd.IndexPath with section "+this.section+" and row "+this.row};
iAd.IndexPath.prototype.copy=function(){return new iAd.IndexPath(this.section,this.row)};iAd.IndexPath.prototype.lowerThan=function(a){return a!=null&&(this.section<a.section||this.section==a.section&&this.row<a.row)};iAd.IndexPath.prototype.equals=function(a){return a!=null&&this.section==a.section&&this.row==a.row};iAd.IndexPath.prototype.greaterThan=function(a){return a!=null&&(this.section>a.section||this.section==a.section&&this.row>a.row)};iAd.Class("iAd.TableViewDeclarativeDataSource");
iAd.TableViewDeclarativeDataSource.ATTR_HEADER="ad-header";iAd.TableViewDeclarativeDataSource.ATTR_FOOTER="ad-footer";
iAd.TableViewDeclarativeDataSource.prototype.init=function(a){this.callSuper();this.data=[];for(var b,c,d;a.childElementCount;){b=a.removeChild(a.firstElementChild);c={cells:[]};if(iAd.Element.hasCustomAttribute(b,iAd.TableViewDeclarativeDataSource.ATTR_HEADER))c.header=iAd.Element.getCustomAttribute(b,iAd.TableViewDeclarativeDataSource.ATTR_HEADER);if(iAd.Element.hasCustomAttribute(b,iAd.TableViewDeclarativeDataSource.ATTR_FOOTER))c.footer=iAd.Element.getCustomAttribute(b,iAd.TableViewDeclarativeDataSource.ATTR_FOOTER);
for(;b.childElementCount;){d=new iAd.TableViewCell(b.removeChild(b.firstElementChild));d.initWithDeclarativeBacking();c.cells.push({text:d.text,detailedText:d.detailedText,cellStyle:d.cellStyle,editingStyle:d.editingStyle,selectionStyle:d.selectionStyle,accessoryType:d.accessoryType})}this.data.push(c)}};iAd.TableViewDeclarativeDataSource.prototype.numberOfSectionsInTableView=function(){return this.data.length};
iAd.TableViewDeclarativeDataSource.prototype.tableViewNumberOfRowsInSection=function(a,b){return this.data[b].cells.length};iAd.TableViewDeclarativeDataSource.prototype.tableViewCellForRowAtIndexPath=function(a,b){var c=this.data[b.section].cells[b.row],d=a.dequeueReusableCellWithIdentifier(iAd.TableViewCell._name)||new iAd.TableViewCell;iAd.Utils.copyPropertiesFromSourceToTarget(c,d);return d};
iAd.TableViewDeclarativeDataSource.prototype.tableViewTitleForHeaderInSection=function(a,b){return this.data[b].header||null};iAd.TableViewDeclarativeDataSource.prototype.tableViewTitleForFooterInSection=function(a,b){return this.data[b].footer||null};
iAd.TableView.prototype.dumpSubviews=function(){var a=this.visibleSubviews;console.group(a.length+" subviews");for(var b,c,d,e=0,f=a.length;e<f;e++){b=a[e];c=b._tableViewDataSourceInfo;if(c.type==iAd.TableView.TYPE_FOOTER){d="Footer";c="section = "+c.section}else if(c.type==iAd.TableView.TYPE_HEADER){d="Header";c="section = "+c.section}else{d="Cell";c="section = "+c.indexPath.section+" row = "+c.indexPath.row}console.log(e,d,b.text,c)}console.groupEnd()};
iAd.Class({name:"WK.TableViewWithFilter",superclass:iAd.TableView,synthesizedProperty:["filterHeight"]});WK.TableViewWithFilter.prototype={setContentSize:function(a){this.callSuper(a);if(this.filterHeight){if(this.contentSize.height<this.size.height)this.contentSize=new iAd.Size(this.contentSize.width,this.size.height+this.filterHeight);this.setContentOffsetAnimated(new iAd.Point(0,this.filterHeight),true)}}};
iAd.Class({name:"iAd.ImageView",superclass:iAd.View,synthesizedProperties:["autoSized","image","highlightedImage","highlighted"],archivedProperties:["autoSized","image","highlightedImage","highlighted"],cssClassName:"ad-image-view",collectionAccessor:"imageViews"});
iAd.ImageView.prototype.init=function(a){this._autoSized=true;this._highlighted=false;this._highlightedImage=this._image=null;this.callSuper(a);this.addEventListener(iAd.View.TOUCH_DOWN_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_DRAG_ENTER_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_DRAG_EXIT_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_CANCEL_EVENT,this,false)};
iAd.ImageView.prototype.layerWasCreated=function(){this._img=this.layer.appendChild(document.createElement("img"))};iAd.ImageView.prototype.setValueForAttribute=function(a,b){switch(b){case "ad-image":this.image=iAd.Image.imageForURL(a,this.layerHasCustomAttribute("ad-has-hidpi-version"));break;case "ad-highlighted-image":this.highlightedImage=iAd.Image.imageForURL(a,this.layerHasCustomAttribute("ad-has-hidpi-version"));break;default:this.callSuper(a,b)}};
iAd.ImageView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.syncImageToCurrentState()};iAd.ImageView.prototype.setImage=function(a){this._image=a;this.syncImageToCurrentState()};iAd.ImageView.prototype.setHighlightedImage=function(a){this.userInteractionEnabled=a!=null;this._highlightedImage=a;this.syncImageToCurrentState()};iAd.ImageView.prototype.setHighlighted=function(a){if(a!=this._highlighted){this._highlighted=a;this.syncImageToCurrentState()}};
iAd.ImageView.prototype.setAutoSized=function(a){if(this._autoSized!=a){this._autoSized=a;this.syncImageToCurrentState()}};
iAd.ImageView.prototype.syncImageToCurrentState=function(){var a=this.highlighted&&this.highlightedImage?this.highlightedImage:this.image;if(a)if(a.loaded){this._img.style.visibility="visible";this._img.src=a.element.src;if(this._autoSized)this.size=new iAd.Size(a.width,a.height);if(iAd.ImageEffects&&this._effect){this._effect.inputImage=this._img;this._effect.render()}}else a.addPropertyObserver("loaded",this,"syncImageToCurrentState");else{this._img.src="";this._img.style.removeProperty("visibility")}};
iAd.ImageView.prototype.handleEvent=function(a){this.callSuper(a);switch(a.type){case iAd.View.TOUCH_DOWN_EVENT:case iAd.View.TOUCH_DRAG_ENTER_EVENT:this.highlighted=true;break;case iAd.View.TOUCH_DRAG_EXIT_EVENT:case iAd.View.TOUCH_UP_INSIDE_EVENT:case iAd.View.TOUCH_CANCEL_EVENT:this.highlighted=false}};iAd.Class({name:"iAd.Switch",superclass:iAd.Control,synthesizedProperties:["on","onTintColor"],archivedProperties:["on","onTintColor"],cssClassName:"ad-switch",collectionAccessor:"switches"});
iAd.Switch.IS_ROUND=iAd.Device.iOS_VERSION?!iAd.Device.iOSVersionLessThan("5.0"):true;iAd.Switch.ROUND_CSS="ad-round";iAd.Switch.ROUND_PADDING=16;iAd.Switch.DOWN_CSS="ad-dragging";iAd.Switch.SNAP_CSS="ad-snap";iAd.Switch.WIDTH=93;iAd.Switch.HEIGHT=27;iAd.Switch.DRAG_IDLE=0;iAd.Switch.CAN_DRAG=1;iAd.Switch.IS_DRAGGING=2;iAd.Switch.SLIDE_DISTANCE=iAd.Switch.IS_ROUND?50:54;iAd.Switch.BUTTON_WIDTH=iAd.Switch.IS_ROUND?29:40;iAd.Switch.DRAG_MAX=iAd.Switch.IS_ROUND?64:70;
iAd.Switch.DRAG_MIN=iAd.Switch.IS_ROUND?14:16;iAd.Switch.DRAG_GUTTER=iAd.Switch.IS_ROUND?0:5;iAd.Switch.CAP_WIDTH=4;iAd.Switch.HALF_WIDTH=(iAd.Switch.IS_ROUND?77:93)/2;iAd.Switch.LEFT_CAP_TRACK_CSS="ad-left-cap ad-track-cap";iAd.Switch.LEFT_CAP_BUTTON_CSS="ad-left-cap ad-button-cap";iAd.Switch.RIGHT_CAP_TRACK_CSS="ad-right-cap ad-track-cap";iAd.Switch.RIGHT_CAP_BUTTON_CSS="ad-right-cap ad-button-cap";
iAd.Switch.prototype.init=function(a){this._setOnAnimatedCalledFromSetter=this._on=false;this.callSuper(a);this.dragOffsetX=iAd.Switch.DRAG_MAX;if(!this.usesDeclarativeBacking)this.size=new iAd.Size(iAd.Switch.WIDTH,iAd.Switch.HEIGHT);this._onTintColor="rgb(0, 127, 234)";this.on=this._on;this.initialized=true};
iAd.Switch.prototype.layerWasCreated=function(){this.callSuper();var a=iAd.Switch.IS_ROUND;if(a){this.layer.addClassName(iAd.Switch.ROUND_CSS);this.labelSlider=this.layer.appendChild(document.createElement("div"));this.labelSlider.className="ad-switch-label-slider"}else{this.leftCap=this.layer.appendChild(document.createElement("div"));this.leftCap.className=iAd.Switch.LEFT_CAP_TRACK_CSS;this.rightCap=this.layer.appendChild(document.createElement("div"));this.rightCap.className=iAd.Switch.RIGHT_CAP_BUTTON_CSS}if(a)this.layer.appendChild(document.createElement("div")).className=
"ad-switch-shadow";this.slideContainer=this.layer.appendChild(document.createElement("div"));this.slideContainer.className="ad-slide-container";this.slider=this.slideContainer.appendChild(document.createElement("div"));this.slider.className="ad-switch-slider";this.slider.addEventListener("webkitTransitionEnd",this,false);if(a){this.labelOFF=this.labelSlider.appendChild(document.createElement("div"));this.labelOFF.textContent="_Control.Switch.Off".loc();this.labelOFF.className="ad-label-off";this.labelOFF.setAttribute("name",
"_Control.Switch.Off".loc());this.labelOFF.setAttribute("aria-label","_Control.Switch.Off".loc());this.tintLayer=this.labelSlider.appendChild(document.createElement("div"));this.tintLayer.className="ad-switch-tint";this.labelON=this.labelSlider.appendChild(document.createElement("div"));this.labelON.textContent="_Control.Switch.On".loc();this.labelON.className="ad-label-on";this.labelON.setAttribute("name","_Control.Switch.On".loc());this.labelON.setAttribute("aria-label","_Control.Switch.On".loc())}else{this.slider.appendChild(document.createElement("div")).className=
"ad-label-off";this.slider.appendChild(document.createElement("div")).className="ad-label-on"}this.button=this.slider.appendChild(document.createElement("div"));this.button.className="ad-switch-button"};iAd.Switch.prototype.setSize=function(a){a.width=iAd.Switch.WIDTH;a.height=iAd.Switch.HEIGHT;this.callSuper(a)};
iAd.Switch.prototype.setOnAnimated=function(a,b){var c=iAd.Switch.IS_ROUND;if(b){this.slider.addClassName(iAd.Switch.SNAP_CSS);if(c)this.labelSlider.addClassName(iAd.Switch.SNAP_CSS);else if(!(a&&this.dragOffsetX==iAd.Switch.DRAG_MAX||!a&&this.dragOffsetX==iAd.Switch.DRAG_MIN)){this.leftCap.className=iAd.Switch.LEFT_CAP_TRACK_CSS;this.rightCap.className=iAd.Switch.RIGHT_CAP_TRACK_CSS}}else{this.slider.removeClassName(iAd.Switch.SNAP_CSS);if(c)this.labelSlider.removeClassName(iAd.Switch.SNAP_CSS);
else if(a){this.leftCap.className=iAd.Switch.LEFT_CAP_TRACK_CSS;this.rightCap.className=iAd.Switch.RIGHT_CAP_BUTTON_CSS}else{this.leftCap.className=iAd.Switch.LEFT_CAP_BUTTON_CSS;this.rightCap.className=iAd.Switch.RIGHT_CAP_TRACK_CSS}}if(a){if(c){this.slider.style.webkitTransform=iAd.CSS.t(0,0);this.labelSlider.style.webkitTransform=this.slider.style.webkitTransform;this.tintLayer.style.display="";this.labelOFF.style.display="none";this.labelON.style.display=""}else this.slider.style.webkitTransform=
iAd.CSS.t(-iAd.Switch.CAP_WIDTH,0);this.dragOffsetX=iAd.Switch.DRAG_MAX}else{if(c){this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.SLIDE_DISTANCE,0);this.labelSlider.style.webkitTransform=this.slider.style.webkitTransform;if(!b){this.tintLayer.style.display="none";this.labelOFF.style.display="";this.labelON.style.display="none"}}else this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.SLIDE_DISTANCE-iAd.Switch.CAP_WIDTH,0);this.dragOffsetX=iAd.Switch.DRAG_MIN}c=this._on!=a;this._on=a;
if(this.initialized&&c){this.createAndDispatchEvent(iAd.Control.VALUE_CHANGE_EVENT);this._setOnAnimatedCalledFromSetter||this.notifyPropertyChange("on")}this._setOnAnimatedCalledFromSetter=false};iAd.Switch.prototype.setOn=function(a){this._setOnAnimatedCalledFromSetter=true;this.setOnAnimated(a,false)};iAd.Switch.prototype.setOnTintColor=function(a){this._onTintColor=a;if(iAd.Switch.IS_ROUND)this.tintLayer.style.backgroundColor=a};
iAd.Switch.prototype.handleEvent=function(a){this.callSuper(a);a.type=="webkitTransitionEnd"&&this.transitionEnded()};
iAd.Switch.prototype.transitionEnded=function(){var a=iAd.Switch.IS_ROUND;this.slider.removeClassName(iAd.Switch.SNAP_CSS);a&&this.labelSlider.removeClassName(iAd.Switch.SNAP_CSS);if(this._on)if(a){this.slider.style.webkitTransform=iAd.CSS.t(0,0);this.labelSlider.style.webkitTransform=this.slider.style.webkitTransform}else{this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.CAP_WIDTH,0);this.rightCap.className=iAd.Switch.RIGHT_CAP_BUTTON_CSS}else if(a){this.tintLayer.style.display="none";this.labelOFF.style.display=
"";this.labelON.style.display="none";this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.SLIDE_DISTANCE,0);this.labelSlider.style.webkitTransform=this.slider.style.webkitTransform}else{this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.SLIDE_DISTANCE-iAd.Switch.CAP_WIDTH,0);this.leftCap.className=iAd.Switch.LEFT_CAP_BUTTON_CSS}};
iAd.Switch.prototype.touchesBegan=function(a){this.callSuper(a);a=iAd.Point.fromEventInElement(a,this.layer);var b=iAd.Switch.IS_ROUND?iAd.Switch.ROUND_PADDING:0;this._touchBeganInPadding=a.x<b;if(!this._on&&a.x>b&&a.x<b+iAd.Switch.BUTTON_WIDTH||this.on&&a.x>b+iAd.Switch.SLIDE_DISTANCE){this.layer.addClassName(iAd.Switch.DOWN_CSS);this.dragState=iAd.Switch.CAN_DRAG}};
iAd.Switch.prototype.touchesMoved=function(a){this.callSuper(a);var b=iAd.Switch.IS_ROUND,c=iAd.Switch.LEFT_CAP_TRACK_CSS,d=iAd.Switch.RIGHT_CAP_TRACK_CSS;if(this.dragState>=iAd.Switch.CAN_DRAG){this.slider.removeClassName(iAd.Switch.SNAP_CSS);this.dragState=iAd.Switch.IS_DRAGGING;if(b){this.labelSlider.removeClassName(iAd.Switch.SNAP_CSS);this.tintLayer.style.display="";this.labelOFF.style.display="none";this.labelON.style.display=""}a=iAd.Point.fromEventInElement(a,this.layer);this.dragOffsetX=
b?a.x-iAd.Switch.ROUND_PADDING:a.x;a=Math.floor(iAd.Switch.BUTTON_WIDTH/2);if(this.dragOffsetX>iAd.Switch.DRAG_MAX-iAd.Switch.DRAG_GUTTER)if(this.dragOffsetX>=iAd.Switch.DRAG_MAX){this.dragOffsetX=iAd.Switch.DRAG_MAX;if(!b)d=iAd.Switch.RIGHT_CAP_BUTTON_CSS}else this.dragOffsetX=iAd.Switch.DRAG_MAX-iAd.Switch.DRAG_GUTTER;else if(this.dragOffsetX<iAd.Switch.DRAG_MIN+iAd.Switch.DRAG_GUTTER)if(this.dragOffsetX<=iAd.Switch.DRAG_MIN){this.dragOffsetX=iAd.Switch.DRAG_MIN;if(b){this.tintLayer.style.display=
"none";this.labelOFF.style.display="";this.labelON.style.display="none"}else c=iAd.Switch.LEFT_CAP_BUTTON_CSS}else this.dragOffsetX=iAd.Switch.DRAG_MIN+iAd.Switch.DRAG_GUTTER;this.slider.style.webkitTransform=iAd.CSS.t(-iAd.Switch.SLIDE_DISTANCE-(a-this.dragOffsetX),0);if(b)this.labelSlider.style.webkitTransform=this.slider.style.webkitTransform;else{this.rightCap.className=d;this.leftCap.className=c}}};
iAd.Switch.prototype.touchesEnded=function(a){this.callSuper(a);if(!this._touchBeganInPadding){if(this.dragState===iAd.Switch.IS_DRAGGING)if(this.dragOffsetX<iAd.Switch.HALF_WIDTH)this.setOnAnimated(false,true);else this.dragOffsetX>iAd.Switch.HALF_WIDTH?this.setOnAnimated(true,true):this.setOnAnimated(this.on,true);else this.setOnAnimated(!this._on,true);this.layer.removeClassName(iAd.Switch.DOWN_CSS);this.dragState=iAd.Switch.DRAG_IDLE}};
iAd.Class({name:"WK.TableViewCellForEntityList",superclass:iAd.TableViewCell,synthesizedProperties:["image","guid","isFavorite","description","looksLikeFirstRow"]});WK.TableViewCellForEntityList.STYLE_DEFAULT="default";WK.TableViewCellForEntityList.STYLE_LOAD_MORE="load_more";
WK.TableViewCellForEntityList.prototype={init:function(a){this.wikiStyle=a||WK.TableViewCellForEntityList.STYLE_DEFAULT;this.callSuper(null,iAd.TableViewCell.STYLE_VALUE_1)},layerWasCreated:function(){this.callSuper();if(this.wikiStyle==WK.TableViewCellForEntityList.STYLE_LOAD_MORE){this.text="_General.Load.More".loc();this.layer.addClassName("wk-list-pagination-cell")}else if(this.wikiStyle==WK.TableViewCellForEntityList.STYLE_DEFAULT){this.accessory=this.favoriteTitleView=new WK.FavoriteClipView;
this.addSubview(this.favoriteTitleView);this.imageView=new iAd.ImageView;this.imageView.layer.classList.add("wk-vertically-centered-item");this.imageView.autoSized=true;this.addSubview(this.imageView);this.dividerView=new iAd.View;this.dividerView.layer.classList.add("wk-divider-line");this.addSubview(this.dividerView)}this.layer.addClassName("wk-table-view-cell-for-entity-list")},elementToAnimateFrom:function(){return this.imageView.layer.firstElementChild},setGuid:function(a){this.favoriteTitleView.setGuid(a);
this._guid=a},setDescription:function(a){this.accessoryType=(this._description=a)?iAd.TableViewCell.ACCESSORY_DETAIL_DISCLOSURE_BUTTON:iAd.TableViewCell.ACCESSORY_NONE;a=105+iAd.CSS.widthForTextAndFont(this.text,"bold 14px Helvetica");this.accessory.position=new iAd.Point(a,12)},setImage:function(a){this._image=a;this.imageView.image=a},setIsFavorite:function(a){this.favoriteTitleView.isFavorite=a},setLooksLikeFirstRow:function(a){this.layer.iad_toggleClassName("wk-looks-like-first-row-in-section",
a)},prepareForReuse:function(){this.callSuper();this.description=this.wikiStyle=this.image=null;this.looksLikeFirstRow=false}};iAd.Class({name:"WK.TableViewCellWithButton",superclass:iAd.TableViewCell,synthesizedProperties:["button"]});
WK.TableViewCellWithButton.prototype={layerWasCreated:function(){this.callSuper();this.layer.classList.add("wk-table-view-cell-with-button")},setButton:function(a){this._button=a;this._button.layer.classList.add("wk-centered-item");this.addSubview(this.button)},prepareForReuse:function(){this.callSuper();this.button.removeFromSuperview()}};iAd.Class({name:"WK.TableViewCellWithImage",superclass:iAd.TableViewCell,synthesizedProperties:["image"]});
WK.TableViewCellWithImage.prototype={layerWasCreated:function(){this.callSuper();this.layer.addClassName("wk-table-view-cell-with-image");this.imageView=new iAd.ImageView;this.imageView.layer.addClassName("wk-vertically-centered-item");this.imageView.layer.style.marginLeft="6px";this.imageView.autoSized=true;this.addSubview(this.imageView)},setImage:function(a){this._image=a;this.imageView.image=a},prepareForReuse:function(){this.callSuper();this.image=null}};
iAd.Class({name:"WK.TableViewCellWithDate",superclass:iAd.TableViewCell,synthesizedProperties:["date"]});WK.TableViewCellWithDate.prototype={layerWasCreated:function(){this.callSuper();this.dateLabel=new iAd.Label;this.addSubview(this.dateLabel)},setDate:function(a){this._date=a;this.dateLabel.text=globalLocalizationManager().shortLocalizedDateTime(a)},prepareForReuse:function(){this.callSuper();this.date=""}};iAd.Class({name:"WK.InlineTextInputTableViewCell",superclass:iAd.TableViewCell});
WK.InlineTextInputTableViewCell.prototype={layerWasCreated:function(){this.callSuper();this.layer.addClassName("wk-tag-input-cell");var a=document.createElement("input");a.placeholder="_Document.Sidebar.Tags.Add".loc();a.type="text";a.setAttribute("aria-label","_Document.Sidebar.Tags.Add.Name".loc());a.setAttribute("name","_Document.Sidebar.Tags.Add.Name".loc());this.textInput=new iAd.View(a);this.addSubview(this.textInput)}};
iAd.Class({name:"WK.CommentTableViewCell",superclass:WK.TableViewCellWithDate,synthesizedProperties:["isPlaceholderCell"]});
WK.CommentTableViewCell.prototype={init:function(){this.callSuper(null,iAd.TableViewCell.STYLE_SUBTITLE)},layerWasCreated:function(){this.callSuper();this.layer.classList.add("wk-comment-cell")},setIsPlaceholderCell:function(a){this.layer.classList[a?"add":"remove"]("wk-comment-cell-editor");if(a){a=document.createElement("textarea");a.rows=2;a.placeholder="_Document.Sidebar.Comments.New".loc();this.textInput=new iAd.View(a);this.addSubview(this.textInput);a=new iAd.BarButton(iAd.BarButtonItem.TYPE_SQUARE);
this.button.layer.setAttribute("aria-label","_Control.Send".loc());this.button.layer.setAttribute("name","_Control.Send".loc());a.title="_Control.Send".loc();a.hidden=true;a.layer.classList.add("wk-send-button");this.sendButton=a;this.addSubview(this.sendButton)}else{this.textInput&&this.textInput.removeFromSuperview();this.sendButton&&this.sendButton.removeFromSuperview()}}};iAd.Class({name:"WK.TableViewCellWithSwitch",superclass:iAd.TableViewCell,synthesizedProperties:["on"]});
WK.TableViewCellWithSwitch.prototype={layerWasCreated:function(){this.callSuper();this.control=new iAd.Switch;this.control.setLayerStyle({top:"8px",height:iAd.Switch.HEIGHT+"px",right:"7px",left:"auto",width:"93px"});this.addSubview(this.control)},setOn:function(a){this._on=a;this.control.on=a},prepareForReuse:function(){this.callSuper();this.on=false}};iAd.Class({name:"WK.AvatarView",superclass:iAd.View,cssClassName:"wk-avatar",synthesizedProperties:["avatarURL","avatarGUID","style"]});
WK.AvatarView.STYLE_SMALL="wk-avatar-small";WK.AvatarView.STYLE_MEDIUM="wk-avatar-medium";WK.AvatarView.STYLE_LARGE="wk-avatar-large";WK.AvatarView.DIMENSION_DEFAULT_WIDTH_SMALL=44;WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_SMALL=44;WK.AvatarView.DIMENSION_DEFAULT_WIDTH_MEDIUM=60;WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_MEDIUM=60;WK.AvatarView.DIMENSION_DEFAULT_WIDTH_LARGE=108;WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_LARGE=108;
WK.AvatarView.prototype.init=function(a){this._avatarURL=this._avatarGUID=null;this._style=WK.AvatarView.STYLE_MEDIUM;this.callSuper(a)};WK.AvatarView.prototype.layerWasCreated=function(){this.callSuper();this.layer.appendChild(Builder.node("div",{className:"wk-avatar-wrapper"},[Builder.node("img",{className:"wk-avatar-wrapper-masked-img"}),Builder.node("div",{className:"wk-avatar-wrapper-frame"})]));this.layer.addClassName("generic");this.updateLayerForStyle(this.style)};
WK.AvatarView.prototype.setStyle=function(a){if(a&&a!=this._style){this.updateLayerForStyle(a);this._style=a}};
WK.AvatarView.prototype.updateLayerForStyle=function(a){this.size=a==WK.AvatarView.STYLE_LARGE?new iAd.Size(WK.AvatarView.DIMENSION_DEFAULT_WIDTH_LARGE,WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_LARGE):a==WK.AvatarView.STYLE_MEDIUM?new iAd.Size(WK.AvatarView.DIMENSION_DEFAULT_WIDTH_MEDIUM,WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_MEDIUM):new iAd.Size(WK.AvatarView.DIMENSION_DEFAULT_WIDTH_SMALL,WK.AvatarView.DIMENSION_DEFAULT_HEIGHT_SMALL);var b=$(this.layer);a!=this._style&&b.classList.remove(this._style);
b.classList.add(a)};WK.AvatarView.prototype.setAvatarGUID=function(a){if(a!=undefined&&a!=""&&a!=this._avatarGUID){this._avatarGUID=a;a=$(this.layer).down("img");var b=this.avatarURL;b&&a.setAttribute("src",b);this.layer.removeClassName("generic")}};WK.AvatarView.prototype.getAvatarURL=function(){if(this.avatarGUID)return"/wiki/files/download/%@".fmt(this.avatarGUID)};
iAd.Class({name:"WK.NavigationSidebarUserCell",superclass:iAd.TableViewCell,cssClassName:"wk-navigation-sidebar-user-cell",synthesizedProperties:["userGUID","avatarGUID","displayName"]});WK.NavigationSidebarUserCell.STYLE_DEFAULT_WIDTH=240;WK.NavigationSidebarUserCell.STYLE_DEFAULT_HEIGHT=109;WK.NavigationSidebarUserCell.STYLE_AVATAR_TOP=13;WK.NavigationSidebarUserCell.STYLE_LABEL_TOP=78;WK.NavigationSidebarUserCell.STYLE_LABEL_HEIGHT=26;
WK.NavigationSidebarUserCell.prototype.init=function(a){this._avatarGUID=this._userGUID=null;this._displayName="_Login.Unauthenticated".loc();this.callSuper(a)};
WK.NavigationSidebarUserCell.prototype.layerWasCreated=function(){this.callSuper();var a=new WK.AvatarView;a.style=WK.AvatarView.STYLE_MEDIUM;a.avatarGUID=this.avatarGUID;this.addSubview(a);a.position=new iAd.Point(Math.floor((WK.NavigationSidebarUserCell.STYLE_DEFAULT_WIDTH-a.size.width)/2),WK.NavigationSidebarUserCell.STYLE_AVATAR_TOP);this.avatarView=a;a=new iAd.Label;this.addSubview(a);a.text=this.displayName;a.numberOfLines=1;a.verticalAlignment=iAd.Label.VERTICAL_ALIGNMENT_TOP;a.size=new iAd.Size(WK.NavigationSidebarUserCell.STYLE_DEFAULT_WIDTH,
WK.NavigationSidebarUserCell.STYLE_LABEL_HEIGHT);a.position=new iAd.Point(0,WK.NavigationSidebarUserCell.STYLE_LABEL_TOP);this.displayNameLabel=a;this.size=new iAd.Size(WK.NavigationSidebarUserCell.STYLE_DEFAULT_WIDTH,WK.NavigationSidebarUserCell.STYLE_DEFAULT_HEIGHT)};WK.NavigationSidebarUserCell.prototype.setEntityURL=function(a){if(a&&a!=this._entityURL)this._entityURL=a};
WK.NavigationSidebarUserCell.prototype.setAvatarGUID=function(a){if(a&&a!=this._avatarGUID)this.avatarView.avatarGUID=this._avatarGUID=a};WK.NavigationSidebarUserCell.prototype.setDisplayName=function(a){if(a&&a!=this._displayName)this.displayNameLabel.text=this._displayName=a};iAd.Class({name:"WK.Dialog",superclass:iAd.ViewController,synthesizedProperties:["contentView","title","isAssistant"]});
WK.Dialog.prototype={init:function(a){this.callSuper();this._isAssistant=a||false},showDialog:function(){this.overlayView=new iAd.View;this.overlayView.size=new iAd.Size(window.innerWidth,window.innerHeight);this.overlayView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.overlayView.layer.style.backgroundColor="black";this.overlayView.layer.style.zIndex="301";this.overlayView.opacity=0.4;iAd.RootView.sharedRoot.addSubview(this.overlayView);iAd.RootView.sharedRoot.addSubview(this.view);
this.viewDidAppear()},hideDialog:function(){this.overlayView.removeFromSuperview();this.view.removeFromSuperview()},loadView:function(){this.callSuper();var a=new iAd.View;a.layer.classList.add("wk-dialog");a.layer.classList.add(this.isAssistant?"assistant":"hud");var b=this.title,c=b?44:0;if(b){var d=new iAd.Label;d.text=b;a.addSubview(d)}b=this.contentView;if(b.size.equals(iAd.Size.ZERO_SIZE))b.size=new iAd.Size(500,300);d=this.isAssistant?0:6;b.position=new iAd.Point(d,d+c);a.size=new iAd.Size(b.size.width+
2*d,b.size.height+2*d+c);a.layer.classList.add("wk-centered-item");a.autoresizingMask=iAd.View.AUTORESIZING_NONE;a.zIndex=401;a.addSubview(b);this.view=a},getContentView:function(){logger.error("For subclasses to implement")}};iAd.Class({name:"WK.LoginDialog",superclass:WK.Dialog});
WK.LoginDialog.prototype={title:"_Login.DialogTitle".loc(),getContentView:function(){if(!this._contentView){var a=new iAd.View;a.layer.id="wk-login-dialog";a.size=new iAd.Size(267,124);var b=document.createElement("input");b.type="text";b.placeholder="_Login.UserName".loc();b.autofocus="true";b.autocorrect="off";b.autocapitalize="off";this.userField=new iAd.View(b);a.addSubview(this.userField);b=document.createElement("input");b.type="password";b.autocorrect="off";b.autocapitalize="off";b.placeholder=
"_Login.Password".loc();b.addEventListener("keyup",this,false);this.pwdField=new iAd.View(b);a.addSubview(this.pwdField);this.cancelButton=new iAd.BarButton(iAd.BarButtonItem.TYPE_SQUARE);this.cancelButton.layer.setAttribute("aria-label","_Control.Cancel".loc());this.cancelButton.layer.setAttribute("name","_Control.Cancel".loc());this.cancelButton.title="_Control.Cancel".loc();this.cancelButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);a.addSubview(this.cancelButton);this.loginButton=new iAd.BarButton(iAd.BarButtonItem.TYPE_DONE);this.loginButton.layer.setAttribute("aria-label","_Login.LogIn".loc());this.loginButton.layer.setAttribute("name","_Login.LogIn".loc());this.loginButton.title="_Control.OK".loc();this.loginButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.loginButton.layer.classList.add("wk-ok-button");this.loginButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.addSubview(this.loginButton);
this._contentView=a}return this._contentView},viewDidAppear:function(a){this.callSuper(a);this.userField.layer.focus()},handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT){a=a.ad.sender;if(a==this.cancelButton)this.hideDialog();else a==this.loginButton&&this.attemptLogin()}else a.type=="keyup"&&a.keyCode==13&&this.attemptLogin()},attemptLogin:function(){this.hideDialog();dialogManager().showProgressMessage("_General.Loading".loc());var a=this.userField.layer.value,
b=this.pwdField.layer.value;authenticator().login_digest(a,b,function(){dialogManager().hide();window.location.reload()},function(){dialogManager().hide();alert("Failed to log in successfully")})}};iAd.Class({name:"WK.FormatterUtilities"});
WK.FormatterUtilities={displayNameForEntity:function(a){return a.longName||a.shortName},locationDescriptionForContainer:function(a){if(!a)return"###";var b=WK.FormatterUtilities.displayNameForEntity(a);return localizedContainerString(b,a.type)},iconImageForEntity:function(a,b,c,d){b=(a=iconURIForEntity(a,b,c,d,iAd.Device.HAS_HIDPI_DISPLAY))&&a.indexOf("@2x")!=-1;return iAd.Image.imageForURL(a,b)}};
iAd.Class({name:"WK.NavigationSidebarViewController",superclass:iAd.ViewController,synthesizedProperties:["isLoggedIn","recents"],id:"sidebar"});WK.NavigationSidebarViewController.HANDLE_BUTTON_WIDTH=16;iAd.TableView.PLAIN_HEADER_HEIGHT=30;
WK.NavigationSidebarViewController.prototype={init:function(a){this.callSuper(a);this.myProfileLinks=[{name:"_NavigationSidebar.My.Activity".loc(),icon:"MyActivity.png",routeURL:"/wiki/mypage/activity"},{name:"_NavigationSidebar.My.Documents".loc(),icon:"MyDocuments.png",routeURL:"/wiki/mypage/documents"},{name:"_NavigationSidebar.My.Favorites".loc(),icon:"MyFavorites.png",routeURL:"/wiki/mypage/favorites"}];this.appLinks=[{name:"_NavigationSidebar.Home".loc(),icon:"Home.png",routeURL:"/wiki"}];CC.meta("x-apple-config-DisableAllActivityView")!=
"true"&&this.appLinks.push({name:"_NavigationSidebar.All.Activity".loc(),icon:"AllActivity.png",routeURL:"/wiki/activity"});CC.meta("x-apple-config-DisableAllProjectsView")!="true"&&this.appLinks.push({name:"_NavigationSidebar.All.Wikis".loc(),icon:"AllWikis.png",routeURL:"/wiki/projects"});CC.meta("x-apple-config-DisableAllPeopleView")!="true"&&this.appLinks.push({name:"_NavigationSidebar.All.People".loc(),icon:"AllPeople.png",routeURL:"/wiki/people"});this._isLoggedIn=cachedUserPermissions.isLoggedIn;
this._recents=[];this.addPropertyObserver("recents",this,"recentsDidChange")},loadView:function(){this.callSuper();this.close=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_PLAIN);this.close.view.layer.setAttribute("aria-label","_Control.Close".loc());this.close.view.layer.setAttribute("name","_Control.Close".loc());this.close.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/sidebar_handle.png",true);this.close.width=WK.NavigationSidebarViewController.HANDLE_BUTTON_WIDTH;this.close.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);this.navigationItem.rightBarButtonItem=this.close;this.tableView=new WK.TableViewWithFilter;this.tableView.filterHeight=iAd.NavigationBar.DEFAULT_HEIGHT;this.tableView.tableStyle=iAd.TableView.STYLE_PLAIN;this.tableView.dataSource=this;this.tableView.delegate=this;this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.view=this.tableView;this.fetchRecentsFromServer()},fetchRecentsFromServer:function(){var a=Math.ceil((window.innerHeight-
6*iAd.NavigationBar.DEFAULT_HEIGHT-WK.NavigationSidebarUserCell.STYLE_DEFAULT_HEIGHT)/iAd.NavigationBar.DEFAULT_HEIGHT);a<0||server_proxy().recentDocumentsWithOptions(a,{subpropertyPaths:{"ownerGUID.type":"owner.type","ownerGUID.guid":"owner.guid","ownerGUID.longName":"owner.longName","ownerGUID.shortName":"owner.shortName"}},function(b){this.recents=b}.bind(this),function(){logger().error("Couldn't load recents from server")})},recentsDidChange:function(){this.tableView.reloadData()},normalizedSection:function(a){return a>=
2&&!this.isLoggedIn?a+1:a},extraClassNameForPath:function(a){return"wk-navigation-sidebar-"+(this.normalizedSection(a.section)%2==0?"dark":"normal")},numberOfSectionsInTableView:function(){return this.isLoggedIn?5:3},tableViewNumberOfRowsInSection:function(a,b){b=this.normalizedSection(b);if(b==0||b==1)return 1;if(b==2)return this.myProfileLinks.length;if(b==3)return this.appLinks.length;if(b==4)return this.recents.length},tableViewHeightForRowAtIndexPath:function(a,b){return b.section==1?WK.NavigationSidebarUserCell.STYLE_DEFAULT_HEIGHT:
iAd.TableView.DEFAULT_ROW_HEIGHT},tableViewTitleForHeaderInSection:function(a,b){b=this.normalizedSection(b);return b==4?"_NavigationSidebar.RecentlyViewed.Title".loc():null},tableViewCellForRowAtIndexPath:function(a,b){var c,d=this.normalizedSection(b.section);if(d==0){c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithButton")||new WK.TableViewCellWithButton;this.loginButton=this.loginButton||new iAd.BarButton;this.loginButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.loginButton.title=
this.isLoggedIn?"_Login.LogOut".loc():"_Login.LogIn".loc();if(this.isLoggedIn){this.loginButton.layer.setAttribute("aria-label","_Login.LogOut".loc());this.loginButton.layer.setAttribute("name","_Login.LogOut".loc())}else{this.loginButton.layer.setAttribute("aria-label","_Login.LogIn".loc());this.loginButton.layer.setAttribute("name","_Login.LogIn".loc())}this.loginButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);c.button=this.loginButton}else if(d==1){c=a.dequeueReusableCellWithIdentifier("WK.NavigationSidebarUserCell")||
new WK.NavigationSidebarUserCell;if(this.isLoggedIn){d=cachedCurrentUser;c.userGUID=d.guid;c.avatarGUID=d.avatarGUID;c.displayName=WK.FormatterUtilities.displayNameForEntity(d)}}else if(d==2||d==3){c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||new WK.TableViewCellWithImage(null);d=d==2?this.myProfileLinks[b.row]:this.appLinks[b.row];c.text=d.name;c.image=iAd.Image.imageForURL("/__collabd/coreclientbase/stylesheets/cc/img/navigation/"+d.icon,true)}else if(d==4){c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||
new WK.TableViewCellWithImage(null,iAd.TableViewCell.STYLE_SUBTITLE);d=this.recents[b.row];c.text=WK.FormatterUtilities.displayNameForEntity(d);c.detailedText=WK.FormatterUtilities.locationDescriptionForContainer(d.container);c.image=WK.FormatterUtilities.iconImageForEntity(d,true,32,32)}c.layer.classList.add(this.extraClassNameForPath(b));c.selectionStyle=iAd.TableViewCell.SELECTION_STYLE_NONE;c.separatorStyle=iAd.TableViewCell.SEPARATOR_STYLE_NONE;return c},tableViewDidSelectRowAtIndexPath:function(a,
b){a.deselectRowAtIndexPathAnimated(a.indexPathForSelectedRow(),true);var c=this.normalizedSection(b.section);if(!(c==0||c==1&&!this.isLoggedIn))if(c==1||c==2||c==3||c==4){c=c==1&&this.isLoggedIn?"/wiki/mypage":c==4?CC.entityURL(this.recents[b.row]):(c==2?this.myProfileLinks:this.appLinks)[b.row].routeURL;mainSplitViewController.hideSidebarAnimated(true);globalRouteHandler().routeURL(c)}},handleEvent:function(a){this.callSuper(a);a=a.ad.sender;if(a==this.close)mainSplitViewController.toggleSidebarAnimated(true);
else if(a==this.loginButton)if(this.isLoggedIn){dialogManager().showProgressMessage("_General.Loading".loc());authenticator().logout()}else window.location.href="/auth?send_token=no&redirect="+window.location}};iAd.Class({name:"iAd.PopoverView",superclass:iAd.View,cssClassName:"ad-popover-view",synthesizedProperties:["shineVisible"]});iAd.PopoverView.instanceCounter=0;iAd.PopoverView.ARROW_DIRECTION_UP=1;iAd.PopoverView.ARROW_DIRECTION_DOWN=2;iAd.PopoverView.ARROW_DIRECTION_LEFT=4;
iAd.PopoverView.ARROW_DIRECTION_RIGHT=8;iAd.PopoverView.PRESENTATION_MARGIN=10;iAd.PopoverView.CONTENT_INSET=8;iAd.PopoverView.ARROW_SIZE=18;iAd.PopoverView.prototype.init=function(a){if(!iAd.PopoverView.canvasSpriteImage)iAd.PopoverView.canvasSpriteImage=iAd.Image.imageForURL(iAd.Path.assetsPath+"popover~ipad.png",true);this._shineVisible=false;this.arrowDirection=null;this.callSuper(a)};
iAd.PopoverView.prototype.createLayer=function(){this.callSuper();this.hostView=this.addSubview(new iAd.View);this.hostView.layer.addClassName("ad-popover-hosting-layer");this.shine=this.layer.appendChild(document.createElement("div"));this.shine.className="ad-popover-shine";this.canvasContextId="ad-popover-background-"+ ++iAd.PopoverView.instanceCounter;this.layer.style.backgroundImage="-webkit-canvas("+this.canvasContextId+")"};
iAd.PopoverView.prototype.setShineVisible=function(a){this.shine.style.visibility=a?"visible":"hidden";this._shineVisible=a};iAd.PopoverView.prototype.canvasSpriteImageDidLoad=function(){iAd.PopoverView.canvasSpriteImage.removePropertyObserver("loaded",this,"canvasSpriteImageDidLoad");this.draw()};
iAd.PopoverView.prototype.sizeForContentSize=function(a,b){var c=new iAd.Size;if(b===iAd.PopoverView.ARROW_DIRECTION_UP||b===iAd.PopoverView.ARROW_DIRECTION_DOWN){c.width=a.width+2*iAd.PopoverView.CONTENT_INSET;c.height=a.height+iAd.PopoverView.ARROW_SIZE+2*iAd.PopoverView.CONTENT_INSET}else if(b===iAd.PopoverView.ARROW_DIRECTION_LEFT||b===iAd.PopoverView.ARROW_DIRECTION_RIGHT){c.width=a.width+iAd.PopoverView.ARROW_SIZE+2*iAd.PopoverView.CONTENT_INSET;c.height=a.height+2*iAd.PopoverView.CONTENT_INSET}return c};
iAd.PopoverView.prototype.updateHostViewFrameWithArrowDirection=function(a){var b=new iAd.Rect(0,0,this.size.width,this.size.height),c=new iAd.EdgeInsets(iAd.PopoverView.CONTENT_INSET+(a===iAd.PopoverView.ARROW_DIRECTION_UP?iAd.PopoverView.ARROW_SIZE:0)-1,iAd.PopoverView.CONTENT_INSET+(a===iAd.PopoverView.ARROW_DIRECTION_RIGHT?iAd.PopoverView.ARROW_SIZE:0),iAd.PopoverView.CONTENT_INSET+(a===iAd.PopoverView.ARROW_DIRECTION_DOWN?iAd.PopoverView.ARROW_SIZE:0),iAd.PopoverView.CONTENT_INSET+(a===iAd.PopoverView.ARROW_DIRECTION_LEFT?
iAd.PopoverView.ARROW_SIZE:0));b=b.inset(c);this.hostView.frame=b;this.shine.style.webkitTransform=iAd.CSS.t3d(0,b.size.height-39+(a===iAd.PopoverView.ARROW_DIRECTION_UP?iAd.PopoverView.ARROW_SIZE:0),0)};
iAd.PopoverView.prototype.applyBestFrame=function(a,b,c){var d=new iAd.Rect,e=new iAd.Point(b.midX(),b.midY()),f=this.sizeForContentSize(a,iAd.PopoverView.ARROW_DIRECTION_LEFT);a=this.sizeForContentSize(a,iAd.PopoverView.ARROW_DIRECTION_UP);d=Array(4);d[0]=c&iAd.PopoverView.ARROW_DIRECTION_UP?new iAd.Rect(e.x-Math.floor(a.width/2),b.origin.y+b.size.height,a.width,a.height):iAd.Rect.ZERO_RECT;d[1]=c&iAd.PopoverView.ARROW_DIRECTION_DOWN?new iAd.Rect(e.x-Math.floor(a.width/2),b.origin.y-a.height,a.width,
a.height):iAd.Rect.ZERO_RECT;d[2]=c&iAd.PopoverView.ARROW_DIRECTION_LEFT?new iAd.Rect(b.origin.x+b.size.width,e.y-Math.floor(f.height/2),f.width,f.height):iAd.Rect.ZERO_RECT;d[3]=c&iAd.PopoverView.ARROW_DIRECTION_RIGHT?new iAd.Rect(b.origin.x-f.width,e.y-Math.floor(f.height/2),f.width,f.height):iAd.Rect.ZERO_RECT;var g=new iAd.Rect(iAd.PopoverView.PRESENTATION_MARGIN,iAd.PopoverView.PRESENTATION_MARGIN,window.innerWidth-2*iAd.PopoverView.PRESENTATION_MARGIN,window.innerHeight-2*iAd.PopoverView.PRESENTATION_MARGIN),
i,h,j,k=0;c=0;a=f=iAd.Rect.ZERO_RECT;for(var l=0;l<4;l++){h=g.copy();switch(1<<l){case iAd.PopoverView.ARROW_DIRECTION_UP:h.size.height-=b.maxY()-h.origin.y;h.origin.y=b.maxY();break;case iAd.PopoverView.ARROW_DIRECTION_DOWN:h.size.height=b.origin.y-h.origin.y;h=h.intersectionWithRect(g);break;case iAd.PopoverView.ARROW_DIRECTION_LEFT:h.size.width-=b.maxX()-h.origin.x;h.origin.x=b.maxX();break;case iAd.PopoverView.ARROW_DIRECTION_RIGHT:h.size.width=b.origin.x-h.origin.x}i=d[l].intersectionWithRect(h);
j=i.size.width*i.size.height;if(j>k){k=j;c=l;f=i;a=h}}d=d[c];if(f.origin.x>d.origin.x)d.origin.x=f.origin.x;else d.origin.x-=d.size.width-f.size.width;if(f.origin.y>d.origin.y)d.origin.y=f.origin.y;else d.origin.y-=d.size.height-f.size.height;this.frame=d=d.intersectionWithRect(a);this.arrowDirection=1<<c;this.drawWithArrowPositionAndDirection(e,this.arrowDirection);this.updateHostViewFrameWithArrowDirection(this.arrowDirection)};
iAd.PopoverView.prototype.drawWithArrowPositionAndDirection=function(a,b){this.desiredArrowPosition=a;this.arrowDirection=b;iAd.PopoverView.canvasSpriteImage.loaded?this.draw():iAd.PopoverView.canvasSpriteImage.addPropertyObserver("loaded",this,"canvasSpriteImageDidLoad")};
iAd.PopoverView.prototype.draw=function(){var a=this.desiredArrowPosition.x-this.position.x,b=this.desiredArrowPosition.y-this.position.y,c=this.scaleFactor=iAd.Device.HAS_HIDPI_DISPLAY?2:1,d=this.size.width,e=this.size.height,f=iAd.PopoverView.canvasSpriteImage.element,g=this.context=document.getCSSCanvasContext("2d",this.canvasContextId,d*c,e*c);this.setLayerStyle({"background-size":d+"px "+e+"px"});g.clearRect(0,0,d*c,e*c);if(this.arrowDirection===iAd.PopoverView.ARROW_DIRECTION_UP)if(a<29)this.drawCanvasBackgroundForUpArrowAtLeft(g,
f,d,e);else a>this.size.width-29?this.drawCanvasBackgroundForUpArrowAtRight(g,f,d,e):this.drawCanvasBackgroundForUpArrow(g,f,d,e,a);else if(this.arrowDirection===iAd.PopoverView.ARROW_DIRECTION_DOWN)if(a<29)this.drawCanvasBackgroundForDownArrowAtLeft(g,f,d,e);else a>this.size.width-29?this.drawCanvasBackgroundForDownArrowAtRight(g,f,d,e):this.drawCanvasBackgroundForDownArrow(g,f,d,e,a);else if(this.arrowDirection===iAd.PopoverView.ARROW_DIRECTION_RIGHT)if(b<43)this.drawCanvasBackgroundForRightArrowAtTop(g,
f,d,e);else b>this.size.height-29?this.drawCanvasBackgroundForRightArrowAtBottom(g,f,d,e):this.drawCanvasBackgroundForRightArrow(g,f,d,e,b);else if(this.arrowDirection===iAd.PopoverView.ARROW_DIRECTION_LEFT)if(b<43)this.drawCanvasBackgroundForLeftArrowAtTop(g,f,d,e);else b>this.size.height-29?this.drawCanvasBackgroundForLeftArrowAtBottom(g,f,d,e):this.drawCanvasBackgroundForLeftArrow(g,f,d,e,b)};
iAd.PopoverView.prototype.drawImage=function(a,b,c,d,e,f,g,i,h){var j=this.scaleFactor;this.context.drawImage(a,b*j,c*j,d*j,e*j,f*j,g*j,i*j,h*j)};iAd.PopoverView.prototype.drawCanvasBackgroundFlippedHorizontally=function(a,b,c,d,e,f){var g=this.scaleFactor;b.scale(-1,1);b.translate(-d*g,0);this[a](b,c,d,e,f);b.scale(-1,1);b.translate(-d*g,0)};
iAd.PopoverView.prototype.drawCanvasBackgroundForUpArrowAtLeft=function(a,b,c,d){this.drawCanvasBackgroundFlippedHorizontally("drawCanvasBackgroundForUpArrowAtRight",a,b,c,d)};
iAd.PopoverView.prototype.drawCanvasBackgroundForUpArrowAtRight=function(a,b,c,d){this.drawImage(b,283,0,10,41,0,0,10,41);this.drawImage(b,293,0,1,41,10,0,c-52,41);this.drawImage(b,294,0,42,41,c-42,0,42,41);this.drawImage(b,283,41,10,1,0,41,10,d-51);this.drawImage(b,293,41,1,1,10,41,c-20,d-51);this.drawImage(b,326,41,10,1,c-10,41,10,d-51);this.drawImage(b,283,42,10,10,0,d-10,10,10);this.drawImage(b,293,42,1,10,10,d-10,c-20,10);this.drawImage(b,326,42,10,10,c-10,d-10,10,10)};
iAd.PopoverView.prototype.drawCanvasBackgroundForUpArrow=function(a,b,c,d,e){a=Math.round(e-17.5);this.drawImage(b,226,0,10,41,0,0,10,41);this.drawImage(b,236,0,1,41,10,0,a-10,41);this.drawImage(b,237,0,35,41,a,0,35,41);this.drawImage(b,272,0,1,41,a+35,0,c-10-a-35,41);this.drawImage(b,273,0,10,41,c-10,0,10,41);this.drawImage(b,226,41,10,1,0,41,10,d-51);this.drawImage(b,236,41,1,1,10,41,c-20,d-51);this.drawImage(b,273,41,10,1,c-10,41,10,d-51);this.drawImage(b,226,42,10,10,0,d-10,10,10);this.drawImage(b,
236,42,1,10,10,d-10,c-20,10);this.drawImage(b,273,42,10,10,c-10,d-10,10,10)};iAd.PopoverView.prototype.drawCanvasBackgroundForDownArrowAtLeft=function(a,b,c,d){this.drawCanvasBackgroundFlippedHorizontally("drawCanvasBackgroundForDownArrowAtRight",a,b,c,d)};
iAd.PopoverView.prototype.drawCanvasBackgroundForDownArrowAtRight=function(a,b,c,d){this.drawImage(b,58,0,10,24,0,0,10,24);this.drawImage(b,68,0,1,24,10,0,c-20,24);this.drawImage(b,102,0,10,24,c-10,0,10,24);this.drawImage(b,58,24,10,1,0,24,10,d-51);this.drawImage(b,68,24,1,1,10,24,c-20,d-51);this.drawImage(b,102,24,10,1,c-10,24,10,d-51);this.drawImage(b,58,25,10,27,0,d-27,10,27);this.drawImage(b,68,25,1,27,10,d-27,c-53,27);this.drawImage(b,69,25,43,27,c-43,d-27,43,27)};
iAd.PopoverView.prototype.drawCanvasBackgroundForDownArrow=function(a,b,c,d,e){a=Math.round(e-17.5);this.drawImage(b,0,0,10,24,0,0,10,24);this.drawImage(b,10,0,1,24,10,0,c-20,24);this.drawImage(b,48,0,10,24,c-10,0,10,24);this.drawImage(b,0,24,10,1,0,24,10,d-51);this.drawImage(b,10,24,1,1,10,24,c-20,d-51);this.drawImage(b,48,24,10,1,c-10,24,10,d-51);this.drawImage(b,0,25,10,27,0,d-27,10,27);this.drawImage(b,10,25,1,27,10,d-27,a-10,27);this.drawImage(b,11,25,37,27,a,d-27,37,27);this.drawImage(b,10,
25,1,27,a+37,d-27,c-10-a-37,27);this.drawImage(b,48,25,10,27,c-10,d-27,10,27)};
iAd.PopoverView.prototype.drawCanvasBackgroundForRightArrowAtTop=function(a,b,c,d){this.drawImage(b,188,0,10,43,0,0,10,43);this.drawImage(b,198,0,1,43,10,0,c-37,43);this.drawImage(b,199,0,27,43,c-27,0,27,43);this.drawImage(b,188,43,10,1,0,43,10,d-52);this.drawImage(b,198,43,1,1,10,43,c-37,d-52);this.drawImage(b,199,43,10,1,c-27,43,10,d-52);this.drawImage(b,188,44,10,9,0,d-9,10,9);this.drawImage(b,198,44,1,9,10,d-9,c-37,9);this.drawImage(b,199,44,27,9,c-27,d-9,27,9)};
iAd.PopoverView.prototype.drawCanvasBackgroundForRightArrowAtBottom=function(a,b,c,d){this.drawImage(b,150,0,10,24,0,0,10,24);this.drawImage(b,160,0,1,24,10,0,c-37,24);this.drawImage(b,161,0,27,24,c-27,0,27,24);this.drawImage(b,150,24,10,1,0,24,10,d-67);this.drawImage(b,160,24,1,1,10,24,c-37,d-67);this.drawImage(b,161,24,10,1,c-27,24,10,d-67);this.drawImage(b,150,25,10,43,0,d-43,10,43);this.drawImage(b,160,25,1,43,10,d-43,c-37,43);this.drawImage(b,161,25,27,43,c-27,d-43,27,43)};
iAd.PopoverView.prototype.drawCanvasBackgroundForRightArrow=function(a,b,c,d,e){a=Math.round(e-18.5);this.drawImage(b,112,0,10,24,0,0,10,24);this.drawImage(b,112,24,10,1,0,24,10,d-33);this.drawImage(b,112,63,10,9,0,d-9,10,9);this.drawImage(b,122,0,1,24,10,0,c-37,24);this.drawImage(b,122,24,1,1,10,24,c-37,d-33);this.drawImage(b,122,63,1,9,10,d-9,c-37,9);this.drawImage(b,123,0,27,24,c-27,0,27,24);this.drawImage(b,123,24,27,1,c-27,24,27,a-24);this.drawImage(b,123,25,27,37,c-27,a,27,37);this.drawImage(b,
123,62,27,1,c-27,a+37,27,d-a-46);this.drawImage(b,123,63,27,9,c-27,d-9,27,9)};iAd.PopoverView.prototype.drawCanvasBackgroundForLeftArrowAtTop=function(a,b,c,d){this.drawCanvasBackgroundFlippedHorizontally("drawCanvasBackgroundForRightArrowAtTop",a,b,c,d)};iAd.PopoverView.prototype.drawCanvasBackgroundForLeftArrowAtBottom=function(a,b,c,d){this.drawCanvasBackgroundFlippedHorizontally("drawCanvasBackgroundForRightArrowAtBottom",a,b,c,d)};
iAd.PopoverView.prototype.drawCanvasBackgroundForLeftArrow=function(a,b,c,d,e){this.drawCanvasBackgroundFlippedHorizontally("drawCanvasBackgroundForRightArrow",a,b,c,d,e)};iAd.Class({name:"iAd.PopoverController",superclass:iAd.Object,synthesizedProperties:["contentViewController","popoverContentSize"],archivedProperties:["contentViewController","popoverContentSize"]});iAd.PopoverController.CONTENT_VIEW_CSS="ad-popover-content-view";iAd.PopoverController.CONTENT_IS_NAVIGATION_CSS="ad-displays-navigation-controller";
iAd.PopoverController.ARROW_DIRECTION_UP=iAd.PopoverView.ARROW_DIRECTION_UP;iAd.PopoverController.ARROW_DIRECTION_DOWN=iAd.PopoverView.ARROW_DIRECTION_DOWN;iAd.PopoverController.ARROW_DIRECTION_LEFT=iAd.PopoverView.ARROW_DIRECTION_LEFT;iAd.PopoverController.ARROW_DIRECTION_RIGHT=iAd.PopoverView.ARROW_DIRECTION_RIGHT;iAd.PopoverController.ARROW_DIRECTION_UNKNOWN=Number.MAX_VALUE;
iAd.PopoverController.ARROW_DIRECTION_ANY=iAd.PopoverController.ARROW_DIRECTION_UP|iAd.PopoverController.ARROW_DIRECTION_DOWN|iAd.PopoverController.ARROW_DIRECTION_LEFT|iAd.PopoverController.ARROW_DIRECTION_RIGHT;iAd.PopoverController.ANIMATION_DURATION=0.35;iAd.PopoverController.SHOULD_DISMISS_POPOVER_DELEGATE="popoverControllerShouldDismissPopover";iAd.PopoverController.DID_DISMISS_POPOVER_DELEGATE="popoverControllerDidDismissPopover";
iAd.PopoverController.prototype.init=function(a){this.callSuper();this._contentViewController=null;this._popoverContentSize=new iAd.Size;this.popoverVisible=false;this.popoverArrowDirection=iAd.PopoverController.ARROW_DIRECTION_UNKNOWN;this.passthroughViews=[];this.delegate=null;this.popoverPresentingOrDismissing=this.hostingNavigationController=false;this.dismissingTouchIdentifier=null;this.firstTouchWillNotDismiss=false;this.barButtonItemPopoverWasPresentedFrom=null;this.view=new iAd.PopoverView;
this.contentViewController=a};iAd.PopoverController.restoreFromArchive=function(a){return new this(a.contentViewController)};
iAd.PopoverController.prototype.setContentViewController=function(a){if(this._contentViewController!==a)if(a==null)iAd.Console.error("A PopoverController should have a non-null contentViewController");else{if(this._contentViewController!=null){this._contentViewController.view.layer.removeClassName(iAd.PopoverController.CONTENT_VIEW_CSS);this._contentViewController.parentViewController=null;if(this.hostingNavigationController){this._contentViewController.removePropertyObserver("toolbarHidden",this,
"navigationControllerToolbarVisibilityChanged");this._contentViewController.navigationBar.isInPopover=false;this._contentViewController.toolbar.isInPopover=false}this._contentViewController.removePropertyObserver("contentSizeForViewInPopover",this)}a.parentViewController=this;this._contentViewController=a;this.hostingNavigationController=a instanceof iAd.NavigationController;this.view.layer.iad_toggleClassName(iAd.PopoverController.CONTENT_IS_NAVIGATION_CSS,this.hostingNavigationController);(this.hostingNavigationController?
a.backingTransitionController:a).view.layer.addClassName(iAd.PopoverController.CONTENT_VIEW_CSS);for(var b=this.view.hostView;b.subviews.length;)b.subviews[0].removeFromSuperview();var c=b.addSubview(a.view);c.position=new iAd.Point;c.size=b.size.copy();c.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;if(this.hostingNavigationController){a.navigationBar.isInPopover=true;a.toolbar.isInPopover=true;a.addPropertyObserver("toolbarHidden",this,"navigationControllerToolbarVisibilityChanged");
this.navigationControllerToolbarVisibilityChanged()}this.popoverContentSize=a.contentSizeForViewInPopover.copy();a.addPropertyObserver("contentSizeForViewInPopover",this,"contentSizeForViewInPopoverChanged")}};iAd.PopoverController.prototype.contentSizeForViewInPopoverChanged=function(a){this.popoverContentSize=a.contentSizeForViewInPopover.copy()};iAd.PopoverController.prototype.setPopoverContentSize=function(a){this.setPopoverContentSizeAnimated(a,true)};
iAd.PopoverController.prototype.setPopoverContentSizeAnimated=function(a){a.width=iAd.Number.clampValue(a.width,320,600);this._popoverContentSize=a;this.popoverVisible&&this.view.applyBestFrame(a,this.targetRect,this.arrowDirections)};iAd.PopoverController.prototype.navigationControllerToolbarVisibilityChanged=function(){this.view.shineVisible=!this._contentViewController.toolbarHidden};
iAd.PopoverController.prototype.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated=function(a,b,c,d){if(b.layerIsInDocument){var e=iAd.RootView.sharedRoot;b=window.webkitConvertPointFromNodeToPage(b.layer,new WebKitPoint(0,0));a=new iAd.Rect(a.origin.x+b.x,a.origin.y+b.y,a.size.width,a.size.height);this.view.applyBestFrame(this.popoverContentSize,a,c);this.targetRect=a;this.arrowDirections=c;window.addEventListener(iAd.Event.START_EVENT,this,true);if(!this.popoverVisible||this.popoverPresentingOrDismissing){if(this.transition)this.transition.delegate=
null;this._contentViewController!=null&&this._contentViewController.viewWillAppear(d);this.transition=this.view.applyTransition({properties:["opacity"],from:[0],to:[1],duration:d?iAd.PopoverController.ANIMATION_DURATION:0,delegate:this,_type:iAd.PopoverController.PRESENT_TRANSITION_TYPE});d||this.didPresentPopover(false)}e.addSubview(this.view);this.popoverArrowDirection=this.view.arrowDirection}};
iAd.PopoverController.prototype.presentPopoverFromBarButtonItemPermittedArrowDirectionsAnimated=function(a,b,c){var d=a.view;if(d!=null){this.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(d.frame,d.superview,b,c);this.barButtonItemPopoverWasPresentedFrom=a}};
iAd.PopoverController.prototype.dismissPopoverAnimated=function(a){window.removeEventListener(iAd.Event.START_EVENT,this,true);window.removeEventListener(iAd.Event.END_EVENT,this,true);window.removeEventListener(iAd.Event.CANCEL_EVENT,this,true);this.dismissingTouchIdentifier=null;this.firstTouchWillNotDismiss=false;this.barButtonItemPopoverWasPresentedFrom=null;this._contentViewController!=null&&this._contentViewController.viewWillDisappear(a);if(this.transition)this.transition.delegate=null;this.popoverPresentingOrDismissing=
true;this.transition=this.view.applyTransition({properties:["opacity"],from:[1],to:[0],duration:a?iAd.PopoverController.ANIMATION_DURATION:0,removesTargetUponCompletion:false,delegate:this,_type:iAd.PopoverController.DISMISS_TRANSITION_TYPE});if(!a){this.view.removeFromSuperview();this.didDismissPopover(false)}};iAd.PopoverController.PRESENT_TRANSITION_TYPE="present";iAd.PopoverController.DISMISS_TRANSITION_TYPE="dismiss";
iAd.PopoverController.prototype.transitionDidComplete=function(a){this.popoverPresentingOrDismissing=false;this.transition=null;if(a._type==iAd.PopoverController.PRESENT_TRANSITION_TYPE)this.didPresentPopover(true);else a._type==iAd.PopoverController.DISMISS_TRANSITION_TYPE&&this.didDismissPopover(true)};iAd.PopoverController.prototype.didPresentPopover=function(a){this.popoverVisible=true;this._contentViewController!=null&&this._contentViewController.viewDidAppear(a)};
iAd.PopoverController.prototype.didDismissPopover=function(a){this.popoverVisible=false;this.popoverArrowDirection=iAd.PopoverController.ARROW_DIRECTION_UNKNOWN;iAd.Utils.objectHasMethod(this.delegate,iAd.PopoverController.DID_DISMISS_POPOVER_DELEGATE)&&this.delegate[iAd.PopoverController.DID_DISMISS_POPOVER_DELEGATE](this);this.view.removeFromSuperview();this._contentViewController!=null&&this._contentViewController.viewDidDisappear(a)};
iAd.PopoverController.prototype.handleEvent=function(a){switch(a.type){case iAd.Event.START_EVENT:this.touchesBeganInWindow(a);break;case iAd.Event.END_EVENT:case iAd.Event.CANCEL_EVENT:this.touchesEndedInWindow(a);break;default:this.callSuper(a)}};
iAd.PopoverController.prototype.touchesBeganInWindow=function(a){if(!a._synthetic){window.addEventListener(iAd.Event.END_EVENT,this,true);window.addEventListener(iAd.Event.CANCEL_EVENT,this,true);var b=iAd.Event.SUPPORTS_TOUCHES?a.changedTouches[0]:a;if(this.isTouchTargetInPassthroughView(b.target)){if(this.dismissingTouchIdentifier==null)this.firstTouchWillNotDismiss=true}else{if(this.dismissingTouchIdentifier==null)this.dismissingTouchIdentifier=b.identifier||1;a.stopPropagation()}}};
iAd.PopoverController.prototype.isTouchTargetInPassthroughView=function(a){var b=[this.view];if(this._contentViewController==null||!this._contentViewController.modalInPopover){this.barButtonItemPopoverWasPresentedFrom!=null&&b.push(this.barButtonItemPopoverWasPresentedFrom.view.superview);b=b.concat(this.passthroughViews)}for(var c=0,d=b.length;c<d;c++)if(b[c].layer.contains(a))return true;return false};
iAd.PopoverController.prototype.touchesEndedInWindow=function(a){if(!a._synthetic){if(iAd.Event.SUPPORTS_TOUCHES){if(!this.firstTouchWillNotDismiss&&this.dismissingTouchIdentifier!=null){for(var b=false,c=a.changedTouches,d=0,e=c.length;d<e;d++)if(c[d].identifier===this.dismissingTouchIdentifier){b=true;break}if(!b)return}if(this.firstTouchWillNotDismiss&&a.touches.length==0){this.firstTouchWillNotDismiss=false;this.dismissingTouchIdentifier=null;return}}else if(this.firstTouchWillNotDismiss){this.dismissingTouchIdentifier=
null;this.firstTouchWillNotDismiss=false;return}a.stopPropagation();a=this._contentViewController!=null&&this._contentViewController.modalInPopover;if((a=!this.firstTouchWillNotDismiss&&!a)&&iAd.Utils.objectHasMethod(this.delegate,iAd.PopoverController.SHOULD_DISMISS_POPOVER_DELEGATE))a=this.delegate[iAd.PopoverController.SHOULD_DISMISS_POPOVER_DELEGATE](this);a&&this.dismissPopoverAnimated(true)}};iAd.Class({name:"WK.MultipleBarButtonItem",superclass:iAd.BarButtonItem});
WK.MultipleBarButtonItem.SPACE_BETWEEN_BUTTONS=15;WK.MultipleBarButtonItem.WIDTH_FOR_IMAGE_BUTTONS=44;WK.MultipleBarButtonItem.DIVIDER="WK.MultipleBarButtonItem.DIVIDER";
WK.MultipleBarButtonItem.prototype={init:function(a,b){this.callSuper(iAd.BarButtonItem.TYPE_PLAIN);var c=new iAd.View,d=b=="left",e=d?-iAd.NavigationItem.LEFT_BUTTON_LEFT_MARGIN:0;a.forEach(function(f){var g=0,i=Math.floor((iAd.NavigationBar.DEFAULT_HEIGHT-iAd.BarButton.DEFAULT_HEIGHT)/2);e+=WK.MultipleBarButtonItem.SPACE_BETWEEN_BUTTONS;if(f==WK.MultipleBarButtonItem.DIVIDER){f=new iAd.View;f.layer.classList.add("wk-toolbar-divider");g=3;i=0;f.size=new iAd.Size(g,iAd.NavigationBar.DEFAULT_HEIGHT);
f=f}else if(f.image)g=f.width=WK.MultipleBarButtonItem.WIDTH_FOR_IMAGE_BUTTONS;else if(f.title)g=f.size.width;f.position=new iAd.Point(e,i);e+=g;c.addSubview(f)});d||(e+=WK.MultipleBarButtonItem.SPACE_BETWEEN_BUTTONS-iAd.NavigationItem.RIGHT_BUTTON_RIGHT_MARGIN);c.size=new iAd.Size(e,iAd.NavigationBar.DEFAULT_HEIGHT);this.customView=c}};iAd.Class({name:"WK.ListOfOptionsViewController",superclass:iAd.ViewController});
WK.ListOfOptionsViewController.prototype={init:function(a){this.callSuper(null);this.options=a||[];this.delegate=null},loadView:function(){this.callSuper();var a=new iAd.TableView;a.tableStyle=iAd.TableView.STYLE_PLAIN;a.dataSource=this;a.delegate=this;this.view=a},tableViewNumberOfRowsInSection:function(){return this.options.length},tableViewCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCell()||new iAd.TableViewCell;c.text=this.options[b.row];return c},tableViewDidSelectRowAtIndexPath:function(a,
b){a.deselectRowAtIndexPathAnimated(b,true);this.delegate&&this.delegate.listOfOptionsDidChooseMenuIndex&&this.delegate.listOfOptionsDidChooseMenuIndex(b.row);a.reloadData()}};
iAd.Class({name:"iAd.SearchBar",superclass:iAd.View,mixins:[iAd.EventTriage],synthesizedProperties:["barStyle","placeholder","text","showsCancelButton","editing","showsBookmarkButton"],archivedProperties:["barStyle","placeholder","text","showsCancelButton","editing","showsBookmarkButton"],excludedProperties:["subviews"],cssClassName:"ad-search-bar",collectionAccessor:"searchBars"});iAd.SearchBar.DEFAULT_HEIGHT=44;iAd.SearchBar.STYLE_DEFAULT="ad-default";iAd.SearchBar.STYLE_BLACK="ad-black";
iAd.SearchBar.STYLE_BLACK_TRANSLUCENT="ad-black-translucent";iAd.SearchBar.TEXT_DID_CHANGE="searchBarTextDidChange";iAd.SearchBar.TEXT_DID_BEGIN_EDITING="searchBarTextDidBeginEditing";iAd.SearchBar.TEXT_DID_END_EDITING="searchBarTextDidEndEditing";iAd.SearchBar.CANCEL_BUTTON_CLICKED="searchBarCancelButtonClicked";iAd.SearchBar.BOOKMARK_BUTTON_CLICKED="searchBarBookmarkButtonClicked";iAd.SearchBar.SHOWS_CANCEL_BUTTON_CSS="ad-shows-cancel-button";iAd.SearchBar.DISPLAYS_PLACEHOLDER="ad-displays-placeholder";
iAd.SearchBar.SHOWS_BOOKMARK_BUTTON_CSS="ad-shows-bookmark-button";
iAd.SearchBar.prototype.init=function(a){this.delegate=null;this._barStyle=iAd.SearchBar.STYLE_DEFAULT;this._text=this._placeholder="";this.hasBeenExplicitelySized=this._showsBookmarkButton=this._editing=this._showsCancelButton=false;this.callSuper(a);this.field.addEventListener("focus",this,false);this.field.addEventListener("blur",this,false);this.field.addEventListener("input",this,false);this.field.parentNode.addEventListener("submit",this,false);this.button.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);this.emptyButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.button.view.addPropertyObserver("size",this,"updateLayout");this.autoresizesSubviews=false;this.checkForPlaceholderDisplay()};iAd.SearchBar.prototype.setupLayer=function(){this.callSuper();if(this.layer.hasClassName(iAd.SearchBar.STYLE_BLACK))this._barStyle=iAd.SearchBar.STYLE_BLACK;else if(this.layer.hasClassName(iAd.SearchBar.STYLE_BLACK_TRANSLUCENT))this._barStyle=iAd.SearchBar.STYLE_BLACK_TRANSLUCENT};
iAd.SearchBar.prototype.layerWasCreated=function(){this.callSuper();var a=this.layer.appendChild(document.createElement("form"));this.label=a.appendChild(document.createElement("div"));this.field=a.appendChild(document.createElement("input"));this.field.type="text";this.button=new iAd.BarButtonItem;this.button.view.layer.setAttribute("aria-label","_Control.Cancel".loc());this.button.view.layer.setAttribute("name","_Control.Cancel".loc());this.button.title="Cancel";this.addSubview(this.button.view);
this.emptyButton=this.addSubview(new iAd.Button(null,iAd.Button.TYPE_CUSTOM))};iAd.SearchBar.prototype.setSize=function(a){a.height=iAd.SearchBar.DEFAULT_HEIGHT;this.callSuper(a);this.hasBeenExplicitelySized=true;this.updateLayout()};iAd.SearchBar.prototype.updateLayout=function(){var a=this.showsCancelButton?this.button.view.size.width+5:0;this.field.parentNode.style.right=a+5+"px";this.emptyButton.layer.style.right=a+10+"px"};
iAd.SearchBar.prototype.didMoveToSuperview=function(){this.callSuper();if(!(this.hasBeenExplicitelySized||this.superview==null||this.usesDeclarativeBacking)){this.size=new iAd.Size(this.superview.size.width,iAd.SearchBar.DEFAULT_HEIGHT);this.hasBeenExplicitelySized=false}};iAd.SearchBar.prototype.setBarStyle=function(a){this.layer.removeClassName(this._barStyle);this.layer.addClassName(a);this._barStyle=a};iAd.SearchBar.prototype.setPlaceholder=function(a){this._placeholder=a;this.checkForPlaceholderDisplay()};
iAd.SearchBar.prototype.getText=function(){return this.field.value};iAd.SearchBar.prototype.setText=function(a){this.label.textContent=a;this.field.value=a;this.dispatchNotification(iAd.SearchBar.TEXT_DID_CHANGE,this.delegate,[["searchText",a]]);this.checkForPlaceholderDisplay()};iAd.SearchBar.prototype.setShowsCancelButton=function(a){if(this._showsCancelButton!=a){this.layer.iad_toggleClassName(iAd.SearchBar.SHOWS_CANCEL_BUTTON_CSS,a);this._showsCancelButton=a;this.updateLayout()}};
iAd.SearchBar.prototype.setShowsBookmarkButton=function(a){if(this._showsBookmarkButton!=a){this._showsBookmarkButton=a;this.checkForPlaceholderDisplay()}};iAd.SearchBar.prototype.checkForPlaceholderDisplay=function(){var a=this.text=="";this.layer.iad_toggleClassName(iAd.SearchBar.DISPLAYS_PLACEHOLDER,a);a&&this._showsBookmarkButton&&this.layer.iad_toggleClassName(iAd.SearchBar.SHOWS_BOOKMARK_BUTTON_CSS,this.text=="");if(a)this.label.textContent=this._placeholder};
iAd.SearchBar.prototype.setEditing=function(a){this._editing=a;this.field[a?"focus":"blur"]()};iAd.SearchBar.prototype.isInBar=function(){var a=this.superview;if(iAd.Device.IS_IPAD&&(iAd.NavigationBar!=null&&a instanceof iAd.NavigationBar||iAd.Toolbar!=null&&a instanceof iAd.Toolbar))return true;return false};iAd.SearchBar.prototype.handleFocus=function(){this.dispatchNotification(iAd.SearchBar.TEXT_DID_BEGIN_EDITING,this.delegate);this.editing=true};
iAd.SearchBar.prototype.handleBlur=function(){this.dispatchNotification(iAd.SearchBar.TEXT_DID_END_EDITING,this.delegate);this.label.textContent=this.field.value;this.checkForPlaceholderDisplay();this.editing=false};iAd.SearchBar.prototype.handleInput=function(){this.checkForPlaceholderDisplay();this.dispatchNotification(iAd.SearchBar.TEXT_DID_CHANGE,this.delegate,[["searchText",this.field.value]])};iAd.SearchBar.prototype.handleSubmit=function(a){a.preventDefault();this.editing=false};
iAd.SearchBar.prototype.handleViewTouchUpInside=function(a){if(a.ad.sender===this.emptyButton)if(this.text=="")this.dispatchNotification(iAd.SearchBar.BOOKMARK_BUTTON_CLICKED,this.delegate);else{this.text="";this.checkForPlaceholderDisplay()}else this.dispatchNotification(iAd.SearchBar.CANCEL_BUTTON_CLICKED,this.delegate)};iAd.Class({name:"WK.SearchPopupViewController",synthesizedProperties:["savedSearches"],superclass:iAd.ViewController});
WK.SearchPopupViewController.prototype={init:function(a){this.callSuper(null);this.contentSizeForViewInPopover=new iAd.Size(320,400);this._savedSearches=[];a&&this.getSavedSearchesForAuthenticatedUserFromServer()},loadView:function(){this.callSuper();var a=new iAd.View;this.searchBar=new iAd.SearchBar;this.searchBar.placeholder="_Search".loc();this.searchBar.position=new iAd.Point(0,0);this.searchBar.delegate=this;this.searchBar.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;a.addSubview(this.searchBar);
this.tableView=new iAd.TableView;this.tableView.tableStyle=iAd.TableView.STYLE_PLAIN;this.tableView.dataSource=this;this.tableView.delegate=this;this.tableView.position=new iAd.Point(0,this.searchBar.size.height);this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;a.addSubview(this.tableView);this.view=a},getSavedSearchesForAuthenticatedUserFromServer:function(){var a=function(b){this.savedSearches=b||[];this.tableView.reloadData()}.bind(this);
server_proxy().savedSearchesForCurrentUser(a,a)},searchBarTextDidEndEditing:function(a){a=a.text||"";globalRecentSearches().addSearchToStack(a);this.tableView.reloadData();this.initiateSearchWithQueryTerm(a)},tableViewDidSelectRowAtIndexPath:function(a,b){b.section==0?this.initiateSearchWithQueryTerm(globalRecentSearches().searchStack()[b.row]):this.initiateSearchWithQuery(this.savedSearches[b.row].entity.query);this.tableView.deselectRowAtIndexPathAnimated(this.tableView.indexPathForSelectedRow(),
true)},initiateSearchWithQueryTerm:function(a){globalRouteHandler().routeURL("/wiki/find/?keyword=%@".fmt(a));this.popover.dismissPopoverAnimated(true)},initiateSearchWithQuery:function(a){globalRouteHandler().routeURL("/wiki%@".fmt(CC.Search.queryToURL(a)));this.popover.dismissPopoverAnimated(true)},numberOfSectionsInTableView:function(){var a=0;if(globalRecentSearches().searchStack().length)a=1;if(this.savedSearches.length)a=2;return a},tableViewNumberOfRowsInSection:function(a,b){if(b==0)return globalRecentSearches().searchStack().length;
return this.savedSearches.length},tableViewTitleForHeaderInSection:function(a,b){return b==0?"_Search.Recents".loc():"_Search.Saved".loc()},tableViewCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCellWithIdentifier("iAd.TableViewCell")||new iAd.TableViewCell;c.text=b.section==0?globalRecentSearches().searchStack()[b.row]:WK.FormatterUtilities.displayNameForEntity(this.savedSearches[b.row].entity);return c}};
iAd.Class({name:"WK.NewWikiAssistantDialog",superclass:WK.Dialog,synthesizedProperties:["assistantViewControllers","selectedIndex"]});
WK.NewWikiAssistantDialog.prototype={init:function(){this.callSuper(true);this.assistantViewControllers=[new WK.SettingsWikiGeneralPanel(null,null),new WK.SettingsPermissionsPanel(null,true),new WK.SettingsAppearancePanel(null,true),new WK.NewWikiDonePanel];this._selectedIndex=-1},getContentView:function(){if(!this._contentView){this.navigation=new iAd.NavigationController;this.navigation.parentViewController=this;this.showNextPane();this._contentView=this.navigation.view;this._contentView.size=new iAd.Size(WK.SettingsPanel.WIDTH,
window.innerHeight-300);this.navigation.view.layer.classList.add("wk-new-wiki-assistant")}return this._contentView},showNextPane:function(){var a=this.selectedIndex+1,b=this.assistantViewControllers[a];if(a<3){this.cancelButton=new iAd.BarButtonItem;this.cancelButton.view.layer.setAttribute("aria-label","_Control.Cancel".loc());this.cancelButton.view.layer.setAttribute("name","_Control.Cancel".loc());this.cancelButton.title="_Control.Cancel".loc();this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);b.navigationItem.leftBarButtonItem=this.cancelButton;a=a==2;this.nextButton=new iAd.BarButtonItem;this.nextButton.title=a?"_WikiSetupAssistant.Create".loc():"_WikiSetupAssistant.Next".loc();if(a){this.nextButton.view.layer.setAttribute("aria-label","_WikiSetupAssistant.Create".loc());this.nextButton.view.layer.setAttribute("name","_WikiSetupAssistant.Create".loc())}else{this.nextButton.view.layer.setAttribute("aria-label","_WikiSetupAssistant.Next".loc());this.nextButton.view.layer.setAttribute("name",
"_WikiSetupAssistant.Next".loc())}this.nextButton.style=a?iAd.BarButtonItem.STYLE_DONE:iAd.BarButtonItem.STYLE_DEFAULT;this.nextButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.nextButton.enabled=b.isPanelReady;this.updateIsEnable(this.nextButton.enabled);b.addPropertyObserver("isPanelReady",this,"panelReadyDidChange");b.navigationItem.rightBarButtonItem=this.nextButton}else b.navigationItem.hidesBackButton=true;this.navigation.pushViewControllerAnimated(b,true);this.selectedIndex+=
1},panelReadyDidChange:function(){this.nextButton.enabled=this.assistantViewControllers[this.selectedIndex].isPanelReady;this.updateIsEnable(this.nextButton.enabled)},updateIsEnable:function(a){this.nextButton._enabled=a;this.nextButton._enabled==true?this.nextButton.view.layer.setAttribute("disabled",false):this.nextButton.view.layer.setAttribute("disabled",true)},handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT){a=a.ad.sender;if(a==this.nextButton)this.selectedIndex<
2?this.showNextPane():this.createNewWiki();else a==this.cancelButton&&this.hideDialog()}},hideDialog:function(){var a=this.assistantViewControllers[this.selectedIndex];a.viewWillDisappear&&a.viewWillDisappear();this.callSuper()},createNewWiki:function(){this.nextButton.enabled=false;var a=this.assistantViewControllers[1].acls,b=this.assistantViewControllers[2].themeName,c={longName:this.assistantViewControllers[0].wikiName,description:this.assistantViewControllers[0].wikiDescription,avatarGUID:this.assistantViewControllers[2].avatarEditor.file_guid,
isNotificationChecked:this.assistantViewControllers[1]._isNotificationEnabled};if(b&&b!="blue")c.themeInfo=b+",,";server_proxy().createProjectWithOptionsAndACLs(c,a,function(d){this.assistantViewControllers[3].newWiki=d;this.nextButton.enabled=true;this.showNextPane()}.bind(this),function(){this.nextButton.enabled=true;logger().error("Could not create a new wiki")})}};iAd.Class({name:"WK.SettingsPanel",superclass:iAd.ViewController,synthesizedProperties:["entity","isInSetUpAssistant","isPanelReady"]});
WK.SettingsPanel.WIDTH=540;
WK.SettingsPanel.prototype={init:function(a,b,c){this.callSuper(c);this._entity=a;this._isInSetUpAssistant=b;this._isPanelReady=true},loadView:function(){this.callSuper();this.panelContainer=new iAd.View},appendSectionWithTitleAndView:function(a,b){this.yOffset=this.yOffset+10||30;var c=Math.max(b.size.height,44);this.slice=new iAd.View;if(a){var d=new iAd.Label;d.text=a.loc();d.size=new iAd.Size(240,44);d.verticalAlignment=iAd.Label.VERTICAL_ALIGNMENT_TOP;this.slice.addSubview(d)}b.position=new iAd.Point(a?
250:0,0);this.slice.addSubview(b);this.slice.size=new iAd.Size(WK.SettingsPanel.WIDTH-60,c);this.slice.position=new iAd.Point(30,this.yOffset);this.panelContainer.size=new iAd.Size(WK.SettingsPanel.WIDTH,this.yOffset+c+30);this.panelContainer.addSubview(this.slice);this.yOffset+=c;return this.slice},commitSettings:function(){},viewWillDisappear:function(){this.commitSettings();this.callSuper()},serializedSettings:function(){this.viewIsLoaded&&this.commitSettings()},serializedACLs:function(){this.viewIsLoaded&&
this.commitSettings()}};iAd.Class({name:"WK.SettingsWikiGeneralPanel",superclass:WK.SettingsPanel,synthesizedProperties:["wikiName","wikiDescription"]});
WK.SettingsWikiGeneralPanel.prototype={init:function(a,b){this.callSuper(a,b,{id:"wk-settings-general-pane"});this.tabBarItem.title="_WikiSetupAssistant.GeneralPane.ShortTitle".loc();this.navigationItem.title="_WikiSetupAssistant.GeneralPane.LongTitle".loc();this.wikiName=this.entity?WK.FormatterUtilities.displayNameForEntity(this.entity):"";this._isPanelReady=false;this.wikiDescription=this.entity?a.description||"":""},loadView:function(){this.callSuper();this.appendSectionWithTitleAndView("_WikiSetupAssistant.GeneralPane.Name.Label",
this._nameFieldView());this.appendSectionWithTitleAndView("_WikiSetupAssistant.GeneralPane.Description.Label",this._descriptionFieldView());this.view=this.panelContainer},_nameFieldView:function(){var a=this.inputWithValueAndPlaceholder(this._wikiName,"_WikiSetupAssistant.GeneralPane.Name.Placeholder");a.autofocus="true";a.addEventListener("keyup",this,false);return this.nameField=new iAd.View(a)},_descriptionFieldView:function(){var a=this.inputWithValueAndPlaceholder(this._wikiDescription,"_WikiSetupAssistant.GeneralPane.Description.Placeholder");
return this.descriptionField=new iAd.View(a)},inputWithValueAndPlaceholder:function(a,b){var c=document.createElement("input");c.value=a;c.placeholder=b.loc();c.autocorrect="off";c.addEventListener("keypress",this,false);return c},commitSettings:function(){this.nameField.layer.blur();this.descriptionField.layer.blur();this.wikiName=this.nameField.layer.value;this.wikiDescription=this.descriptionField.layer.value},serializedSettings:function(){this.callSuper();return[["longName",this.wikiName],["description",
this.wikiDescription]]},handleEvent:function(a){this.callSuper(a);if(a.type=="keyup")this.isPanelReady=/\S/.test(this.nameField.layer.value)}};iAd.Class({name:"WK.SettingsUserGeneralPanel",superclass:WK.SettingsPanel,synthesizedProperties:["userLongName","emailAddress"]});
WK.SettingsUserGeneralPanel.prototype={init:function(a,b){this.callSuper(a,b,{id:"wk-settings-general-pane"});this.tabBarItem.title="_WikiSetupAssistant.GeneralPane.ShortTitle".loc();this.navigationItem.title="_WikiSetupAssistant.GeneralPane.LongTitle".loc();this.userLongName=this.entity?WK.FormatterUtilities.displayNameForEntity(this.entity):"";this._isPanelReady=false;this.emailAddress=this.entity&&this.entity.privateAttributes?a.privateAttributes.preferredEmailAddress||"":"";server_proxy().preferredEmailAddressForUser(this.gotEmailAddress.bind(this),
function(){logger.error("Couldn't get user email")})},gotEmailAddress:function(a){this.emailAddress=a;if(this.emailField&&this.emailField.layer)this.emailField.layer.value=a},loadView:function(){this.callSuper();this.appendSectionWithTitleAndView("_WikiSetupAssistant.GeneralUserPane.Name.Label",this._nameFieldView());this.appendSectionWithTitleAndView("_WikiSetupAssistant.GeneralUserPane.Email.Label",this._emailFieldView());this.view=this.panelContainer},_nameFieldView:function(){var a=this.inputWithValueAndPlaceholder(this._userLongName,
"_WikiSetupAssistant.GeneralPane.Name.Placeholder");a.autofocus="true";a.addEventListener("keyup",this,false);return this.nameField=new iAd.View(a)},_emailFieldView:function(){var a=this.inputWithValueAndPlaceholder(this._emailAddress,"_WikiSetupAssistant.GeneralUserPane.Email.Placeholder");return this.emailField=new iAd.View(a)},inputWithValueAndPlaceholder:function(a,b){var c=document.createElement("input");c.value=a;c.placeholder=b.loc();c.autocorrect="off";c.addEventListener("keypress",this,false);
return c},commitSettings:function(){this.nameField.layer.blur();this.emailField.layer.blur();this.userLongName=this.nameField.layer.value;this.emailAddress=this.emailField.layer.value},serializedSettings:function(){this.callSuper();return[["longName",this.userLongName],["privateAttributes",{preferredEmailAddress:this.emailAddress}]]},handleEvent:function(a){this.callSuper(a);if(a.type=="keyup")this.isPanelReady=this.nameField.layer.value.length>0}};
iAd.Class({name:"WK.SettingsPermissionsPanel",superclass:WK.SettingsPanel,synthesizedProperties:["acls","comments","commentModeration"]});
WK.SettingsPermissionsPanel.prototype={init:function(a,b){this.callSuper(a,b,{id:"wk-settings-acl-pane"});this.tabBarItem.title="_WikiSetupAssistant.ACLPane.ShortTitle".loc();this.navigationItem.title="_WikiSetupAssistant.ACLPane.LongTitle".loc();if(b){var c=cachedCurrentUser;this._acls=[{userExternalID:c.externalID,userLogin:c.login,userLongName:c.longName,allow:true,action:"own"}];this._isNotificationEnabled=false}else{server_proxy().aclsForEntityGUID(this.entity.guid,function(d){this._acls=d}.bind(this));
this._comments=a.extendedAttributes.settings.comments;this._commentModeration=a.extendedAttributes.settings.commentModeration}},loadView:function(){this.callSuper();var a=[];a.push(this.appendSectionWithTitleAndView(null,this._aclPickerView()));if(!this.isInSetUpAssistant){a.push(this.appendSectionWithTitleAndView("_Settings.Permissions.CommentAccess.Label",this._commentPopUpView()));a.push(this.appendSectionWithTitleAndView("_Settings.Permissions.CommentModeration.Label",this._commentModerationPopUpView()))}this.panelContainer.removeFromSuperview();
this.container=new iAd.ScrollView;this.container.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;a.forEach(function(b){this.container.addSubview(b)},this);this.view=this.container;this.layoutSections();globalNotificationCenter().subscribe(CC.AccessEditor.ACCESS_EDITOR_VIEW_LIST_DID_CHANGE,this.itemsDidChange.bind(this))},itemsDidChange:function(){this.layoutSections()},layoutSections:function(){for(var a=30,b=0,c=0;c<this.container.subviews.length;c++){var d=
this.container.subviews[c];if(c==0){b=(this.accessEditor.mACLItems.length==0&&this.acls.length>0?this.acls.length:this.accessEditor.mACLItems.length)*iAd.TableView.DEFAULT_ROW_HEIGHT;var e=$$(".cc-access-editor-view ad-view").first();if(e)e.style.height=b+"px"}else b=iAd.TableView.DEFAULT_ROW_HEIGHT;d.size=new iAd.Size(470,b);d.position=new iAd.Point(30,a);a+=b+10}this.container.contentSize=new iAd.Size(470,a)},_aclPickerView:function(){this.accessEditor=new CC.AccessEditorView(this.acls,false);this.accessEditor.delegate=
this;this.accessEditor._render();var a=new iAd.View(this.accessEditor.$());a.size=new iAd.Size(470,this.accessEditor.mACLItems.length*iAd.TableView.DEFAULT_ROW_HEIGHT);return a},_commentPopUpView:function(){return this._buildPopupForSettingChoicesAndLocPrefix("comments",["disabled","all","authenticated"],"_Settings.Permissions.CommentAccess.")},_commentModerationPopUpView:function(){return this._buildPopupForSettingChoicesAndLocPrefix("commentModeration",["disabled","all","anonymous"],"_Settings.Permissions.CommentModeration.")},
_buildPopupForSettingChoicesAndLocPrefix:function(a,b,c){var d=this[a];b=b.map(function(f){var g={value:f};if(d==f)g.selected="selected";return Builder.node("option",g,(c+f).loc())});var e=Builder.node("select",b);e.onchange=function(){this[a]=$F(e)}.bind(this);b=new iAd.View(e);b.size=new iAd.Size(200,44);return b},viewWillDisappear:function(a){this.accessEditor.resultList&&this.accessEditor.resultList.hide();this.callSuper(a)},didRotateFromInterfaceOrientation:function(){this.accessEditor.resultList&&
this.accessEditor.userSearchField.updatePosition()},commitSettings:function(){this.acls=this._isInSetUpAssistant?this.accessEditor.serialize(true):this.accessEditor.serialize(false);this._isNotificationEnabled=false;if($("settings_send_notification"))this._isNotificationEnabled=$("settings_send_notification").checked},serializedSettings:function(){this.callSuper();var a=this.entity.extendedAttributes;if(!a.settings)a.settings={};a.settings.comments=this.comments;a.settings.commentModeration=this.commentModeration;
return[["extendedAttributes",a]]},serializedACLs:function(){this.callSuper();if(this.accessEditor&&this.accessEditor.dirty)return this.acls}};iAd.Class({name:"WK.SettingsAppearancePanel",superclass:WK.SettingsPanel,synthesizedProperties:["themeName"]});
WK.SettingsAppearancePanel.prototype={init:function(a,b){this.callSuper(a,b,{id:"wk-settings-appearance-pane"});this.tabBarItem.title="_WikiSetupAssistant.AppearancePane.ShortTitle".loc();this.navigationItem.title="_WikiSetupAssistant.AppearancePane.LongTitle".loc();var c=["blue",null,null];c=a&&a.themeInfo?a.themeInfo.split(","):c;this._themeName=c[0];this._entity=this._entity||{type:"com.apple.entity.Wiki",avatarGUID:null};this._themeBanner=c[1];this._themeBackground=c[2]},loadView:function(){this.callSuper();
var a=Builder.node("input",{type:"file"}).disabled==false,b=this.entity.type=="com.apple.entity.User"?"People":"Projects";if(a){var c=(new CC.AvatarEditorView(b))._render();this.avatarEditor=new CC.AvatarEditor(c,this.entity.avatarGUID,true);this.appendSectionWithTitleAndView("_Settings.Avatar.%@.Label".fmt(b).loc(),new iAd.View(c))}this.appendSectionWithTitleAndView(null,this._themeChooserView());if(a&&!this.isInSetUpAssistant){a=(new CC.AvatarEditorView(b))._render();this.bannerImageEditor=new CC.AvatarEditor(a,
this._themeBanner,false,true);this.appendSectionWithTitleAndView("_Settings.BannerImage.Label".loc(),new iAd.View(a));b=(new CC.AvatarEditorView(b))._render();this.backgroundImageEditor=new CC.AvatarEditor(b,this._themeBackground,false,true);this.appendSectionWithTitleAndView("_Settings.BackgroundImage.Label".loc(),new iAd.View(b))}this.view=this.panelContainer},_themeChooserView:function(){var a=Builder.node("div",{"class":"settings_theme_chooser"}),b=a.appendChild(Builder.node("ul",{"class":"theme_swatches"}));
"blue scarlet orange green royal purple steel carbon".split(" ").forEach(function(c){var d=Builder.node("li",{className:"theme_swatch "+c,"data-color":c},Builder.node("div",{role:"button",name:c,"arial-label":c,className:"theme_swatch_container"},[Builder.node("div",{className:"theme_main_swatch"}),Builder.node("div",{className:"theme_sidebar_swatch"})]));d.on("click",function(){this.themeName=d.getAttribute("data-color");$A(b.children).forEach(function(e){e==d?e.classList.add("selected"):e.classList.remove("selected")})}.bind(this));
this.themeName==c&&d.classList.add("selected");b.appendChild(d)},this);a=new iAd.View(a);a.size=new iAd.Size(480,216);return a},commitSettings:function(){if(this.avatarEditor)this.avatarGUID=this.avatarEditor.file_guid||null;if(this.bannerImageEditor)this._themeBanner=this.bannerImageEditor.file_guid||"";if(this.backgroundImageEditor)this._themeBackground=this.backgroundImageEditor.file_guid||""},serializedSettings:function(){this.callSuper();return[["avatarGUID",this.avatarGUID],["themeInfo",[this.themeName,
this._themeBanner,this._themeBackground].join(",")]]}};iAd.Class({name:"WK.NewWikiDonePanel",superclass:WK.SettingsPanel,synthesizedProperties:["newWiki"]});
WK.NewWikiDonePanel.prototype={init:function(){this.callSuper(null,true,{id:"wk-new-wiki-done-panel"});this.navigationItem.title="_WikiSetupAssistant.DonePane.LongTitle".loc()},loadView:function(){this.callSuper();this.newWiki||logger("new wiki should not be null");this.gotoButton=new iAd.Button(null,iAd.Button.TYPE_ROUNDED_RECT);this.gotoButton.setTitleForState("_WikiSetupAssistant.DonePane.GoToWiki%@".loc(this.newWiki.longName),iAd.Control.STATE_NORMAL);this.gotoButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);var a=Builder.node("div",[Builder.node("div",{className:"line"},"_WikiSetupAssistant.DonePane.InformationLine1%@".loc(this.newWiki.longName)),Builder.node("div",{className:"line"},"_WikiSetupAssistant.DonePane.InformationLine2".loc()),Builder.node("div",{className:"img"}),this.gotoButton.layer]);a=new iAd.View(a);a.size=new iAd.Size(WK.SettingsPanel.WIDTH-60,300);a.position=new iAd.Point(30,40);this.panelContainer.addSubview(a);this.view=this.panelContainer},handleEvent:function(a){if(a.ad.sender==
this.gotoButton){this.navigationController.parentViewController.hideDialog();globalRouteHandler().routeURL("/wiki/projects/%@".fmt(this.newWiki.tinyID))}}};iAd.Class({name:"iAd.TabBarItemView",superclass:iAd.Control,synthesizedProperties:["title","image","badgeValue"],cssClassName:"ad-tab-bar-item"});iAd.TabBarItemView.HEIGHT=44;iAd.TabBarItemView.SELECTED_MASK_IMAGE_WIDTH=48;iAd.TabBarItemView.HAS_HIDPI_VERSION_ATTR="ad-has-hidpi-version";
iAd.TabBarItemView.prototype.init=function(a){if(!iAd.TabBarItemView.selectedMaskImage)iAd.TabBarItemView.selectedMaskImage=iAd.Image.imageForURL(iAd.Path.assetsPath+"tab-bar-blue-gradient-mask.png",true);this._image=this._title="";this._badgeValue=null;this.callSuper(a)};
iAd.TabBarItemView.prototype.layerWasCreated=function(){this.callSuper();this.canvasContainer=this.layer.appendChild(document.createElement("div"));this.defaultCanvas=this.canvasContainer.appendChild(document.createElement("canvas"));this.selectedCanvas=this.canvasContainer.appendChild(document.createElement("canvas"));this.canvasContainer.className="ad-image";this.label=this.layer.appendChild(document.createElement("div"));this.label.className="ad-title";this.badge=this.layer.appendChild(document.createElement("div"));
this.badge.className="ad-badge";this.badgeContent=this.badge.appendChild(document.createElement("span"))};iAd.TabBarItemView.prototype.setValueForAttribute=function(a,b){if(b=="ad-image")this.image=iAd.Image.imageForURL(a,this.layerHasCustomAttribute(iAd.TabBarItemView.HAS_HIDPI_VERSION_ATTR));else b!=iAd.TabBarItemView.HAS_HIDPI_VERSION_ATTR&&this.callSuper(a,b)};
iAd.TabBarItemView.prototype.setSize=function(a){this.callSuper(a);this.badgeContent.style.maxWidth=this.size.width-12+"px";this.updateBadgePosition();this.updateImagePosition()};iAd.TabBarItemView.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.updateBadgePosition()};iAd.TabBarItemView.prototype.setTitle=function(a){this._title=this.label.textContent=a};
iAd.TabBarItemView.prototype.setImage=function(a){this._image&&this._image.removePropertyObserver("loaded",this);if(this._image=a)a.loaded?this.updateCanvasImages():a.addPropertyObserver("loaded",this,"updateCanvasImages")};iAd.TabBarItemView.prototype.setBadgeValue=function(a){this._badgeValue=a;if(a!=null){this.badge.style.display="block";this.badgeContent.textContent=a;this.updateBadgePosition()}else this.badge.style.display="none"};
iAd.TabBarItemView.prototype.updateBadgePosition=function(){if(!(!this.layerIsInDocument||this._badgeValue==null))if(this.badge.offsetWidth<this.size.width/2){this.badge.style.left=Math.round(this.size.width/2)+"px";this.badge.style.right=""}else{this.badge.style.right="-4px";this.badge.style.left=""}};iAd.TabBarItemView.prototype.updateImagePosition=function(){this.canvasContainer.style.left=(this._size.width-iAd.TabBarItemView.SELECTED_MASK_IMAGE_WIDTH)/2-3+"px"};
iAd.TabBarItemView.prototype.maskImageDidLoad=function(a){if(a.loaded){a.removePropertyObserver("loaded",this);this.updateCanvasImages()}};iAd.TabBarItemView.prototype.updateCanvasImages=function(){if(!(this._image==null||!this._image.loaded)){var a=iAd.TabBarItemView.selectedMaskImage;if(a.loaded){this.drawImage(this.defaultCanvas,false);this.drawImage(this.selectedCanvas,true)}else a.addPropertyObserver("loaded",this,"maskImageDidLoad")}};
iAd.TabBarItemView.prototype.drawImage=function(a,b){var c=iAd.TabBarItemView.selectedMaskImage,d=c.element.width,e=c.element.height;a.width=d;a.height=e;var f=a.getContext("2d");f.clearRect(0,0,d,e);f.globalCompositeOperation="source-over";f.drawImage(this._image.element,(d-this._image.element.width)/2,(e-this._image.element.height)/2);f.globalCompositeOperation="source-in";if(b)f.drawImage(c.element,0,0);else{c=f.createLinearGradient(0,0,0,e);c.addColorStop(0,"rgb(69%, 69%, 69%)");c.addColorStop(1,
"rgb(31%, 31%, 31%)");f.fillStyle=c;f.fillRect(0,0,d,e)}};iAd.Class({name:"iAd.TabBarItem",superclass:iAd.BarItem,synthesizedProperties:["badgeValue"],archivedProperties:["badgeValue"]});iAd.TabBarItem.prototype.init=function(a){this.callSuper();this.view=a||new iAd.TabBarItemView(null);this.view.tabBarItem=this};iAd.TabBarItem.initWithTitleImageAndTag=function(a,b,c){var d=new iAd.TabBarItem;d.title=a;d.image=b;d.tag=c;return d};iAd.TabBarItem.prototype.getTitle=function(){return this.view.title};
iAd.TabBarItem.prototype.setTitle=function(a){this.view.title=a};iAd.TabBarItem.prototype.getImage=function(){return this.view.image};iAd.TabBarItem.prototype.setImage=function(a){this.view.image=a};iAd.TabBarItem.prototype.getBadgeValue=function(){return this.view.badgeValue};iAd.TabBarItem.prototype.setBadgeValue=function(a){this.view.badgeValue=a};iAd.TabBarItem.prototype.getEnabled=function(){return this.view.enabled};iAd.TabBarItem.prototype.setEnabled=function(a){this.view.enabled=a};
iAd.Class({name:"iAd.TabBar",superclass:iAd.View,synthesizedProperties:["items","selectedItem"],archivedProperties:["items","selectedItem"],cssClassName:"ad-tab-bar",collectionAccessor:"tabBars"});iAd.TabBar.DEFAULT_HEIGHT=49;iAd.TabBar.X_MARGIN=2;iAd.TabBar.DEFAULT_IPAD_ITEM_WIDTH=80;iAd.TabBar.DEFAULT_IPAD_ITEM_SPACING=30;iAd.TabBar.CUSTOMIZE_GRID_CELL_SIZE=80;iAd.TabBar.DID_SELECT_ITEM="tabBarDidSelectItem";iAd.TabBar.WILL_BEGIN_CUSTOMIZING_ITEMS="tabBarWillBeginCustomizingItems";
iAd.TabBar.DID_BEGIN_CUSTOMIZING_ITEMS="tabBarDidBeginCustomizingItems";iAd.TabBar.WILL_END_CUSTOMIZING_ITEMS_CHANGED="tabBarWillEndCustomizingItemsChanged";iAd.TabBar.DID_END_CUSTOMIZING_ITEMS_CHANGED="tabBarDidEndCustomizingItemsChanged";iAd.TabBar.prototype.init=function(a){this.delegate=null;this.isCustomizing=false;this._items=[];this._selectedItem=null;this.callSuper(a);this.layer.addEventListener("webkitTransitionEnd",this,false)};
iAd.TabBar.prototype.readPropertiesFromLayerComputedStyle=function(a){this.callSuper(a);a=[];for(var b=this.layer.querySelectorAll("."+iAd.TabBarItemView.cssClassName),c,d=0,e=b.length;d<e;d++){c=b[d]._view;c.addEventListener(iAd.View.TOUCH_DOWN_EVENT,this,false);a.push(new iAd.TabBarItem(c))}this.items=a};iAd.TabBar.prototype.setSize=function(a){a.height=iAd.TabBar.DEFAULT_HEIGHT;this.callSuper(a);this.updateLayout()};
iAd.TabBar.prototype.willMoveToSuperview=function(a){if(a!=null){if(this._size.width==0)this.size=new iAd.Size(a.size.width,iAd.TabBar.DEFAULT_HEIGHT);if(this._position.y==0)this.position=new iAd.Point(0,a.size.height-iAd.TabBar.DEFAULT_HEIGHT)}};
iAd.TabBar.prototype.setSelectedItem=function(a){if(a){if(this._selectedItem!==a){if(this._selectedItem!=null)this._selectedItem.view.selected=false;a.view.selected=true;this._selectedItem=a}this.dispatchNotification(iAd.TabBar.DID_SELECT_ITEM,this.delegate,[["item",a]])}};iAd.TabBar.prototype.setItems=function(a){this.setItemsAnimated(a,false)};
iAd.TabBar.prototype.setItemsAnimated=function(a,b){if(iAd.Utils.objectIsArray(a)){for(var c=0,d=this._items.length;c<d;c++){var e=this._items[c],f=e.view;if(a.indexOf(e)==-1)if(f.transitionsEnabled=b){f.needsRemoval=true;f.transform="scale(0.001)";f.opacity=0}else f.removeFromSuperview()}d=a.length;e=Math.round((this.size.width-2*iAd.TabBar.X_MARGIN)/d);var g=0,i=iAd.TabBar.X_MARGIN;if(iAd.Device.IS_IPAD&&e>iAd.TabBar.DEFAULT_IPAD_ITEM_WIDTH+iAd.TabBar.DEFAULT_IPAD_ITEM_SPACING){e=iAd.TabBar.DEFAULT_IPAD_ITEM_WIDTH;
g=iAd.TabBar.DEFAULT_IPAD_ITEM_SPACING;i=Math.round((this._size.width-d*e-(d-1)*g)/2)}for(c=0;c<d;c++){f=a[c].view;f.position=new iAd.Point(i,0);f.size=new iAd.Size(e,iAd.TabBarItemView.HEIGHT);f.transitionsEnabled=b;if(f.superview!==this){this.addSubview(f);f.addEventListener(iAd.View.TOUCH_DOWN_EVENT,this,false)}i+=e+g}this._items=a;if((this.selectedItem==null||this.selectedItem.view.superview!==this||this.selectedItem.view.needsRemoval)&&d>0)this.selectedItem=a[0]}};
iAd.TabBar.prototype.updateLayout=function(){this._items.length>0&&this.setItemsAnimated(this._items,false)};iAd.TabBar.prototype.handleEvent=function(a){this.callSuper(a);switch(a.type){case iAd.View.TOUCH_DOWN_EVENT:this.selectedItem=a.ad.sender.tabBarItem;break;case "webkitTransitionEnd":this.removeItemViewIfNeeded(a.target._control)}};
iAd.TabBar.prototype.removeItemViewIfNeeded=function(a){if(a.needsRemoval){a.removeFromSuperview();a.needsRemoval=false;a.transitionsEnabled=false;a.transform="scale(1)";a.opacity=1}};
iAd.TabBar.prototype.beginCustomizingItems=function(a){this.dispatchNotification(iAd.TabBar.WILL_BEGIN_CUSTOMIZING_ITEMS,this.delegate,[["items",a]]);this.isCustomizing=true;this.itemsPriorToCustomization=this._items;this.customizingItems=a;this.dispatchNotification(iAd.TabBar.DID_BEGIN_CUSTOMIZING_ITEMS,this.delegate,[["items",a]])};
iAd.TabBar.prototype.endCustomizingAnimated=function(){this.dispatchNotification(iAd.TabBar.WILL_END_CUSTOMIZING_ITEMS_CHANGED,this.delegate,[["items",this.customizingItems],["changed",true]]);this.isCustomizing=false;this.dispatchNotification(iAd.TabBar.DID_END_CUSTOMIZING_ITEMS_CHANGED,this.delegate,[["items",this.customizingItems],["changed",true]])};
iAd.Class({name:"iAd.TabBarController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","selectedViewController","selectedIndex"],archivedProperties:["viewControllers","selectedViewController"]});iAd.TabBarController.SHOULD_SELECT_VIEW_CONTROLLER="tabBarControllerShouldSelectViewController";iAd.TabBarController.DID_SELECT_VIEW_CONTROLLER="tabBarControllerDidSelectViewController";iAd.TabBarControllerMaxItems=5;
iAd.TabBarController.prototype.init=function(a){this.callSuper(a);this.delegate=null;this.tabBar=new iAd.TabBar;this.viewAppearancePropagationProperty="selectedViewController";this.shouldArchiveView=false;this._viewControllers=[];this._selectedViewController=null;this.tabBar.delegate=this};
iAd.TabBarController.prototype.loadView=function(){this.callSuper();this._view.layer.addClassName("ad-tab-bar-controller-view");this._view.size=new iAd.Size(window.innerWidth,window.innerHeight);this._view.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.hostView=this._view.addSubview(new iAd.View);this.hostView.layer.addClassName("ad-tab-bar-controller-host-view");this.hostView.size=new iAd.Size(this._view.size.width,this._view.size.height-iAd.TabBar.DEFAULT_HEIGHT);
this.hostView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this._view.addSubview(this.tabBar);this.tabBar.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_TOP_MARGIN;this.showSelectedViewController(this._viewControllers[this.selectedIndex])};iAd.TabBarController.prototype.unloadView=function(){this.tabBar&&this.tabBar.removeFromSuperview();if(this.hostView){this.hostView.removeFromSuperview();this.hostView=null}this.callSuper()};
iAd.TabBarController.prototype.didReceiveMemoryWarning=function(){this.callSuper();for(var a=this._viewControllers,b=this._view?this.selectedIndex:-1,c=0,d=a.length;c<d;c++)c!=b&&a[c].unloadView()};iAd.TabBarController.prototype.tabBarDidSelectItem=function(){this.showSelectedViewController(this._viewControllers[this.selectedIndex])};
iAd.TabBarController.prototype.showSelectedViewController=function(a){if(this.isViewLoaded()){var b=this._selectedViewController;if(a===b)iAd.NavigationController!=null&&a instanceof iAd.NavigationController&&a.popToRootViewControllerAnimated(true);else{this._selectedViewController=a;a!=null&&a.viewWillAppear(false);if(b!=null){b.viewWillDisappear(false);b.view.removeFromSuperview();b.viewDidDisappear(false)}if(a!=null){b=a.view;b.size=this.hostView.size.copy();b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|
iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.hostView.addSubview(b);a.viewDidAppear(false);iAd.Utils.objectHasMethod(this.delegate,iAd.TabBarController.DID_SELECT_VIEW_CONTROLLER)&&this.delegate[iAd.TabBarController.DID_SELECT_VIEW_CONTROLLER](this,a)}}}};iAd.TabBarController.prototype.setViewControllers=function(a){this.setViewControllersAnimated(a,false)};
iAd.TabBarController.prototype.setViewControllersAnimated=function(a,b){this._viewControllers=a;for(var c=[],d=0,e=a.length;d<e;d++)c.push(a[d].tabBarItem);this.tabBar.setItemsAnimated(c,b)};iAd.TabBarController.prototype.setSelectedViewController=function(a){if(this._viewControllers.indexOf(a)!=-1)this.tabBar.selectedItem=a.tabBarItem};iAd.TabBarController.prototype.getSelectedIndex=function(){return this.tabBar.items.indexOf(this.tabBar.selectedItem)};
iAd.TabBarController.prototype.setSelectedIndex=function(a){if(a>=0&&a<this._viewControllers.length)this.tabBar.selectedItem=this._viewControllers[a].tabBarItem};iAd.ViewController.prototype.getTabBarController=function(){return this.parentControllerOfKind(iAd.TabBarController)};iAd.ViewController.prototype.getTabBarItem=function(){if(this._tabBarItem==null){this._tabBarItem=new iAd.TabBarItem;this._tabBarItem.title=this.title;this._tabBarItem.viewController=this}return this._tabBarItem};
iAd.Class.synthesizeProperties(iAd.ViewController,["tabBarController","tabBarItem"]);iAd.Class({name:"WK.SettingsDialog",superclass:WK.Dialog,synthesizedProperties:["entity","settingsControllers"]});
WK.SettingsDialog.prototype={init:function(a){this.callSuper(true);this._entity=a},getContentView:function(){if(!this._contentView){var a=new iAd.View;a.size=new iAd.Size(540,500);var b=new iAd.Toolbar;b.size=new iAd.Size(540,iAd.Toolbar.DEFAULT_HEIGHT);this.segmentedControl=new iAd.SegmentedControl;this.segmentedControl.width=100*this.settingsControllers.length;this.segmentedControl.addEventListener(iAd.Control.VALUE_CHANGE_EVENT,this.selectedSegmentDidChange.bind(this),false);for(var c=0;c<this.settingsControllers.length;c++)this.segmentedControl.insertSegmentWithTitleAtIndexAnimated(this.settingsControllers[c].tabBarItem.title,
c,false);c=new iAd.BarButtonItem(null,this.segmentedControl);this.saveButton=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_SQUARE);this.saveButton.view.layer.setAttribute("aria-label","_Control.Save".loc());this.saveButton.view.layer.setAttribute("name","_Control.Save".loc());this.saveButton.title="_Control.Save".loc();this.saveButton.style=iAd.BarButtonItem.STYLE_DONE;this.saveButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.saveSettings.bind(this),false);var d=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_SQUARE);
d.view.layer.setAttribute("aria-label","_Control.Cancel".loc());d.view.layer.setAttribute("name","_Control.Cancel".loc());d.title="_Control.Cancel".loc();d.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.hideDialog.bind(this),false);var e=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE);b.setItemsAnimated([d,e,c,e,this.saveButton],false);a.addSubview(b);this.tabController=new iAd.TabBarController;this.tabController.viewControllers=this.settingsControllers;this.tabController.view.position=
new iAd.Point(0,iAd.Toolbar.DEFAULT_HEIGHT);this.tabController.view.size=new iAd.Size(540,500-iAd.Toolbar.DEFAULT_HEIGHT);this.tabController.tabBar.hidden=true;this.tabController.hostView.size=new iAd.Size(540,500-iAd.Toolbar.DEFAULT_HEIGHT);a.addSubview(this.tabController.view);this.segmentedControl.selectedSegmentIndex=0;this._contentView=a}return this._contentView},selectedSegmentDidChange:function(){this.tabController.selectedIndex=this.segmentedControl.selectedSegmentIndex},saveSettings:function(){this.saveButton.enabled=
false;var a=[],b=null;this.settingsControllers.forEach(function(e){var f=e.serializedSettings();e=e.serializedACLs();if(f)a=a.concat(f);if(e)b=e});var c=new CC.EntityTypes.EntityChangeSet({changeAction:"UPDATE",entityGUID:this.entity.guid,entityRevision:this.entity.revision,entityType:this.entity.type,changes:a,force:false}),d=false;if($("settings_send_notification"))d=$("settings_send_notification").checked;server_proxy().updateEntityAndACLs(d,c,b,function(){this.saveButton.enabled=true;this.hideDialog()}.bind(this),
function(){this.saveButton.enabled=true;logger().error("Couldn't save settings");this.hideDialog()}.bind(this))}};iAd.Class({name:"WK.UserSettingsDialog",superclass:WK.SettingsDialog});WK.UserSettingsDialog.prototype={getSettingsControllers:function(){if(!this._settingsControllers)this._settingsControllers=[new WK.SettingsUserGeneralPanel(this.entity,false),new WK.SettingsAppearancePanel(this.entity,false)];return this._settingsControllers}};iAd.Class({name:"WK.WikiSettingsDialog",superclass:WK.SettingsDialog});
WK.WikiSettingsDialog.prototype={getSettingsControllers:function(){if(!this._settingsControllers)this._settingsControllers=[new WK.SettingsWikiGeneralPanel(this.entity,false),new WK.SettingsPermissionsPanel(this.entity,false),new WK.SettingsAppearancePanel(this.entity,false)];return this._settingsControllers}};iAd.Class({name:"WK.NewPageDialog",superclass:WK.Dialog});
WK.NewPageDialog.prototype={init:function(a){this.callSuper(false);this._containerGUID=a},title:"_PlusMenu.NewPage.Dialog.Title".loc(),getContentView:function(){if(!this._contentView){var a=new iAd.View;a.layer.id="wk-login-dialog";a.size=new iAd.Size(267,86);var b=document.createElement("input");b.type="text";b.placeholder="_PlusMenu.NewPage.Dialog.Label".loc();b.autofocus="true";b.autocorrect="off";b.autocapitalize="off";this.pageNameField=new iAd.View(b);a.addSubview(this.pageNameField);this.cancelButton=
new iAd.BarButton(iAd.BarButtonItem.TYPE_SQUARE);this.cancelButton.layer.setAttribute("aria-label","_Control.Cancel".loc());this.cancelButton.layer.setAttribute("name","_Control.Cancel".loc());this.cancelButton.title="_Control.Cancel".loc();this.cancelButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.addSubview(this.cancelButton);this.okButton=new iAd.BarButton(iAd.BarButtonItem.TYPE_DONE);this.okButton.layer.setAttribute("aria-label",
"_Control.OK".loc());this.okButton.layer.setAttribute("name","_Control.OK".loc());this.okButton.title="_Control.Add".loc();this.okButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.okButton.layer.classList.add("wk-ok-button");this.okButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.addSubview(this.okButton);this._contentView=a}return this._contentView},handleEvent:function(a){this.callSuper(a);a=a.ad.sender;if(a==this.cancelButton)this.hideDialog();else if(a==this.okButton){var b=
this.pageNameField.layer.value;if(b==undefined||b.isWhitespace())b="_Page.Default.Title".loc();a={longName:b,ownerGUID:this._containerGUID};server_proxy().createPageWithOptionsAndOptionalACLs(a,undefined,function(c){this.hideDialog();globalRouteHandler().routeURL("/wiki/pages/%@".fmt(c.tinyID))}.bind(this),function(){logger().error("Couldn't create page %@ in containerGUID %@".fmt(b,this._containerGUID));this.hideDialog()})}}};
iAd.Class({name:"WK.TopLevelViewController",superclass:iAd.ViewController,synthesizedProperties:["rightBarButtonItems","userPermissions"]});
WK.TopLevelViewController.prototype={init:function(a){this.callSuper(a);this._rightBarButtonItems=[];this._userPermissions=cachedUserPermissions},defaultLeftItems:function(){var a=[];this.navSidebarButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.navSidebarButton.layer.setAttribute("aria-label","_Control.MenuNavigation".loc());this.navSidebarButton.layer.setAttribute("name","_Control.MenuNavigation".loc());this.navSidebarButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonNavigationSidebar.png",
true);this.navSidebarButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.push(this.navSidebarButton);if(mainDetailViewNavigationController.viewControllers.length>1||globalRouteHandler().mRouteStack.stack().length>1){this.backButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_SQUARE);this.backButton.layer.setAttribute("aria-label","_Control.Back".loc());this.backButton.layer.setAttribute("name","_Control.Back".loc());this.backButton.title="_Control.Back".loc();this.backButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);a.push(this.backButton)}return a},getRightBarButtonItems:function(){var a=[];this.plusMenuItems=[];var b=this.newDocumentMenuItem();b&&this.plusMenuItems.push(b);(b=this.uploadDocumentMenuItem())&&this.plusMenuItems.push(b);this.userPermissions.canCreateWikis&&this.plusMenuItems.push({name:"_PlusMenu.NewWiki".loc(),callback:this.createNewWiki.bind(this)});if(this.plusMenuItems.length){this.plusButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.plusButton.layer.setAttribute("aria-label",
"_Control.Plus".loc());this.plusButton.layer.setAttribute("name","_Control.Plus".loc());this.plusButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonAdd.png",true);this.plusButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.push(this.plusButton)}this.gearButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.gearButton.layer.setAttribute("aria-label","_Control.Gear".loc());this.gearButton.layer.setAttribute("name","_Control.Gear".loc());this.gearButton.image=
iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonGear.png",true);this.gearButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.push(this.gearButton);this.searchButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.searchButton.layer.setAttribute("aria-label","_Search".loc());this.searchButton.layer.setAttribute("name","_Search".loc());this.searchButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonSearch.png",true);this.searchButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,
this,false);a.push(this.searchButton);if(!this.userPermissions.isLoggedIn){a.push(WK.MultipleBarButtonItem.DIVIDER);this.loginButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_SQUARE);this.loginButton.layer.setAttribute("aria-label","_Login.LogIn".loc());this.loginButton.layer.setAttribute("name","_Login.LogIn".loc());this.loginButton.title="_Login.LogIn".loc();this.loginButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.push(this.loginButton)}return a},navigationItemsDidChange:function(){if(this.navigationController){var a=
mainDetailViewNavigationController.navigationBar,b=a.items,c=this.getNavigationItem();b[b.length-1]=c;a.setItemsAnimated(b,true)}},additionalRightBarButtonItems:function(){return[]},getNavigationItem:function(){var a=this.callSuper();a.leftBarButtonItem=new WK.MultipleBarButtonItem(this.defaultLeftItems(),"left");var b=this.rightBarButtonItems;b=(this.additionalRightBarButtonItems()||[]).concat(b);a.rightBarButtonItem=new WK.MultipleBarButtonItem(b,"right");return a},handleEvent:function(a){this.callSuper(a);
if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)if(a=a.ad.sender)if(a==this.navSidebarButton)this.handleNavSidebarButtonTapped();else if(a==this.backButton)this.handleBackButtonTapped();else if(a==this.plusButton)this.handlePlusButtonTapped();else if(a==this.gearButton)this.handleGearButtonTapped();else if(a==this.searchButton)this.handleSearchButtonTapped();else a==this.loginButton&&this.handleLoginButtonTapped()},handleNavSidebarButtonTapped:function(){mainSplitViewController.toggleSidebarAnimated(true)},
handleBackButtonTapped:function(){globalRouteHandler().mRouteStack.popMostRecentRoute();var a=globalRouteHandler().mRouteStack.popMostRecentRoute();a&&a.url?globalRouteHandler().routeURL(a.url):mainDetailViewNavigationController.popViewControllerAnimated(true)},handleSearchButtonTapped:function(){var a=new WK.SearchPopupViewController(this.userPermissions.isLoggedIn);if(this.popover)this.popover.contentViewController=a;else this.popover=new iAd.PopoverController(a);a.popover=this.popover;this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(this.searchButton.frame,
this.searchButton.superview,iAd.PopoverController.ARROW_DIRECTION_UP,true)},handleLoginButtonTapped:function(){if(this.userPermissions.isLoggedIn)logger.error("Called Log In Button (from black toolbar) while already logged in");else window.location.href="/auth?send_token=no&redirect="+window.location},showMenuForButtonAndMenuItems:function(a,b){var c=b.map(function(d){return d.name});this.menuItems=b;this.menuContentsVC=new WK.ListOfOptionsViewController(c);this.menuContentsVC.contentSizeForViewInPopover=
new iAd.Size(320,c.length*iAd.TableView.DEFAULT_ROW_HEIGHT-1);this.menuContentsVC.delegate=this;if(this.popover){this.popover.contentViewController=this.menuContentsVC;this.popover.delegate=this}else this.popover=new iAd.PopoverController(this.menuContentsVC);this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(a.frame,a.superview,iAd.PopoverController.ARROW_DIRECTION_UP,true)},listOfOptionsDidChooseMenuIndex:function(a){a=this.menuItems[a];this.popover.dismissPopoverAnimated(true);
a.callback(a.args)},handlePlusButtonTapped:function(){this.showMenuForButtonAndMenuItems(this.plusButton,this.plusMenuItems)},createNewWiki:function(){(new WK.NewWikiAssistantDialog).showDialog()},newDocumentMenuItem:function(){if(this.userPermissions.isLoggedIn)return{name:"_PlusMenu.NewPage.NewInMyDocs".loc(),callback:this.createNewDocumentInContainer.bind(this)}},uploadDocumentMenuItem:function(){if(this.userPermissions.isLoggedIn)return{name:"_PlusMenu.Private.File".loc(),callback:this.uploadNewDocumentInContainer.bind(this)}},
createNewDocumentInContainer:function(a){(new WK.NewPageDialog(a||cachedCurrentUser.guid)).showDialog()},uploadNewDocumentInContainer:function(a){fileUploadManager().uploadNewFileInContainerGUID(a||cachedCurrentUser.guid)},handleGearButtonTapped:function(){this.showMenuForButtonAndMenuItems(this.gearButton,(this.additionalGearMenuItems()||[]).concat(this.defaultGearMenuItems()))},additionalGearMenuItems:function(){return[]},defaultGearMenuItems:function(){var a=[];this.userPermissions.isLoggedIn&&
a.push({name:"_GearMenu.General.MySettings".loc(),callback:this.showUserSettings.bind(this)});a.push({name:"_GearMenu.General.Help".loc(),callback:this.showHelp.bind(this)});return a},showUserSettings:function(){(new WK.UserSettingsDialog(cachedCurrentUser)).showDialog()},showHelp:function(){window.location.href="_Help.iPad.URL".loc()}};iAd.Class({name:"WK.HybridScrollView",superclass:iAd.ScrollView,synthesizedProperties:["hybridDrawingLayer"]});
WK.HybridScrollView.prototype.init=function(){this.callSuper();this.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.contentSize=iAd.ScrollView.AUTOMATED_CONTENT_SIZE;this.usesNativeScrolling=true;this.delaysContentTouches=false};WK.HybridScrollView.prototype.getHybridDrawingLayer=function(){return this.hostingLayer};iAd.Class({name:"WK.EditorView",superclass:WK.HybridScrollView,cssClassName:"wk-editor-view"});
iAd.Class({name:"WK.SharedEditorViewController",superclass:WK.TopLevelViewController,synthesizedProperties:["shouldDisplayPageTitle"]});WK.SharedEditorViewController.EDITOR_TOOLBAR_HEIGHT=44;WK.SharedEditorViewController.DEFAULT_Z_INDEX=100;WK.SharedEditorViewController.prototype.init=function(){this._editor=null;this.callSuper()};
WK.SharedEditorViewController.prototype.loadView=function(){var a=new iAd.View;a.layer.addClassName("wk-shared-editor");a.size=new iAd.Size(window.innerWidth,window.innerHeight);a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;var b=new iAd.View;b.layer.addClassName("wk-editor-toolbar");b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;b.size=new iAd.Size(window.innerWidth,WK.SharedEditorViewController.EDITOR_TOOLBAR_HEIGHT);b.position=new iAd.Point(0,
0);this.toolbarView=b;b=new WK.EditorView;b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;b.size=new iAd.Size(window.innerWidth,window.innerHeight-WK.SharedEditorViewController.EDITOR_TOOLBAR_HEIGHT);b.position=new iAd.Point(0,WK.SharedEditorViewController.EDITOR_TOOLBAR_HEIGHT);this.editorView=b;a.addSubview(this.toolbarView);a.addSubview(this.editorView);_globalEditorController=this.editor=new CC.WikiEditor.EditorController({mParentElement:this.editorView.hybridDrawingLayer,
mToolbarParentElement:this.toolbarView.layer,mDebugMode:(window.location.href||"").match(/\?editorDebugMode=true/)});globalNotificationCenter().subscribe(CC.WikiEditor.NOTIFICATION_DID_START_EDITING,this.handleDidStartEditing.bind(this));globalNotificationCenter().subscribe(CC.WikiEditor.NOTIFICATION_DID_FINISH_EDITING,this.handleDidFinishEditing.bind(this));a.zIndex=WK.SharedEditorViewController.DEFAULT_Z_INDEX;this.view=a};
WK.SharedEditorViewController.prototype.editPageWithGUID=function(a){mainDetailViewNavigationController.pushViewControllerAnimated(this,false);globalNotificationCenter().publish(CC.WikiEditor.NOTIFICATION_EDITOR_READY,this.editor);if(a){this.editor._initializeInlineContent(server_proxy().objectFromStoreWithGUID(a));this.editor.toggleEditMode(true)}};WK.SharedEditorViewController.prototype.handleDidStartEditing=function(){};WK.SharedEditorViewController.prototype.handleDidFinishEditing=function(){mainDetailViewNavigationController.popViewControllerAnimated(false)};
WK.SharedEditorViewController.prototype.setShouldDisplayPageTitle=function(a){this._shouldDisplayPageTitle=a;var b=this.editor.mEditorView.$().down(".cc-entity-title");a?b.show():b.hide()};
WK.SharedEditorViewController.prototype.defaultLeftItems=function(){this.undoButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_SQUARE);this.undoButton.layer.setAttribute("aria-label","_Editor.Undo.Title".loc());this.undoButton.layer.setAttribute("name","_Editor.Undo.Title".loc());this.undoButton.title="_Editor.Undo.Title".loc();this.undoButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);return[this.undoButton]};
WK.SharedEditorViewController.prototype.getRightBarButtonItems=function(){this.cancelButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_SQUARE);this.cancelButton.layer.setAttribute("aria-label","_Editor.Cancel.Title".loc());this.cancelButton.layer.setAttribute("name","_Editor.Cancel.Title".loc());this.cancelButton.title="_Editor.Cancel.Title".loc();this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.saveButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_SQUARE);
this.saveButton.layer.setAttribute("aria-label","_Editor.Save.Title".loc());this.saveButton.layer.setAttribute("name","_Editor.Save.Title".loc());this.saveButton.title="_Editor.Save.Title".loc();this.saveButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);return[this.cancelButton,this.saveButton]};
WK.SharedEditorViewController.prototype.handleEvent=function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT){var b=a.ad.sender;if(b){var c=this.editor.mEditorView.mToolbarView;if(b==this.undoButton)c.handleEditorToolbarUndo(a);else if(b==this.cancelButton)c.handleEditorToolbarCancel(a);else b==this.saveButton&&c.handleEditorToolbarSave(a)}}};iAd.Class({name:"WK.RightSidebarViewController",superclass:iAd.ViewController,synthesizedProperties:["viewControllers","isSidebarVisible"]});
WK.RightSidebarViewController.DEFAULT_SIDEBAR_WIDTH=256;WK.RightSidebarViewController.prototype.init=function(){this.callSuper();this._viewControllers=null;this._isSidebarVisible=true};
WK.RightSidebarViewController.prototype.loadView=function(){this.callSuper();var a=new iAd.View;a.size=new iAd.Size(window.innerWidth,window.innerHeight);a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.contentView=this.viewControllers[1].view;this.sidebarView=this.viewControllers[0].view;a.addSubview(this.contentView);a.addSubview(this.sidebarView);this.contentView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.contentView.position=new iAd.Point(0,
0);this.contentView.size=new iAd.Size(768,window.innerHeight);this.sidebarView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.sidebarView.layer.style.left="auto";this.sidebarView.layer.style.webkitTransition="right 0.2s ease-in-out";this.sidebarView.size=new iAd.Size(WK.RightSidebarViewController.DEFAULT_SIDEBAR_WIDTH,window.innerHeight);this.isSidebarVisible=false;this.view=a};
WK.RightSidebarViewController.prototype.setIsSidebarVisible=function(a){if(a!=this._isSidebarVisible){this._isSidebarVisible=a;this.sidebarView.layer.style.right=this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT||this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT_UPSIDE_DOWN?a?"0px":-1*WK.RightSidebarViewController.DEFAULT_SIDEBAR_WIDTH+"px":"0px"}};WK.RightSidebarViewController.prototype.toggleIsSidebarVisible=function(){this.isSidebarVisible=!this.isSidebarVisible};
iAd.Class({name:"WK.DocumentSidebarEditableViewController",superclass:iAd.ViewController,synthesizedProperties:["editButtonVisible","editButtonEnabled","editing"]});WK.DocumentSidebarEditableViewController.prototype.init=function(a){this.callSuper();this._editing=a||false;this._enabled=this._visible=false;this.addPropertyObserver("editButtonEnabled",this,"handleEditButtonChanged")};WK.DocumentSidebarEditableViewController.prototype.EDIT_TITLE="_Control.Edit".loc();
WK.DocumentSidebarEditableViewController.prototype.DONE_TITLE="_Control.Done".loc();
WK.DocumentSidebarEditableViewController.prototype.loadView=function(){this.callSuper();this.editButton=new iAd.BarButtonItem;this.editButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);var a=iAd.CSS.widthForTextAndFont(this.EDIT_TITLE,"bold 12px Helvetica"),b=iAd.CSS.widthForTextAndFont(this.DONE_TITLE,"bold 12px Helvetica");this.editButton.width=Math.max(a,b)+20;this.editButton.enabled=this.editButtonEnabled;this.navigationItem.rightBarButtonItem=this.editButton};
WK.DocumentSidebarEditableViewController.prototype.setEditing=function(a){this._editing=a||false;this.editButton.title=this._editing?this.DONE_TITLE:this.EDIT_TITLE;if(this._editing){this.editButton.view.layer.setAttribute("aria-label",this.DONE_TITLE);this.editButton.view.layer.setAttribute("name",this.DONE_TITLE)}else{this.editButton.view.layer.setAttribute("aria-label",this.EDIT_TITLE);this.editButton.view.layer.setAttribute("name",this.EDIT_TITLE)}this.editButton.style=this._editing?iAd.BarButtonItem.STYLE_DONE:
iAd.BarButtonItem.STYLE_DEFAULT;if(this._futureEnabled!=undefined){this.editButtonEnabled=this._futureEnabled;delete this._futureEnabled}};WK.DocumentSidebarEditableViewController.prototype.setEditButtonEnabled=function(a){if(this.editing&&!a)this._futureEnabled=a;else{this._editButtonEnabled=a||false;this.editButton.enabled=this._editButtonEnabled}};
WK.DocumentSidebarEditableViewController.prototype.handleEvent=function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)if(event.ad.sender==this.editButton)this.editing=!this.editing};iAd.Class({name:"WK.InfoDetails",superclass:WK.DocumentSidebarEditableViewController});
WK.InfoDetails.prototype={init:function(a,b){this.callSuper(a);this.datasource=b;this.title=b.title;this.datasource.paginatesIfNeeded=false},loadView:function(){this.callSuper();this.tableView=new iAd.TableView;this.tableView.tableStyle=iAd.TableView.STYLE_GROUPED;this.tableView.dataSource=this.datasource;this.tableView.delegate=this.datasource;this.tableView.confirmesBeforeDeleting=false;this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.tableView.editing=
this.editing;this.view=this.tableView;this.datasource.view=this.view;this.tableView.dataSource.addPropertyObserver("collection",this,"sectionCollectionDidChange")},viewWillAppear:function(){this.editButtonEnabled=this.datasource.hasEditableContent()},viewWillDisappear:function(a){this.datasource.paginatesIfNeeded=true;this.callSuper(a)},setEditing:function(a){this.callSuper(a);this.tableView.editing=a},sectionCollectionDidChange:function(){this.editButtonEnabled=this.datasource.hasEditableContent();
this.tableView.reloadData()}};iAd.Class({name:"WK.SidebarSection",superclass:iAd.ViewController,synthesizedProperties:["title","emptyPlaceholder","canEdit","docEntity","collection","editing"]});
WK.SidebarSection.prototype={PAGINATION_LIMIT:3,init:function(a,b){this.callSuper(null);this._docEntity=a;this._canEdit=b;this._collection=[];this._editing=false;this.addPropertyObserver("collection",this,"collectionDidChange")},collectionDidChange:function(){this.tableView.reloadData();this.editButtonEnabled=this.hasEditableContent()},viewWillAppear:function(){this.collectionDidChange()},hasEditableContent:function(){return this.canEdit&&this.collection!=undefined&&this.collection.length>0},tableViewSizeDidChange:function(){this.view.size=
new iAd.Size(this.view.size.width,this.tableView.contentSize.height)},loadView:function(){this.callSuper();this.container=new iAd.View;this.container.layer.classList.add("wk-sidebar-section");this.container.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.tableView=new iAd.TableView;this.tableView.confirmesBeforeDeleting=false;this.tableView.tableStyle=iAd.TableView.STYLE_GROUPED;this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.tableView.scrollEnabled=
false;this.tableView.dataSource=this;this.tableView.delegate=this;this.tableView.addPropertyObserver("contentSize",this,"tableViewSizeDidChange");this.container.addSubview(this.tableView);this.view=this.container},setEditing:function(a){this._editing=a;this.tableView.editing=a},tableViewTitleForHeaderInSection:function(){return this.title},tableViewTitleForFooterInSection:function(a,b){return this.tableView.dataSource.tableViewNumberOfRowsInSection(a,b)==0?this.emptyPlaceholder:""},tableViewNumberOfRowsInSection:function(){var a=
this.collection.length;if(this.canEdit)a+=1;if(this.paginatesIfNeeded&&a>this.PAGINATION_LIMIT)return this.PAGINATION_LIMIT+1;return a},willPaginate:function(){return this.paginatesIfNeeded&&this.collection.length+(this.canEdit?1:0)>this.PAGINATION_LIMIT},normalizedIndexPathForPath:function(a){if(this.canEdit)a=new iAd.IndexPath(a.section,a.row-1);return a},isPlaceholderRow:function(a){return this.canEdit&&a.row==0},isPaginationRow:function(a){return this.paginatesIfNeeded&&a.row==this.PAGINATION_LIMIT},
paginationCell:function(a){a=a.dequeueReusableCell()||new iAd.TableViewCell;a.text="_Document.Sidebar.ViewAll".loc();a.layer.classList.add("wk-view-all-cell");return a},tableViewCellForRowAtIndexPath:function(a,b){var c;if(this.isPlaceholderRow(b)){c=this.tableView.dataSource.tableViewPlaceholderCell(a);c.wkCellIdentifier="placeholder"}else if(this.isPaginationRow(b)){c=this.paginationCell(a);c.wkCellIdentifier="pagination"}else{c=this.tableView.dataSource.tableViewRegularCellForRowAtIndexPath(a,
this.normalizedIndexPathForPath(b));c.wkCellIdentifier=this.normalizedIndexPathForPath(b);this.willPaginate()&&b.row==this.PAGINATION_LIMIT-1&&setTimeout(function(){c.layer.classList.add("ad-last-row-in-section")},50)}c.layer.addEventListener("click",this,false);return c},handleEvent:function(a){this.callSuper(a);var b=a.currentTarget._view;if(a.type=="click")if(b.wkCellIdentifier=="placeholder")this.tableView.delegate.tableViewDidSelectPlaceholderRow(this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,
0)));else if(b.wkCellIdentifier=="pagination")this.navigationController.pushViewControllerAnimated(new WK.InfoDetails(this.parentViewController.editing,this),true);else b.accessory&&a.srcElement!=b.accessory.layer&&b.editAccessory&&a.srcElement!=b.editAccessory.layer&&b.deleteButton&&a.srcElement!=b.deleteButton.layer&&this.tableView.delegate.tableViewDidSelectRegularRowAtIndexPath(this.tableView,b.wkCellIdentifier)},tableViewDidSelectRowAtIndexPath:function(a,b){if(this.isPlaceholderRow(b))this.tableView.delegate.tableViewDidSelectPlaceholderRow(a.cellForRowAtIndexPath(new iAd.IndexPath(0,
0)));else this.isPaginationRow(b)?this.navigationController.pushViewControllerAnimated(new WK.InfoDetails(this.parentViewController.editing,this),true):this.tableView.delegate.tableViewDidSelectRegularRowAtIndexPath(a,this.normalizedIndexPathForPath(b))},tableViewCommitEditingStyleForRowAtIndexPath:function(a,b,c){if(this.isPlaceholderRow(c))console.error("Can't delete a placeholder row");else this.isPaginationRow(c)?console.error("Can't delete a pagination row"):this.tableView.delegate.tableViewCommitEditingStyleForRegularRowAtIndexPath(a,
b,this.normalizedIndexPathForPath(c))},tableViewHeightForRowAtIndexPath:function(a,b){return this.isPlaceholderRow(b)?this.tableViewHeightForPlaceholderRow(a):this.isPaginationRow(b)?this.tableViewHeightForPaginationRow():this.tableViewHeightForRegularRowAtIndexPath(a,this.normalizedIndexPathForPath(b))},tableViewHeightForRegularRowAtIndexPath:function(){return iAd.TableView.DEFAULT_ROW_HEIGHT},tableViewHeightForPlaceholderRow:function(){return iAd.TableView.DEFAULT_ROW_HEIGHT},tableViewHeightForPaginationRow:function(){return iAd.TableView.DEFAULT_ROW_HEIGHT},
tableViewTitleForDeleteConfirmationButtonForRowAtIndexPath:function(){return"_Control.Delete".loc()}};iAd.Class({name:"WK.CommentsSection",superclass:WK.SidebarSection});
WK.CommentsSection.prototype={init:function(a){this.callSuper(a,false);this.title="_Document.Sidebar.Comments".loc();this.emptyPlaceholder="_Document.Sidebar.Comments.None".loc();this.paginatesIfNeeded=true},loadView:function(){this.callSuper();this.tableView.allowsSelection=false;this.getDataFromServer()},getDataFromServer:function(){server_proxy().commentsAndCanICommentForGUID(this.docEntity.guid,function(a,b){this.canEdit=b;this.collection=a}.bind(this),function(){logger().error("couldn't load comments from server")})},
tableViewPlaceholderCell:function(a){var b=a.dequeueReusableCellWithIdentifier("WK.CommentTableViewCell")||new WK.CommentTableViewCell;b.isPlaceholderCell=true;b.detailedText=cachedCurrentUser.isAuthenticated?"_Document.Sidebar.Comments.You".loc():"_Login.Unauthenticated".loc();if(this.cachedHeight){b.textInput.layer.value=this.cachedText;b.textInput.layer.style.height=this.cachedHeight+15+"px";setTimeout(function(){b.textInput.layer.focus();b.textInput.layer.setSelectionRange(this.cachedSelection[0],
this.cachedSelection[1]);b.sendButton.hidden=false}.bind(this),0)}b.textInput.layer.addEventListener("keyup",this,false);b.textInput.layer.addEventListener("blur",this,false);b.date=new Date;return b},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCellWithIdentifier("WK.CommentTableViewCell")||new WK.CommentTableViewCell,d=this.collection[b.row];c.text=d.body;var e=cachedCurrentUser,f=e.isAuthenticated;c.detailedText=e.isAuthenticated&&e.guid==d.authorUserGUID?"_Document.Sidebar.Comments.You".loc():
f?"_Login.Unauthenticated".loc():d.authorUserLongName;c.date=d.createTime;if(this.canEdit)c.editingStyle=iAd.TableViewCell.EDITING_STYLE_DELETE;return c},tableViewHeightForPlaceholderRow:function(){return this.cachedHeight+49||iAd.TableView.DEFAULT_ROW_HEIGHT+35},tableViewHeightForRegularRowAtIndexPath:function(a,b){var c=this.collection[b.row],d=document.createElement("span");d.appendChild(document.createTextNode(c.body));d.style.font="normal 12px Helvetica";d.style.lineHeight="13px";d.style.whiteSpace=
"pre-wrap";d.style.wordWrap="break-word";c=document.createElement("div");c.style.width="200px";c.style.lineHeight="13px";c.appendChild(d);document.body.appendChild(c);d=d.offsetHeight;document.body.removeChild(c);return d+22+35-2},tableViewCommitEditingStyleForRegularRowAtIndexPath:function(a,b,c){if(b==iAd.TableViewCell.EDITING_STYLE_DELETE){var d=this.collection[c.row];server_proxy().deleteCommentWithGUID(d.guid,function(){this.collection.splice(c.row,1);this.notifyPropertyChange("collection")}.bind(this),
function(){logger().error("couldn't remove comment: "+d)})}},tableViewDidSelectPlaceholderRow:function(){var a=this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,0));a.sendButton.hidden=false;a.sendButton.enabled=a.textInput.layer.value.length>0;a.sendButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.sendComment.bind(this),false)},handleEvent:function(a){this.callSuper(a);var b=this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,0)),c=b.textInput.layer;if(a.type=="keyup"){a=c.value;
if(a!=this.cachedText){b.sendButton.enabled=a.length>0;b=c.scrollHeight;if(b!=this.cachedHeight&&b>40){this.cachedHeight=b+3;this.cachedText=a;this.cachedSelection=[c.selectionStart,c.selectionEnd];this.tableView.reloadData()}}}else if(a.type=="blur")if(c.value.length==0)b.sendButton.hidden=true},sendComment:function(){var a=this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,0)).textInput.layer.value;a.length!=0&&server_proxy().addCommentToOwnerGUID(a,this.docEntity.guid,function(){delete this.cachedHeight;
delete this.cachedText;delete this.cachedSelection;this.getDataFromServer()}.bind(this),function(){logger().error("couldn't add following comment: "+a)})}};
iAd.Class({name:"iAd.SearchDisplayController",superclass:iAd.Object,mixins:[iAd.EventTarget],synthesizedProperties:["searchResultsTableView","searchResultsDataSource","searchResultsDelegate","searchResultsTitle","active","dimTableViewOnEmptySearchString","automaticallyShowsNoResultsMessage","noResultsMessage","noResultsMessageVisible"],archivedProperties:["searchBar","searchContentsController","searchResultsDataSource","searchResultsDelegate","searchResultsTitle","active"]});
iAd.SearchDisplayController.SEARCHBAR_PLACEHOLDER_TEXT="Search";iAd.SearchDisplayController.NO_RESULTS_MESSAGE_DEFAULT="No Results.";iAd.SearchDisplayController.SEARCH_RESULTS_TITLE_DEFAULT="Results";iAd.SearchDisplayController.WILL_BEGIN_SEARCH="searchDisplayControllerWillBeginSearch";iAd.SearchDisplayController.DID_BEGIN_SEARCH="searchDisplayControllerDidBeginSearch";iAd.SearchDisplayController.WILL_END_SEARCH="searchDisplayControllerWillEndSearch";iAd.SearchDisplayController.DID_END_SEARCH="searchDisplayControllerDidEndSearch";
iAd.SearchDisplayController.DID_LOAD_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerDidLoadSearchResultsTableView";iAd.SearchDisplayController.WILL_UNLOAD_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerWillUnloadSearchResultsTableView";iAd.SearchDisplayController.WILL_SHOW_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerWillShowSearchResultsTableView";iAd.SearchDisplayController.DID_SHOW_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerDidShowSearchResultsTableView";
iAd.SearchDisplayController.WILL_HIDE_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerWillHideSearchResultsTableView";iAd.SearchDisplayController.DID_HIDE_SEARCH_RESULTS_TABLE_VIEW="searchDisplayControllerDidHideSearchResultsTableView";iAd.SearchDisplayController.SHOULD_RELOAD_TABLE_FOR_SEARCH_STRING="searchDisplayControllerShouldReloadTableForSearchString";iAd.SearchDisplayController.SHOULD_DEACTIVATE_ON_CANCEL_BUTTON_CLICK="shouldDeactivateOnCancelButtonClick";
iAd.SearchDisplayController.prototype.init=function(a,b){this.delegate=null;this.searchBar=a;this.searchBar.delegate=this;if(this.searchBar.placeholder.length==0)this.searchBar.placeholder=iAd.SearchDisplayController.SEARCHBAR_PLACEHOLDER_TEXT;this.searchContentsController=b;this._searchResultsTitle=this._searchResultsDelegate=this._searchResultsDataSource=this._searchResultsTableView=null;this._active=false;this._automaticallyShowsNoResultMessage=true;this._noResultsMessage=iAd.SearchDisplayController.NO_RESULTS_MESSAGE_DEFAULT;
this._dimTableViewOnEmptySearchString=this._noResultsMessageVisibile=true;this.eventTarget=document;this.callSuper()};iAd.SearchDisplayController.restoreFromArchive=function(a){return new this(a.searchBar,a.searchContentsController)};iAd.SearchDisplayController.prototype.setSearchResultsDataSource=function(a){if(this._searchResultsTableView)this._searchResultsTableView.dataSource=a;this._searchResultsDataSource=a};
iAd.SearchDisplayController.prototype.setSearchResultsDelegate=function(a){if(this._searchResultsTableView)this._searchResultsTableView.delegate=a;this._searchResultsDelegate=a};iAd.SearchDisplayController.prototype.setNoResultsMessageVisible=function(a){if(this._noResultsMessageVisible!=a){this._noResultsMessageVisible=a;this.updateNoSearchResultsMessageVisibility()}};
iAd.SearchDisplayController.prototype.setAutomaticallyShowsNoResultsMessage=function(a){if(this._automaticallyShowsNoResultsMessage!=a){this._automaticallyShowsNoResultsMessage=a;this.updateNoSearchResultsMessageVisibility()}};iAd.SearchDisplayController.prototype.setNoResultsMessage=function(a){this._noResultsMessage=a};iAd.SearchDisplayController.prototype.setActive=function(a){this.setActiveAnimated(a,false)};
iAd.SearchDisplayController.prototype.setActiveAnimated=function(a,b){if(this._active!=a){this._active=a;this.dispatchNotification(a?iAd.SearchDisplayController.WILL_BEGIN_SEARCH:iAd.SearchDisplayController.WILL_END_SEARCH,this.delegate);var c=this.searchBar.isInBar();if(!c){b=false;var d=this.searchContentsController.view,e=new iAd.Rect,f=d.frame;e=this.searchBar.convertRectToView(this.searchBar.frame,d);if(!this._dimmingView){this._dimmingView=new iAd.View;this._dimmingView.userInteractionEnabled=
true;this._dimmingView.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this._dimmingView.layer.style.setProperty("background-color","black");this._dimmingView.opacity=0.5}this._dimTableViewOnEmptySearchString&&d.addSubview(this._dimmingView);this._dimmingView.frame=new iAd.Rect(f.origin.x,e.maxY(),f.size.width,f.size.height-e.maxY());if(this._searchResultsTableView)this._searchResultsTableView.frame=this._dimmingView.frame}if(!this._active)this.searchBar.editing=false;this.notifyPropertyChange("active");
if(!b||c)this.showHideAnimationDidFinish()}};
iAd.SearchDisplayController.prototype.showHideAnimationDidFinish=function(){if(this._active)this.searchBar.isInBar()&&this.setSearchResultsTableViewVisible(this.searchBar.text.length>0,this.searchContentsController.view);else{this.setSearchResultsTableViewVisible(false,this.searchContentsController.view);this.destroyManagedTableView();if(this._dimmingView){this._dimmingView.removeFromSuperview();this._dimmingView=null}}this.dispatchNotification(this._active?iAd.SearchDisplayController.DID_BEGIN_SEARCH:
iAd.SearchDisplayController.DID_END_SEARCH,this.delegate)};iAd.SearchDisplayController.prototype.setSearchResultsTableView=function(){};iAd.SearchDisplayController.prototype.getSearchResultsTableView=function(){if(!this._searchResultsTableView)this._searchResultsTableView=this.createSearchResultsTableView();return this._searchResultsTableView};
iAd.SearchDisplayController.prototype.createSearchResultsTableView=function(){var a=new iAd.SearchResultsTableView;a._searchDisplayController=this;a.tableStyle=iAd.TableView.STYLE_PLAIN;a.dataSource=this.searchResultsDataSource;a.delegate=this.searchResultsDelegate;a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.dispatchNotification(iAd.SearchDisplayController.DID_LOAD_SEARCH_RESULTS_TABLE_VIEW,this.delegate,[["tableView",a]]);return a};
iAd.SearchDisplayController.prototype.tableViewFrame=function(){var a=this.searchContentsController.view,b=a.frame;a=this.searchBar.convertRectToView(this.searchBar.frame,a);return new iAd.Rect(b.origin.x,a.maxY(),b.size.width,b.maxY()-a.maxY())};
iAd.SearchDisplayController.prototype.setSearchResultsTableViewVisible=function(a,b){var c=this.searchBar.isInBar(),d=b||this.searchContentsController.view;if(a&&(!this._searchResultsTableView||this._searchResultsTableView.superview==null||c&&(!this._popoverController||!this._popoverController.popoverVisible))){var e=this.searchResultsTableView;this.dispatchNotification(iAd.SearchDisplayController.WILL_SHOW_SEARCH_RESULTS_TABLE_VIEW,this.delegate,[["tableView",e]]);if(c){if(!this._popoverController)this._popoverController=
this.createPopoverController();this._popoverController.passthroughViews=[this.searchBar];this._popoverController.presentPopoverFromBarButtonItemPermittedArrowDirectionsAnimated(this.searchBar.barButtonItem,iAd.PopoverController.ARROW_DIRECTION_UP|iAd.PopoverController.ARROW_DIRECTION_DOWN,true)}else{e.frame=this.tableViewFrame();d.addSubview(e)}this.dispatchNotification(iAd.SearchDisplayController.DID_SHOW_SEARCH_RESULTS_TABLE_VIEW,this.delegate,[["tableView",e]])}else if(!a&&(this._searchResultsTableView&&
this._searchResultsTableView.superview||c)){this.dispatchNotification(iAd.SearchDisplayController.WILL_HIDE_SEARCH_RESULTS_TABLE_VIEW,this.delegate,[["tableView",this._searchResultsTableView]]);if(c){this._popoverController&&this._popoverController.popoverVisible&&this._popoverController.dismissPopoverAnimated(false);this._popoverController=null}else{this._dimTableViewOnEmptySearchString&&this._dimmingView&&d.addSubview(this._dimmingView);this._searchResultsTableView.removeFromSuperview()}this.dispatchNotification(iAd.SearchDisplayController.DID_HIDE_SEARCH_RESULTS_TABLE_VIEW,
this.delegate,[["tableView",this._searchResultsTableView]])}};iAd.SearchDisplayController.prototype.createPopoverController=function(){var a=new iAd.ViewController;a.title=this.searchResultsTitle||iAd.SearchDisplayController.SEARCH_RESULTS_TITLE_DEFAULT;a.view=this.searchResultsTableView;a=new iAd.NavigationController(null,a);a=new iAd.PopoverController(a);a.delegate=this;return a};
iAd.SearchDisplayController.prototype.destroyManagedTableView=function(){if(this._searchResultsTableView){this.dispatchNotification(iAd.SearchDisplayController.WILL_UNLOAD_SEARCH_RESULTS_TABLE_VIEW,this.delegate,[["tableView",this._searchResultsTableView]]);this._searchResultsTableView.removeFromSuperview();this._searchResultsTableView=null}if(this._popoverController){this._popoverController.isPopoverVisible&&this._popoverController.dismissPopoverAnimated(false);this._popoverController=null}};
iAd.SearchDisplayController.prototype.updateNoSearchResultsMessageVisibility=function(){this._automaticallyDisplayNoResultsMessage&&this.searchResultsTableViewRowCount()};iAd.SearchDisplayController.prototype.searchResultsTableViewRowCount=function(){return this._searchResultsTableView.calculateNumberOfRows()};
iAd.SearchDisplayController.prototype.searchBarCancelButtonClicked=function(){var a=true;if(iAd.Utils.objectHasMethod(this.delegate,iAd.SearchDisplayController.SHOULD_DEACTIVATE_ON_CANCEL_BUTTON_CLICKED))a=this.delegate[iAd.SearchDisplayController.SHOULD_DEACTIVATE_ON_CANCEL_BUTTON_CLICKED]();a&&this.setActiveAnimated(false,true)};iAd.SearchDisplayController.prototype.searchBarTextDidBeginEditing=function(){this.setActiveAnimated(true,true)};
iAd.SearchDisplayController.prototype.searchBarTextDidChange=function(a,b){var c=this.searchResultsTableView,d=true;if(iAd.Utils.objectHasMethod(this.delegate,iAd.SearchDisplayController.SHOULD_RELOAD_TABLE_FOR_SEARCH_STRING))d=this.delegate[iAd.SearchDisplayController.SHOULD_RELOAD_TABLE_FOR_SEARCH_STRING](this,b);d&&c.reloadData();this.setSearchResultsTableViewVisible(b.length||this._popoverController&&this._popoverController.popoverVisible)};
iAd.SearchDisplayController.prototype.popoverControllerDidDismissPopover=function(){this.setActiveAnimated(false,false)};iAd.SearchDisplayController.prototype.popoverControllerShouldDismissPopover=function(){if(this.searchBar.editing)this.searchBar.editing=false;return true};iAd.SearchDisplayController.prototype.searchResultsTableViewNumberOfRowsDidChange=function(){this.updateNoSearchResultsMessageVisibility()};
iAd.SearchDisplayController.prototype.handleEvent=function(a){var b=a.ad?a.ad.sender:null;a.type==iAd.View.TOUCH_UP_INSIDE_EVENT&&b&&b==this._dimmingView&&this.searchBarCancelButtonClicked()};iAd.Class({name:"iAd.SearchResultsTableView",superclass:iAd.TableView});iAd.SearchResultsTableView.NUMBER_OF_ROWS_DID_CHANGE="searchResultsTableViewNumberOfRowsDidChange";iAd.SearchResultsTableView.prototype.init=function(a){this._searchDisplayController=null;this.callSuper(a)};
iAd.SearchResultsTableView.prototype.reloadData=function(){var a=this.calculateNumberOfRows();this.callSuper();var b=this.calculateNumberOfRows();a!=b&&this._searchDisplayController&&this._searchDisplayController[iAd.SearchResultsTableView.NUMBER_OF_ROWS_DID_CHANGE]()};iAd.SearchResultsTableView.prototype.calculateNumberOfRows=function(){for(var a=this.numberOfSections,b=0,c=0;c<a;c++)b+=this.numberOfRowsInSection(c);return b};iAd.Class({name:"WK.RelatedSection",superclass:WK.SidebarSection});
WK.RelatedSection.prototype={init:function(a,b){this.callSuper(a,b);this.title="_Document.Sidebar.Related".loc();this.emptyPlaceholder="_Document.Sidebar.Related.None".loc();this.paginatesIfNeeded=true},loadView:function(){this.callSuper();this.getDataFromServer()},getDataFromServer:function(){server_proxy().relationshipsForGUID(this.docEntity.guid,function(a){if(a.length){var b=$A(a);a=b.collect(function(c){return c.targetEntityGUID});server_proxy().entitiesForGUIDsWithOptions(a,{subpropertyPaths:{"ownerGUID.type":"owner.type",
"ownerGUID.guid":"owner.guid","ownerGUID.longName":"owner.longName","ownerGUID.shortName":"owner.shortName"}},function(c){if(c){for(var d=0;d<c.length;d++)b[d].targetEntity=c[d];this.collection=b}}.bind(this),function(){logger().error("couldn't expand related entities")})}}.bind(this),function(){logger().error("couldn't load related docs from server")})},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||new WK.TableViewCellWithImage(null,
iAd.TableViewCell.STYLE_SUBTITLE),d=this.collection[b.row].targetEntity;if(d){c.text=WK.FormatterUtilities.displayNameForEntity(d);c.detailedText=WK.FormatterUtilities.locationDescriptionForContainer(d.owner);c.image=WK.FormatterUtilities.iconImageForEntity(d,true,32,32)}if(this.canEdit)c.editingStyle=iAd.TableViewCell.EDITING_STYLE_DELETE;return c},tableViewPlaceholderCell:function(a){a=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||new WK.TableViewCellWithImage;a.text="_Document.Sidebar.Related.Add".loc();
a.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/placeholder_empty.png",true);a.layer.classList.add("wk-related-placeholder-cell");return a},tableViewDidSelectRegularRowAtIndexPath:function(a,b){var c=this.collection[b.row].targetEntity;globalRouteHandler().routeURL("/wiki/pages/%@".fmt(c.tinyID))},tableViewDidSelectPlaceholderRow:function(a){var b=new WK.RelatedPicker(this.collection,this.docEntity.guid);b.delegate=this;this.navigation=new iAd.NavigationController(null,b);this.navigation.contentSizeForViewInPopover=
b.contentSizeForViewInPopover;this.popover=new iAd.PopoverController(this.navigation);this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(a.frame,this.view,iAd.PopoverController.ARROW_DIRECTION_ANY,true)},tableViewCommitEditingStyleForRegularRowAtIndexPath:function(a,b,c){if(b==iAd.TableViewCell.EDITING_STYLE_DELETE){a=this.collection[c.row].guid;server_proxy().deleteRelationship(a,function(){this.collection.splice(c.row,1);this.notifyPropertyChange("collection")}.bind(this),
function(){logger().error("couldn't remove relationship")})}},pickerDidSelectItem:function(a){server_proxy().relateEntities(this.docEntity.guid,a.guid,function(){this.getDataFromServer();this.popover.dismissPopoverAnimated(true)}.bind(this),function(){logger().error("couldn't relate entities");this.popover.dismissPopoverAnimated(true)})}};iAd.Class({name:"WK.RelatedPicker",superclass:iAd.ViewController,synthesizedProperties:["docs","searchResults"]});
WK.RelatedPicker.prototype={MAX_NUMBER_OF_RECENTS:10,init:function(a,b){this.callSuper(null);this.contentSizeForViewInPopover=new iAd.Size(320,this.MAX_NUMBER_OF_RECENTS*iAd.TableView.DEFAULT_ROW_HEIGHT+iAd.SearchBar.DEFAULT_HEIGHT+iAd.TableView.PLAIN_HEADER_HEIGHT);this.title="_Document.Sidebar.Related.SuggestedDocuments".loc();this._currentlyRelated=a;this._documentGUID=b;this._docs=[];this._searchResults=[];this.addPropertyObserver("docs",this,"docsListChanged");this.getRecentsFromServer()},getRecentsFromServer:function(){var a=
this.MAX_NUMBER_OF_RECENTS+this._currentlyRelated.length;server_proxy().recentDocumentsWithOptions(a,{subpropertyPaths:{"ownerGUID.longName":"owner.longName","ownerGUID.shortName":"owner.shortName"}},function(b){var c=$A(this._currentlyRelated).pluck("targetEntity").pluck("guid");c.push(this._documentGUID);this.docs=b=b.filter(function(d){return c.indexOf(d.guid)==-1}.bind(this));this.contentSizeForViewInPopover=new iAd.Size(320,b.length*iAd.TableView.DEFAULT_ROW_HEIGHT-1)}.bind(this),function(){logger().error("couldn't load history data from server")})},
docsListChanged:function(){this.tableView.reloadData();this.contentSizeForViewInPopover=new iAd.Size(320,this.docs.length*iAd.TableView.DEFAULT_ROW_HEIGHT+iAd.SearchBar.DEFAULT_HEIGHT+iAd.TableView.PLAIN_HEADER_HEIGHT)},loadView:function(){this.callSuper();var a=new iAd.View,b=new iAd.SearchBar;b.placeholder="_Search".loc();b.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;a.addSubview(b);this.tableView=new iAd.TableView(null);this.tableView.tableStyle=iAd.TableView.STYLE_PLAIN;this.tableView.dataSource=
this;this.tableView.delegate=this;this.tableView.position=new iAd.Point(0,iAd.SearchBar.DEFAULT_HEIGHT);this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;a.addSubview(this.tableView);this.searchDisplayController=new iAd.SearchDisplayController(b,this);this.searchDisplayController.delegate=this;this.searchDisplayController.searchResultsDataSource=this;this.searchDisplayController.searchResultsDelegate=this;this.view=a},searchForString:function(a){a=
server_proxy().searchQuery(a,["com.apple.entity.File","com.apple.entity.Page"],0,20);server_proxy().searchQueryUpdateSort(a,"-rank");server_proxy().entitiesForSearchQuery(a,function(b){b=$A(b).collect(function(d){return d.entity});var c=$A(this._currentlyRelated).pluck("targetEntity").pluck("guid");c.push(this._documentGUID);this.searchResults=b=b.filter(function(d){return c.indexOf(d.guid)==-1}.bind(this));this.contentSizeForViewInPopover=new iAd.Size(320,b.length*iAd.TableView.DEFAULT_ROW_HEIGHT-
1)}.bind(this),function(){logger.error("Error getting results for related search")}.bind(this))},searchDisplayControllerShouldReloadTableForSearchString:function(a,b){this.searchForString(b);return true},numberOfSectionsInTableView:function(){return 1},tableViewNumberOfRowsInSection:function(a){return a==this.searchDisplayController.searchResultsTableView?this.searchResults.length:this.docs.length},tableViewCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||
new WK.TableViewCellWithImage(null,iAd.TableViewCell.STYLE_SUBTITLE),d=a==this.searchDisplayController.searchResultsTableView?this.searchResults[b.row]:this.docs[b.row];c.text=WK.FormatterUtilities.displayNameForEntity(d);c.detailedText=WK.FormatterUtilities.locationDescriptionForContainer(d.container);c.image=WK.FormatterUtilities.iconImageForEntity(d,true,32,32);return c},tableViewDidSelectRowAtIndexPath:function(a,b){this.delegate.pickerDidSelectItem(a==this.searchDisplayController.searchResultsTableView?
this.searchResults[b.row]:this.docs[b.row])}};iAd.Class({name:"WK.TagsSection",superclass:WK.SidebarSection});
WK.TagsSection.prototype={init:function(a,b){this.callSuper(a,b);this.title="_Document.Sidebar.Tags".loc();this.emptyPlaceholder="_Document.Sidebar.Tags.None".loc();this._collection=this.docEntity.tags},tableViewPlaceholderCell:function(a){a=a.dequeueReusableCellWithIdentifier("WK.InlineTextInputTableViewCell")||new WK.InlineTextInputTableViewCell;a.textInput.layer.addEventListener("keyup",this,false);return a},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCell()||new iAd.TableViewCell;
c.text=this.collection[b.row];if(this.canEdit)c.editingStyle=iAd.TableViewCell.EDITING_STYLE_DELETE;return c},tableViewDidSelectRegularRowAtIndexPath:function(a,b){var c=this.collection[b.row];globalRouteHandler().routeURL("/wiki/find?tags=%@".fmt(c))},tableViewCommitEditingStyleForRegularRowAtIndexPath:function(a,b,c){if(b==iAd.TableViewCell.EDITING_STYLE_DELETE){var d=this.collection[c.row];server_proxy().deleteTagForOwner(d,this.docEntity.guid,function(){this.collection.splice(c.row,1);this.notifyPropertyChange("collection")}.bind(this),
function(){logger().error("couldn't remove tag: "+d)})}},handleEvent:function(a){this.callSuper(a);if(a.type=="keyup"){var b=this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,0)).textInput.layer;if(a.keyCode==13)b.value.length&&this.addTag(b.value,function(){this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,0)).textInput.layer.focus()}.bind(this));else{this.tagPicker||logger.error("Should have tag picker by now");this.tagPicker.prefix=b.value}}},tableViewDidSelectPlaceholderRow:function(a){this.tagPicker=
new WK.TagPicker;this.tagPicker.delegate=this;this.navigation=new iAd.NavigationController(null,this.tagPicker);this.navigation.contentSizeForViewInPopover=this.tagPicker.contentSizeForViewInPopover;this.tagPicker.addPropertyObserver("contentSizeForViewInPopover",this,"suggestionsListSizeDidChange");this.popover=new iAd.PopoverController(this.navigation);this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(a.frame,this.view,iAd.PopoverController.ARROW_DIRECTION_RIGHT,true)},suggestionsListSizeDidChange:function(){var a=
this.tagPicker.contentSizeForViewInPopover;this.navigation.contentSizeForViewInPopover=new iAd.Size(a.width,a.height+iAd.NavigationBar.DEFAULT_HEIGHT)},pickerDidSelectItem:function(a){this.addTag(a,function(){this.popover.dismissPopoverAnimated(true)}.bind(this))},addTag:function(a,b){this.collection.indexOf(a)==-1&&server_proxy().addTagForOwner(a,this.docEntity.guid,function(){this.collection.unshift(a);this.notifyPropertyChange("collection");b&&b(true)}.bind(this),function(){logger().error("couldn't add tag: "+
a);b&&b(false)})}};iAd.Class({name:"WK.TagPicker",superclass:iAd.ViewController,synthesizedProperties:["prefix","suggestions"]});
WK.TagPicker.prototype={init:function(){this.callSuper();this.title="_Document.Sidebar.Tags.SuggestedTags".loc();this._suggestions=[];this._prefix="";this.addPropertyObserver("suggestions",this,"suggestionsDidChange")},setPrefix:function(a){this._prefix=a;a.length==0?server_proxy().allTagsStartingWith(a,function(b){this.suggestions=b}.bind(this)):server_proxy().allTags(function(b){this.suggestions=b}.bind(this))},suggestionsDidChange:function(){this.tableView.reloadData();this.computeContentSize()},
computeContentSize:function(){this.contentSizeForViewInPopover=new iAd.Size(320,(this.suggestions.length||1)*iAd.TableView.DEFAULT_ROW_HEIGHT-7)},loadView:function(){this.callSuper();this.tableView=new iAd.TableView;this.tableView.tableStyle=iAd.TableView.STYLE_PLAIN;this.tableView.dataSource=this;this.tableView.delegate=this;this.view=this.tableView;this.computeContentSize()},tableViewNumberOfRowsInSection:function(){return this.suggestions.length||1},tableViewCellForRowAtIndexPath:function(a,b){var c=
this.tableView.dequeueReusableCell()||new iAd.TableViewCell;c.text=this.suggestions.length?this.suggestions[b.row]:"No suggestions";if(this.suggestions.length==0){c.layer.style.color="lightgray";c.layer.style.textAlign="center"}return c},tableViewDidSelectRowAtIndexPath:function(a,b){this.suggestions.length!=0&&this.delegate.pickerDidSelectItem(this.suggestions[b.row])}};iAd.Class({name:"WK.NotificationsSection",superclass:WK.SidebarSection,synthesizedProperties:["subscriptions"]});
WK.NotificationsSection.prototype={wikiNotificationsTriggers:[{name:"_Document.Sidebar.Notifications.Updated".loc(),enabled:false}],pageNotificationsTriggers:[{name:"_Document.Sidebar.Notifications.DocumentUpdated".loc(),enabled:false},{name:"_Document.Sidebar.Notifications.CommentAdded".loc(),enabled:false}],init:function(a){this.callSuper(a,false);this.title="_Document.Sidebar.Notifications".loc();this._collection=this.docEntity.isDetailPage?this.wikiNotificationsTriggers:this.pageNotificationsTriggers},
loadView:function(){this.callSuper();this.tableView.allowsSelection=false;this.getDataFromServer()},getDataFromServer:function(){var a=this.docEntity.isDetailPage?this.docEntity.containerGUID:this.docEntity.guid;server_proxy().subscriptionsForEntity(a,function(b){if(b.reason=="no-email")prompt("_Document.Sidebar.Notifications.EmailInputTitle".loc(),null)&&this.saveUserEmailToServer(text,null,function(){logger().error("couldn't push email adress to server")});else{b=b.response;if(b.indexOf("com.apple.notifications.DocumentUpdated")!=
-1||b.indexOf("com.apple.notifications.DocumentRenamed")!=-1)this.collection[0].enabled=true;if(b.indexOf("com.apple.notifications.CommentAdded")!=-1||b.indexOf("com.apple.notifications.CommentApproved")!=-1)this.collection[1].enabled=true;this.notifyPropertyChange("collection")}}.bind(this),function(){logger().error("couldn't load notifications from server")})},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=new WK.TableViewCellWithSwitch;c.text=this.collection[b.row].name;if(c.subviews&&
c.subviews[1]&&"tag"in c.subviews[1])c.subviews[1].tag=b.row;c.on=this.collection[b.row].enabled;c.control.addEventListener("controlValueChange",this,false);return c},tableViewDidSelectRegularRowAtIndexPath:function(a,b){a.deselectRowAtIndexPathAnimated(b,false)},handleEvent:function(a){this.callSuper(a);if(a.type=="controlValueChange"){var b=a.target._view,c=b.on,d;if(b.tag==0)d=["com.apple.notifications.DocumentUpdated","com.apple.notifications.DocumentRenamed"];else if(b.tag==1)d=["com.apple.notifications.CommentAdded",
"com.apple.notifications.CommentApproved"];a=this.docEntity.isDetailPage?this.docEntity.containerGUID:this.docEntity.guid;var e=[],f=[],g=function(i){i==="email"?notifier().printErrorMessage("_Sharing.Notification.Updating.Subscription.Failed.Email".loc()):notifier().printErrorMessage("_Sharing.Notification.Updating.Subscription.Failed".loc());b.removeEventListener("controlValueChange",this,false);b.setOnAnimated(!c,true);b.addEventListener("controlValueChange",this,false);logger().error(i)}.bind(this);
if(b.on==true)e=d;else f=d;this.updateSubscriptionForEntity(a,e,f,function(){},g)}},updateSubscriptionForEntity:function(a,b,c,d,e){var f=cachedCurrentUser.guid;server_proxy().entityForGUID(f,function(g){if((g&&g.privateAttributes||{}).preferredEmailAddress){var i=[];b.each(function(h){i.push(["ContentService","subscribeToEntity:withType:",[a,h]])});c.each(function(h){i.push(["ContentService","unsubscribeFromEntity:withType:",[a,h]])});return service_client().batchExecuteAsynchronously(i,{},d,e)}else{dialogManager().hide();
logger().error("no preferred email address");e&&e("email")}},function(){dialogManager().hide();logger().error("Could not get preferredEmail setting for user before updating subscription");e&&e(null)})},saveUserEmailToServer:function(a,b,c){var d=cachedCurrentUser,e=d.guid,f=server_proxy().mStore.workingCopyForGUID(e),g=f.privateAttributes||{};g.preferredEmail=a;server_proxy().mStore.pushChangeForObject(f,"privateAttributes",g);a=server_proxy().mStore.buildChangesetForObjectWithGUID(e);d=new CC.EntityTypes.EntityChangeSet({changeAction:"UPDATE",
entityGUID:e,entityRevision:d.revision,entityType:"com.apple.entity.User",changes:a,force:false});server_proxy().updateEntity(d,function(){b()}.bind(this),function(){c()})}};iAd.Class({name:"WK.HistorySection",superclass:WK.SidebarSection,synthesizedProperties:["revisionsService","isShowingDiffs"]});
WK.HistorySection.prototype={init:function(a){this.callSuper(a,false);this.title="_Document.Sidebar.History".loc();this.emptyPlaceholder="_Document.Sidebar.History.None".loc();this.paginatesIfNeeded=true;this.PAGINATION_LIMIT=0;this._isShowingDiffs=this._isToolbarVisible=false},loadView:function(){this.callSuper();this.getDataFromServer();globalNotificationCenter().subscribe(CC.WikiEditor.NOTIFICATION_DID_SAVE_PAGE_WITH_GUID,this.handlePageSavedNotificationForGUID.bind(this))},getDataFromServer:function(){server_proxy().revisionsForGUID(this.docEntity.guid,
function(a){a=a.response;if(!(a.length==1&&!a[0].updateTime))this.collection=a}.bind(this),function(){logger().error("couldn't load history data from server")})},paginationCell:function(){var a=this.tableView.dequeueReusableCell()||new iAd.TableViewCell(null,iAd.TableViewCell.STYLE_SUBTITLE);a.text="_Document.Sidebar.History".loc();a.detailedText=this.collection.length==1?"_Document.Sidebar.History.VersionAvailableSingular".loc():"_Document.Sidebar.History.VersionAvailablePlural".loc(this.collection.length);
a.accessoryType=iAd.TableViewCell.ACCESSORY_DISCLOSURE_INDICATOR;return a},tableViewHeightForPaginationRow:function(){return iAd.TableView.DEFAULT_ROW_HEIGHT},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=this.collection[b.row],d=a.dequeueReusableCell()||new iAd.TableViewCell(null,iAd.TableViewCell.STYLE_SUBTITLE);d.cellStyle=iAd.TableViewCell.STYLE_SUBTITLE;d.text=globalLocalizationManager().localizedDateTime(c.updateTime);d.detailedText=c.updatedByUserLongName||c.updatedByUserShortName;
return d},tableViewDidSelectRegularRowAtIndexPath:function(a,b){if(this.currentlySelectedPath&&this.currentlySelectedPath.equals(b))this.exitRevisionsUI();else{this.currentlySelectedPath=b;this.showRevisionsToolbar();this.showPageAtRevision(this.collection[b.row].revision)}},showRevisionsToolbar:function(){if(!this.revisionsToolbar){this.revisionsToolbar=new iAd.Toolbar;this.revisionsToolbar.layer.style.zIndex=200;var a=[];this.restoreButton=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_SQUARE);this.restoreButton.view.layer.setAttribute("aria-label",
"_Revisions.Controls.Restore.Label".loc());this.restoreButton.view.layer.setAttribute("name","_Revisions.Controls.Restore.Label".loc());this.restoreButton.style=iAd.BarButtonItem.STYLE_BLACK;this.restoreButton.title="_Revisions.Controls.Restore.Label".loc();this.restoreButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.restoreSelectedRevision.bind(this),false);a.push(this.restoreButton);a.push(new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_FLEXIBLE_SPACE));if(this.docEntity.type!="com.apple.entity.File"){this.showDiffsButton=
new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_SQUARE);this.showDiffsButton.view.layer.setAttribute("aria-label","_Control.ShowDiff".loc());this.showDiffsButton.view.layer.setAttribute("name","_Control.ShowDiff".loc());this.showDiffsButton.style=iAd.BarButtonItem.STYLE_BLACK;this.showDiffsButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.toggleShowDiffs.bind(this),false);a.push(this.showDiffsButton);this.isShowingDiffs=false}this.cancelButton=new iAd.BarButtonItem(iAd.BarButtonItem.TYPE_SQUARE);
this.cancelButton.view.layer.setAttribute("aria-label","_Control.Cancel".loc());this.cancelButton.view.layer.setAttribute("name","_Control.Cancel".loc());this.cancelButton.style=iAd.BarButtonItem.STYLE_BLACK;this.cancelButton.title="_Control.Cancel".loc();this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.exitRevisionsUI.bind(this),false);a.push(this.cancelButton);this.revisionsToolbar.setItemsAnimated(a,true)}iAd.RootView.sharedRoot.addSubview(this.revisionsToolbar)},exitRevisionsUI:function(){this.showingRevision=
false;globalRouteHandler().setRoutePrefireCallback(this.mStashedRoutePrefireCallback);this.revisionsToolbar.removeFromSuperview();this._hideRenderedPage();this.tableView.deselectRowAtIndexPathAnimated(this.tableView.indexPathForSelectedRow(),true);this.currentlySelectedPath=null;this.setPreviewMode(false)},getRevisionsService:function(){if(!this._revisionsService)this._revisionsService=new CC.Revisions.RevisionService;return this._revisionsService},showPageAtRevision:function(a){if(!this.showingRevision){this.setPreviewMode(false);
this.mStashedRoutePrefireCallback=globalRouteHandler().mRoutePrefireCallback;globalRouteHandler().setRoutePrefireCallback(function(){return false}.bind(this))}this.setPreviewMode(true);this.showingRevision=true;this.isShowingDiffs?this.showDiffedPageAtRevision(a):this.showRawPageAtRevision(a)},showDiffedPageAtRevision:function(a){this.diffCache=this.diffCache||[];var b=this.diffCache[a]||null;if(b)this._showRenderedPage(b);else{b=this.collection[this.currentlySelectedPath.row+1];this.revisionsService.getDiffForEntityBetweenRevisions(this.docEntity.guid,
b?b.revision:0,this.collection[this.currentlySelectedPath.row].revision,function(c){var d=Builder.node("div");d.innerHTML=c;this.diffCache[a]=d;this._showRenderedPage(d)}.bind(this))}},showRawPageAtRevision:function(a){this.revisionsCache=this.revisionsCache||[];var b=this.revisionsCache[a]||null;b?this._showRenderedPage(b):this.revisionsService.getRevisionForEntityWithGUID(this.docEntity.guid,a,function(c){var d=Builder.node("div");if(c.extendedAttributes&&c.extendedAttributes.renderedPage){d.innerHTML=
c.extendedAttributes.renderedPage;d.select('*[contentEditable="true"]').invoke("removeAttribute","contentEditable");d.select(".editing").invoke("removeClassName","editing")}else if(c.previewGUIDs||c.iconGUID){c=CC.Files.buildInlineFileDetailView(c,true);d.appendChild(c.mParentElement)}else d.appendChild(Builder.node("h1",{className:"empty"},"_Revisions.Placeholder.Empty.Revision".loc()));this.revisionsCache[a]=d;this._showRenderedPage(d)}.bind(this))},_showRenderedPage:function(a){var b=this.navigationController.parentViewController.parentViewController.contentViewController;
this._hideRenderedPage();this.revisionView=new iAd.View(a);this.revisionView.layer.classList.add("wk-revision-preview");b.view.addSubview(this.revisionView)},_hideRenderedPage:function(){this.revisionView&&this.revisionView.removeFromSuperview()},toggleShowDiffs:function(){this.isShowingDiffs=!this.isShowingDiffs},setIsShowingDiffs:function(a){this._isShowingDiffs=a;this.showDiffsButton.title=a?"_Revisions.Controls.HideChanges.Label".loc():"_Revisions.Controls.ShowChanges.Label".loc();this.showPageAtRevision(this.collection[this.currentlySelectedPath.row].revision)},
restoreSelectedRevision:function(){this.revisionsService.restoreEntityWithGUIDToRevision(this.docEntity.guid,this.collection[this.currentlySelectedPath.row].revision,function(a){this.exitRevisionsUI();a&&a.guid?window.location.reload():logger().error("Couldn't restore previous revision")}.bind(this))},handlePageSavedNotificationForGUID:function(){this.getDataFromServer()},setPreviewMode:function(a){var b=document.querySelector(".ad-hosting-layer .editor"),c=document.querySelector(".ad-hosting-layer div.files.info.cc-view");
if(b)a?b.setAttribute("style","display:none"):b.setAttribute("style","display:");if(c)isFirstHistoryView?c.setAttribute("style","display:none"):c.setAttribute("style","display:")}};iAd.Class({name:"WK.SharingSection",superclass:WK.SidebarSection,synthesizedProperties:["acls"]});
WK.SharingSection.prototype={init:function(a){this.callSuper(a,true);this.title="_Document.Sidebar.Sharing".loc();this.emptyPlaceholder="_Document.Sidebar.Sharing.None".loc();this.paginatesIfNeeded=false},loadView:function(){this.callSuper();this.getDataFromServer()},getDataFromServer:function(){server_proxy().aclsForEntityGUID(this.docEntity.guid,function(a){this.acls=a}.bind(this),function(){logger().error("couldn't get sharing ACLS from server")})},setAcls:function(a){this._acls=a;var b=[];a.forEach(function(c){c.action!=
"none"&&c.allow!="false"&&c.userExternalID!=cachedCurrentUser.externalID&&b.push(c)});this.collection=b},tableViewRegularCellForRowAtIndexPath:function(a,b){var c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||new WK.TableViewCellWithImage(null,iAd.TableViewCell.STYLE_SUBTITLE),d=this.collection[b.row];c.text=d.userLongName||d.userLogin;c.detailedText=("_Access.Role."+d.action).loc();c.image=WK.FormatterUtilities.iconImageForEntity(d,true,32,32);return c},tableViewPlaceholderCell:function(a){a=
a.dequeueReusableCellWithIdentifier("WK.TableViewCellWithImage")||new WK.TableViewCellWithImage;a.text="_Document.Sidebar.Sharing.Add".loc();a.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/placeholder_empty.png",true);a.layer.classList.add("wk-related-placeholder-cell");return a},tableViewDidSelectRegularRowAtIndexPath:function(){},tableViewDidSelectPlaceholderRow:function(a){this.picker=new WK.SharingPicker(this.acls,this.docEntity.guid);this.picker.delegate=this;this.navigation=
new iAd.NavigationController(null,this.picker);this.navigation.contentSizeForViewInPopover=this.picker.contentSizeForViewInPopover;this.picker.addPropertyObserver("contentSizeForViewInPopover",this,"pickerSizeDidChange");this.popover=new iAd.PopoverController(this.navigation);this.popover.passthroughViews=[new iAd.View(this.picker.mAccessEditor.userSearchField.mResultTable)];this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(a.frame,this.view,iAd.PopoverController.ARROW_DIRECTION_RIGHT,
true)},pickerSizeDidChange:function(){popSize=this.picker.contentSizeForViewInPopover;this.navigation.contentSizeForViewInPopover=new iAd.Size(popSize.width,popSize.height+iAd.NavigationBar.DEFAULT_HEIGHT)},pickerDidSelectItem:function(a){if(a)this.acls=this.collection=a;this.popover.dismissPopoverAnimated(true)}};iAd.Class({name:"WK.SharingPicker",superclass:iAd.ViewController});
WK.SharingPicker.prototype={init:function(a,b){this.callSuper(null);this.acls=a;this.guid=b},getContentSizeForViewInPopover:function(){if(this.mAccessEditor&&this.mAccessEditor.mACLItems)return new iAd.Size(472,(this.mAccessEditor.mACLItems.length+1)*iAd.TableView.DEFAULT_ROW_HEIGHT-7)},loadView:function(){this.callSuper();this.mAccessEditor=new CC.AccessEditorView(this.acls,false,this.guid);this.mAccessEditor._render();var a=this.mAccessEditor.$();a.show();a=new iAd.View(a);this.notifyPropertyChange("contentSizeForViewInPopover");
this.mAccessEditorDidAddCallback=this.mAccessEditor.userSearchField.mClickedItemCallback;this.mAccessEditor.userSearchField.mClickedItemCallback=this.didAddACLItem.bind(this);this.title="_Document.Sidebar.Sharing.PopoverTitle".loc();this.navigationItem.rightBarButtonItem=new iAd.BarButtonItem;this.navigationItem.view.layer.setAttribute("aria-label","_Control.OK".loc());this.navigationItem.view.layer.setAttribute("name","_Control.OK".loc());this.navigationItem.rightBarButtonItem.title="_Control.OK".loc();
this.navigationItem.rightBarButtonItem.style=iAd.BarButtonItem.STYLE_DONE;this.navigationItem.rightBarButtonItem.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this.closeSharingPicker.bind(this),false);this.view=a},didAddACLItem:function(){this.mAccessEditorDidAddCallback.call(this.mAccessEditor);this.acls=this.mAccessEditor.mACLItems;this.notifyPropertyChange("contentSizeForViewInPopover")},closeSharingPicker:function(){if(this.mAccessEditor.dirty){this.navigationItem.rightBarButtonItem.enabled=
false;var a=this.mAccessEditor.validItems();this.mAccessEditor.save(function(){this.navigationItem.rightBarButtonItem.enabled=true;this.delegate.pickerDidSelectItem(a)}.bind(this))}else this.delegate.pickerDidSelectItem(null)}};iAd.Class({name:"WK.InfoMaster",superclass:WK.DocumentSidebarEditableViewController,synthesizedProperties:["doc","containerPermissions"]});
WK.InfoMaster.prototype={init:function(a,b){this.callSuper(false);this._doc=a;this.title="_Document.Sidebar.Info".loc();this._containerPermissions=b;this.sectionVCs=[];if(!a.isDetailPage)this.sectionVCs=this.sectionVCs.concat([new WK.CommentsSection(a),new WK.RelatedSection(a,this.containerPermissions.canWrite),new WK.TagsSection(a,this.containerPermissions.canWrite)]);var c=cachedUserPermissions;c.isLoggedIn&&this.sectionVCs.push(new WK.NotificationsSection(a));this.sectionVCs.push(new WK.HistorySection(a,
this.containerPermissions.canWrite));c.isLoggedIn&&!a.isDetailPage&&a.ownerGUID==cachedCurrentUser.guid&&this.sectionVCs.push(new WK.SharingSection(a))},loadView:function(){this.callSuper();this.container=new iAd.ScrollView;this.container.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.sectionVCs.forEach(function(a){a.parentViewController=this;this.container.addSubview(a.view);a.view.addPropertyObserver("size",this,"sectionSizeDidChange");a.addPropertyObserver("collection",
this,"sectionCollectionDidChange")},this);this.editing=false;this.view=this.container;this.layoutSections()},sectionSizeDidChange:function(){this.layoutSections()},sectionCollectionDidChange:function(){var a=false;this.sectionVCs.forEach(function(b){if(b.hasEditableContent())a=true});this.editButtonEnabled=a},layoutSections:function(){var a=0;this.sectionVCs.forEach(function(b){b.view.position=new iAd.Point(0,a);a+=b.view.size.height});this.container.contentSize.height=a},setEditing:function(a){this.callSuper(a);
this.sectionVCs.forEach(function(b){if(b.canEdit)b.editing=a})},viewWillAppear:function(){this.sectionVCs.forEach(function(a){a.viewWillAppear()})}};iAd.Class({name:"WK.DocumentSidebarViewController",superclass:iAd.ViewController});
WK.DocumentSidebarViewController.prototype={init:function(a,b){this.callSuper();this.docEntity=a;this.containerPermissions=b},loadView:function(){this.callSuper();this.navigation=new iAd.NavigationController;this.navigation.navigationBar.barStyle=iAd.NavigationBar.STYLE_DEFAULT;this.navigation.delegate=this;this.navigation.parentViewController=this;this.sectionsVC=new WK.InfoMaster(this.docEntity,this.containerPermissions);this.navigation.pushViewControllerAnimated(this.sectionsVC,true);this.view=
this.navigation.view;this.view.layer.classList.add("wk-info-sidebar")},navigationControllerWillShowViewControllerAnimated:function(a,b){b.isViewLoaded()||b.loadView();b.editing=a.visibleViewController.editing}};iAd.Class({name:"WK.DeleteDialog",superclass:WK.Dialog});
WK.DeleteDialog.prototype={init:function(a,b){this.callSuper(false);this._entity=a;var c;if(a.type=="com.apple.entity.Page")c="Page";else if(a.type=="com.apple.entity.File")c="File";else if(a.type=="com.apple.entity.Wiki")c="Project";this.title=c?("_Dialogs.Delete."+c+".Title").loc():"_Dialogs.Delete.Title".loc();this.details=c?("_Dialogs.Delete."+c+".Description").loc():"_Dialogs.Delete.Description".loc();this._canPermanentlyDelete=b},getContentView:function(){if(!this._contentView){var a=new iAd.View;
a.layer.id="wk-login-dialog";a.size=new iAd.Size(267,this._canPermanentlyDelete?140:110);var b=new iAd.Label;b.text=this.details;b.numberOfLines=2;b.layer.classList.add("wk-description");a.addSubview(b);if(this._canPermanentlyDelete){b=new iAd.Label;b.text="_Dialogs.Delete.Permanently".loc();b.layer.classList.add("wk-switch-description");a.addSubview(b);this.control=new iAd.Switch;this.control.on=false;a.addSubview(this.control)}this.cancelButton=new iAd.BarButton(iAd.BarButtonItem.TYPE_SQUARE);this.cancelButton.layer.setAttribute("aria-label",
"_Control.Cancel".loc());this.cancelButton.layer.setAttribute("name","_Control.Cancel".loc());this.cancelButton.title="_Control.Cancel".loc();this.cancelButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.cancelButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.addSubview(this.cancelButton);this.deleteButton=new iAd.BarButton(iAd.BarButtonItem.TYPE_DONE);this.deleteButton.layer.setAttribute("aria-label","_Control.Delete".loc());this.deleteButton.layer.setAttribute("name","_Control.Delete".loc());
this.deleteButton.title="_Control.Delete".loc();this.deleteButton.buttonStyle=iAd.BarButtonItem.STYLE_BLACK;this.deleteButton.layer.classList.add("wk-ok-button");this.deleteButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.addSubview(this.deleteButton);this._contentView=a}return this._contentView},handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT){a=a.ad.sender;if(a==this.cancelButton)this.hideDialog();else a==this.deleteButton&&this.deleteEntity()}},
deleteEntity:function(){var a=this.control?this.control.on:false,b=function(){this.hideDialog();var c;c=this._entity.type=="com.apple.entity.Wiki"?"/wiki/projects/":"/wiki/projects/%@".fmt(this._entity.container.tinyID);globalRouteHandler().routeURL(c)}.bind(this);server_proxy().deleteEntityWithGUID(this._entity.guid,a,b,function(){this.hideDialog();alert("_Error.Delete.Document.Permissions".loc())})}};
iAd.Class({name:"WK.DocumentViewController",superclass:WK.TopLevelViewController,synthesizedProperties:["documentEntity","containerPermissions"]});
WK.DocumentViewController.prototype={init:function(a,b,c){this.callSuper();this._containerPermissions=c;if(a)this.documentEntity=a;else this.title=b},loadView:function(){this.splitViewController=new WK.RightSidebarViewController;this.contentViewController=this.loadContentViewController();this.contentViewController.documentEntity=this.documentEntity;var a=new WK.DocumentSidebarViewController(this.documentEntity,this.containerPermissions);a.parentViewController=this;this.splitViewController.viewControllers=
[a,this.contentViewController];this.view=this.splitViewController.view;this.layoutSidebarDependingOnOrientation()},loadContentViewController:function(){return new iAd.View},didRotateFromInterfaceOrientation:function(){this.layoutSidebarDependingOnOrientation()},layoutSidebarDependingOnOrientation:function(){if(this.isViewLoaded()){this.splitViewController.isSidebarVisible=this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT||this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT_UPSIDE_DOWN?
false:true;this.navigationItemsDidChange()}},additionalRightBarButtonItems:function(){if(this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT||this.interfaceOrientation==iAd.Device.ORIENTATION_PORTRAIT_UPSIDE_DOWN){this.infoButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.infoButton.layer.setAttribute("aria-label","_Document.Sidebar.Info".loc());this.infoButton.layer.setAttribute("name","_Document.Sidebar.Info".loc());this.infoButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonInfo.png",
true);this.infoButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);return[this.infoButton]}return[]},additionalGearMenuItems:function(){var a=[];if(!this.documentEntity||this.documentEntity.isDetailPage)return a;var b=this.containerPermissions.owns;if(this.containerPermissions.canWrite||b){b=this.deleteMenuTitle||"_GearMenu.Delete.Title".loc();a.push({name:b,callback:this.deleteDocument.bind(this)})}b=this.replaceMenuTitle||"_GearMenu.General.Replace".loc();a.push({name:b,callback:this.replaceDocument.bind(this)});
return a},deleteDocument:function(){(new WK.DeleteDialog(this.documentEntity,this.containerPermissions.owns)).showDialog()},replaceDocument:function(){fileUploadManager().updateFileWithGUID(this.documentEntity.guid)},moveDocument:function(){},handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)(a=a.ad.sender)&&a==this.infoButton&&this.splitViewController.toggleIsSidebarVisible()}};iAd.Class({name:"WK.PageViewController",superclass:WK.DocumentViewController});
WK.PageViewController.prototype.deleteMenuTitle="_GearMenu.Delete.Page.Title".loc();WK.PageViewController.prototype.loadContentViewController=function(){return new WK.PageContentViewController(!this.documentEntity.isDetailPage)};
WK.PageViewController.prototype.additionalRightBarButtonItems=function(){var a=[];if(this.containerPermissions.canWrite){this.editButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.editButton.layer.setAttribute("aria-label","_Control.Edit".loc());this.editButton.layer.setAttribute("name","_Control.Edit".loc());this.editButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonEdit.png",true);this.editButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);
a.push(this.editButton)}var b=this.callSuper();return a.concat(b)};WK.PageViewController.prototype.handleEvent=function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)(a=a.ad.sender)&&a==this.editButton&&this.handleEditButtonTapped()};
WK.PageViewController.prototype.handleEditButtonTapped=function(){sharedEditorViewController||(sharedEditorViewController=new WK.SharedEditorViewController);sharedEditorViewController.editPageWithGUID(this.documentEntity.guid);sharedEditorViewController.shouldDisplayPageTitle=this.contentViewController.shouldDisplayPageTitle};iAd.Class({name:"WK.PageContentViewController",superclass:iAd.ViewController,synthesizedProperties:["documentEntity"]});
WK.PageContentViewController.prototype={init:function(a){this.shouldDisplayPageTitle=a!=undefined?a:true;this.callSuper()},loadView:function(){this.callSuper();var a=new WK.EditorView;_globalEditorController=this.readOnlyEditor=new CC.WikiEditor.ReadOnlyEditorController({mParentElement:a.hybridDrawingLayer,mPageGUID:this.documentEntity.guid});this.configurePageTitleDisplay();this.view=a;globalNotificationCenter().subscribe(CC.WikiEditor.NOTIFICATION_DID_SAVE_PAGE_WITH_GUID,this.handlePageSavedNotificationForGUID.bind(this))},
handlePageSavedNotificationForGUID:function(a,b,c){if(c&&c.entity&&c.guid){a=c.entity;this.readOnlyEditor._initializeInlineContent(server_proxy()._parseAndStoreEntity(a));this.configurePageTitleDisplay()}},configurePageTitleDisplay:function(){var a=this.readOnlyEditor.mEditorView.$().down(".cc-entity-title");this.shouldDisplayPageTitle?a.show():a.hide()}};iAd.Class({name:"WK.ServerHomepageViewController",superclass:WK.PageViewController});
WK.ServerHomepageViewController.prototype={reusableViewControllerID:"ServerHomepageViewController",init:function(a,b){this.callSuper();this.documentEntity=a;this.permissions=b},loadContentViewController:function(){return new WK.PageContentViewController(false)},loadView:function(){this.contentViewController=this.loadContentViewController();this.contentViewController.documentEntity=this.documentEntity;this.contentViewController.containerPermissions=this.permissions;this.view=this.contentViewController.view},
additionalRightBarButtonItems:function(){var a=[];if(this.permissions.canWrite){this.editButton=new iAd.BarButton(null,iAd.BarButtonItem.TYPE_PLAIN);this.editButton.layer.setAttribute("aria-label","_Control.Edit".loc());this.editButton.layer.setAttribute("name","_Control.Edit".loc());this.editButton.image=iAd.Image.imageForURL("/__collabd/coreclientmobile/images/buttonEdit.png",true);this.editButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);a.push(this.editButton)}return a},additionalGearMenuItems:function(){return[]},
handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)(a=a.ad.sender)&&this.editButton==a&&this.handleEditButtonTapped()}};iAd.Class({name:"WK.PaginatingDataSource",synthesizedProperties:["items"]});
WK.PaginatingDataSource.prototype={itemsPerPaginationWindow:25,paginationState:{},init:function(a,b,c){this.callSuper();this._items=[];this.searchTypes=a;this.searchFavorites=b;this.searchContainerGUID=c},buildQuery:function(a,b){var c=server_proxy().searchQuery([],this.searchTypes);c.onlyDeleted=false;c=server_proxy().searchQueryFavoritesOnly(c,this.searchFavorites);c=server_proxy().searchQueryUpdateSort(c,"+longName");c=server_proxy().searchQueryUpdateContainerGUID(c,this.searchContainerGUID);c.range=
[a||c.range[0],b||this.itemsPerPaginationWindow+1];return c},paginate:function(){var a=this.paginationState&&this.paginationState.startIndex!=undefined?this.paginationState.startIndex+this.paginationState.previousResults.length:0,b=this.itemsPerPaginationWindow+1,c=this.buildQuery(a,b);this.mStashedRecordedQuery=CC.deepClone(c);var d=function(e){e=server_proxy()._parseSearchResultsAndStoreEntities(e);var f=(a||0)+e.length+1;if(e.length<b)f-=1;e.length==b&&e.pop();return this.didPaginate(e,a||0,f)}.bind(this);
server_proxy().entitiesForSearchQueryWithOptions(c,undefined,d,this.didPaginate.bind(this))},didPaginate:function(a,b,c){this.paginationState={previousResults:a||[],startIndex:b||0,total:c||0};this.items=this.items.concat(a);globalNotificationCenter().publish(CC.DID_UPDATE_PAGINATING_LIST_VIEW,this);if(this._paginationDoneCallback){this._paginationDoneCallback();delete this._paginationDoneCallback}},totalItems:function(){return this.paginationState&&this.paginationState.total},didReceivePaginationRequest:function(a){this._paginationDoneCallback=
a;this.paginate(a)}};iAd.Class({name:"iAd.SegmentedControl",superclass:iAd.Control,synthesizedProperties:["width","segmentedControlStyle","numberOfSegments","selectedSegmentIndex","momentary"],archivedProperties:["segmentedControlStyle","selectedSegmentIndex","momentary"],cssClassName:"ad-segmented-control",collectionAccessor:"segmentedControls"});iAd.SegmentedControl.cachedCanvasBackgroundImages=[];iAd.SegmentedControl.NO_SEGMENT=-1;iAd.SegmentedControl.STYLE_PLAIN="ad-plain";
iAd.SegmentedControl.STYLE_BORDERED="ad-bordered";iAd.SegmentedControl.STYLE_BAR="ad-bar";iAd.SegmentedControl.STYLE_BAR_BLACK="ad-bar-black";iAd.SegmentedControl.STYLE_BAR_POPOVER="ad-bar-popover";iAd.SegmentedControl.SEGMENT_SELECTED_CSS="ad-selected";iAd.SegmentedControl.SEGMENT_MOMENTARY_SELECTION_TIMER=0.2;
iAd.SegmentedControl.prototype.init=function(a,b){this._width=0;this._segmentedControlStyle="";this._numberOfSegments=0;this._selectedSegmentIndex=iAd.SegmentedControl.NO_SEGMENT;this._momentary=false;this.canvasBackgroundImage=null;this.hasBarStyle=false;this.callSuper(a);b!=undefined&&iAd.Utils.objectIsArray(b)&&this.populateWithItems(b)};iAd.SegmentedControl.prototype.createLayer=function(){this.callSuper();this.segmentedControlStyle=iAd.SegmentedControl.STYLE_PLAIN};
iAd.SegmentedControl.prototype.readPropertiesFromLayerComputedStyle=function(a){this.callSuper(a);this.segmentedControlStyle=this.layer.hasClassName(iAd.SegmentedControl.STYLE_BORDERED)?iAd.SegmentedControl.STYLE_BORDERED:this.layer.hasClassName(iAd.SegmentedControl.STYLE_BAR)?iAd.SegmentedControl.STYLE_BAR:this.layer.hasClassName(iAd.SegmentedControl.STYLE_BAR_BLACK)?iAd.SegmentedControl.STYLE_BAR_BLACK:iAd.SegmentedControl.STYLE_PLAIN};
iAd.SegmentedControl.prototype.setSize=function(a){a.height=this.hasBarStyle?30:44;this.callSuper(a);this.updateLayout()};iAd.SegmentedControl.prototype.layerWasInsertedIntoDocument=function(){this.callSuper();this.updateLayout();if(this.isInBar()&&this.superview.isInPopover)this.segmentedControlStyle=iAd.SegmentedControl.STYLE_BAR_POPOVER};
iAd.SegmentedControl.prototype.didAddSubview=function(a){this.updateLayout();this._selectedSegmentIndex!=iAd.SegmentedControl.NO_SEGMENT&&a._indexInSuperviewSubviews<=this._selectedSegmentIndex&&this.selectedSegmentIndex++};iAd.SegmentedControl.prototype.willMoveToSuperview=function(a){if(iAd.Toolbar!=null&&a instanceof iAd.Toolbar)this.segmentedControlStyle=a.barStyle===iAd.Toolbar.STYLE_DEFAULT?iAd.SegmentedControl.STYLE_BAR:iAd.SegmentedControl.STYLE_BAR_BLACK};
iAd.SegmentedControl.prototype.isInBar=function(){var a=this.superview;if(iAd.NavigationBar!=null&&a instanceof iAd.NavigationBar||iAd.Toolbar!=null&&a instanceof iAd.Toolbar)return true;return false};iAd.SegmentedControl.prototype.getWidth=function(){return this.size.width};iAd.SegmentedControl.prototype.setWidth=function(a){this.size=new iAd.Size(a,0)};
iAd.SegmentedControl.prototype.setSegmentedControlStyle=function(a){if(a){this.hasBarStyle=!(a===iAd.SegmentedControl.STYLE_PLAIN||a===iAd.SegmentedControl.STYLE_BORDERED);this.layer.removeClassName(this._segmentedControlStyle);this.layer.addClassName(a);this._segmentedControlStyle=a;this.updateCanvasBackgroundImage();this.width=this.width;this.updateAllSegmentBackgrounds()}};iAd.SegmentedControl.prototype.getNumberOfSegments=function(){return this.subviews.length};
iAd.SegmentedControl.prototype.setSelectedSegmentIndex=function(a){if(!(a==null||a<-1||a>=this.subviews.length||a==this._selectedSegmentIndex)){if(this._selectedSegmentIndex!=iAd.SegmentedControl.NO_SEGMENT&&this._selectedSegmentIndex>=0&&this._selectedSegmentIndex<this.subviews.length){var b=this.subviews[this._selectedSegmentIndex];b.layer.removeClassName(iAd.SegmentedControl.SEGMENT_SELECTED_CSS);b.drawBackgroundCanvas(this._selectedSegmentIndex,this.subviews.length,false)}if(a!=iAd.SegmentedControl.NO_SEGMENT){b=
this.subviews[a];b.layer.addClassName(iAd.SegmentedControl.SEGMENT_SELECTED_CSS);b.drawBackgroundCanvas(a,this.subviews.length,true)}this._selectedSegmentIndex=a;if(!this._momentary||a!=iAd.SegmentedControl.NO_SEGMENT)this.createAndDispatchEvent(iAd.Control.VALUE_CHANGE_EVENT)}};iAd.SegmentedControl.prototype.setMomentary=function(a){if(this._momentary!=a){this._momentary=a;this.selectedSegmentIndex=iAd.SegmentedControl.NO_SEGMENT}};
iAd.SegmentedControl.prototype.updateCanvasBackgroundImage=function(){var a="";if(iAd.Device.IS_IPAD&&this._segmentedControlStyle===iAd.SegmentedControl.STYLE_BAR||this._segmentedControlStyle===iAd.SegmentedControl.STYLE_BAR_POPOVER)a="~ipad";a=iAd.Path.assetsPath+"segmented-control-"+this._segmentedControlStyle.substr(3)+a+".png";if(!(this.canvasBackgroundImage!=null&&a==this.canvasBackgroundImage.url)){for(var b=iAd.SegmentedControl.cachedCanvasBackgroundImages,c=null,d,e=0,f=b.length;e<f;e++){d=
b[e];if(d.url==a){c=d;break}}if(c!=null)this.canvasBackgroundImage=c;else{this.canvasBackgroundImage=iAd.Image.imageForURL(a,true);this.canvasBackgroundImage.loaded||this.canvasBackgroundImage.addPropertyObserver("loaded",this,"canvasBackgroundImageDidLoad")}}};iAd.SegmentedControl.prototype.canvasBackgroundImageDidLoad=function(a){var b=iAd.SegmentedControl.cachedCanvasBackgroundImages;b.indexOf(a)==-1&&b.push(a);a===this.canvasBackgroundImage&&this.updateAllSegmentBackgrounds()};
iAd.SegmentedControl.prototype.populateWithItems=function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d instanceof iAd.Image)this.insertSegmentWithImageAtIndexAnimated(d,this.numberOfSegments,false);else iAd.Utils.objectIsString(d)&&this.insertSegmentWithTitleAtIndexAnimated(d,this.numberOfSegments,false)}this.updateLayout()};
iAd.SegmentedControl.prototype.updateLayout=function(){if(!(this.size.width<=0)){for(var a=0,b=0,c=0,d=this.subviews.length;c<d;c++){var e=this.subviews[c];if(e.width>0)a+=e.width;else b++}a=Math.round(b>0?(this.size.width-a)/b:0);b=this.hasBarStyle?6:10;var f=-b;for(c=0;c<d;c++){e=this.subviews[c];var g=e.width==0?a:e.width;e.setLayerStyle({left:f+"px"});if(c==d-1)g=this.size.width-f-b;this.setActualWidthForSegmentAtIndex(g,c);f+=g;e.drawBackgroundCanvas(c,d,c==this._selectedSegmentIndex)}}};
iAd.SegmentedControl.prototype.updateAllSegmentBackgrounds=function(){for(var a=this.subviews,b=0,c=a.length;b<c;b++)a[b].drawBackgroundCanvas(b,a.length,b==this._selectedSegmentIndex)};iAd.SegmentedControl.prototype.setImageForSegmentAtIndex=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length-1);this.subviews[b].image=a};iAd.SegmentedControl.prototype.imageForSegmentAtIndex=function(a){a=Math.min(a,this.subviews.length-1);return a>=0?this.subviews[a].image:null};
iAd.SegmentedControl.prototype.setTitleForSegmentAtIndex=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length-1);this.subviews[b].title=a};iAd.SegmentedControl.prototype.titleForSegmentAtIndex=function(a){a=Math.min(a,this.subviews.length-1);return a>=0?this.subviews[a].title:null};
iAd.SegmentedControl.prototype.insertSegmentWithImageAtIndexAnimated=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length);var c=new iAd.Segment;this.insertSubviewAtIndex(c,b);this.setImageForSegmentAtIndex(a,b);c.drawBackgroundCanvas(b,this.subviews.length,false)};
iAd.SegmentedControl.prototype.insertSegmentWithTitleAtIndexAnimated=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length);var c=new iAd.Segment;this.insertSubviewAtIndex(c,b);this.setTitleForSegmentAtIndex(a,b);c.drawBackgroundCanvas(b,this.subviews.length,false)};
iAd.SegmentedControl.prototype.removeSegmentAtIndexAnimated=function(a){a=iAd.Number.clampValue(a,0,this.subviews.length-1);if(!(a>=this.subviews.length)){this.subviews[a].removeFromSuperview();this.updateLayout();if(this._selectedSegmentIndex!=iAd.SegmentedControl.NO_SEGMENT)if(a<this._selectedSegmentIndex)this.selectedSegmentIndex--;else if(a==this._selectedSegmentIndex)this.selectedSegmentIndex=iAd.SegmentedControl.NO_SEGMENT}};iAd.SegmentedControl.prototype.removeAllSegments=function(){for(;this.subviews.length;)this.subviews[0].removeFromSuperview()};
iAd.SegmentedControl.prototype.setWidthForSegmentAtIndex=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length-1);this.subviews[b].width=a;this.setActualWidthForSegmentAtIndex(a,b);this.updateLayout()};iAd.SegmentedControl.prototype.widthForSegmentAtIndex=function(a){a=iAd.Number.clampValue(a,0,this.subviews.length-1);return this.subviews[a].width};
iAd.SegmentedControl.prototype.setActualWidthForSegmentAtIndex=function(a,b){b=iAd.Number.clampValue(b,0,this.subviews.length-1);this.subviews[b].size=new iAd.Size(a,this.size.height)};
iAd.SegmentedControl.prototype.touchesBegan=function(a){this.callSuper(a);this.selectedSegmentIndex=iAd.View.nearestViewForElement(a.target)._indexInSuperviewSubviews;if(this._momentary){var b=this;setTimeout(function(){b.selectedSegmentIndex=iAd.SegmentedControl.NO_SEGMENT},iAd.SegmentedControl.SEGMENT_MOMENTARY_SELECTION_TIMER*1E3)}};iAd.Class({name:"iAd.Segment",superclass:iAd.View,synthesizedProperties:["title","image"],archivedProperties:["title","image"],cssClassName:"ad-segment"});
iAd.Segment.canvasInstances=0;iAd.Segment.prototype.init=function(a){this._title="";this._image=null;this.width=0;this.callSuper(a)};iAd.Segment.prototype.layerWasCreated=function(){this.callSuper();this.label=this.layer.appendChild(document.createElement("span"));this.icon=this.layer.appendChild(document.createElement("img"));this.backgroundCanvasId="ad-segment-"+iAd.Segment.canvasInstances++;this.setLayerStyle({"background-image":"-webkit-canvas("+this.backgroundCanvasId+")"})};
iAd.Segment.prototype.setValueForAttribute=function(a,b){if(b=="ad-image")this.image=iAd.Image.imageForURL(a);else this.callSuper(a,b)};iAd.Segment.prototype.setSize=function(a){this.callSuper(a);this._image!=null&&this.positionImage()};iAd.Segment.prototype.setTitle=function(a){this._title=this.label.textContent=a};iAd.Segment.prototype.setImage=function(a){if(this._image=a){this.icon.src=a.resolvedURL;a.loaded?this.positionImage():a.addPropertyObserver("loaded",this)}else this.icon.src=""};
iAd.Segment.prototype.handlePropertyChange=function(){this.positionImage()};iAd.Segment.prototype.positionImage=function(){this.icon.style.left=(this.size.width-this._image.width)/2+"px";this.icon.style.top=(this.size.height-this._image.height)/2+"px"};
iAd.Segment.prototype.drawBackgroundCanvas=function(a,b,c){var d=this.superview.canvasBackgroundImage;if(!(d==null||!d.loaded)){d=d.element;var e=this.scaleFactor=iAd.Device.HAS_HIDPI_DISPLAY?2:1,f=this.size.width,g=this.size.height,i=this.superview.hasBarStyle,h=this.context=document.getCSSCanvasContext("2d",this.backgroundCanvasId,f*e,g*e);this.setLayerStyle({"background-size":f+"px "+g+"px"});h.clearRect(0,0,f*e,g*e);if(b==1){if(c)if(i){this.drawImage(d,0,0,6,g,0,0,6,g);this.drawImage(d,5,0,1,
g,6,0,f-12,g);this.drawImage(d,6,0,6,g,f-6,0,6,g)}else{this.drawImage(d,0,0,11,g,0,0,11,g);this.drawImage(d,27,0,1,g,11,0,f-22,g);this.drawImage(d,11,0,11,g,f-11,0,11,g)}}else if(a==0)if(i){if(c){this.drawImage(d,0,0,6,g,0,0,6,g);this.drawImage(d,5,0,1,g,6,0,f-6,g)}this.drawImage(d,12,0,1,g,f-1,0,1,g)}else{if(c){this.drawImage(d,0,0,11,g,0,0,11,g);this.drawImage(d,27,0,1,g,11,0,f-18,g);this.drawImage(d,28,0,6,g,f-7,0,6,g)}this.drawImage(d,34,0,1,g,f-1,0,1,g)}else if(a==b-1){if(c)if(i){this.drawImage(d,
5,0,1,g,0,0,f-6,g);this.drawImage(d,6,0,6,g,f-6,0,6,g)}else{this.drawImage(d,22,0,6,g,0,0,6,g);this.drawImage(d,27,0,1,g,6,0,f-17,g);this.drawImage(d,11,0,11,g,f-11,0,11,g)}}else if(i){c&&this.drawImage(d,5,0,1,g,0,0,f,g);this.drawImage(d,12,0,1,g,f-1,0,1,g)}else{if(c){this.drawImage(d,22,0,6,g,0,0,6,g);this.drawImage(d,27,0,1,g,6,0,f-13,g);this.drawImage(d,28,0,6,g,f-7,0,6,g)}this.drawImage(d,34,0,1,g,f-1,0,1,g)}}};
iAd.Segment.prototype.drawImage=function(a,b,c,d,e,f,g,i,h){var j=this.scaleFactor;this.context.drawImage(a,b*j,c*j,d*j,e*j,f*j,g*j,i*j,h*j)};iAd.Class({name:"WK.ButtonWithLabelView",superclass:iAd.View,cssClassName:"wk-button-with-label-view",synthesizedProperties:["labelText","buttonText"]});WK.ButtonWithLabelView.DEFAULT_HEIGHT=22;WK.ButtonWithLabelView.DEFAULT_BUTTON_WIDTH=100;WK.ButtonWithLabelView.MAX_WIDTH=256;
WK.ButtonWithLabelView.prototype.init=function(a){this._buttonText=this._labelText="";this.callSuper(a)};WK.ButtonWithLabelView.prototype.layerWasCreated=function(){this.callSuper();this.labelView=new iAd.Label;this.buttonView=new iAd.BarButton;this.addSubview(this.labelView);this.addSubview(this.buttonView);this.relayout();this.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false)};WK.ButtonWithLabelView.prototype.handleEvent=function(a){Event.stop(a)};
WK.ButtonWithLabelView.prototype.setLabelText=function(a){if(a&&a!=this._labelText){this._labelText=this.labelView.text=a;this.relayout()}};WK.ButtonWithLabelView.prototype.setButtonText=function(a){if(a&&a!=this._buttonText){this._buttonText=this.buttonView.title=a;this.relayout()}};
WK.ButtonWithLabelView.prototype.relayout=function(){var a=WK.ButtonWithLabelView.MAX_WIDTH/2,b=Math.min(iAd.CSS.widthForTextAndFont(this.labelView.text,"bold 13px Helvetica")+10,a);this.labelView.size=new iAd.Size(b,WK.ButtonWithLabelView.DEFAULT_HEIGHT);this.labelView.position=new iAd.Point(0,0);a=Math.min(a,WK.ButtonWithLabelView.DEFAULT_BUTTON_WIDTH);this.buttonView.size=new iAd.Size(a,WK.ButtonWithLabelView.DEFAULT_HEIGHT);this.buttonView.position=new iAd.Point(b,0);this.size=new iAd.Size(b+
a,WK.ButtonWithLabelView.DEFAULT_HEIGHT)};iAd.Class({name:"WK.FilterBarPopoverController",superclass:iAd.PopoverController,synthesizedProperties:["options","selectedOptionIndex"]});WK.FilterBarPopoverController.prototype.init=function(){this.delegate=null;this._options=[];this._selectedOptionIndex=0;var a=new iAd.ViewController;tableView=new iAd.TableView;tableView.tableStyle=iAd.TableView.STYLE_PLAIN;tableView.dataSource=this;tableView.delegate=this;a.view=tableView;return this.callSuper(a)};
WK.FilterBarPopoverController.prototype.showFromSourceViewAnimated=function(a,b){this.contentViewController.view.reloadData();this.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(a.frame,a.superview,iAd.PopoverController.ARROW_DIRECTION_UP,b)};WK.FilterBarPopoverController.prototype.setOptions=function(a){if(a&&a!=this._options){this._options=a;this.popoverContentSize=new iAd.Size(320,a.length*iAd.TableView.DEFAULT_ROW_HEIGHT-1)}};
WK.FilterBarPopoverController.prototype.tableViewNumberOfRowsInSection=function(){return this.options.length};WK.FilterBarPopoverController.prototype.tableViewCellForRowAtIndexPath=function(a,b){var c=a.dequeueReusableCell()||new iAd.TableViewCell,d=b.row;c.text=this.options[d];c.accessoryType=d==this.selectedOptionIndex?iAd.TableViewCell.ACCESSORY_CHECKMARK:iAd.TableViewCell.ACCESSORY_NONE;return c};
WK.FilterBarPopoverController.prototype.tableViewDidSelectRowAtIndexPath=function(a,b){a.deselectRowAtIndexPathAnimated(b,true);a.cellForRowAtIndexPath(b);var c=b.row;this.delegate&&this.delegate.filterBarPopoverDidChooseOption&&this.delegate.filterBarPopoverDidChooseOption(c);this.dismissPopoverAnimated(true)};iAd.Class({name:"WK.FilterBarCell",superclass:iAd.TableViewCell});
WK.FilterBarCell.prototype={init:function(){this.callSuper(null,iAd.TableViewCell.STYLE_CUSTOM)},layerWasCreated:function(){this.callSuper();this.filterBarView=this.addSubview(new WK.FilterBarView);this.filterBarView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.layer.classList.add("wk-filter-bar-cell")}};
iAd.Class({name:"WK.FilterBarView",superclass:iAd.View,cssClassName:"wk-filter-bar-view",synthesizedProperties:["hideFilterOptions","hideViewPreferenceSwitch","hideSortByOptions"]});WK.FilterBarView.DEFAULT_HEIGHT=75;WK.FilterBarView.DEFAULT_SWITCH_WIDTH=190;WK.FilterBarView.DEFAULT_SWITCH_SELECTED_INDEX=0;WK.FilterBarView.prototype.init=function(a,b){this.delegate=this;this.showingFiltersPopover=false;this.filterOptions=[];this.sortByOptions=[];this.filterKey=a;this.sortByKey=b;this.callSuper()};
WK.FilterBarView.prototype.layerWasCreated=function(){this.callSuper();this.filterButton=new WK.ButtonWithLabelView;this.filterButton.layer.addClassName("left");this.filterButton.labelText="_FilterBar.Filter.Label".loc();this.filterButton.buttonText="###";this.viewPreferenceSwitch=new iAd.SegmentedControl(null,["_FilterBar.Grid.Title".loc(),"_FilterBar.List.Title".loc()]);this.viewPreferenceSwitch.segmentedControlStyle=iAd.SegmentedControl.STYLE_BAR;this.viewPreferenceSwitch.selectedSegmentIndex=
WK.FilterBarView.DEFAULT_SWITCH_SELECTED_INDEX;this.viewPreferenceSwitch.width=WK.FilterBarView.DEFAULT_SWITCH_WIDTH;this.sortButton=new WK.ButtonWithLabelView;this.sortButton.layer.addClassName("right");this.sortButton.labelText="_FilterBar.SortBy.Label".loc();this.sortButton.buttonText="###";this.addSubview(this.filterButton);this.addSubview(this.viewPreferenceSwitch);this.addSubview(this.sortButton);this.addEventListener(iAd.View.TOUCH_DOWN_EVENT,this,false);this.viewPreferenceSwitch.addEventListener(iAd.Control.VALUE_CHANGE_EVENT,
this,false)};WK.FilterBarView.prototype.setFilterOptions=function(a,b){if(a&&this.filterOptions!=a){this.filterOptions=$A(a);var c=0;if(b)c=this.filterOptions.collect(function(d){return d[0]}).indexOf(b);if(this.filterOptions.length)this.filterButton.buttonText=this.filterOptions[c][1];if(this.filterOptions.length<=1)this.hideFilterOptions=true}};
WK.FilterBarView.prototype.setSortByOptions=function(a,b){if(a&&this.sortByOptions!=a){this.sortByOptions=$A(a);var c=0;if(b)c=this.sortByOptions.collect(function(d){return d[0]}).indexOf(b);if(this.sortByOptions.length)this.sortButton.buttonText=this.sortByOptions[c][1];if(this.sortByOptions.length<=1)this.hideSortByOptions=true}};WK.FilterBarView.prototype.setHideFilterOptions=function(a){this.filterButton.hidden=this._hideFilterOptions=a==true};
WK.FilterBarView.prototype.setHideViewPreferenceSwitch=function(a){this.viewPreferenceSwitch.hidden=this._hideViewPreferenceSwitch=a==true};WK.FilterBarView.prototype.setHideSortByOptions=function(a){this.sortButton.hidden=this._hideSortByOptions=a==true};
WK.FilterBarView.prototype.handleEvent=function(a){var b=a.ad.sender;if(a.type==iAd.Control.VALUE_CHANGE_EVENT&&b==this.viewPreferenceSwitch)this.delegate&&this.delegate.didChooseViewPreference&&this.delegate.didChooseViewPreference(this.viewPreferenceSwitch.selectedSegmentIndex);else if(a.type==iAd.View.TOUCH_DOWN_EVENT&&(b==this.filterButton.buttonView||b==this.sortButton.buttonView)){if(b==this.filterButton.buttonView){a=this.filterOptions;this.showingFiltersPopover=true}else{a=this.sortByOptions;
this.showingFiltersPopover=false}a=a.collect(function(c){return c[1]});if(!this.popover){this.popover=new WK.FilterBarPopoverController;this.popover.delegate=this}this.popover.options=a;this.popover.selectedOptionIndex=a.indexOf(b==this.filterButton.buttonView?this.filterButton.buttonText:this.sortButton.buttonText);this.popover.showFromSourceViewAnimated(b,true)}};
WK.FilterBarView.prototype.filterBarPopoverDidChooseOption=function(a){if(this.showingFiltersPopover){this.filterButton.buttonText=this.filterOptions[a][1];this.delegate&&this.delegate.didChooseFilter&&this.delegate.didChooseFilter(this.filterOptions[a][0])}else{this.sortButton.buttonText=this.sortByOptions[a][1];this.delegate&&this.delegate.didChooseSortKey&&this.delegate.didChooseSortKey(this.sortByOptions[a][0])}};WK.FilterBarView.prototype.didChooseFilter=function(){};
WK.FilterBarView.prototype.didChooseViewPreference=function(){};WK.FilterBarView.prototype.didChooseSortKey=function(){};iAd.Class({name:"WK.GridRow",superclass:iAd.TableViewCell,synthesizedProperties:["cells","selectedCellIndex"],cssClassName:"wk-grid-row",collectionAccessor:"gridRows"});WK.GridRow.prototype.init=function(a){this._cells=[];this._selectionStyle=iAd.TableViewCell.SELECTION_STYLE_NONE;this.callSuper(a,iAd.TableViewCell.STYLE_CUSTOM)};
WK.GridRow.prototype.prepareForReuse=function(){this.callSuper();this.cells.forEach(function(a){a.removeFromSuperview()});this.cells=[]};WK.GridRow.prototype.setCells=function(a){for(var b=0;b<a.length;b++){a[b].size=new iAd.Size(WK.DocumentGridCell.CELL_WIDTH,WK.DocumentGridCell.CELL_HEIGHT);a[b].position=new iAd.Point(b*WK.DocumentGridCell.CELL_WIDTH,0);this.addSubview(a[b])}this._cells=a};WK.GridRow.prototype.selectedCell=function(){return this._cells[this._selectedCellIndex]};
iAd.Class({name:"WK.GridCell",superclass:iAd.Control,cssClassName:"wk-grid-cell",collectionAccessor:"gridCells"});WK.GridCell.prototype.elementToAnimateFrom=function(){return this.layer};iAd.Class({name:"WK.PaginationGridCell",superclass:WK.GridCell,cssClassName:"wk-pagination-grid-cell"});WK.PaginationGridCell.CELL_WIDTH=256;WK.PaginationGridCell.CELL_HEIGHT=256;
WK.PaginationGridCell.prototype.init=function(a){this.callSuper(a,iAd.TableViewCell.STYLE_CUSTOM);a=new iAd.Label;a.text="_General.Load.More".loc();this.addSubview(a);this.size=new iAd.Size(WK.AvatarViewGridCell.CELL_WIDTH,WK.AvatarViewGridCell.CELL_HEIGHT);a.size=new iAd.Size(WK.AvatarViewGridCell.CELL_WIDTH,WK.AvatarViewGridCell.CELL_HEIGHT);a.verticalAlignment=iAd.Label.VERTICAL_ALIGNMENT_MIDDLE};
iAd.Class({name:"WK.FavoriteTitleView",superclass:iAd.Control,synthesizedProperties:["isFavorite","title","guid"],cssClassName:"wk-favorite-title"});WK.FavoriteTitleView.prototype.init=function(a){this._isFavorite=false;this._guid=this._title="";this.callSuper(a)};
WK.FavoriteTitleView.prototype.layerWasCreated=function(){this.callSuper();this.favoriteLayer=Builder.node("a",{className:"cc-entity-favorite-toggle"+(this.isFavorite?" selected":""),"data-guid":this.guid,title:"_General.Favorite.Toggle.Title".loc()});this.titleLayer=Builder.node("h3",{className:"title ellipsis"},this.title);this.layer.appendChild(this.favoriteLayer);this.layer.appendChild(this.titleLayer);new CC.EntityFavoriteToggle(this.favoriteLayer);this.addEventListener(iAd.View.TOUCH_DOWN_EVENT,
this,false);this.addEventListener(iAd.View.TOUCH_DRAG_ENTER_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_DRAG_EXIT_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false)};WK.FavoriteTitleView.prototype.handleEvent=function(a){Event.stop(a)};WK.FavoriteTitleView.prototype.setTitle=function(a){this.titleLayer.innerHTML=this._title=a.escapeHTML();a=iAd.CSS.widthForTextAndFont(a,"bold 16px Helvetica")+64;a=Math.min(236,a);this.size=new iAd.Size(a,iAd.NavigationBar.DEFAULT_HEIGHT)};
WK.FavoriteTitleView.prototype.setIsFavorite=function(a){a==true?this.favoriteLayer.addClassName("selected"):this.favoriteLayer.removeClassName("selected");this._isFavorite=a};WK.FavoriteTitleView.prototype.setGuid=function(a){this.favoriteLayer.setAttribute("data-guid",this._guid=a)};iAd.Class({name:"WK.AvatarViewGridCell",superclass:WK.GridCell,synthesizedProperties:["guid","title","isFavorite","avatarGUID"],cssClassName:"wk-avatar-grid-cell"});WK.AvatarViewGridCell.CELL_WIDTH=256;
WK.AvatarViewGridCell.CELL_HEIGHT=244;WK.AvatarViewGridCell.prototype.init=function(a){this.callSuper(a,iAd.TableViewCell.STYLE_CUSTOM);this._guid=null;this._title="";this._isFavorite=false;this._avatarGUID=null};
WK.AvatarViewGridCell.prototype.layerWasCreated=function(){this.callSuper();this.avatarView=new WK.AvatarView;this.avatarView.style=WK.AvatarView.STYLE_LARGE;this.avatarView.avatarGUID=this.avatarGUID;this.avatarView.layer.classList.add("wk-horizontally-centered-item");this.favoriteTitleView=new WK.FavoriteTitleView;this.favoriteTitleView.layer.classList.add("wk-horizontally-centered-item");this.addSubview(this.avatarView);this.addSubview(this.favoriteTitleView)};
WK.GridCell.prototype.elementToAnimateFrom=function(){return this.avatarView.layer};WK.AvatarViewGridCell.prototype.setGuid=function(a){this.favoriteTitleView.setGuid(a)};WK.AvatarViewGridCell.prototype.setTitle=function(a){this.favoriteTitleView.setTitle(a)};WK.AvatarViewGridCell.prototype.setIsFavorite=function(a){this.favoriteTitleView.setIsFavorite(a)};WK.AvatarViewGridCell.prototype.setAvatarGUID=function(a){if(a&&this._avatarGUID!=a)this._avatarGUID=this.avatarView.avatarGUID=a};
iAd.Class({name:"WK.FavoriteClipView",superclass:iAd.Control,synthesizedProperties:["isFavorite","guid"],cssClassName:"wk-favorite-clip"});WK.FavoriteClipView.prototype.init=function(a){this._isFavorite=false;this._guid="";this.callSuper(a)};
WK.FavoriteClipView.prototype.layerWasCreated=function(){this.callSuper();this.layer=Builder.node("div",{href:"#",className:"cc-entity-favorite-toggle wk-favorite-clip"+(this.isFavorite?" selected":""),"data-guid":this.guid,title:"_General.Favorite.Toggle.Title".loc()});this.size=new iAd.Size(62,40);new CC.EntityFavoriteToggle(this.layer);this.addEventListener(iAd.View.TOUCH_DOWN_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_DRAG_ENTER_EVENT,this,false);this.addEventListener(iAd.View.TOUCH_DRAG_EXIT_EVENT,
this,false);this.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false)};WK.FavoriteClipView.prototype.handleEvent=function(a){Event.stop(a)};WK.FavoriteClipView.prototype.setIsFavorite=function(a){a==true?this.layer.addClassName("selected"):this.layer.removeClassName("selected");this._isFavorite=a};WK.FavoriteClipView.prototype.setGuid=function(a){this.layer.setAttribute("data-guid",this._guid=a)};
iAd.Class({name:"WK.DocumentGridCell",superclass:WK.GridCell,synthesizedProperties:["guid","type","thumbnailGUIDs","title","isFavorite","isStacked","themeInfo"],cssClassName:"wk-document-grid-cell"});WK.DocumentGridCell.CELL_WIDTH=256;WK.DocumentGridCell.CELL_HEIGHT=281;WK.DocumentGridCell.PREVIEW_IMAGE_WIDTH=154;WK.DocumentGridCell.PREVIEW_IMAGE_HEIGHT=199;WK.DocumentGridCell.THUMBNAIL_HEIGHT_INCLUDING_MARGIN=227;WK.DocumentGridCell.THEME_BAR_HEIGHT=100;WK.DocumentGridCell.LABEL_HEIGHT=44;
WK.DocumentGridCell.STYLE_STACKED="wk-document-grid-cell-stacked";WK.DocumentGridCell.prototype.init=function(a){this.callSuper(a,iAd.TableViewCell.STYLE_CUSTOM);this._guid=null;this._type="";this._thumbnailGUIDs=[];this._title="";this._isFavorite=false;this._themeInfo=this._isStacked=null};
WK.DocumentGridCell.prototype.layerWasCreated=function(){this.callSuper();this.wrappingPreviewImageView=new iAd.View;this.wrappingPreviewImageView.position=new iAd.Point(51,21);this.wrappingPreviewImageView.size=new iAd.Size(WK.DocumentGridCell.PREVIEW_IMAGE_WIDTH,WK.DocumentGridCell.PREVIEW_IMAGE_HEIGHT);this.wrappingPreviewImageView.layer.classList.add("wk-grid-preview");var a=Builder.node("div",{className:"wk-grid-preview-icon"}),b=Builder.node("div",{className:"wk-fake-header"});this.wrappingPreviewImageView.layer.appendChild(a);
this.wrappingPreviewImageView.layer.appendChild(b);this.addSubview(this.wrappingPreviewImageView);this.titleLabel=new iAd.Label;this.titleLabel.layer.classList.add("wk-grid-title");this.titleLabel.layer.classList.add("wk-horizontally-centered-item");this.titleLabel.size=new iAd.Size(WK.DocumentGridCell.CELL_WIDTH,WK.DocumentGridCell.LABEL_HEIGHT);this.addSubview(this.titleLabel);this.favoriteTitleView=new WK.FavoriteTitleView;this.favoriteTitleView.position=new iAd.Point(0,WK.DocumentGridCell.THUMBNAIL_HEIGHT_INCLUDING_MARGIN);
this.favoriteTitleView.layer.classList.add("wk-horizontally-centered-item");this.addSubview(this.favoriteTitleView);this.favoriteClipView=new WK.FavoriteClipView;this.favoriteClipView.position=new iAd.Point(40,128);this.addSubview(this.favoriteClipView)};WK.DocumentGridCell.prototype.elementToAnimateFrom=function(){return this.wrappingPreviewImageView.layer};
WK.DocumentGridCell.prototype.setGuid=function(a){this.favoriteTitleView.setGuid(a);this.favoriteClipView.setGuid(a);this._guid=a;globalNotificationCenter().subscribe(CC.WikiEditor.NOTIFICATION_DID_SAVE_PAGE_WITH_GUID,this.handlePageSavedNotificationForGUID.bind(this))};
WK.DocumentGridCell.prototype.resetPreviewImage=function(){var a,b=this.type=="com.apple.entity.File";if(b){if(this.thumbnailGUIDs&&this.thumbnailGUIDs.length>0){var c=this.thumbnailGUIDs[0];if(c)a="/wiki/files/download/%@".fmt(c)}}else if(this.guid)a="/__collabd/preview/download/%@/%@".fmt(this.guid,buildRandomString(16));if(a){c=this.wrappingPreviewImageView.layer.down(".wk-grid-preview-icon");if(b){c.style.backgroundSize="contain";c.style.backgroundPosition="0px 0px"}c.style.backgroundImage="url(%@)".fmt(a)}};
WK.DocumentGridCell.prototype.handlePageSavedNotificationForGUID=function(a,b,c){if(c&&c.entity&&c.guid)if(c.guid==this.guid||c.entity.parentGUIDs.indexOf(this.guid)>-1)setTimeout(this.resetPreviewImage.bind(this),2E4)};WK.DocumentGridCell.prototype.setTitle=function(a){this.favoriteTitleView.setTitle(a);this.titleLabel.text=a};WK.DocumentGridCell.prototype.setIsFavorite=function(a){this.favoriteTitleView.setIsFavorite(a);this.favoriteClipView.setIsFavorite(a)};
WK.DocumentGridCell.prototype.setIsStacked=function(a){if(a!=undefined&&this._isStacked!=a){this.layer.classList.add(WK.DocumentGridCell.STYLE_STACKED);this._isStacked=a}};WK.DocumentGridCell.prototype.setThemeInfo=function(a){a=(a||"").split(",");if(a.length==0||a&&!Object.isString(a[1]))a=["blue"];if(a&&a.length){var b=a[0],c,d;if(a.length>1)c=a[1];if(a.length>2)d=a[2];b&&this.wrappingPreviewImageView.layer.down(".wk-fake-header").setAttribute("data-theme-name",b);this._themeInfo=[b,c,d]}};
WK.DocumentGridCell.prototype.prepareForReuse=function(){this.callSuper();this.title=this.guid=null;this.isFavorite=false;this.favoriteTitleView=this.isStacked=null};iAd.Class({name:"WK.GridTableView",superclass:iAd.View,synthesizedProperties:["useFlatList","delegate"],cssClassName:"wk-grid-table-view",collectionAccessor:"gridTableViews"});WK.GridTableView.GRID_CELL="WK.GridTableView.GRID_CELL";WK.GridTableView.TABLE_CELL="WK.GridTableView.TABLE_CELL";
WK.GridTableView.TOTAL_NUMBER_OF_CELLS_IN_SECTION="totalNumberOfCellsInSection";WK.GridTableView.DID_RECEIVE_PAGINATION_REQUEST="didReceivePaginationRequest";WK.GridTableView.FILTER_ROW_HEIGHT=80;WK.GridTableView.PADDING_FOR_LIST_MODE=18;WK.GridTableView.ROW_HEIGHT_FOR_LIST_MODE=71;
WK.GridTableView.prototype={init:function(a){this._useFlatList=false;this._emptyPlaceholderString=a||"_General.No.Results.Found".loc();this._loadingPlaceholderString="_General.Loading".loc();this.paginationCellsIndexes=[];this.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.callSuper(null)},layerWasCreated:function(){this.callSuper();this.layer.classList.add("wk-grid-table-view");this.tableView=new WK.TableViewWithFilter;this.tableView.filterHeight=
WK.GridTableView.FILTER_ROW_HEIGHT-24;this.tableView.dataSource=this;this.tableView.delegate=this;this.configureTableView();this.tableView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.addSubview(this.tableView);this.emptyPlaceholderLabel=new iAd.Label;this.emptyPlaceholderLabel.text=this._loadingPlaceholderString;this.emptyPlaceholderLabel.layer.classList.add("wk-empty-placeholder");this.emptyPlaceholderLabel.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|
iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.emptyPlaceholderLabel.hidden=true;this.addSubview(this.emptyPlaceholderLabel)},setUseFlatList:function(a){this._useFlatList=a;this.configureTableView();this.reloadData()},configureTableView:function(){this.tableView.tableStyle=this.useFlatList?iAd.TableView.STYLE_PLAIN:iAd.TableView.STYLE_CUSTOM;var a=this.useFlatList?WK.GridTableView.PADDING_FOR_LIST_MODE:0;this.tableView._size=new iAd.Size(window.innerWidth-2*a,this.tableView.size.height||0);this.tableView.position=
new iAd.Point(a,0)},tableViewHeightForRowAtIndexPath:function(a,b){if(b.row==0)return WK.GridTableView.FILTER_ROW_HEIGHT;if(this.useFlatList)return WK.GridTableView.ROW_HEIGHT_FOR_LIST_MODE;return WK.DocumentGridCell.CELL_HEIGHT},setSize:function(a){this.callSuper(a);this.useFlatList||this.reloadData()},reloadData:function(){this._dataLoadedAtLeastOnce=true;this.paginationCellsIndexes=[];this.tableView.reloadData()},animationOriginRect:function(){var a=this.tableView.indexPathForSelectedRow();if(!a)return null;
a=this.tableView.cellForRowAtIndexPath(a);if(!a)return null;a=this.useFlatList?a.elementToAnimateFrom():a.selectedCell().elementToAnimateFrom();a=Element.viewportOffset(a);a=new iAd.Point(a.left,a.top-iAd.NavigationBar.DEFAULT_HEIGHT);var b=this.useFlatList?new iAd.Size(32,32):new iAd.Size(WK.DocumentGridCell.PREVIEW_IMAGE_WIDTH,WK.DocumentGridCell.PREVIEW_IMAGE_HEIGHT);return new iAd.Rect(a.x,a.y,b.width,b.height)},maxCellsPerRow:function(){return this.useFlatList?1:Math.floor(this.size.width/WK.DocumentGridCell.CELL_WIDTH)},
numberOfCellsForSection:function(a){var b=this.delegate.numberOfCellsInSection(a);if(this.shouldShowPaginationControlForSection(a)){this.paginationCellsIndexes[a]=b;b+=1}return b},shouldShowPaginationControlForSection:function(a){if(!iAd.Utils.objectHasMethod(this.delegate,WK.GridTableView.TOTAL_NUMBER_OF_CELLS_IN_SECTION))return false;return this.delegate[WK.GridTableView.TOTAL_NUMBER_OF_CELLS_IN_SECTION](a)>this.delegate.numberOfCellsInSection(a)},isPaginationCellAtRealPath:function(a){return this.paginationCellsIndexes.length&&
this.paginationCellsIndexes[a.section]==a.row},tableViewNumberOfRowsInSection:function(a,b){var c=this.numberOfCellsForSection(b);if(c==0){this.showEmptyPlaceholderString(true);return 0}else{this.showEmptyPlaceholderString(false);return Math.ceil(c/this.maxCellsPerRow())+1}},showEmptyPlaceholderString:function(a){this.emptyPlaceholderLabel.hidden=!a;this.emptyPlaceholderLabel.text=this._dataLoadedAtLeastOnce?this._emptyPlaceholderString:this._loadingPlaceholderString;this.tableView.hidden=a},tableViewCellForRowAtIndexPath:function(a,
b){var c;if(b.row==0){c=a.dequeueReusableCellWithIdentifier("WK.FilterBarCell")||new WK.FilterBarCell;c.filterBarView.delegate=this;c.filterBarView.hideFilterOptions=c.filterBarView.hideSortByOptions=true;c.filterBarView.viewPreferenceSwitch.selectedSegmentIndex=this.useFlatList?1:0}else{var d=new iAd.IndexPath(b.section,b.row-1);if(this.useFlatList)if(this.isPaginationCellAtRealPath(d))c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellForEntityList")||new WK.TableViewCellForEntityList(WK.TableViewCellForEntityList.STYLE_LOAD_MORE);
else{c=a.dequeueReusableCellWithIdentifier("WK.TableViewCellForEntityList")||new WK.TableViewCellForEntityList(WK.TableViewCellForEntityList.STYLE_DEFAULT);h=this.delegate.dataForCellAtIndexPath(d);c.text=WK.FormatterUtilities.displayNameForEntity(h);c.detailedText="_General.LastActivity.Format".loc(globalLocalizationManager().localizedDateTime(h.lastActivityTime||h.createTime));c.image=WK.FormatterUtilities.iconImageForEntity(h,false,32,32);c.imageView.autoSized=false;c.imageView.size=new iAd.Size(32,
32);c.isFavorite=h.isFavorite;c.description=h.description||null;c.guid=h.guid;if(d.row==0)c.looksLikeFirstRow=true}else{c=a.dequeueReusableCellWithIdentifier("WK.GridRow")||new WK.GridRow;var e=this.numberOfCellsForSection(d.section);h=this.maxCellsPerRow();e=(d.row+1)*h<=e?h:e%h;for(var f=[],g=new iAd.IndexPath(d.section,d.row*h),i=0;i<e;i++){if(this.isPaginationCellAtRealPath(g))d=a.dequeueReusableCellWithIdentifier("WK.PaginationGridCell")||new WK.PaginationGridCell;else{var h=this.delegate.dataForCellAtIndexPath(g),
j=h.type;d=j=="com.apple.entity.User"?a.dequeueReusableCellWithIdentifier("WK.AvatarViewGridCell")||new WK.AvatarViewGridCell:a.dequeueReusableCellWithIdentifier("WK.DocumentGridCell")||new WK.DocumentGridCell;d.guid=h.guid;d.type=h.type;d.title=WK.FormatterUtilities.displayNameForEntity(h);d.isFavorite=h.isFavorite;if(j=="com.apple.entity.User")d.avatarGUID=h.avatarGUID;else{if(j=="com.apple.entity.Wiki"){d.isStacked=true;d.themeInfo=h.themeInfo}d.thumbnailGUIDs=h.thumbnailGUIDs;d.resetPreviewImage()}}d.tag=
g.row;d.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);f.push(d);g.row+=1}c.cells=f}}c.selectionStyle=iAd.TableViewCell.SELECTION_STYLE_NONE;return c},handleEvent:function(a){this.callSuper(a);if(a.type==iAd.View.TOUCH_UP_INSIDE_EVENT)if(!this.useFlatList){a=a.ad.sender.tag;var b=Math.floor(a/this.maxCellsPerRow()),c=a%this.maxCellsPerRow();b=this.tableView.cellForRowAtIndexPath(new iAd.IndexPath(0,1+b));var d=b.cells[c];b.setSelectedCellIndex(c);this.didSelectCellAtRealPath(d,new iAd.IndexPath(0,
a))}},tableViewDidSelectAccessoryForRowAtIndexPath:function(a,b){if(b==0||!this.useFlatList)logger.error("Info buttons are only expected in regular list rows");var c=this.delegate.dataForCellAtIndexPath(new iAd.IndexPath(b.section,b.row-1)).description,d=a.cellForRowAtIndexPath(b).accessory,e=new iAd.View(Builder.node("div",{style:"padding: 10px; white-space: pre-wrap"},c));c=new iAd.ScrollView;c.addSubview(e);c.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;
e=new iAd.ViewController;e.contentSizeForViewInPopover=new iAd.Size(320,200);e.view=c;if(this.popover)this.popover.contentViewController=e;else this.popover=new iAd.PopoverController(e);this.popover.presentPopoverFromRectInViewPermittedArrowDirectionsAnimated(d.frame,d.superview,iAd.PopoverController.ARROW_DIRECTION_ANY,true)},tableViewDidSelectRowAtIndexPath:function(a,b){if(b.row==0)this.tableView.deselectRowAtIndexPathAnimated(b,false);else if(this.useFlatList){var c=new iAd.IndexPath(b.section,
b.row-1);this.didSelectCellAtRealPath(a.cellForRowAtIndexPath(c),c)}},didSelectCellAtRealPath:function(a,b){var c=function(){a.isLoading=false};this.isPaginationCellAtRealPath(b)?this.delegate.didReceivePaginationRequest(c):this.delegate.didSelectCellAtIndexPath(b,c)},deselectSelectedCell:function(){this.tableView.deselectRowAtIndexPathAnimated(this.tableView.indexPathForSelectedRow(),true)},didChooseFilter:function(){},didChooseViewPreference:function(a){a=a==1;if(this.useFlatList!=a)this.useFlatList=
a},didChooseSortKey:function(){}};iAd.Class({name:"WK.EntityListViewController",superclass:WK.TopLevelViewController,synthesizedProperties:["parentEnt","dataSource"]});
WK.EntityListViewController.prototype={init:function(a){this.callSuper();this._parentEnt=a;this._dataSource=new WK.PaginatingDataSource(this.searchTypes,this.searchFavorites,this.searchContainerGUID)},loadView:function(){this.callSuper();this.grid=new WK.GridTableView(this.emptyPlaceholderTitle);this.grid.delegate=this;this.grid.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.viewButton=new iAd.BarButton;this.viewButton.layer.setAttribute("aria-label",
"_Control.Filter.View".loc());this.viewButton.layer.setAttribute("name","_Control.Filter.View".loc());this.viewButton.title="_Control.Filter.View".loc()+": "+"_Control.Filter.View.All".loc();this.viewButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.grid.leftFilter=this.viewButton;this.showButton=new iAd.BarButton;this.showButton.layer.setAttribute("aria-label","_Control.Filter.Show".loc());this.showButton.layer.setAttribute("name","_Control.Filter.Show".loc());this.showButton.title=
"_Control.Filter.Show".loc()+": "+"_Control.Filter.Show.Everything".loc();this.showButton.addEventListener(iAd.View.TOUCH_UP_INSIDE_EVENT,this,false);this.grid.rightFilter=this.showButton;this.view=this.grid},animationOriginRect:function(){return this.grid.animationOriginRect()},itemsDidChange:function(){if(this.isViewLoaded()){this.grid.reloadData();this.grid.deselectSelectedCell()}},numberOfCellsInSection:function(){return this.dataSource.items.length},totalNumberOfCellsInSection:function(){return this.dataSource.totalItems()},
dataForCellAtIndexPath:function(a){return this.dataSource.items[a.row]},didReceivePaginationRequest:function(a){return this.dataSource.didReceivePaginationRequest(a)},viewWillAppear:function(a){this.callSuper(a);this._dataSource=new WK.PaginatingDataSource(this.searchTypes,this.searchFavorites,this.searchContainerGUID);this.dataSource.addPropertyObserver("items",this,"itemsDidChange");this.dataSource.paginate()},viewDidAppear:function(a){this.callSuper(a);this.grid.deselectSelectedCell()},handleEvent:function(a){this.callSuper(a);
a=a.ad.sender;if(a==this.viewButton)alert("View");else a==this.showButton&&alert("Show")}};iAd.Class({name:"WK.WikisViewController",superclass:WK.EntityListViewController});
WK.WikisViewController.prototype={searchTypes:["com.apple.entity.Wiki"],searchFavorites:false,searchContainerGUID:null,reusableViewControllerID:"WikisViewController",init:function(){this.callSuper();this.title="_General.All.Wikis".loc();this.emptyPlaceholderTitle="_General.No.Wikis.Found".loc()},didSelectCellAtIndexPath:function(a){a=CC.entityURL(this.dataSource.items[a.row],true);globalRouteHandler().routeURL(a)}};iAd.Class({name:"WK.TabBarController",superclass:iAd.TabBarController});
WK.TabBarController.prototype={init:function(a){this.callSuper();this.tabBar=new WK.TabBar(a);this.tabBar.delegate=this},loadView:function(){this.callSuper();this.hostView.size=new iAd.Size(this._view.size.width,this._view.size.height-WK.TabBar.DEFAULT_HEIGHT);this.hostView.position=new iAd.Point(0,WK.TabBar.DEFAULT_HEIGHT);this.tabBar.position=new iAd.Point(0,0);this.tabBar.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_BOTTOM_MARGIN}};
iAd.Class({name:"WK.TabBar",superclass:iAd.TabBar});WK.TabBar.DEFAULT_HEIGHT=65;
WK.TabBar.prototype={init:function(a){this.entity=a;this.theme=a.themeInfo&&a.themeInfo.split(",")[0]||"blue";this.title=WK.FormatterUtilities.displayNameForEntity(a);this.callSuper()},layerWasCreated:function(){this.callSuper();this.layer.classList.add("wk-header");this.layer.dataset.themeName=this.theme;if(this.entity.type=="com.apple.entity.User"){var a=new WK.AvatarView;a.avatarGUID=this.entity.avatarGUID;a.style=WK.AvatarView.STYLE_SMALL;a.layer.classList.add("wk-vertically-centered-item");this.addSubview(a)}else{a=
new iAd.ImageView;a.autoSized=false;a.size=new iAd.Size(44,44);a.image=WK.FormatterUtilities.iconImageForEntity(this.entity,false,44,44);a.layer.classList.add("wk-vertically-centered-item");this.addSubview(a)}a=new iAd.Label;a.text=this.title;a.layer.classList.add("wk-vertically-centered-item");this.addSubview(a);this.slider=new iAd.View;this.slider.layer.classList.add("wk-header-slider");this.slider.layer.classList.add("wk-vertically-centered-item");this.addSubview(this.slider);this.sliderThumb=
new iAd.View;this.sliderThumb.layer.classList.add("wk-header-slider-thumb");this.slider.addSubview(this.sliderThumb);this.segmentedControl=new iAd.SegmentedControl;this.segmentedControl.momentary=true;this.segmentedControl.addEventListener(iAd.Control.VALUE_CHANGE_EVENT,this,false);this.slider.addSubview(this.segmentedControl)},setSize:function(a){a.height=WK.TabBar.DEFAULT_HEIGHT;iAd.View.prototype.setSize.apply(this,[a])},setItemsAnimated:function(a){this.segmentedControl.removeAllSegments();for(var b=
0;b<a.length;b++){var c=a[b].viewController.title;c!=WK.ContainerViewController.HIDDEN_TAB_IDENTIFIER&&this.segmentedControl.insertSegmentWithTitleAtIndexAnimated(c,b,false)}this.segmentedControl.setWidthForSegmentAtIndex(70,0);this.segmentedControl.setWidthForSegmentAtIndex(80,1);this.segmentedControl.setWidthForSegmentAtIndex(100,2);this.segmentedControl.setWidthForSegmentAtIndex(0,3);this.segmentedControl.width=250;if(a.length>4){this.segmentedControl.setWidthForSegmentAtIndex(90,4);this.segmentedControl.width=
340}this.segmentedControl.position=new iAd.Point(-1,0);this.slider.size=new iAd.Size(this.segmentedControl.width,23);this._items=a;if(this.selectedItem==null)this.selectedItem=a[0]},setSelectedItem:function(a){if(this._selectedItem!==a){for(var b=this.items.length-1;b>=0&&this.items[b].viewController.title!==a.viewController.title;)b--;var c=false;if(b==WK.ContainerViewController.TABS.HIDDEN_DOCUMENTS){c=true;b=WK.ContainerViewController.TABS.DOCUMENTS}this.segmentedControl._selectedSegmentIndex=
b;for(var d=0,e=0;e<b;e++)d+=this.segmentedControl.widthForSegmentAtIndex(e);this.sliderThumb.layer.style.webkitTransform=iAd.CSS.tm(d-1,0);this.sliderThumb.size=new iAd.Size(this.segmentedControl.widthForSegmentAtIndex(b),23);this._selectedItem=a;(a=this.superview&&this.superview._viewController)&&a.routes&&!c&&globalRouteHandler().routeURL(a.routes[b])}},handleEvent:function(a){iAd.View.prototype.handleEvent.apply(this,[a]);switch(a.type){case iAd.Control.VALUE_CHANGE_EVENT:this.selectedItem=this.items[this.segmentedControl.selectedSegmentIndex]}}};
iAd.Class({name:"WK.FileView",superclass:WK.HybridScrollView,cssClassName:"wk-file-view"});iAd.Class({name:"WK.FileViewController",superclass:WK.DocumentViewController});WK.FileViewController.prototype.deleteMenuTitle="_GearMenu.Delete.File.Title".loc();WK.FileViewController.prototype.replaceMenuTitle="_GearMenu.Replace.File.Title".loc();WK.FileViewController.prototype.loadContentViewController=function(){return new WK.FileContentViewController};
iAd.Class({name:"WK.FileContentViewController",superclass:iAd.ViewController,synthesizedProperties:["documentEntity"]});WK.FileContentViewController.prototype={loadView:function(){this.callSuper();var a=new CC.Mvc.ObjectController({mRecord:this.documentEntity}),b=new CC.Files.FileDetailView({mContent:a});a.mViewInstance=b;b._render();a=new WK.FileView;a.hybridDrawingLayer.appendChild(b.$());this.view=a}};iAd.Class({name:"WK.HybridPaginatingViewController",superclass:WK.TopLevelViewController});
WK.HybridPaginatingViewController.prototype.loadView=function(){this.callSuper();this.view=new iAd.ScrollView;this.hybridWrappingView=new iAd.View;this.hybridWrappingView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH|iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT;this.hybridPaginatingView=this.createHybridPaginatingView();this.hybridPaginatingView._render();this.hybridWrappingView.layer.appendChild(this.hybridPaginatingView.$());this.hybridWrappingView.position=new iAd.Point(0,WK.FilterBarView.DEFAULT_HEIGHT);
this.filterBarView=new WK.FilterBarView;this.filterBarView.hideViewPreferenceSwitch=true;this.filterBarView.size.height=WK.FilterBarView.DEFAULT_HEIGHT;this.filterBarView.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.filterBarView.position=new iAd.Point(0,0);this.filterBarView.delegate=this;globalNotificationCenter().subscribe(CC.DID_UPDATE_PAGINATING_LIST_VIEW,this.handleDidUpdatePaginatingListView.bind(this),this.hybridPaginatingView);this.view.addSubview(this.filterBarView);this.view.addSubview(this.hybridWrappingView)};
WK.HybridPaginatingViewController.prototype.viewWillAppear=function(){this.callSuper();this.updateSortAndFilterOptionsForFilterBarView()};
WK.HybridPaginatingViewController.prototype.updateSortAndFilterOptionsForFilterBarView=function(){var a=this.hybridPaginatingView.$().down(".cc-filter-bar-view"),b=a.down(".section.first").select(".button").collect(function(f){return[f.getAttribute("name"),f.innerHTML]}),c,d=a.down(".section.first .button");if(d)c=d.getAttribute("name");if(a=a.down(".section.first .selected"))c=a.getAttribute("name");this.filterBarView.setFilterOptions(b,c);b=[];if(c=this.hybridPaginatingView.mFilterBarView.mSortDirectionMenu)b=
c.menu.select(".button").collect(function(f){return[f.getAttribute("name"),f.innerHTML]});c=c.menu.down(".button.selected");var e;if(c)e=c.getAttribute("name");this.filterBarView.setSortByOptions(b,e)};WK.HybridPaginatingViewController.prototype.handleDidUpdatePaginatingListView=function(){this.updateContentViewSize();this.updateSortAndFilterOptionsForFilterBarView()};
WK.HybridPaginatingViewController.prototype.didRotateFromInterfaceOrientation=function(){setTimeout(this.updateContentViewSize.bind(this),CoreClientMobile.ORIENTATION_CHANGED_TIMEOUT_HACK_DURATION)};WK.HybridPaginatingViewController.prototype.updateContentViewSize=function(){var a=this.filterBarView.size.height,b=this.view.size.height,c=this.hybridPaginatingView.$().getHeight();a=Math.max(b,c)+a;if(c>b)a+=18;else a-=18;this.view.contentSize=new iAd.Size(this.view.size.width,a)};
WK.HybridPaginatingViewController.prototype.createHybridPaginatingView=function(){return new CC.PaginatingListView};WK.HybridPaginatingViewController.prototype.viewDidAppear=function(){this.view.setContentOffsetAnimated(new iAd.Point(0,WK.FilterBarView.DEFAULT_HEIGHT-18),true)};WK.HybridPaginatingViewController.prototype.didChooseFilter=function(a){this.hybridPaginatingView.mFilterBarView.setFilter(a)};WK.HybridPaginatingViewController.prototype.didChooseSortKey=function(a){this.hybridPaginatingView.mFilterBarView.setSortKey(a)};
iAd.Class({name:"WK.ActivityViewController",superclass:WK.HybridPaginatingViewController,synthesizedProperties:["scopingUserGUID","scopingContainerGUID"]});WK.ActivityViewController.prototype.init=function(){this.callSuper();this._scopingContainerGUID=this._scopingUserGUID=null;this.title="_Activity.All".loc()};
WK.ActivityViewController.prototype.createHybridPaginatingView=function(){var a=new CC.Activity.GroupedPaginatingActivityView;a.mScopingContainerGUID=this.scopingContainerGUID;a.mScopingUserGUID=this.scopingUserGUID;return a};WK.ActivityViewController.prototype.viewDidAppear=function(){this.hybridPaginatingView.paginate();this.callSuper()};WK.ActivityViewController.prototype.setScopingUserGUID=function(a){this.activityView.mScopingUserGUID=this._scopingUserGUID=a};
WK.ActivityViewController.prototype.setScopingContainerGUID=function(){this.activityView.mContainerUserGUID=this._scopingContainerGUID=inGUID};iAd.Class({name:"WK.ContainerActivityViewController",superclass:WK.ActivityViewController});WK.ContainerActivityViewController.prototype.init=function(a){this.callSuper();if(a.type=="com.apple.entity.Wiki")this._scopingContainerGUID=a.guid;if(a.type=="com.apple.entity.User")this._scopingUserGUID=a.guid;this.title="_Activity.ShortTitle".loc()};
iAd.Class({name:"WK.DocumentsViewController",superclass:WK.EntityListViewController});
WK.DocumentsViewController.prototype={init:function(a){parent||console.error("DocumentsViewController & subclasses expects a containerGUID");this.searchTypes=["com.apple.entity.File","com.apple.entity.Page"];this.searchFavorites=false;this.searchContainerGUID=a.guid;this.callSuper(a);this.title="_General.Documents".loc();this.emptyPlaceholderTitle="_General.Documents.None".loc()},didSelectCellAtIndexPath:function(a){a=this.dataSource.items[a.row];var b=a.tinyID;if(a.type=="com.apple.entity.Page")globalRouteHandler().routeURL("/wiki/pages/%@".fmt(b));
else a.type=="com.apple.entity.File"&&globalRouteHandler().routeURL("/wiki/files/%@".fmt(b))}};iAd.Class({name:"WK.FavoritesViewController",superclass:WK.EntityListViewController});
WK.FavoritesViewController.prototype={searchTypes:["com.apple.entity.User","com.apple.entity.Wiki","com.apple.entity.File","com.apple.entity.Page"],searchFavorites:true,searchContainerGUID:null,init:function(){this.callSuper();this.title="_General.Favorites".loc();this.emptyPlaceholderTitle="_General.No.Results.Found".loc()},didSelectCellAtIndexPath:function(a){a=this.dataSource.items[a.row];var b=a.tinyID;if(a.type=="com.apple.entity.Page")globalRouteHandler().routeURL("/wiki/pages/%@".fmt(b));else if(a.type==
"com.apple.entity.File")globalRouteHandler().routeURL("/wiki/files/%@".fmt(b));else if(a.type=="com.apple.entity.Wiki")globalRouteHandler().routeURL("/wiki/projects/%@".fmt(b));else a.type=="com.apple.entity.User"&&globalRouteHandler().routeURL("/wiki/people/%@".fmt(b))}};iAd.Class({name:"WK.ContainerViewController",superclass:WK.TopLevelViewController,synthesizedProperties:["containerEntity","selectedIndex","containerPermissions"]});
WK.ContainerViewController.TABS={PROFILE:0,ACTIVITY:1,DOCUMENTS:2,HIDDEN_DOCUMENTS:3,FAVORITES:4};WK.ContainerViewController.HIDDEN_TAB_IDENTIFIER="WK.ContainerViewController.HIDDEN_TAB_IDENTIFIER";
WK.ContainerViewController.prototype={homePageTitle:"For subclasses to implement",containerName:"For subclasses to implement",init:function(a,b,c){this.callSuper();a||logger().error("ContainerViewController expects a valid container entity to be passed to init");this._containerEntity=a;this.reusableViewControllerID=a.guid;this._selectedIndex=b||0;this._containerPermissions=c||{canRead:false,canWrite:false,owns:false};this.tabsViewController=new WK.TabBarController(this.containerEntity);b=[new WK.PageViewController(null,
this.homePageTitle,this.containerPermissions),new WK.ContainerActivityViewController(this.containerEntity),new WK.DocumentsViewController(this.containerEntity)];c=["/wiki/%@/%@".fmt(this.containerName,a.tinyID),"/wiki/%@/%@/activity".fmt(this.containerName,a.tinyID),"/wiki/%@/%@/documents".fmt(this.containerName,a.tinyID)];this.hiddenDocumentTab=new WK.PageViewController(null,null,this.containerPermissions);b.push(this.hiddenDocumentTab);c.push(undefined);if(this.containerEntity.guid==cachedCurrentUser.guid){b.push(new WK.FavoritesViewController(this.containerEntity));
c.push("/wiki/%@/%@/favorites".fmt(this.containerName,a.tinyID))}this.tabsViewController.viewControllers=b;this.routes=c;this.tabsViewController.delegate=this},loadView:function(){this.callSuper();this.tabsViewController.selectedIndex=this.selectedIndex;this.view=this.tabsViewController.view},setSelectedIndex:function(a){this._selectedIndex=a;this.tabsViewController.setSelectedIndex(a);this.tabsViewController.showSelectedViewController(this.tabsViewController.viewControllers[a])},configureDocumentEntity:function(a){if(a.isDetailPage)this.tabsViewController.viewControllers[0].documentEntity=
a;else{var b=this.tabsViewController.viewControllers;a=a.type=="com.apple.entity.Page"?new WK.PageViewController(a,null,this.containerPermissions):new WK.FileViewController(a,null,this.containerPermissions);this.hiddenDocumentTab=b[WK.ContainerViewController.TABS.HIDDEN_DOCUMENTS]=a;this.tabsViewController.viewControllers=b}},configurePageEntity:function(a){this.configureDocumentEntity(a)},configureFileEntity:function(a){this.configureDocumentEntity(a)},tabBarControllerDidSelectViewController:function(){WK.TopLevelViewController.prototype.navigationItemsDidChange.apply(this)},
additionalRightBarButtonItems:function(){if(this.tabsViewController.viewIsLoaded&&this.tabsViewController.selectedViewController.additionalRightBarButtonItems)return this.tabsViewController.selectedViewController.additionalRightBarButtonItems()},additionalGearMenuItems:function(){var a=[];if(this.tabsViewController.viewIsLoaded&&this.tabsViewController.selectedViewController.additionalGearMenuItems)a=this.tabsViewController.selectedViewController.additionalGearMenuItems()||[];return a}};
iAd.Class({name:"WK.WikiViewController",superclass:WK.ContainerViewController});
WK.WikiViewController.prototype={homePageTitle:"_General.Home".loc(),containerName:"projects",newDocumentMenuItem:function(){if(this.containerPermissions.canWrite)return{name:"_PlusMenu.NewPage.NewPageInWiki%@".loc(this.containerEntity.longName),callback:this.createNewDocumentInContainer.bind(this),args:this.containerEntity.guid}},uploadDocumentMenuItem:function(){if(this.containerPermissions.canWrite)return{name:"_PlusMenu.Project.File".loc(this.containerEntity.longName),callback:this.uploadNewDocumentInContainer.bind(this),
args:this.containerEntity.guid}},additionalGearMenuItems:function(){var a=[];if(this.tabsViewController.viewIsLoaded&&this.tabsViewController.selectedViewController.additionalGearMenuItems)a=this.tabsViewController.selectedViewController.additionalGearMenuItems()||[];if(this.containerPermissions.owns){a.push({name:"_GearMenu.Wiki.Settings".loc(),callback:this.showWikiSettings.bind(this)});a.push({name:"_GearMenu.Delete.Project.Title".loc(),callback:this.deleteWiki.bind(this)})}return a},showWikiSettings:function(){(new WK.WikiSettingsDialog(this.containerEntity)).showDialog()},
deleteWiki:function(){(new WK.DeleteDialog(this.containerEntity,this.containerPermissions.owns)).showDialog()}};iAd.Class({name:"WK.PeopleViewController",superclass:WK.EntityListViewController});
WK.PeopleViewController.prototype={searchTypes:["com.apple.entity.User"],searchFavorites:false,searchContainerGUID:null,reusableViewControllerID:"PeopleViewController",init:function(){this.callSuper();this.title="_General.All.People".loc();this.emptyPlaceholderTitle="_General.No.People.Found".loc()},didSelectCellAtIndexPath:function(a){a=this.dataSource.items[a.row].tinyID;globalRouteHandler().routeURL("/wiki/people/%@".fmt(a))}};iAd.Class({name:"WK.PersonViewController",superclass:WK.ContainerViewController});
WK.PersonViewController.prototype={homePageTitle:"_General.Profile".loc(),containerName:"people",loadView:function(){this.callSuper();this.view.layer.classList.add("wk-people-container")},additionalGearMenuItems:function(){var a=[];if(this.tabsViewController.viewIsLoaded&&this.tabsViewController.selectedViewController.additionalGearMenuItems)a=this.tabsViewController.selectedViewController.additionalGearMenuItems()||[];if(this.userPermissions.isAdmin)this._containerEntity.isHidden?a.push({name:"_GearMenu.User.Unhide".loc(),
callback:this.toggleHideUser.bind(this)}):a.push({name:"_GearMenu.User.Hide".loc(),callback:this.toggleHideUser.bind(this)});return a},toggleHideUser:function(a){a=!this._containerEntity.isHidden;document.removeEventListener(iAd.Event.START_EVENT,iAd.ScrollViewPanGestureRecognizer.handleEventProxy,true);var b=confirm((a?"_Dialogs.Hide.Person.Description":"_Dialogs.Unhide.Person.Description").loc());window.setTimeout(function(){document.addEventListener(iAd.Event.START_EVENT,iAd.ScrollViewPanGestureRecognizer.handleEventProxy,
true)},0);if(b)a?server_proxy().hideUserWithGUID(this._containerEntity.guid,function(){globalRouteHandler().routeURL("/wiki/people/")},function(){alert("_Error.Hide.Person.Permissions".loc())}):server_proxy().unhideUserWithGUID(this._containerEntity.guid,function(){this._containerEntity.isHidden=false}.bind(this),function(){logger().error("Could not unhide user")})}};iAd.Class({name:"WK.AllActivityViewController",superclass:WK.ActivityViewController});
WK.AllActivityViewController.prototype={reusableViewControllerID:"AllActivityViewController",init:function(){this.callSuper();this.title="_Activity.All".loc()}};iAd.Class({name:"WK.SearchResultsViewController",superclass:WK.HybridPaginatingViewController});
WK.SearchResultsViewController.prototype={reusableViewControllerID:"SearchResultsViewController",init:function(){this.callSuper();this._scopingContainerGUID=this._scopingUserGUID=null;this.title="_Search.Results".loc()},createHybridPaginatingView:function(){return new CC.Search.PaginatingSearchResultsView},additionalGearMenuItems:function(){return[]}};iAd.Class({name:"WK.ErrorViewController",superclass:WK.TopLevelViewController,synthesizedProperties:["message"]});
WK.ErrorViewController.prototype={reusableViewControllerID:"ErrorViewController",init:function(a,b){this.callSuper();this.title=a;this.message=b},loadView:function(){this.callSuper();var a=new iAd.Label;a.text=this.message;a.layer.classList.add("wk-empty-placeholder");a.autoresizingMask=iAd.View.AUTORESIZING_FLEXIBLE_HEIGHT|iAd.View.AUTORESIZING_FLEXIBLE_WIDTH;this.view=a}};
var homepageRoute=function(a){dialogManager().showProgressMessage("_General.Loading".loc());server_proxy().serverHomepageDocument(function(b,c){createOrReuseViewControllerWithName("ServerHomepageViewController",[b,c]);a.routeDidComplete();dialogManager().hide()},function(){logger().error("Could not fetch homepage in homepage route.");a.routeDidFail();dialogManager().hide()})},allActivityRoute=function(a){if(CC.meta("x-apple-config-DisableAllActivityView")=="true"){this.showErrorPage("","_Error.AllActivity.Disabled".loc());
a.routeDidComplete()}else createOrReuseViewControllerWithName("AllActivityViewController")?a.routeDidComplete():a.routeDidFail()},allProjectsRoute=function(a){if(CC.meta("x-apple-config-DisableAllProjectsView")=="true"){this.showErrorPage("","_Error.Projects.Disabled".loc());a.routeDidComplete()}else createOrReuseViewControllerWithName("WikisViewController")?a.routeDidComplete():a.routeDidFail()},allPeopleRoute=function(a){if(CC.meta("x-apple-config-DisableAllPeopleView")=="true"){this.showErrorPage("",
"_Error.People.Disabled".loc());a.routeDidComplete()}else createOrReuseViewControllerWithName("PeopleViewController")?a.routeDidComplete():a.routeDidFail()},searchRoute=function(a){var b=createOrReuseViewControllerWithName("SearchResultsViewController"),c=CC.params(a.url);CC.Search.setupFilterForQuery(b.hybridPaginatingView.mFilterBarView,c);a.routeDidComplete()},unimplementedRoute=function(a){alert("Route not yet implemented for URL (%@)".fmt(a.url));a.routeDidFail()},mypageRoute=function(a){var b=
a.url.match(/\/wiki\/mypage\/([^\/]*)/),c="";if(b&&b.length>0)c=b[1];if((b=cachedCurrentUser)&&b.tinyID){a.routeDidComplete();globalRouteHandler().routeURL("/wiki/people/%@/%@".fmt(b.tinyID,c))}else{logger().error("Could not find current user or current user tinyID to redirect to in mypage route");a.routeDidFail()}},pageRoute=function(a){dialogManager().showProgressMessage("_General.Loading".loc());var b=a.namedMatches.tinyID;server_proxy().documentWithContainerAndPermissionForID(b,function(c,d,e){server_proxy().markEntityAsRead(c.guid,
Prototype.emptyFunction,Prototype.emptyFunction);showContainerAtTabAndDocument(d,c&&c.isDetailPage?WK.ContainerViewController.TABS.PROFILE:WK.ContainerViewController.TABS.HIDDEN_DOCUMENTS,c,e);a.routeDidComplete();dialogManager().hide()},function(c){dialogManager().hide();var d="_General.Error.Unknown".loc();if(!c||c.type=="com.apple.EntityPlaceholder"){logger().error("Page could not be retrieved.");d=c.reason&&c.reason=="permission-denied"?"_General.Error.PermissionDenied".loc():"_General.Error.NotFound".loc()}else logger().error("Unknown error getting a page");
showErrorPage(d,d);a.routeDidFail()})},fileRoute=function(a){return pageRoute(a)},containerTabRoute=function(a){dialogManager().showProgressMessage("_General.Loading".loc());var b=a.namedMatches.tinyID,c=0,d=a.url.match(/wiki\/[^\/]*\/[^\/]*\/([^\/]*)/);if(d&&d.length>0){d=d[1];if(d=="activity")c=WK.ContainerViewController.TABS.ACTIVITY;else if(d=="documents"||d=="blog")c=WK.ContainerViewController.TABS.DOCUMENTS;else if(d=="favorites")c=WK.ContainerViewController.TABS.FAVORITES}server_proxy().detailPageWithContainerAndPermissionForID(b,
function(e,f,g){showContainerAtTabAndDocument(f,c,e,g);a.routeDidComplete();dialogManager().hide()},function(e){dialogManager().hide();var f="_General.Error.Unknown".loc();if(!e||e.type=="com.apple.EntityPlaceholder"){logger().error("Page could not be retrieved.");f=e&&e.reason&&e.reason=="permission-denied"?"_General.Error.PermissionDenied".loc():"_General.Error.NotFound".loc()}else logger().error("Unknown error getting a page");showErrorPage(f,f);a.routeDidFail()})},showContainerAtTabAndDocument=
function(a,b,c,d){if(a.type=="com.apple.entity.Wiki"||a.type=="com.apple.entity.User")createOrReuseViewControllerWithName(a.type=="com.apple.entity.Wiki"?"WikiViewController":"PersonViewController",[a,b,d],function(e){if(c)if(c.type=="com.apple.entity.File")e.configureFileEntity(c);else c.type=="com.apple.entity.Page"?e.configurePageEntity(c):logger().error("Could not process document entity in showContainerAtTabAndDocument %@".fmt(c.guid));e.selectedIndex=b})},showErrorPage=function(a,b){return createOrReuseViewControllerWithName("ErrorViewController",
[a,b],function(c){c.title=a;c.message=b})},createOrReuseViewControllerWithName=function(a,b,c){if(!a)return false;var d=window.WK[a],e=d.prototype.reusableViewControllerID||b[0].guid;if(a=mainDetailViewNavigationController.viewControllers.filter(function(f){return f.reusableViewControllerID==e})[0]){c&&c(a);prepareRouteAnimationsForDestinationViewController(a);mainDetailViewNavigationController.popToViewControllerAnimated(a,true)}else{a=function(){return d.apply(this,b)};a.prototype=d.prototype;a=
new a;c&&c(a);prepareRouteAnimationsForDestinationViewController(a);mainDetailViewNavigationController.pushViewControllerAnimated(a,true)}return a},prepareRouteAnimationsForDestinationViewController=function(a){var b=mainDetailViewNavigationController.topViewController;if(b){var c=b instanceof WK.EntityListViewController&&a instanceof WK.ContainerViewController,d=b instanceof WK.ContainerViewController&&a instanceof WK.EntityListViewController;if(c||d){a.isViewLoaded()||a.loadView();var e=c?b:a,f=
new iAd.Rect(window.innerWidth/2,window.innerHeight/2,100,100),g=e.animationOriginRect()||f;e=g.size.width/window.innerWidth;g=new iAd.Point(g.origin.x*(1+e),g.origin.y*(1+e));g={base:["zIndex",1,"anchorPoint",new iAd.Point(g.x/window.innerWidth,g.y/window.innerHeight)],properties:["transform","opacity"],from:["scale("+e+")","0"],to:["scale(1)","1"]};f={base:["zIndex",1,"anchorPoint",f],properties:["transform","opacity"],from:["scale(1)","1"],to:["scale("+e+")","0"]};if(c){b.wasTopItemTransition=
null;b.becomesBackItemTransition=null;a.becomesTopItemTransition=g;a.wasBackItemTransition=g}else if(d){b.wasTopItemTransition=f;b.becomesBackItemTransition=f;a.becomesTopItemTransition=null;a.wasBackItemTransition=null}}else{b.wasTopItemTransition=iAd.ViewController.TRANSITION_DISSOLVE_OUT;b.becomesBackItemTransition=iAd.ViewController.TRANSITION_DISSOLVE_OUT;a.becomesTopItemTransition=iAd.ViewController.TRANSITION_DISSOLVE_IN;a.wasBackItemTransition=iAd.ViewController.TRANSITION_DISSOLVE_IN;a.view.layer.style.webkitTransform=
""}}};globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_TITLE_ROUTE,containerTabRoute);globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_ROUTE,containerTabRoute);globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_BLOG_ROUTE,containerTabRoute);globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_FAVORITES_ROUTE,containerTabRoute);globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_DOCUMENTS_ROUTE,containerTabRoute);
globalRouteHandler().register(CC.Routes.WIKI_CONTAINER_TINYID_ACTIVITY_ROUTE,containerTabRoute);globalRouteHandler().register(CC.Routes.WIKI_SEARCH_ROUTE,searchRoute);globalRouteHandler().register(CC.Routes.WIKI_FILES_TINYID_TITLE_ROUTE,fileRoute);globalRouteHandler().register(CC.Routes.WIKI_FILES_TINYID_ROUTE,fileRoute);globalRouteHandler().register(CC.Routes.WIKI_PAGES_TINYID_TITLE_ROUTE,pageRoute);globalRouteHandler().register(CC.Routes.WIKI_PAGES_TINYID_ROUTE,pageRoute);
globalRouteHandler().register(CC.Routes.WIKI_MYPAGE_FAVORITES_ROUTE,mypageRoute);globalRouteHandler().register(CC.Routes.WIKI_MYPAGE_DOCUMENTS_ROUTE,mypageRoute);globalRouteHandler().register(CC.Routes.WIKI_MYPAGE_ACTIVITY_ROUTE,mypageRoute);globalRouteHandler().register(CC.Routes.WIKI_MYPAGE_ROUTE,mypageRoute);globalRouteHandler().register(CC.Routes.WIKI_PEOPLE_ROUTE,allPeopleRoute);globalRouteHandler().register(CC.Routes.WIKI_PROJECTS_ROUTE,allProjectsRoute);
globalRouteHandler().register(CC.Routes.WIKI_ACTIVITY_ROUTE,allActivityRoute);globalRouteHandler().register(CC.Routes.WIKI_HOMEPAGE_ROUTE,homepageRoute);iAd.Class({name:"CoreClientMobile",superclass:iAd.RootViewController});CoreClientMobile.ORIENTATION_CHANGED_TIMEOUT_HACK_DURATION=500;var mainSplitViewController,mainDetailViewNavigationController,sharedEditorViewController,cachedUserPermissions,cachedCurrentSession,cachedCurrentUser;
CoreClientMobile.prototype.init=function(){if(browser().isiPad()&&browser().isiOS5Plus()){iAd.Path.assetsPath=iAd.Path.resolveAbsolutePath("/__collabd/coreclientmobile/stylesheets/assets/");document.body.addClassName("ad-iPad mobilesafari");if(!iAd.Device.IS_IPAD)iAd.Device.IS_IPAD=true;this.callSuper();dialogManager().mProgressMessageDelay=100;dialogManager().mProgressMessageHideDelay=0;globalRouteHandler().mRouteAllLinks=true;globalRouteHandler().mRoutesTriggerReload=false;globalRouteHandler().mDefaultRoutesSetURLHash=
true;mainSplitViewController=new WK.LeftSidebarViewController({id:"wk-main-split-controller"});var a=new WK.NavigationSidebarViewController({id:"wk-navigation-sidebar"});a=new iAd.NavigationController(null,a);a.navigationBar.barStyle=iAd.NavigationBar.STYLE_BLACK;mainDetailViewNavigationController=new iAd.NavigationController;mainDetailViewNavigationController.navigationBar.barStyle=iAd.NavigationBar.STYLE_BLACK;mainSplitViewController.viewControllers=[a,mainDetailViewNavigationController];iAd.RootView.sharedRoot.addSubview(mainSplitViewController.view)}else window.location.href=
CC.getRouteFromURLHash()||"/wiki"};window.addEventListener(iAd.Device.iOS_VERSION?"orientationchange":"resize",function(){setTimeout(function(){iAd.RootView.sharedRoot.updateSize()},CoreClientMobile.ORIENTATION_CHANGED_TIMEOUT_HACK_DURATION)},true);
window.addEventListener("DOMContentLoaded",function(){sessions().currentOrNewSessionAsynchronously(false,function(a){if(a){cachedCurrentSession=a;cachedCurrentUser=a.user;server_proxy().permissionsForUser(function(b){cachedUserPermissions=b;window.appController=new CoreClientMobile;b=window.location.href;if(window.location.pathname!="/"&&!b.indexOf("#route=/")>-1)window.location.href=window.location.protocol+"//"+window.location.host+"/#route="+window.location.pathname;b=CC.getRouteFromURLHash();
if(!(b?globalRouteHandler().routeURL(b):globalRouteHandler().routeURL("/wiki"))){b="_General.Error.NotFound".loc();showErrorPage(b,b)}},function(){logger().error("Couldn't fetch permissions status for current user session")})}}.bind(this),function(){logger().error("Couldn't fetch session from server")})},false);
